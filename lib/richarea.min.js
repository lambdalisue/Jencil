/*!
 * Richarea - JavaScript contentEditable munipulate library v0.1.2
 *
 * Cross browser contentEditable iframe munipulator library written in CoffeeScript
 *
 * Author: Alisue (lambdalisue@hashnote.net)
 * License: MIT License.
 * Version: v0.1.2
 * Url: http://github.com/lambdalisue/Richarea
 * Date: Sat, 01 Oct 2011 06:26:25 GMT
 * References (ja):
 * - http://arinogotokuatumarite.blog19.fc2.com/blog-entry-101.html
 * - http://uhyohyohyo.sakura.ne.jp/javascript/8_3.html
 * References (en):
 * - http://msdn.microsoft.com/en-us/library/ms535872(v=VS.85).aspx
 * - http://www.quirksmode.org/dom/range_intro.html
 * - http://stackoverflow.com/questions/1223324/selection-startcontainer-in-ie
 * - http://stackoverflow.com/questions/4811822/get-a-ranges-start-and-end-offsets-relative-to-its-parent-container
 * - http://www.quirksmode.org/dom/execCommand.html
 * - http://stackoverflow.com/questions/3972014/get-caret-position-in-contenteditable-div
 */
(function(){var h,i,o,l,p,s,q,t,v,k,m=function(a,b){return function(){return a.apply(b,arguments)}},r=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};o=function(){function a(){this.browser=this.searchString(a.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"An unknown browser";this.OS=this.searchString(a.dataOS)||"An unknown OS"}a.prototype.searchString=function(b){var c,
a,e;for(a=0,e=b.length;a<e;a++)if(c=b[a],this.versionSearchString=c.versionSearch||c.identify,c.string!=null)if(c.string.indexOf(c.subString)!==-1)return c.identify;else if(c.prop)return c.identify;return[]};a.prototype.searchVersion=function(b){var c;c=b.indexOf(this.versionSearchString);return c===-1?void 0:parseFloat(b.substring(c+this.versionSearchString.length+1))};a.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identify:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",
versionSearch:"OmniWeb/",identify:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identify:"Safari",versionSearch:"Version"},{prop:window.opera,identify:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identify:"iCab"},{string:navigator.vendor,subString:"KDE",identify:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identify:"Firefox"},{string:navigator.vendor,subString:"Camino",identify:"Camino"},{string:navigator.userAgent,subString:"Netscape",identify:"Netscape"},
{string:navigator.userAgent,subString:"MSIE",identify:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identify:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identify:"Netscape",versionSearch:"Mozilla"}];a.dataOS=[{string:navigator.platform,subString:"Win",identify:"Windows"},{string:navigator.platform,subString:"Mac",identify:"Mac"},{string:navigator.userAgent,subString:"iPhone",identify:"iPhone/iPad"},{string:navigator.platform,subString:"Linux",
identify:"Linux"}];return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Detector=o;k=function(a,b){var c,d;for(d in b)c=b[d],a.prototype[d]=c;return a};if(typeof exports!=="undefined"&&exports!==null)exports.partial=k;i=function(){function a(){}a.findChildPosition=function(b){var c;for(c=0;b.previousSibling;)b=b.previousSibling,c+=1;return c};a.isDataNode=function(b){return b!=null&&b.nodeValue!=null&&b.data!=null};a.isDataContainerNode=function(b){var c,d,e;if(b.firstChild==null)return!1;
e=b.childNodes;for(c=0,d=e.length;c<d;c++)if(b=e[c],!a.isDataNode(b))return!1;return!0};a.isAncestorOf=function(b,c){var d,e,f;d=!a.isDataNode(b);e=typeof b.contains==="function"?b.contains(a.isDataNode(c)?c.parentNode:c):void 0;f=c.parentNode===b;return d&&(e||f)};a.isAncestorOrSelf=function(b,c){return a.isAncestorOf(b,c)||b===c};a.findClosestAncestor=function(b,c){if(a.isAncestorOf(b,c))for(;(c!=null?c.parentNode:void 0)!==b;)c=c.parentNode;return c};a.getNodeLength=function(b){if(a.isDataNode(b))return b.length||
b.childNodes.length};a.splitDataNode=function(b,c){var d;if(!a.isDataNode(b))return!1;d=b.cloneNode(!1);b.deleteData(c,b.length);d.deleteData(0,c);return b.parentNode.insertBefore(d,b.nextSibling)};return a}();q=function(){function a(){}a.convertToW3CRange=function(b,c){var a,e,f,g;a=function(b,a,d){var e,f,g,i,h;g=c.createElement("span");f=a.duplicate();f.collapse(d);i=f.parentElement();e=function(b,a){return b.compareEndPoints(d?"StartToStart":"StartToEnd",a)};h=function(){i.insertBefore(g,g.previousSibling);
return f.moveToElementText(g)};for(h();e(f,a)>0&&g.previousSibling;)h();if(e(f,a)===-1&&g.nextSibling)f.setEndPoint(d?"EndToStart":"EndToEnd",a),b[d?"setStart":"setEnd"](g.nextSibling,f.text.length);else b[d?"setStartBefore":"setEndBefore"](g);return g.parentNode.removeChild(g)};g=new t(c);e=b.compareEndPoints("StartToEnd",b)!==0;f=b.parentElement().isContentEditable;if(e&&f)a(g,b,!0),a(g,b,!1),g.startContainer===g.endContainer&&g.endOffset===1&&i.isDataContainerNode(g.startContainer)&&(a=i.getNodeLength(g.endContainer.firstChild),
g.setEnd(g.endContainer,a));else if(f)f=b.duplicate(),e=f.parentElement(),a=c.createElement("span"),e.insertBefore(a,e.firstChild),f.moveToElementText(a),f.setEndPoint("EndToEnd",b),f=f.text.length,g.setStart(e,f),g.setEnd(e,f),e.removeChild(a);return g};a.convertFromW3CRange=function(b){var a,d;a=function(b,a,c){var d,w,n,h,u;n=a[c?"startContainer":"endContainer"];h=a[c?"startOffset":"endOffset"];u=0;d=i.isDataNode(n)?n:n.childNodes[h];w=d.parentNode;if(n.nodeType===3||n.nodeType===4)u=h;n=a._document.createElement("span");
w.insertBefore(n,d);a=a._document.body.createTextRange();a.moveToElementText(n);n.parentNode.removeChild(n);b.setEndPoint(c?"StartToStart":"EndToStart",a);return b[c?"moveStart":"moveEnd"]("character",u)};d=b._document.body.createTextRange();a(d,b,!0);a(d,b,!1);return d};return a}();p=function(){function a(b){var a;this.range=b;if(!this.range.collapsed)a=b.commonAncestorContainer,this._current=null,this._next=b.startContainer===a&&!i.isDataNode(b.startContainer)?b.startContainer.childNodes[b.startOffset]:
i.findClosestAncestor(a,b.startContainer),this._end=b.endContainer===a&&!i.isDataNode(b.endContainer)?b.endContainer.childNodes[b.endOffset]:i.findClosestAncestor(a,b.endContainer).nextSibling}a.prototype.hasNext=function(){return this._next!=null};a.prototype.next=function(){var b;b=this._current=this._next;this._next=this._current!=null&&this._current.nextSibling!==this._end?this._current.nextSibling:null;i.isDataNode(this._current)&&(this.range.endContainer===this._current&&(b=b.cloneNode(!0),
b.deleteData(this.range.endOffset,b.length-this.range.endOffset)),this.range.startContainer===this._current&&(b=b.cloneNode(!0),b.deleteData(0,this.range.startOffset)));return b};a.prototype.remove=function(){var b,a;return i.isDataNode(this._current&&(this.range.startContainer===this._current||this.range.endContainer===this._current))?(a=this.range.startContainer===this._current?this.range.startOffset:0,b=this.range.endContainer===this._current?this.range.endOffset:this._current.length,this._current.deleteData(a,
b-a)):this._current.parentNode.removeChild(this._current)};a.prototype.hasPartialSubtree=function(){var b,a,d;b=!i.isDataNode(this._current);a=i.isAncestorOrSelf(this._current,this.range.startContainer);d=i.isAncestorOrSelf(this._current,this.range.endContainer);return b&&(a||d)};a.prototype.getSubtreeIterator=function(){var b;b=new t(this.range._document);b.selectNodeContents(this._current);i.isAncestorOrSelf(this._current,this.range.startContainer)&&b.setStart(this.range.startContainer,this.range.startOffset);
i.isAncestorOrSelf(this._current,this.range.endContainer)&&b.setEnd(this.range.endContainer,this.range.endOffset);return new a(b)};return a}();t=function(){function a(b){this._document=b;this.startContainer=b.body;this.startOffset=0;this.endContainer=b.body;this.endOffset=i.getNodeLength(b.body);this.commonAncestorContainer=null;this.collapsed=!1}a.START_TO_START=0;a.START_TO_END=1;a.END_TO_END=2;a.END_TO_START=3;a.prototype._refreshProperties=function(){var b;this.collapsed=this.startContainer===
this.endContainer&&this.startOffset===this.endOffset;for(b=this.startContainer;b!=null&&b!==this.endContainer&&!i.isAncestorOf(b,this.endContainer);)b=b.parentNode;return this.commonAncestorContainer=b};a.prototype.setStart=function(b,a){this.startContainer=b;this.startOffset=a;return this._refreshProperties()};a.prototype.setEnd=function(b,a){this.endContainer=b;this.endOffset=a;return this._refreshProperties()};a.prototype.setStartBefore=function(b){var a;a=b.parentNode;b=i.findChildPosition(b);
return this.setStart(a,b)};a.prototype.setStartAfter=function(b){var a;a=b.parentNode;b=i.findChildPosition(b);return this.setStart(a,b+1)};a.prototype.setEndBefore=function(b){var a;a=b.parentNode;b=i.findChildPosition(b);return this.setEnd(a,b)};a.prototype.setEndAfter=function(b){var a;a=b.parentNode;b=i.findChildPosition(b);return this.setEnd(a,b+1)};a.prototype.selectNode=function(b){this.setStartBefore(b);return this.setEndAfter(b)};a.prototype.selectNodeContents=function(b){this.setStart(b,
0);return this.setEnd(b,i.getNodeLength(b))};a.prototype.collapse=function(b){return b?this.setEnd(this.startContainer,this.startOffset):this.setStart(this.endContainer,this.endOffset)};a.prototype.cloneContents=function(){var b;b=function(a){var d,e;for(d=document.createDocumentFragment();(e=a.next())!=null;)e=e.cloneNode(!a.hasPartialSubtree()),a.hasPartialSubtree()&&e.appendChild(b(a.getSubtreeIterator())),d.appendChild(e);return flag};return b(new p(this))};a.prototype.extractContents=function(){var b,
a;a=this.cloneRange();this.startContainer!==this.commonAncestorContainer&&this.setStartAfter(i.findClosestAncestor(this.commonAncestorContainer,this.startContainer));this.collapse(!0);b=function(a){var c,f;for(c=document.createDocumentFragment();(f=a.next())!=null;)a.hasPartialSubtree(),a.hasPartialSubtree()?f=f.cloneNode(!1):a.remove(),a.hasPartialSubtree()&&f.appendChild(b(a.getSubtreeIterator())),c.appendChild(f);return c};return b(new p(a))};a.prototype.deleteContents=function(){var b,a;a=this.cloneRange();
this.startContainer!==this.commonAncestorContainer&&this.setStartAfter(i.findClosestAncestor(this.commonAncestorContainer,this.startContainer));this.collapse(!0);return b=function(d){for(;d.next();)d.hasPartialSubtree()?b(d.getSubtreeIterator()):d.remove();return b(new p(a))}};a.prototype.insertNode=function(b){i.isDataNode(this.startContainer)?(i.splitDataNode(this.startContainer,this.startOffset),this.startContainer.parentNode.insertBefore(b,this.startContainer.nextSibling)):this.startContainer.insertBefore(b,
this.startContainer.childNodes[this.startOffset]);return this.setStart(this.startContainer,this.startOffset)};a.prototype.surroundContents=function(b){var a;a=this.extractContents();this.insertNode(b);b.appendChild(a);return this.selectNode(b)};a.prototype.compareBoundaryPoints=function(b,c){var d,e,f,g;switch(b){case a.START_TO_START:case a.START_TO_END:d=this.startContainer;f=this.startOffset;break;case a.END_TO_END:case a.END_TO_START:d=this.endContainer,f=this.endOffset}switch(b){case a.START_TO_START:case a.END_TO_START:e=
c.startContainer;g=c.startOffset;break;case a.START_TO_END:case a.END_TO_END:e=c.endContainer,g=c.endOffset}if(d.sourceIndex<e.souceIndex)return-1;if(d.sourceIndex===e.sourceIndex){if(f<g)return-1;if(f===g)return 0}return 1};a.prototype.cloneRange=function(){var b;b=new a(this.document);b.setStart(this.startContainer,this.startOffset);b.setEnd(this.endContainer,this.endOffset);return b};a.prototype.detach=function(){};a.prototype.toString=function(){return q.convertFromW3CRange(this).text};a.prototype.createContextualFragment=
function(b){var a;a=i.isDataNode(this.startContainer)?this.startContainer.parentNode:this.startContainer;a=a.cloneNode(!1);a.innerHTML=b;for(b=this._document.createDocumentFragment();a.firstChild!=null;)b.appendChild(a.firstChild);return b};return a}();v=function(){function a(b){this.rangeCount=0;this._document=b;this._document.parentWindow.focus();this._document.attachEvent("onselectionchange",m(function(){return this._selectionChangeHolder()},this));this._refreshProperties()}a.prototype._selectionChangeHolder=
function(){var b,a;a=this._document.selection.createRange();b=a.compareEndPoints("StartToEnd",a)!==0;a=a.parentElement().isContentEditable;return b&&a?this.rangeCount=1:this.rangeCount=0};a.prototype._refreshProperties=function(){var b;b=this.getRangeAt(0);return this.isCollapsed=b==null||b.collapsed?!0:!1};a.prototype.addRange=function(b){var a;a=this._document.selection.createRange();b=q.convertFromW3CRange(b);return this._selectionExists(a)?(b.compareEndPoints("StartToStart",a)===-1?b.compareEndPoints("StartToEnd",
a)>-1&&b.compareEndPoints("EndToEnd",a)===-1&&a.setEndPoint("StartToStart",b):b.compareEndPoints("EndToStart",a)<1&&b.compareEndPoints("EndToEnd",a)>-1&&a.sendEndPoint("EndToEnd",b),a.select()):b.select()};a.prototype.removeAllRanges=function(){return this._document.selection.empty()};a.prototype.getRangeAt=function(){var b;try{return b=this._document.selection.createRange(),q.convertToW3CRange(b,this._document)}catch(a){return null}};a.prototype.toString=function(){return this._document.selection.createRange().text};
return a}();String.prototype.startsWith=function(a){return this.lastIndexOf(a,0)===0};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};l=function(){function a(){}a.prototype.CONTAINER_ELEMENTS="body,div,center,blockquote,li,td".split(",");a.prototype.BLOCK_ELEMENTS="address,dir,dl,form,h1,h2,h3,h4,h5,h6,hr,menu,noframes,ol,p,pre,table,ul,xmp".split(",");a.prototype.createElementFromHTML=function(b){var a;a=document.createElement("div");a.innerHTML=b;return a.firstChild};a.prototype.getTextContent=
function(b,a){var d;a==null&&(a=!1);d=b.textContent||b.nodeValue;return a?d.trim():d};a.prototype.isContainerNode=function(b){var c;var a;return(c=(a=b.tagName)!=null?a.toLowerCase():void 0,b=c)&&r.call(this.CONTAINER_ELEMENTS,b)>=0};a.prototype.isBlockNode=function(b){var c;var a;return(c=(a=b.tagName)!=null?a.toLowerCase():void 0,b=c)&&r.call(this.BLOCK_ELEMENTS,b)>=0};a.prototype.isInlineNode=function(b){return!this.isContainerNode(b&&!this.isBlockNode(b))};a.prototype.isVisibleNode=function(b){var a,
d,e;if(b.nodeType===3)return b=this.getTextContent(b),b=b.replace(/\s\t\r\n/,""),b.length!==0;else{e=b.childNodes;for(a=0,d=e.length;a<d;a++)if(b=e[a],this.isVisibleNode(b)===!1)return!1;return!0}};a.prototype.isIsolateNode=function(a){return!a.nextSibling&&!a.previousSibling};a.prototype.getNextNode=function(a){for(;!a.nextSibling;)if(a=a.parentNode,!a)return null;return a.nextSibling};a.prototype.getNextLeaf=function(a){for(a=this.getNextNode(a);(a!=null?a.firstChild:void 0)!=null;)a=a.firstChild;
return a};a.prototype.getPreviousNode=function(a){for(;!a.previousSibling;)if(a=a.parentNode,!a)return null;return a.previousSibling};a.prototype.getPreviousLeaf=function(a){for(a=this.getPreviousNode(a);(a!=null?a.lastChild:void 0)!=null;)a=a.lastChild;return a};a.prototype.extractLeaf=function(a,c,d){var e,f,g,j;c==null&&(c=void 0);d==null&&(d=void 0);f=this.getTextContent(a,!1);c==null&&(c=0);if(d==null)d=f.length;if(c===d||c===0&&d===f.length)return a;e=f.substring(0,c);c=f.substring(c,d);g=f.substring(d,
f.length);d=a.nextSibling;f=a.parentNode;f.removeChild(a);e.length>0&&(a=document.createTextNode(e.trim()),this.isVisibleNode(a)&&f.insertBefore(a,d));c.length>0&&(j=document.createTextNode(c.trim()),f.insertBefore(j,d));g.length>0&&(a=document.createTextNode(g.trim()),this.isVisibleNode(a)&&f.insertBefore(a,d));return j};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=l;if(typeof require!=="undefined"&&require!==null)k=require("./partial").partial,l=require("./nodeutils.core").NodeUtils;
l=k(l,{_unwrapNode:function(a){var b,c,d,e;d=a.parentNode;c=d.nextSibling;b=d.parentNode;b.removeChild(d);for(e=[];d.firstChild!=null;)a=d.firstChild,e.push(b.insertBefore(a,c));return e},unwrapNode:function(a,b,c){var d,e,f;for(c==null&&(c=!1);a.parentNode!=null&&(c||this.isIsolateNode(a));){d=a.parentNode;if(e=(f=d.tagName)!=null?f.toLowerCase():void 0,r.call(b,e)>=0)return this._unwrapNode(a),!0;a=d}return!1},convertNode:function(a,b,c,d){var e,f,g,j;d==null&&(d=!1);for(g=function(a,b){var c,d;
c=a.nextSibling;d=a.parentNode;for(d.removeChild(a);a.firstChild!=null;)b.appendChild(a.firstChild);return d.insertBefore(b,c)};a.parentNode!=null&&(d||this.isIsolateNode(a));){e=a.parentNode;f=(j=e.tagName)!=null?j.toLowerCase():void 0;if(r.call(b,f)>=0)return f===c.tagName.toLowerCase()?this._unwrapNode(a):g(e,c),!0;a=e}return!1},wrapLeaf:function(a,b,c){var d,e,f;c==null&&(c=!0);if(!this.isVisibleNode(a))return!1;e=function(a,b){var c,d;c=a.nextSibling;d=a.parentNode;d.removeChild(a);b.appendChild(a);
return d.insertBefore(b,c)};f=function(a,b){var c,d,e,f,h;f=a.parentNode;h=null;if(a.previousSibling!=null){h=f.cloneNode(!1);for(c=a;c.previousSibling!=null;)c=c.previousSibling,h.insertBefore(c,h.firstChild)}e=null;if(a.nextSibling!=null){e=f.cloneNode(!1);for(c=a;c.nextSibling!=null;)c=c.nextSibling,e.insertBefore(c,null)}d=f.nextSibling;c=f.parentNode;c.removeChild(f);h!=null&&c.insertBefore(h,d);b.appendChild(a);c.insertBefore(b,d);if(e!=null)return c.insertBefore(e,d)};if(this.isContainerNode(b)){if(c||
!this.unwrapNode(a,[b.tagName.toLowerCase()],!0)){for(c=a;c.parentNode!=null;){d=c.parentNode;if(this.isContainerNode(d))return e(c,b),!0;c=d}e(a,b)}}else if(this.isBlockNode(b)){if(c||!this.convertNode(a,this.BLOCK_ELEMENTS,b,!0)){for(c=a;c.parentNode!=null;){d=c.parentNode;if(this.isContainerNode(d)&&this.isBlockNode(d))return f(c,b),!0;c=d}for(c=a;c.parentNode!=null;){d=c.parentNode;if(this.isContainerNode(d))return e(c,b),!0;c=d}e(a,b)}}else(c||!this.unwrapNode(a,[b.tagName.toLowerCase()],!0))&&
e(a,b);return!0},wrapNode:function(a,b,c,d,e){var f,g,j,h;c==null&&(c=!1);d==null&&(d=void 0);e==null&&(e=void 0);if(a.firstChild==null)return a=this.extractLeaf(a,d,e),this.wrapLeaf(a,b,c);d==null&&(d=0);if(e==null)e=a.childNodes.length;j=a.childNodes;h=[];for(f=0,g=j.length;f<g;f++)a=j[f],h.push(a!=null?this.wrapNode(a,b,c,d,e):void 0);return h},wrapRange:function(a,b,c){var d,e,f,g,j,h;c==null&&(c=!1);if(a.startContainer===a.endContainer)return this.wrapNode(a.startContainer,b,c,a.startOffset,
a.endOffset);if(!c&&(e=!1,this.isContainerNode(b)?e=this.convertNode(a.commonAncestorContainer,[(j=b.tagName)!=null?j.toLowerCase():void 0],b,!0):this.isBlockNode(b)&&(e=this.convertNode(a.commonAncestorContainer,this.BLOCK_ELEMENTS,b,!0)),e===!0))return!0;if(this.isContainerNode(b))b.appendChild(a.extractContents()),a.insertNode(b);else{if(this.isBlockNode(b)){if(!function(a,b){var c;for(c=a;c!=null||c===b;){if(this.isBlockNode(c))return!0;c=this.getNextNode(c)}return!1}(a.startContainer,a.endContainer)){b.appendChild(a.extractContents());
a.insertNode(b);return}g=!0}else g=!1;e=function(a){return g?this.getNextNode(a):this.getNextLeaf(a)};d=function(a){return g?this.getPreviousNode(a):this.getPreviousLeaf(a)};a.startContainer.firstChild!=null?j=a.startContainer.childNodes[a.startOffset]:(j=e(a.startContainer),this.wrapNode(a.startContainer,b,c,a.startOffset,void 0));a.endContainer.firstChild!=null?d=a.endOffset>0?a.endContainer.childNodes[a.endOffset-1]:d(a.endContainer):(d=d(a.endContainer),this.wrapNode(a.endContainer,b,c,void 0,
a.endOffset));for(h=[];j!=null&&j!==a.endContainer;){f=e(j);j.parentNode!=null&&this.wrapNode(j,b,c);if(j===d)break;h.push(j=f)}return h}},unwrapRange:function(a,b,c){c==null&&(c=!1);return this.unwrapNode(a.commonAncestorContainer,b,c)},convertRange:function(a,b,c,d){d==null&&(d=!1);return this.convertNode(a.commonAncestorContainer,b,c,d)}});if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=l;if(typeof require!=="undefined"&&require!==null)k=require("./partial").partial,l=require("./nodeutils.wrap").NodeUtils;
l=k(l,{unstyleLeaf:function(a,b,c){var d,e,f;c==null&&(c=!1);for(d=c?"div":"span";a.parentNode!=null&&a.parentNode.tagName!=null;){c=a.parentNode;e=c.tagName.toLowerCase();if(e===d){for(e=0,f=b.length;e<f;e++)d=b[e],c.style[d]="";c.getAttribute("style")===""&&this._unwrapNode(a);return!0}a=c}return!1},styleLeaf:function(a,b,c,d){var e,f,g,j,h,i,k,l,m;c==null&&(c=!1);d==null&&(d=!1);m=c?"div":"span";l=document.createElement(m);for(g in b)k=b[g],l.style[g]=k;i=function(){var a;a=[];for(g in b)k=b[g],
a.push(g);return a}();f=function(a){var b,c,d;for(c=0,d=i.length;c<d;c++)if(b=i[c],a.style[b]!==l.style[b])return!1;return!0};for(e=a;e.parentNode!=null&&e.parentNode.tagName!=null;){j=e.parentNode;h=j.tagName.toLowerCase();if(h===m){if(!d&&f(j))this.unstyleLeaf(e,i,c);else for(g in b)k=b[g],j.style[g]=k;return!0}e=j}this.wrapLeaf(a,l);return!0},styleNode:function(a,b,c,d,e,f){var g,h,i,k;c==null&&(c=!1);d==null&&(d=!1);e==null&&(e=void 0);f==null&&(f=void 0);if(a.firstChild==null)return a=this.extractLeaf(a,
e,f),this.styleLeaf(a,b,c,d);e==null&&(e=0);if(f==null)f=a.childNodes.length;i=a.childNodes;k=[];for(g=0,h=i.length;g<h;g++)a=i[g],k.push(a!=null?this.styleNode(a,b,c,d,e,f):void 0);return k},styleRange:function(a,b,c,d){var e,f,g,h,i;c==null&&(c=!1);d==null&&(d=!1);if(a.startContainer===a.endContainer)return this.styleNode(a.startContainer,b,c,d,a.startOffset,a.endOffset);f=function(a){return this.getNextLeaf(a)};e=function(a){return this.getPreviousLeaf(a)};a.startContainer.firstChild!=null?h=a.startContainer.childNodes[a.startOffset]:
(h=f(a.startContainer),this.styleNode(a.startContainer,b,c,d,a.startOffset,void 0));a.endContainer.firstChild!=null?e=a.endOffset>0?a.endContainer.childNodes[a.endOffset-1]:e(a.endContainer):(e=e(a.endContainer),this.styleNode(a.endContainer,b,c,d,void 0,a.endOffset));for(i=[];h!=null&&h!==a.endContainer;){g=f(h);h.parentNode!=null&&this.styleNode(h,b,c,d);if(h===e)break;i.push(h=g)}return i},unstyleRange:function(a,b,c,d){c==null&&(c=!1);d==null&&(d=!1);return this.unstyleLeaf(a.commonAncestorContainer,
b,c,d)}});if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=l;h=function(){function a(a){this.raw=a;this.utils=new l}a.prototype.execCommand=function(a,c,d){var e,f,g;d==null&&(d=!1);e=m(function(){if(this.raw.window.getSelection!=null)return this.raw.window.getSelection();else if(this.raw.document.selection!=null)return new v(this.raw.document)},this)();if(e==null)return((f=window.console)!=null?f.error:void 0)!=null&&console.error("This browser does not support W3C type of range or Microsoft type of range."),
!1;e=e.getRangeAt(0);switch(a){case "wrap":this.utils.wrapRange(e,this.utils.createElementFromHTML(c),d);break;case "unwrap":this.utils.unwrapRange(e,c,d);break;case "style":this.utils.styleRange(e,c,d);break;case "unstyle":this.utils.unstyleRange(e,c,d);break;default:return((g=window.console)!=null?g.error:void 0)!=null&&console.error("Unknown command type has passed. type: "+a),!1}return!0};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!=="undefined"&&
require!==null)k=require("../utils/partial").partial,h=require("./api.core").API;h=k(h,{strong:function(){return this.execCommand("wrap","<strong>")},em:function(){return this.execCommand("wrap","<em>")},ins:function(){return this.execCommand("wrap","<ins>")},del:function(){return this.execCommand("wrap","<del>")},sub:function(){return this.execCommand("wrap","<sub>")},sup:function(){return this.execCommand("wrap","<sup>")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!==
"undefined"&&require!==null)k=require("../utils/partial").partial,h=require("./api.core").API;h=k(h,{blockquote:function(){return this.execCommand("wrap","<blockquote>",!0)},unblockquote:function(){return this.execCommand("unwrap",["blockquote"],!0)},heading:function(a){return this.execCommand("wrap","<h"+a+">")},h1:function(){return this.heading(1)},h2:function(){return this.heading(2)},h3:function(){return this.heading(3)},h4:function(){return this.heading(4)},h5:function(){return this.heading(5)},
h6:function(){return this.heading(6)},p:function(){return this.execCommand("wrap","<p>")},pre:function(){return this.execCommand("wrap","<pre>")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!=="undefined"&&require!==null)k=require("../utils/partial").partial,h=require("./api.core").API;h=k(h,{a:function(a){return this.execCommand("wrap","<a href='"+a+"'>")},img:function(a){return this.execCommand("wrap","<img src='"+a+"'>")},ul:function(){return this.raw.execCommand("insertUnorderedList")},
ol:function(){return this.raw.execCommand("insertOrderedList")},hr:function(){return this.raw.execCommand("insertHorizontalRule")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!=="undefined"&&require!==null)k=require("../utils/partial").partial,h=require("./commandapi.core").API;h=k(h,{forecolor:function(a){return this.execCommand("style",{color:a})},backcolor:function(a){return this.execCommand("style",{backgroundColor:a})},fontfamily:function(a){return this.execCommand("style",
{fontFamily:a})},fontsize:function(a){return this.execCommand("style",{fontSize:a})},justifyleft:function(){return this.execCommand("style",{textAlign:"left"},!0)},justifycenter:function(){return this.execCommand("style",{textAlign:"center"},!0)},justifyright:function(){return this.execCommand("style",{textAlign:"right"},!0)},justifyfull:function(){return this.execCommand("style",{textAlign:"justify"},!0)}});if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!=="undefined"&&
require!==null)k=require("../utils/partial").partial,h=require("./api.core").API;h=k(h,{indent:function(){return this.raw.execCommand("indent")},outdent:function(){return this.raw.execCommand("outdent")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!=="undefined"&&require!==null)o=require("./utils/detector").Detector;s=function(){function a(a){var c,d;this.iframe=a;c=new o;this._loaded=!1;this._callbacks=[];this.ready(m(function(){var a,b;this.document=this.iframe.contentDocument!=
null?this.iframe.contentDocument:this.iframe.contentWindow.document;this.document.body==null&&this.document.writeln("<body></body>");this.body=this.document.body;this.body.style.cursor="text";this.body.style.height="100%";c.browser==="Explorer"&&c.version<9&&(a=m(function(){return this.body.style.height=""+this.iframe.offsetHeight+"px"},this),setTimeout(m(function(){var b,c;((b=this.iframe)!=null?b.offsetHeight:void 0)!==((c=this.body)!=null?c.offsetHeight:void 0)&&a();return setTimeout(arguments.callee,
100)},this),100));if(this.body.spellcheck!=null)this.body.spellcheck=!1;this.body.contentEditable!=null?this.body.contentEditable=!0:this.document.designMode!=null?this.document.designMode="On":((b=window.console)!=null?b.error:void 0)!=null&&console.error("This browser doesn't support contentEditable nor designMode");return this.window=this.iframe.contentWindow},this));d=m(function(){var a,b,c,d;this._loaded=!0;d=this._callbacks;for(b=0,c=d.length;b<c;b++)a=d[b],a();return this._callbacks=void 0},
this);this.iframe.getAttribute("src")!=null?c.browser==="Explorer"&&c.version<9?this.iframe.attachEvent("onreadystatechange",m(function(){if(this.iframe.readyState==="complete")return this.iframe.onreadystatechange=null,d()},this)):this.iframe.addEventListener("load",m(function(){return d()},this),!1):d()}a.prototype.ready=function(a){a==null&&(a=void 0);return a==null?this._loaded:this._loaded?a():this._callbacks.push(a)};a.prototype.getValue=function(){if(this.ready())return this.body.innerHTML};
a.prototype.setValue=function(a){if(this.ready())return this.body.innerHTML=a};a.prototype.execCommand=function(a,c,d){c==null&&(c=!1);d==null&&(d=null);return this.document.execCommand(a,c,d)};a.prototype.queryCommandState=function(a){return this.document.queryCommandState(a)};a.prototype.queryCommandEnabled=function(a){return this.document.queryCommandEnabled(a)};a.prototype.queryCommandIndeterm=function(a){return this.document.queryCommandIndeterm(a)};a.prototype.queryCommandSupported=function(a){return this.document.queryCommandSupported(a)};
a.prototype.queryCommandValue=function(a){return this.document.queryCommandValue(a)};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Rawarea=s;this.Richarea=function(){function a(a){this.iframe=a;if(window.jQuery!=null&&this.iframe instanceof jQuery)this.iframe=this.iframe.get(0);this.raw=new s(this.iframe);this.raw.ready(m(function(){var a;if(this.iframe.innerHTML!=null)return a=this.iframe.innerHTML,a=a.split("&lt;").join("<"),a=a.split("&gt;").join(">"),this.setValue(a)},this));
this.api=new h(this.raw)}a.prototype.ready=function(a){a==null&&(a=void 0);return this.raw.ready(a)};a.prototype.getValue=function(){return this.raw.getValue()};a.prototype.setValue=function(a){return this.raw.setValue(a)};a.prototype.execCommand=function(a,c){var d;c==null&&(c=void 0);if(a in this.api)return this.api[a](c);else if(((d=window.console)!=null?d.error:void 0)!=null)return console.error("Command '"+a+"' not found.")};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Richarea=
Richarea}).call(this);
