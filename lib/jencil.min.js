/*!
 * Jencil
 * 
 * Javascript cross-browser WYSIWYM and WYSIWYG editor written in CoffeeScript
 * 
 * Author: Alisue (lambdalisue@hashnote.net)
 * Version: 0.0.2
 * Date: Tue, 04 Oct 2011 15:53:42 GMT
 * License: MIT License
 * Url: http://github.com/lambdalisue/Jencil
 */
(function(){this.Textarea=function(){function h(k){this.textarea=typeof jQuery!=="undefined"&&jQuery!==null&&k instanceof jQuery?k.get(0):k}h.prototype.getValue=function(){return this.textarea.value};h.prototype.setValue=function(k){return this.textarea.value=k};h.prototype.getSelection=function(){var k,h;if(document.selection)h=document.selection.createRange(),k=h.duplicate(),k.moveToElementText(this.textarea),k.setEndPoint("EndToEnd",h),k=k.text.length-h.text.length,h=k+h.text.length;else if(this.textarea.setSelectionRange)k=
this.textarea.selectionStart,h=this.textarea.selectionEnd;return[k,h]};h.prototype.setSelection=function(k,h){var j,n;n=this.textarea.scrollTop;if(this.textarea.createTextRange){if($.browser.opera&&$.browser.version>=9.5&&length===0)return!1;j=this.textarea.createTextRange();j.collapse(!0);j.moveStart("character",k);j.moveEnd("character",h-k);j.select()}else this.textarea.setSelectionRange&&this.textarea.setSelectionRange(k,h);this.textarea.focus();return this.textarea.scrollTop=n};h.prototype.getSelected=
function(){var k,h,j;if(document.selection)return k=document.selection.createRange(),k.text;else if(this.textarea.setSelectionRange)return j=this.getSelection(),h=j[0],k=j[1],this.textarea.value.substring(h,k);return!1};h.prototype._replaceSelected=function(k,h,j){h==null&&(h=void 0);j==null&&(j=void 0);if(document.selection)return this.textarea.focus(),j=document.selection.createRange(),j.text=k,j.select();else if(this.textarea.setSelectionRange)return h=this.textarea.value.substring(0,h),j=this.textarea.value.substring(j),
this.textarea.value=h+k+j};h.prototype.replaceSelected=function(k,h){var j,n,l;h==null&&(h=!1);n=this.textarea.scrollTop;j=this.getSelection();l=j[0];j=j[1];this._replaceSelected(k,l,j);j=l+k.length;h||(l=j);this.setSelection(l,j);this.textarea.focus();return this.textarea.scrollTop=n};h.prototype.insertBeforeSelected=function(h,o){var j,n,l,e;o==null&&(o=!1);n=this.textarea.scrollTop;l=this.getSelection();e=l[0];j=l[1];l=this.getSelected();this._replaceSelected(h+l,e,j);j=e+h.length;o||(e=j);this.setSelection(e,
j);this.textarea.focus();return this.textarea.scrollTop=n};h.prototype.insertAfterSelected=function(h,o){var j,n,l,e;o==null&&(o=!1);n=this.textarea.scrollTop;l=this.getSelection();e=l[0];j=l[1];l=this.getSelected();this._replaceSelected(l+h,e,j);j=e+h.length;o?e+=l.length:e=j;this.setSelection(e,j);this.textarea.focus();return this.textarea.scrollTop=n};h.prototype.wrapSelected=function(h,o,j,n){var l,e,i,d,b;j==null&&(j=!1);n==null&&(n=void 0);i=this.getSelected();return i.indexOf(h)===0&&i.lastIndexOf(o)===
i.length-o.length?(h=i.substring(h.length,i.length-o.length),this.replaceSelected(h,j)):(i===""&&n!=null?i=n:n=void 0,e=this.textarea.scrollTop,b=this.getSelection(),d=b[0],l=b[1],this._replaceSelected(h+i+o,d,l),j?n?(l=d+h.length+i.length,d+=h.length):l=d+h.length+o.length+i.length:d=l=d+h.length+i.length+o.length,this.setSelection(d,l),this.textarea.focus(),this.textarea.scrollTop=e)};return h}()}).call(this);
(function(){var h,k,o,j,n,l,e,i,d,b,g=function(a,f){return function(){return a.apply(f,arguments)}},c=Array.prototype.indexOf||function(a){for(var f=0,m=this.length;f<m;f++)if(this[f]===a)return f;return-1};o=function(){function a(){this.browser=this.searchString(a.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"An unknown browser";this.OS=this.searchString(a.dataOS)||"An unknown OS"}a.prototype.searchString=function(f){var a,
b,c;for(b=0,c=f.length;b<c;b++)if(a=f[b],this.versionSearchString=a.versionSearch||a.identify,a.string!=null)if(a.string.indexOf(a.subString)!==-1)return a.identify;else if(a.prop)return a.identify;return[]};a.prototype.searchVersion=function(f){var a;a=f.indexOf(this.versionSearchString);return a===-1?void 0:parseFloat(f.substring(a+this.versionSearchString.length+1))};a.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identify:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",
versionSearch:"OmniWeb/",identify:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identify:"Safari",versionSearch:"Version"},{prop:window.opera,identify:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identify:"iCab"},{string:navigator.vendor,subString:"KDE",identify:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identify:"Firefox"},{string:navigator.vendor,subString:"Camino",identify:"Camino"},{string:navigator.userAgent,subString:"Netscape",identify:"Netscape"},
{string:navigator.userAgent,subString:"MSIE",identify:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identify:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identify:"Netscape",versionSearch:"Mozilla"}];a.dataOS=[{string:navigator.platform,subString:"Win",identify:"Windows"},{string:navigator.platform,subString:"Mac",identify:"Mac"},{string:navigator.userAgent,subString:"iPhone",identify:"iPhone/iPad"},{string:navigator.platform,subString:"Linux",
identify:"Linux"}];return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Detector=o;b=function(a,f){var m,b;for(b in f)m=f[b],a.prototype[b]=m;return a};if(typeof exports!=="undefined"&&exports!==null)exports.partial=b;k=function(){function a(){}a.findChildPosition=function(f){var a;for(a=0;f.previousSibling;)f=f.previousSibling,a+=1;return a};a.isDataNode=function(f){return f!=null&&f.nodeValue!=null&&f.data!=null};a.isDataContainerNode=function(f){var m,b,c;if(f.firstChild==null)return!1;
c=f.childNodes;for(m=0,b=c.length;m<b;m++)if(f=c[m],!a.isDataNode(f))return!1;return!0};a.isAncestorOf=function(f,m){var b,c,g;b=!a.isDataNode(f);c=typeof f.contains==="function"?f.contains(a.isDataNode(m)?m.parentNode:m):void 0;g=m.parentNode===f;return b&&(c||g)};a.isAncestorOrSelf=function(f,m){return a.isAncestorOf(f,m)||f===m};a.findClosestAncestor=function(f,m){if(a.isAncestorOf(f,m))for(;(m!=null?m.parentNode:void 0)!==f;)m=m.parentNode;return m};a.getNodeLength=function(f){if(a.isDataNode(f))return f.length||
f.childNodes.length};a.splitDataNode=function(f,m){var b;if(!a.isDataNode(f))return!1;b=f.cloneNode(!1);f.deleteData(m,f.length);b.deleteData(0,m);return f.parentNode.insertBefore(b,f.nextSibling)};return a}();e=function(){function a(){}a.convertToW3CRange=function(f,a){var b,c,g,d;b=function(f,b,c){var g,d,p,i,e;p=a.createElement("span");d=b.duplicate();d.collapse(c);i=d.parentElement();g=function(f,a){return f.compareEndPoints(c?"StartToStart":"StartToEnd",a)};e=function(){i.insertBefore(p,p.previousSibling);
return d.moveToElementText(p)};for(e();g(d,b)>0&&p.previousSibling;)e();if(g(d,b)===-1&&p.nextSibling)d.setEndPoint(c?"EndToStart":"EndToEnd",b),f[c?"setStart":"setEnd"](p.nextSibling,d.text.length);else f[c?"setStartBefore":"setEndBefore"](p);return p.parentNode.removeChild(p)};d=new i(a);c=f.compareEndPoints("StartToEnd",f)!==0;g=f.parentElement().isContentEditable;if(c&&g)b(d,f,!0),b(d,f,!1),d.startContainer===d.endContainer&&d.endOffset===1&&k.isDataContainerNode(d.startContainer)&&(b=k.getNodeLength(d.endContainer.firstChild),
d.setEnd(d.endContainer,b));else if(g)g=f.duplicate(),c=g.parentElement(),b=a.createElement("span"),c.insertBefore(b,c.firstChild),g.moveToElementText(b),g.setEndPoint("EndToEnd",f),g=g.text.length,d.setStart(c,g),d.setEnd(c,g),c.removeChild(b);return d};a.convertFromW3CRange=function(f){var a,b;a=function(f,a,b){var m,c,g,d,p;g=a[b?"startContainer":"endContainer"];d=a[b?"startOffset":"endOffset"];p=0;m=k.isDataNode(g)?g:g.childNodes[d];c=m.parentNode;if(g.nodeType===3||g.nodeType===4)p=d;g=a._document.createElement("span");
c.insertBefore(g,m);a=a._document.body.createTextRange();a.moveToElementText(g);g.parentNode.removeChild(g);f.setEndPoint(b?"StartToStart":"EndToStart",a);return f[b?"moveStart":"moveEnd"]("character",p)};b=f._document.body.createTextRange();a(b,f,!0);a(b,f,!1);return b};return a}();n=function(){function a(f){var a;this.range=f;if(!this.range.collapsed)a=f.commonAncestorContainer,this._current=null,this._next=f.startContainer===a&&!k.isDataNode(f.startContainer)?f.startContainer.childNodes[f.startOffset]:
k.findClosestAncestor(a,f.startContainer),this._end=f.endContainer===a&&!k.isDataNode(f.endContainer)?f.endContainer.childNodes[f.endOffset]:k.findClosestAncestor(a,f.endContainer).nextSibling}a.prototype.hasNext=function(){return this._next!=null};a.prototype.next=function(){var f;f=this._current=this._next;this._next=this._current!=null&&this._current.nextSibling!==this._end?this._current.nextSibling:null;k.isDataNode(this._current)&&(this.range.endContainer===this._current&&(f=f.cloneNode(!0),
f.deleteData(this.range.endOffset,f.length-this.range.endOffset)),this.range.startContainer===this._current&&(f=f.cloneNode(!0),f.deleteData(0,this.range.startOffset)));return f};a.prototype.remove=function(){var f,a;return k.isDataNode(this._current&&(this.range.startContainer===this._current||this.range.endContainer===this._current))?(a=this.range.startContainer===this._current?this.range.startOffset:0,f=this.range.endContainer===this._current?this.range.endOffset:this._current.length,this._current.deleteData(a,
f-a)):this._current.parentNode.removeChild(this._current)};a.prototype.hasPartialSubtree=function(){var f,a,b;f=!k.isDataNode(this._current);a=k.isAncestorOrSelf(this._current,this.range.startContainer);b=k.isAncestorOrSelf(this._current,this.range.endContainer);return f&&(a||b)};a.prototype.getSubtreeIterator=function(){var f;f=new i(this.range._document);f.selectNodeContents(this._current);k.isAncestorOrSelf(this._current,this.range.startContainer)&&f.setStart(this.range.startContainer,this.range.startOffset);
k.isAncestorOrSelf(this._current,this.range.endContainer)&&f.setEnd(this.range.endContainer,this.range.endOffset);return new a(f)};return a}();i=function(){function a(f){this._document=f;this.startContainer=f.body;this.startOffset=0;this.endContainer=f.body;this.endOffset=k.getNodeLength(f.body);this.commonAncestorContainer=null;this.collapsed=!1}a.START_TO_START=0;a.START_TO_END=1;a.END_TO_END=2;a.END_TO_START=3;a.prototype._refreshProperties=function(){var f;this.collapsed=this.startContainer===
this.endContainer&&this.startOffset===this.endOffset;for(f=this.startContainer;f!=null&&f!==this.endContainer&&!k.isAncestorOf(f,this.endContainer);)f=f.parentNode;return this.commonAncestorContainer=f};a.prototype.setStart=function(f,a){this.startContainer=f;this.startOffset=a;return this._refreshProperties()};a.prototype.setEnd=function(f,a){this.endContainer=f;this.endOffset=a;return this._refreshProperties()};a.prototype.setStartBefore=function(f){var a;a=f.parentNode;f=k.findChildPosition(f);
return this.setStart(a,f)};a.prototype.setStartAfter=function(f){var a;a=f.parentNode;f=k.findChildPosition(f);return this.setStart(a,f+1)};a.prototype.setEndBefore=function(f){var a;a=f.parentNode;f=k.findChildPosition(f);return this.setEnd(a,f)};a.prototype.setEndAfter=function(f){var a;a=f.parentNode;f=k.findChildPosition(f);return this.setEnd(a,f+1)};a.prototype.selectNode=function(f){this.setStartBefore(f);return this.setEndAfter(f)};a.prototype.selectNodeContents=function(f){this.setStart(f,
0);return this.setEnd(f,k.getNodeLength(f))};a.prototype.collapse=function(f){return f?this.setEnd(this.startContainer,this.startOffset):this.setStart(this.endContainer,this.endOffset)};a.prototype.cloneContents=function(){var f;f=function(a){var b,c;for(b=document.createDocumentFragment();(c=a.next())!=null;)c=c.cloneNode(!a.hasPartialSubtree()),a.hasPartialSubtree()&&c.appendChild(f(a.getSubtreeIterator())),b.appendChild(c);return flag};return f(new n(this))};a.prototype.extractContents=function(){var f,
a;a=this.cloneRange();this.startContainer!==this.commonAncestorContainer&&this.setStartAfter(k.findClosestAncestor(this.commonAncestorContainer,this.startContainer));this.collapse(!0);f=function(a){var b,m;for(b=document.createDocumentFragment();(m=a.next())!=null;)a.hasPartialSubtree(),a.hasPartialSubtree()?m=m.cloneNode(!1):a.remove(),a.hasPartialSubtree()&&m.appendChild(f(a.getSubtreeIterator())),b.appendChild(m);return b};return f(new n(a))};a.prototype.deleteContents=function(){var f,a;a=this.cloneRange();
this.startContainer!==this.commonAncestorContainer&&this.setStartAfter(k.findClosestAncestor(this.commonAncestorContainer,this.startContainer));this.collapse(!0);return f=function(b){for(;b.next();)b.hasPartialSubtree()?f(b.getSubtreeIterator()):b.remove();return f(new n(a))}};a.prototype.insertNode=function(f){k.isDataNode(this.startContainer)?(k.splitDataNode(this.startContainer,this.startOffset),this.startContainer.parentNode.insertBefore(f,this.startContainer.nextSibling)):this.startContainer.insertBefore(f,
this.startContainer.childNodes[this.startOffset]);return this.setStart(this.startContainer,this.startOffset)};a.prototype.surroundContents=function(f){var a;a=this.extractContents();this.insertNode(f);f.appendChild(a);return this.selectNode(f)};a.prototype.compareBoundaryPoints=function(f,b){var c,g,d,e;switch(f){case a.START_TO_START:case a.START_TO_END:c=this.startContainer;d=this.startOffset;break;case a.END_TO_END:case a.END_TO_START:c=this.endContainer,d=this.endOffset}switch(f){case a.START_TO_START:case a.END_TO_START:g=
b.startContainer;e=b.startOffset;break;case a.START_TO_END:case a.END_TO_END:g=b.endContainer,e=b.endOffset}if(c.sourceIndex<g.souceIndex)return-1;if(c.sourceIndex===g.sourceIndex){if(d<e)return-1;if(d===e)return 0}return 1};a.prototype.cloneRange=function(){var f;f=new a(this.document);f.setStart(this.startContainer,this.startOffset);f.setEnd(this.endContainer,this.endOffset);return f};a.prototype.detach=function(){};a.prototype.toString=function(){return e.convertFromW3CRange(this).text};a.prototype.createContextualFragment=
function(a){var b;b=k.isDataNode(this.startContainer)?this.startContainer.parentNode:this.startContainer;b=b.cloneNode(!1);b.innerHTML=a;for(a=this._document.createDocumentFragment();b.firstChild!=null;)a.appendChild(b.firstChild);return a};return a}();d=function(){function a(a){this.rangeCount=0;this._document=a;this._document.parentWindow.focus();this._document.attachEvent("onselectionchange",g(function(){return this._selectionChangeHolder()},this));this._refreshProperties()}a.prototype._selectionChangeHolder=
function(){var a,b;b=this._document.selection.createRange();a=b.compareEndPoints("StartToEnd",b)!==0;b=b.parentElement().isContentEditable;return a&&b?this.rangeCount=1:this.rangeCount=0};a.prototype._refreshProperties=function(){var a;a=this.getRangeAt(0);return this.isCollapsed=a==null||a.collapsed?!0:!1};a.prototype.addRange=function(a){var b;b=this._document.selection.createRange();a=e.convertFromW3CRange(a);return this._selectionExists(b)?(a.compareEndPoints("StartToStart",b)===-1?a.compareEndPoints("StartToEnd",
b)>-1&&a.compareEndPoints("EndToEnd",b)===-1&&b.setEndPoint("StartToStart",a):a.compareEndPoints("EndToStart",b)<1&&a.compareEndPoints("EndToEnd",b)>-1&&b.sendEndPoint("EndToEnd",a),b.select()):a.select()};a.prototype.removeAllRanges=function(){return this._document.selection.empty()};a.prototype.getRangeAt=function(){var a;try{return a=this._document.selection.createRange(),e.convertToW3CRange(a,this._document)}catch(b){return null}};a.prototype.toString=function(){return this._document.selection.createRange().text};
return a}();String.prototype.startsWith=function(a){return this.lastIndexOf(a,0)===0};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};j=function(){function a(){}a.prototype.CONTAINER_ELEMENTS="body,div,center,blockquote,li,td".split(",");a.prototype.BLOCK_ELEMENTS="address,dir,dl,form,h1,h2,h3,h4,h5,h6,hr,menu,noframes,ol,p,pre,table,ul,xmp".split(",");a.prototype.createElementFromHTML=function(a){var b;b=document.createElement("div");b.innerHTML=a;return b.firstChild};a.prototype.getTextContent=
function(a,b){var c;b==null&&(b=!1);c=a.textContent||a.nodeValue;return b?c.trim():c};a.prototype.isContainerNode=function(a){var b,g;return(b=(g=a.tagName)!=null?g.toLowerCase():void 0,a=b)&&c.call(this.CONTAINER_ELEMENTS,a)>=0};a.prototype.isBlockNode=function(a){var b,g;return(b=(g=a.tagName)!=null?g.toLowerCase():void 0,a=b)&&c.call(this.BLOCK_ELEMENTS,a)>=0};a.prototype.isInlineNode=function(a){return!this.isContainerNode(a&&!this.isBlockNode(a))};a.prototype.isVisibleNode=function(a){var b,
c,g;if(a.nodeType===3)return a=this.getTextContent(a),a=a.replace(/\s\t\r\n/,""),a.length!==0;else{g=a.childNodes;for(b=0,c=g.length;b<c;b++)if(a=g[b],this.isVisibleNode(a)===!1)return!1;return!0}};a.prototype.isIsolateNode=function(a){return!a.nextSibling&&!a.previousSibling};a.prototype.getNextNode=function(a){for(;!a.nextSibling;)if(a=a.parentNode,!a)return null;return a.nextSibling};a.prototype.getNextLeaf=function(a){for(a=this.getNextNode(a);(a!=null?a.firstChild:void 0)!=null;)a=a.firstChild;
return a};a.prototype.getPreviousNode=function(a){for(;!a.previousSibling;)if(a=a.parentNode,!a)return null;return a.previousSibling};a.prototype.getPreviousLeaf=function(a){for(a=this.getPreviousNode(a);(a!=null?a.lastChild:void 0)!=null;)a=a.lastChild;return a};a.prototype.extractLeaf=function(a,b,c){var g,d,e,i;b==null&&(b=void 0);c==null&&(c=void 0);d=this.getTextContent(a,!1);b==null&&(b=0);if(c==null)c=d.length;if(b===c||b===0&&c===d.length)return a;g=d.substring(0,b);b=d.substring(b,c);e=d.substring(c,
d.length);c=a.nextSibling;d=a.parentNode;d.removeChild(a);g.length>0&&(a=document.createTextNode(g.trim()),this.isVisibleNode(a)&&d.insertBefore(a,c));b.length>0&&(i=document.createTextNode(b.trim()),d.insertBefore(i,c));e.length>0&&(a=document.createTextNode(e.trim()),this.isVisibleNode(a)&&d.insertBefore(a,c));return i};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=j;if(typeof require!=="undefined"&&require!==null)b=require("./partial").partial,j=require("./nodeutils.core").NodeUtils;
j=b(j,{_unwrapNode:function(a){var f,b,c,g;c=a.parentNode;b=c.nextSibling;f=c.parentNode;f.removeChild(c);for(g=[];c.firstChild!=null;)a=c.firstChild,g.push(f.insertBefore(a,b));return g},unwrapNode:function(a,b,g){var d,e,i;for(g==null&&(g=!1);a.parentNode!=null&&(g||this.isIsolateNode(a));){d=a.parentNode;if(e=(i=d.tagName)!=null?i.toLowerCase():void 0,c.call(b,e)>=0)return this._unwrapNode(a),!0;a=d}return!1},convertNode:function(a,b,g,d){var e,i,h,j;d==null&&(d=!1);for(h=function(a,b){var f,c;
f=a.nextSibling;c=a.parentNode;for(c.removeChild(a);a.firstChild!=null;)b.appendChild(a.firstChild);return c.insertBefore(b,f)};a.parentNode!=null&&(d||this.isIsolateNode(a));){e=a.parentNode;i=(j=e.tagName)!=null?j.toLowerCase():void 0;if(c.call(b,i)>=0)return i===g.tagName.toLowerCase()?this._unwrapNode(a):h(e,g),!0;a=e}return!1},wrapLeaf:function(a,b,c){var g,d,e;c==null&&(c=!0);if(!this.isVisibleNode(a))return!1;d=function(a,b){var f,c;f=a.nextSibling;c=a.parentNode;c.removeChild(a);b.appendChild(a);
return c.insertBefore(b,f)};e=function(a,b){var f,c,g,d,e;d=a.parentNode;e=null;if(a.previousSibling!=null){e=d.cloneNode(!1);for(f=a;f.previousSibling!=null;)f=f.previousSibling,e.insertBefore(f,e.firstChild)}g=null;if(a.nextSibling!=null){g=d.cloneNode(!1);for(f=a;f.nextSibling!=null;)f=f.nextSibling,g.insertBefore(f,null)}c=d.nextSibling;f=d.parentNode;f.removeChild(d);e!=null&&f.insertBefore(e,c);b.appendChild(a);f.insertBefore(b,c);if(g!=null)return f.insertBefore(g,c)};if(this.isContainerNode(b)){if(c||
!this.unwrapNode(a,[b.tagName.toLowerCase()],!0)){for(c=a;c.parentNode!=null;){g=c.parentNode;if(this.isContainerNode(g))return d(c,b),!0;c=g}d(a,b)}}else if(this.isBlockNode(b)){if(c||!this.convertNode(a,this.BLOCK_ELEMENTS,b,!0)){for(c=a;c.parentNode!=null;){g=c.parentNode;if(this.isContainerNode(g)&&this.isBlockNode(g))return e(c,b),!0;c=g}for(c=a;c.parentNode!=null;){g=c.parentNode;if(this.isContainerNode(g))return d(c,b),!0;c=g}d(a,b)}}else(c||!this.unwrapNode(a,[b.tagName.toLowerCase()],!0))&&
d(a,b);return!0},wrapNode:function(a,b,c,g,d){var e,i,h,j;c==null&&(c=!1);g==null&&(g=void 0);d==null&&(d=void 0);if(a.firstChild==null)return a=this.extractLeaf(a,g,d),this.wrapLeaf(a,b,c);g==null&&(g=0);if(d==null)d=a.childNodes.length;h=a.childNodes;j=[];for(e=0,i=h.length;e<i;e++)a=h[e],j.push(a!=null?this.wrapNode(a,b,c,g,d):void 0);return j},wrapRange:function(a,b,c){var g,d,e,i,h,j;c==null&&(c=!1);if(a.startContainer===a.endContainer)return this.wrapNode(a.startContainer,b,c,a.startOffset,
a.endOffset);if(!c&&(d=!1,this.isContainerNode(b)?d=this.convertNode(a.commonAncestorContainer,[(h=b.tagName)!=null?h.toLowerCase():void 0],b,!0):this.isBlockNode(b)&&(d=this.convertNode(a.commonAncestorContainer,this.BLOCK_ELEMENTS,b,!0)),d===!0))return!0;if(this.isContainerNode(b))b.appendChild(a.extractContents()),a.insertNode(b);else{if(this.isBlockNode(b)){if(!function(a,b){var f;for(f=a;f!=null||f===b;){if(this.isBlockNode(f))return!0;f=this.getNextNode(f)}return!1}(a.startContainer,a.endContainer)){b.appendChild(a.extractContents());
a.insertNode(b);return}i=!0}else i=!1;d=function(a){return i?this.getNextNode(a):this.getNextLeaf(a)};g=function(a){return i?this.getPreviousNode(a):this.getPreviousLeaf(a)};a.startContainer.firstChild!=null?h=a.startContainer.childNodes[a.startOffset]:(h=d(a.startContainer),this.wrapNode(a.startContainer,b,c,a.startOffset,void 0));a.endContainer.firstChild!=null?g=a.endOffset>0?a.endContainer.childNodes[a.endOffset-1]:g(a.endContainer):(g=g(a.endContainer),this.wrapNode(a.endContainer,b,c,void 0,
a.endOffset));for(j=[];h!=null&&h!==a.endContainer;){e=d(h);h.parentNode!=null&&this.wrapNode(h,b,c);if(h===g)break;j.push(h=e)}return j}},unwrapRange:function(a,b,c){c==null&&(c=!1);return this.unwrapNode(a.commonAncestorContainer,b,c)},convertRange:function(a,b,c,g){g==null&&(g=!1);return this.convertNode(a.commonAncestorContainer,b,c,g)}});if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=j;if(typeof require!=="undefined"&&require!==null)b=require("./partial").partial,j=require("./nodeutils.wrap").NodeUtils;
j=b(j,{unstyleLeaf:function(a,b,c){var g,d,e;c==null&&(c=!1);for(g=c?"div":"span";a.parentNode!=null&&a.parentNode.tagName!=null;){c=a.parentNode;d=c.tagName.toLowerCase();if(d===g){for(d=0,e=b.length;d<e;d++)g=b[d],c.style[g]="";c.getAttribute("style")===""&&this._unwrapNode(a);return!0}a=c}return!1},styleLeaf:function(a,b,c,g){var d,e,i,h,j,k,l,n,o;c==null&&(c=!1);g==null&&(g=!1);o=c?"div":"span";n=document.createElement(o);for(i in b)l=b[i],n.style[i]=l;k=function(){var a;a=[];for(i in b)l=b[i],
a.push(i);return a}();e=function(a){var b,f,c;for(f=0,c=k.length;f<c;f++)if(b=k[f],a.style[b]!==n.style[b])return!1;return!0};for(d=a;d.parentNode!=null&&d.parentNode.tagName!=null;){h=d.parentNode;j=h.tagName.toLowerCase();if(j===o){if(!g&&e(h))this.unstyleLeaf(d,k,c);else for(i in b)l=b[i],h.style[i]=l;return!0}d=h}this.wrapLeaf(a,n);return!0},styleNode:function(a,b,c,g,d,e){var i,h,j,k;c==null&&(c=!1);g==null&&(g=!1);d==null&&(d=void 0);e==null&&(e=void 0);if(a.firstChild==null)return a=this.extractLeaf(a,
d,e),this.styleLeaf(a,b,c,g);d==null&&(d=0);if(e==null)e=a.childNodes.length;j=a.childNodes;k=[];for(i=0,h=j.length;i<h;i++)a=j[i],k.push(a!=null?this.styleNode(a,b,c,g,d,e):void 0);return k},styleRange:function(a,b,c,g){var d,e,i,h,j;c==null&&(c=!1);g==null&&(g=!1);if(a.startContainer===a.endContainer)return this.styleNode(a.startContainer,b,c,g,a.startOffset,a.endOffset);e=function(a){return this.getNextLeaf(a)};d=function(a){return this.getPreviousLeaf(a)};a.startContainer.firstChild!=null?h=a.startContainer.childNodes[a.startOffset]:
(h=e(a.startContainer),this.styleNode(a.startContainer,b,c,g,a.startOffset,void 0));a.endContainer.firstChild!=null?d=a.endOffset>0?a.endContainer.childNodes[a.endOffset-1]:d(a.endContainer):(d=d(a.endContainer),this.styleNode(a.endContainer,b,c,g,void 0,a.endOffset));for(j=[];h!=null&&h!==a.endContainer;){i=e(h);h.parentNode!=null&&this.styleNode(h,b,c,g);if(h===d)break;j.push(h=i)}return j},unstyleRange:function(a,b,c,g){c==null&&(c=!1);g==null&&(g=!1);return this.unstyleLeaf(a.commonAncestorContainer,
b,c,g)}});if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=j;h=function(){function a(a){this.raw=a;this.utils=new j}a.prototype.execCommand=function(a,b,c){var e,i,h;c==null&&(c=!1);e=g(function(){if(this.raw.window.getSelection!=null)return this.raw.window.getSelection();else if(this.raw.document.selection!=null)return new d(this.raw.document)},this)();if(e==null)return((i=window.console)!=null?i.error:void 0)!=null&&console.error("This browser does not support W3C type of range or Microsoft type of range."),
!1;e=e.getRangeAt(0);switch(a){case "wrap":this.utils.wrapRange(e,this.utils.createElementFromHTML(b),c);break;case "unwrap":this.utils.unwrapRange(e,b,c);break;case "style":this.utils.styleRange(e,b,c);break;case "unstyle":this.utils.unstyleRange(e,b,c);break;default:return((h=window.console)!=null?h.error:void 0)!=null&&console.error("Unknown command type has passed. type: "+a),!1}return!0};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!=="undefined"&&
require!==null)b=require("../utils/partial").partial,h=require("./api.core").API;h=b(h,{strong:function(){return this.execCommand("wrap","<strong>")},em:function(){return this.execCommand("wrap","<em>")},ins:function(){return this.execCommand("wrap","<ins>")},del:function(){return this.execCommand("wrap","<del>")},sub:function(){return this.execCommand("wrap","<sub>")},sup:function(){return this.execCommand("wrap","<sup>")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!==
"undefined"&&require!==null)b=require("../utils/partial").partial,h=require("./api.core").API;h=b(h,{blockquote:function(){return this.execCommand("wrap","<blockquote>",!0)},unblockquote:function(){return this.execCommand("unwrap",["blockquote"],!0)},heading:function(a){return this.execCommand("wrap","<h"+a+">")},h1:function(){return this.heading(1)},h2:function(){return this.heading(2)},h3:function(){return this.heading(3)},h4:function(){return this.heading(4)},h5:function(){return this.heading(5)},
h6:function(){return this.heading(6)},p:function(){return this.execCommand("wrap","<p>")},pre:function(){return this.execCommand("wrap","<pre>")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!=="undefined"&&require!==null)b=require("../utils/partial").partial,h=require("./api.core").API;h=b(h,{a:function(a){return this.execCommand("wrap","<a href='"+a+"'>")},img:function(a){return this.execCommand("wrap","<img src='"+a+"'>")},ul:function(){return this.raw.execCommand("insertUnorderedList")},
ol:function(){return this.raw.execCommand("insertOrderedList")},hr:function(){return this.raw.execCommand("insertHorizontalRule")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!=="undefined"&&require!==null)b=require("../utils/partial").partial,h=require("./commandapi.core").API;h=b(h,{forecolor:function(a){return this.execCommand("style",{color:a})},backcolor:function(a){return this.execCommand("style",{backgroundColor:a})},fontfamily:function(a){return this.execCommand("style",
{fontFamily:a})},fontsize:function(a){return this.execCommand("style",{fontSize:a})},justifyleft:function(){return this.execCommand("style",{textAlign:"left"},!0)},justifycenter:function(){return this.execCommand("style",{textAlign:"center"},!0)},justifyright:function(){return this.execCommand("style",{textAlign:"right"},!0)},justifyfull:function(){return this.execCommand("style",{textAlign:"justify"},!0)}});if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!=="undefined"&&
require!==null)b=require("../utils/partial").partial,h=require("./api.core").API;h=b(h,{indent:function(){return this.raw.execCommand("indent")},outdent:function(){return this.raw.execCommand("outdent")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=h;if(typeof require!=="undefined"&&require!==null)o=require("./utils/detector").Detector;l=function(){function a(a){var b,c;this.iframe=a;b=new o;this._loaded=!1;this._callbacks=[];this.ready(g(function(){var a,c;this.document=this.iframe.contentDocument!=
null?this.iframe.contentDocument:this.iframe.contentWindow.document;this.document.body==null&&this.document.writeln("<body></body>");this.body=this.document.body;this.body.style.cursor="text";this.body.style.height="100%";b.browser==="Explorer"&&b.version<9&&(a=g(function(){return this.body.style.height=""+this.iframe.offsetHeight+"px"},this),setTimeout(g(function(){var b,c;((b=this.iframe)!=null?b.offsetHeight:void 0)!==((c=this.body)!=null?c.offsetHeight:void 0)&&a();return setTimeout(arguments.callee,
100)},this),100));if(this.body.spellcheck!=null)this.body.spellcheck=!1;this.body.contentEditable!=null?this.body.contentEditable=!0:this.document.designMode!=null?this.document.designMode="On":((c=window.console)!=null?c.error:void 0)!=null&&console.error("This browser doesn't support contentEditable nor designMode");return this.window=this.iframe.contentWindow},this));c=g(function(){var a,b,c,f;this._loaded=!0;f=this._callbacks;for(b=0,c=f.length;b<c;b++)a=f[b],a();return this._callbacks=void 0},
this);this.iframe.getAttribute("src")!=null?b.browser==="Explorer"&&b.version<9?this.iframe.attachEvent("onreadystatechange",g(function(){if(this.iframe.readyState==="complete")return this.iframe.onreadystatechange=null,c()},this)):this.iframe.addEventListener("load",g(function(){return c()},this),!1):c()}a.prototype.ready=function(a){a==null&&(a=void 0);return a==null?this._loaded:this._loaded?a():this._callbacks.push(a)};a.prototype.getValue=function(){if(this.ready())return this.body.innerHTML};
a.prototype.setValue=function(a){if(this.ready())return this.body.innerHTML=a};a.prototype.execCommand=function(a,b,c){b==null&&(b=!1);c==null&&(c=null);return this.document.execCommand(a,b,c)};a.prototype.queryCommandState=function(a){return this.document.queryCommandState(a)};a.prototype.queryCommandEnabled=function(a){return this.document.queryCommandEnabled(a)};a.prototype.queryCommandIndeterm=function(a){return this.document.queryCommandIndeterm(a)};a.prototype.queryCommandSupported=function(a){return this.document.queryCommandSupported(a)};
a.prototype.queryCommandValue=function(a){return this.document.queryCommandValue(a)};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Rawarea=l;this.Richarea=function(){function a(a){this.iframe=a;if(window.jQuery!=null&&this.iframe instanceof jQuery)this.iframe=this.iframe.get(0);this.raw=new l(this.iframe);this.raw.ready(g(function(){var a;if(this.iframe.innerHTML!=null)return a=this.iframe.innerHTML,a=a.split("&lt;").join("<"),a=a.split("&gt;").join(">"),this.setValue(a)},this));
this.api=new h(this.raw)}a.prototype.ready=function(a){a==null&&(a=void 0);return this.raw.ready(a)};a.prototype.getValue=function(){return this.raw.getValue()};a.prototype.setValue=function(a){return this.raw.setValue(a)};a.prototype.execCommand=function(a,b){var c;b==null&&(b=void 0);if(a in this.api)return this.api[a](b);else if(((c=window.console)!=null?c.error:void 0)!=null)return console.error("Command '"+a+"' not found.")};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Richarea=
Richarea}).call(this);
(function(){var h,k,o=Array.prototype.slice,j=function(e,i){return function(){return e.apply(i,arguments)}},n=Object.prototype.hasOwnProperty,l=function(e,i){function d(){this.constructor=e}for(var b in i)n.call(i,b)&&(e[b]=i[b]);d.prototype=i.prototype;e.prototype=new d;e.__super__=i.prototype;return e};k=function(){function e(){this.browser=this.searchString(e.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"An unknown browser";
this.OS=this.searchString(e.dataOS)||"An unknown OS"}e.prototype.searchString=function(e){var d,b,g;for(b=0,g=e.length;b<g;b++)if(d=e[b],this.versionSearchString=d.versionSearch||d.identify,d.string!=null)if(d.string.indexOf(d.subString)!==-1)return d.identify;else if(d.prop)return d.identify;return[]};e.prototype.searchVersion=function(e){var d;d=e.indexOf(this.versionSearchString);return d===-1?void 0:parseFloat(e.substring(d+this.versionSearchString.length+1))};e.dataBrowser=[{string:navigator.userAgent,
subString:"Chrome",identify:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identify:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identify:"Safari",versionSearch:"Version"},{prop:window.opera,identify:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identify:"iCab"},{string:navigator.vendor,subString:"KDE",identify:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identify:"Firefox"},{string:navigator.vendor,subString:"Camino",
identify:"Camino"},{string:navigator.userAgent,subString:"Netscape",identify:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identify:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identify:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identify:"Netscape",versionSearch:"Mozilla"}];e.dataOS=[{string:navigator.platform,subString:"Win",identify:"Windows"},{string:navigator.platform,subString:"Mac",identify:"Mac"},{string:navigator.userAgent,
subString:"iPhone",identify:"iPhone/iPad"},{string:navigator.platform,subString:"Linux",identify:"Linux"}];return e}();if(typeof exports!=="undefined"&&exports!==null)exports.Detector=k;window.namespace=function(e,i,d){var b,g,c,a,f;arguments.length<3&&(b=[typeof exports!=="undefined"?exports:window].concat(o.call(arguments)),e=b[0],i=b[1],d=b[2]);g=e;f=i.split(".");for(c=0,a=f.length;c<a;c++)b=f[c],e=e[b]||(e[b]={});return d(e,g)};if(typeof exports!=="undefined"&&exports!==null)exports.namespace=
namespace;namespace(this,"dynamicloader.script",function(e){var i;e.include=i=function(d){var b;b=document.createElement("script");b.type="text/javascript";b.src=d;document.head=document.head||document.getElementsByTagName("head")[0];return document.head.appendChild(b)};e.load=function(d,b,g,c){var a;c==null&&(c=5E3);a=new Function("return !!("+b+")");return a()?typeof g==="function"?g():void 0:(i(d),setTimeout(function(){return c=!0},c),setTimeout(function(){return c!==!0&&!a()?setTimeout(arguments.callee,
100):typeof g==="function"?g():void 0},100))};return e.loadall=function(){return next()}});namespace("dynamicloader.css",function(e){e.include=function(e,d){var b;d==null&&(d="all");b=document.createElement("link");b.rel="stylesheet";b.type="text/css";b.media=d;b.href=e;document.head=document.head||document.getElementsByTagName("head")[0];return document.head.appendChild(b)};return e.remove=function(e){return h("link").each(function(d,b){if(b.href.match(e)!=null)return h(b).remove()})}});if(String.prototype.startsWith==
null)String.prototype.startsWith=function(e){return this.lastIndexOf(e,0)===0};if(String.prototype.endsWith==null)String.prototype.endsWith=function(e){var i;i=this.length-e.length;return i>=0&&this.lastIndexOf(e,i)===i};if(String.prototype.replaceAll==null)String.prototype.replaceAll=function(e,i){return this.split(e).join(i)};if(String.prototype.trim==null)String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};h=jQuery;h.fn.jencil=function(e){e=h.extend(!0,Jencil.options["default"],
e);if(this.length>1&&e.documentTypeElement!=null)logger.warn("documentTypeElement is not avaialble on multiple textarea"),e.documentTypeElement=void 0;Jencil.utils.path.init(e);Jencil.theme.init(e);if(Jencil.jencils==null)Jencil.jencils=[];return this.each(function(){return Jencil.jencils.push(new Jencil.core.JencilCore(h(this),e))})};namespace("Jencil.core",function(e){return e.JencilCore=function(){function e(d,b){this.$textarea=d;this.options=b;this.profile=void 0;this.wrapper=new Jencil.widget.Wrapper(this);
this.buttonHolder=new Jencil.widget.ButtonHolder(this);this.documentType=new Jencil.widget.DocumentType(this);this.toolbar=new Jencil.widget.Toolbar(this);this.toolbar.append(this.buttonHolder);this.toolbar.append(this.documentType);this.wrapper.append(this.toolbar);this.workspace=new Jencil.widget.Workspace(this);this.wrapper.append(this.workspace);this.$textarea.after(this.wrapper.$element);this.$textarea.hide();Jencil.profile.load(this,this.getProfileName())}e.prototype.update=function(){return this.workspace.use(this.profile.editor,
j(function(){this.buttonHolder.update();return this.workspace.editor.update()},this))};e.prototype.getProfileName=function(){return this.documentType.getProfileName()};e.prototype.getSourceValue=function(){return this.$textarea.val()};e.prototype.setSourceValue=function(d){return this.$textarea.val(d)};return e}()});namespace("Jencil.utils",function(e){return e.detector=new k});namespace("Jencil.utils.path",function(e){var i;e.init=function(d){var b,g;return e.path=new i((b=(g=d.root)!=null?g:d.rootPattern)!=
null?b:/(.*)jencil(\.min)?\.js/)};e.abspath=function(d,b,g){g==null&&(g="~/");return e.path.abspath(d,b,g)};return e.Path=i=function(){function d(b){b instanceof RegExp?h("script").each(j(function(g,c){var a;a=c.src.match(b);if(a!=null)return this.root=a[1],this.root=this.root.slice(0,this.root.length-2+1||9E9)},this)):this.root=b}d.prototype.abspath=function(b,g,c){c==null&&(c="~/");if(g==null)g=this.root;b!=null&&b.startsWith(c)&&(b=""+g+"/"+b.slice(2,b.length+1||9E9));return b};return d}()});namespace("Jencil.utils.script",
function(e){e.load=function(e,d,b){return dynamicloader.script.load(Jencil.utils.path.abspath(e),d,b)};return e.loadall=function(e,d){var b;b=0;return function(){var g,c;c=e[b][0];g=e[b][1];b++;return b>e.length?typeof d==="function"?d():void 0:Jencil.utils.module.load(c,g,next)}()}});namespace("Jencil.utils.css",function(e){e.include=function(e){return dynamicloader.css.include(e)};return e.remove=function(e){return dynamicloader.css.remove(e)}});namespace("Jencil.utils.string",function(e){return e.format=
function(e,d){var b,g;for(b in d)g=d[b],e=e.replace("{{"+b+"}}",g);return e}});namespace("Jencil.options",function(e){return e["default"]={debug:!0,root:null,rootPattern:null,theme:{root:"~/extras/themes","default":"default"},profile:{root:"~/extras/profiles","default":"default"}}});namespace("Jencil.profile",function(e){e.abspath=function(e,d){e.endsWith(".js")||(e=""+d.options.profile.root+"/"+e+".js");return Jencil.utils.path.abspath(e)};return e.load=function(e,d){var b;b=Jencil.profile.abspath(d,
e);delete Jencil.profile.Profile;delete e.profile;return Jencil.utils.script.load(b,"Jencil.profile.Profile",function(){e.profile=new Jencil.profile.Profile(e);return e.update()})}});namespace("Jencil.theme",function(e){e.root=void 0;e.init=function(i){e.root=Jencil.utils.path.abspath(i.theme.root);return Jencil.theme.load(i.theme["default"])};e.load=function(e){var d,b,g,c,a;Jencil.theme.current!=null&&Jencil.utils.css.remove(RegExp(""+Jencil.theme.current+"/.*.css"));Jencil.theme.current=Jencil.utils.path.abspath(""+
Jencil.theme.root+"/"+e);Jencil.theme.include(""+Jencil.theme.current+"/style.css","screen, projection");if(Jencil.jencils!=null){g=Jencil.jencils;a=[];for(e=0,b=g.length;e<b;e++)d=g[e],d=d.workspace.editor.constructor,a.push(((c=d.extras)!=null?c.stylesheets:void 0)!=null?Jencil.theme.includeall(d.extras.stylesheets):void 0);return a}};e.abspath=function(e){return Jencil.utils.path.abspath(e,Jencil.theme.current)};e.include=function(e,d){e=Jencil.theme.abspath(e);return Jencil.utils.css.include(e,
d)};return e.includeall=function(e){var d,b,g,c;c=[];for(b=0,g=e.length;b<g;b++)d=e[b],c.push(Jencil.theme.include(d,"screen, projection"));return c}});namespace("Jencil.widget",function(e){var i;e.Widget=i=function(){function d(b,g,c){this.jencil=b;this.cls=g;c==null&&(c="div");this.$element=h("<"+c+">").addClass(g)}d.prototype.after=function(b){return this.$element.after(b.$element)};d.prototype.append=function(b){return this.$element.append(b.$element)};d.prototype.appendTo=function(b){return this.$element.appendTo(b.$element)};
d.prototype.before=function(b){return this.$element.before(b.$element)};d.prototype.prepend=function(b){return this.$element.prepend(b.$element)};d.prototype.prependTo=function(b){return this.$element.prependTo(b.$element)};return d}();e.Wrapper=function(){function d(b){d.__super__.constructor.call(this,b,"jencil")}l(d,i);return d}();e.DocumentType=function(){function d(b){d.__super__.constructor.call(this,b,"jencil-document-type");this.$documentTypeElement=this.jencil.options.documentTypeElement;
if(this.$documentTypeElement!=null){if(!(this.$documentTypeElement instanceof jQuery))this.$documentTypeElement=h(this.$documentTypeElement);this.$element.append(this.$documentTypeElement);this.$documentTypeElement.change(j(function(){return Jencil.profile.load(this.jencil,this.getProfileName())},this))}}l(d,i);d.prototype.getProfileName=function(){return this.$documentTypeElement!=null?this.$documentTypeElement.val():this.jencil.options.profile["default"]};return d}();e.ButtonHolder=function(){function d(b){d.__super__.constructor.call(this,
b,"jencil-button-holder")}l(d,i);d.prototype.update=function(){var b,g,c,a,f,d;this.$element.children().remove();f=this.jencil.profile.buttonsets;d=[];for(c=0,a=f.length;c<a;c++)b=f[c],g=b[0],b=b.slice(1,b.length+1||9E9),g=Jencil.button.createButton(this.jencil,g,b),d.push(this.append(g));return d};return d}();e.Toolbar=function(){function d(b){d.__super__.constructor.call(this,b,"jencil-toolbar")}l(d,i);return d}();return e.Workspace=function(){function d(b){d.__super__.constructor.call(this,b,"jencil-workspace");
this.editor=null}l(d,i);d.prototype.use=function(b,g){return Jencil.editor.use(this.jencil,b,j(function(){return g()},this))};return d}()});namespace("Jencil.button",function(e){var i,d;d=Jencil.widget.Widget;e.createButton=function(b,g,c){var a;switch(g){case "-":case "separator":a=Jencil.button.Separator;break;case "+":case "exec":a=Jencil.button.ExecButton;break;case "preview":a=Jencil.button.PreviewButton;break;default:if(a=Jencil.button[g],a==null)throw Error("Unknown button type is passed (type: "+
g+")");}return new a(b,c)};e.ButtonBase=i=function(){function b(g,c,a){b.__super__.constructor.call(this,g,"button","a");this.$element.addClass(c);this.$element.attr("title",a);this.$element.css("cursor","pointer");Jencil.utils.detector.browser==="Explorer"&&Jencil.utils.detector.version<8&&this.$element.attr("href","javascript:void(0);");this.$element.append(h("<span>"+a+"</span>"));this.$element.click(j(function(){this.clickBefore();this.click();return this.clickAfter()},this))}l(b,d);b.prototype.editor=
function(){return this.jencil.workspace.editor};b.prototype.clickBefore=function(){};b.prototype.click=function(){};b.prototype.clickAfter=function(){};return b}();e.MarkupButtonBase=function(){function b(){b.__super__.constructor.apply(this,arguments)}l(b,i);b.prototype.clickAfter=function(){return this.editor().update()};return b}();e.Separator=function(){function b(g){b.__super__.constructor.call(this,g,"separator","span");this.$element.append(h("<span>|</span>"))}l(b,d);return b}();e.ExecButton=
function(){function b(g,c){var a,f;a=c[0];f=c[1];this._click=c[2];this._clickBefore=c[3];this._clickAfter=c[4];b.__super__.constructor.call(this,g,a,f)}l(b,i);b.prototype.clickBefore=function(){return this._clickBefore(this.editor())};b.prototype.click=function(){return this._click(this.editor())};b.prototype.clickAfter=function(){return this._clickAfter(this.editor())};return b}();return e.PreviewButton=function(){function b(g){b.__super__.constructor.call(this,g,"preview","Preview")}l(b,i);b.prototype.click=
function(){var b,c;b=this.editor();(c=b.preview)!=null&&c.toggle();return b.relocate()};return b}()});namespace("Jencil.editor",function(e){var i,d,b,g;d=Jencil.widget.Widget;b=function(b){return b.outerWidth(!0)-b.width()};g=function(b){return b.outerHeight(!0)-b.height()};e.use=function(b,a,f){var g,d,e,i,j;f==null&&(f=void 0);d=function(){var f,g;f=Jencil.editor[a].extras;if((f!=null?f.options:void 0)!=null)b.options.extras=h.extend(!0,f.options,(g=b.options.extras)!=null?g:{});(f!=null?f.stylesheets:
void 0)!=null&&Jencil.theme.includeall(f.stylesheets);return(f!=null?f.requires:void 0)!=null?Jencil.utils.script.loadall(f.requires,function(){return e()}):e()};e=function(){var g;g=Jencil.editor[a];if(b.workspace.editor!=null)b.workspace.editor.$element.remove(),b.workspace.editor=null;g=new g(b);b.workspace.append(g);b.workspace.editor=g;g.init();if(f!=null)return f()};return a instanceof Array?(j=a,a=j[0],i=j[1],g=j[2],Jencil.utils.script.load(i,g,function(){return d()})):d()};e.EditorBase=i=
function(){function c(a,b){c.__super__.constructor.call(this,a,b);this.workspace=this.jencil.workspace;this.$element.addClass("jencil-editor");this.$element.hide()}l(c,d);c.prototype.init=function(){this.$element.show();return this.relocate()};c.prototype.update=function(){return this.relocate()};c.prototype.relocate=function(){var a,c,d,e;c=b(this.$element);d=g(this.$element);e=this.workspace.$element.width();a=this.workspace.$element.height();this.$element.width(e-c);return this.$element.height(a-
d)};return c}();e.SinglePaneEditorBase=function(){function c(a,b,g){this.pane=g;c.__super__.constructor.call(this,a,b);this.pane.$element.appendTo(this.$element);this.pane.$element.addClass("jencil-pane");this.$element.addClass("jencil-siglepane-editor")}l(c,i);c.prototype.init=function(){this.pane.init();return c.__super__.init.call(this)};c.prototype.update=function(){this.pane.update();return c.__super__.update.call(this)};c.prototype.relocate=function(){var a,f,d,e;c.__super__.relocate.call(this);
f=b(this.pane.$element);d=g(this.pane.$element);e=this.$element.width();a=this.$element.height();this.pane.$element.width(e-f);return this.pane.$element.height(a-d)};return c}();return e.DualPaneEditorBase=function(){function c(a,b,g,d,e){this.lhspane=g;this.rhspane=d;this.panedir=e!=null?e:"horizontal";c.__super__.constructor.call(this,a,b);this.lhspane.$element.appendTo(this.$element);this.rhspane.$element.appendTo(this.$element);this.lhspane.$element.addClass("jencil-lhspane");this.rhspane.$element.addClass("jencil-rhspane");
this.$element.addClass("jencil-panedir-"+this.panedir)}l(c,i);c.prototype.init=function(){this.lhspane.init();this.rhspane.init();return c.__super__.init.call(this)};c.prototype.update=function(){this.lhspane.update();this.rhspane.update();return c.__super__.update.call(this)};c.prototype.relocate=function(){var a,f,d,e,h,i;c.__super__.relocate.call(this);this.lhspane.isVisible()&&this.rhspane.isVisible()?(this.$element.removeClass("jencil-singlepane-editor"),this.$element.addClass("jencil-dualpane-editor")):
(this.$element.addClass("jencil-singlepane-editor"),this.$element.removeClass("jencil-dualpane-editor"));f=b(this.lhspane.$element);e=b(this.rhspane.$element);d=g(this.lhspane.$element);h=g(this.rhspane.$element);i=this.$element.width();a=this.$element.height();this.lhspane.isVisible()&&this.rhspane.isVisible()?this.panedir==="horizontal"?(this.lhspane.$element.css({"float":"left"}),this.rhspane.$element.css({"float":"right"}),this.lhspane.$element.width(i/2-f),this.rhspane.$element.width(i/2-e),
this.lhspane.$element.height(a-d),this.rhspane.$element.height(a-h)):(this.lhspane.$element.css({"float":"none"}),this.rhspane.$element.css({"float":"none"}),this.lhspane.$element.width(i-f),this.rhspane.$element.width(i-e),this.lhspane.$element.height(a/2-d),this.rhspane.$element.height(a/2-h)):this.lhspane.isVisible()?(this.lhspane.$element.css({"float":"none"}),this.lhspane.$element.width(i-f),this.lhspane.$element.height(a-d)):(this.rhspane.$element.css({"float":"none"}),this.rhspane.$element.width(i-
e),this.rhspane.$element.height(a-h));this.lhspane.relocate();return this.rhspane.relocate()};return c}()});namespace("Jencil.editor.pane",function(e){var i,d;d=Jencil.widget.Widget;e.EditorPane=i=function(){function b(g,c,a){this.editor=a;b.__super__.constructor.call(this,g,c);this._updateCallbacks=[]}l(b,d);b.prototype.init=function(){return this};b.prototype.update=function(b){var c,a,f,d;if(b!=null)return this._updateCallbacks.push(b);else{f=this._updateCallbacks;d=[];for(c=0,a=f.length;c<a;c++)b=
f[c],d.push(b());return d}};b.prototype.isVisible=function(){return this.$element.is(":visible")};b.prototype.show=function(){this.update();this.editor.$element.removeClass(""+this.cls+"-invisible");return this.$element.show()};b.prototype.hide=function(){this.editor.$element.addClass(""+this.cls+"-invisible");return this.$element.hide()};b.prototype.toggle=function(){return this.isVisible()?this.hide():this.show()};b.prototype.relocate=function(){};return b}();return e.PreviewPane=function(){function b(g,
c){b.__super__.constructor.call(this,g,"jencil-preview-pane",c);this.$element.css({position:"relative"});this.$surface=h("<div>").addClass("surface");this.$surface.appendTo(this.$element);this.$surface.css({width:"100%",height:"100%",border:"",margin:0,padding:0,overflow:"auto"})}l(b,i);b.prototype._writeContent=function(b){var c,a;c=j(function(a){return this.$surface.html(a.replace("{{content}}",b))},this);return this._previewTemplate==null?(a=Jencil.utils.path.abspath(this.jencil.options.extras.previewTemplatePath),
this.$surface.load(a,j(function(a){this._previewTemplate=a;return c(a)},this))):c(this._previewTemplate)};b.prototype.update=function(){var g,c;g=j(function(a){this._writeContent(a);return g.__super__.constructor.call(this)},this);g.__super__=b.__super__.update.apply(this,arguments);c=j(function(){var a,b;a=this.editor.getValue();return((b=this.jencil.profile.extras)!=null?b.previewParserPath:void 0)!=null?(a=encodeURIComponent(a),h.ajax({url:Jencil.utils.path.abspath(this.jencil.profile.extras.previewParserPath),
type:this.jencil.profile.extras.previewParserMethod||"GET",dataType:this.jencil.profile.extras.previewParserType||"text",data:""+(this.jencil.profile.extras.previewParserVal||"data")+"="+a,success:j(function(a){return g(a)},this)})):g(a)},this);return this.jencil.profile!=null?c():setTimeout(j(function(){return this.jencil.profile!=null?c():setTimeout(arguments.callee,100)},this),100)};b.prototype.relocate=function(){b.__super__.relocate.call(this);if(Jencil.utils.detector.browser==="Explorer"&&Jencil.utils.detector.version<
8)return this.$surface.height(this.$element.height())};return b}()});namespace("Jencil.editor.pane",function(e){var i;i=Jencil.editor.pane.EditorPane;return e.TextareaPane=function(){function d(b,g){d.__super__.constructor.call(this,b,"jencil-textarea-pane",g);this.$element.css({position:"relative"});this.$surface=h("<textarea>").addClass("surface");this.$surface.appendTo(this.$element);this.$surface.css({width:"100%",height:"100%",border:"none",margin:0,padding:0,resize:"none",outline:"none"});this.$surface.bind("keypress click change blur enter",
j(function(){return this.update()},this));this.controller=new Textarea(this.$surface)}l(d,i);d.prototype.relocate=function(){d.__super__.relocate.call(this);if(Jencil.utils.detector.browser==="Explorer"&&Jencil.utils.detector.version<8)return this.$surface.height(this.$element.height())};d.prototype.getValue=function(){return this.controller.getValue()};d.prototype.setValue=function(b){return this.controller.setValue(b)};return d}()});namespace("Jencil.editor",function(e){var i,d,b;i=Jencil.editor.DualPaneEditorBase;
d=Jencil.editor.pane.PreviewPane;b=Jencil.editor.pane.TextareaPane;return e.TextEditor=function(){function g(c){var a,f;(a=c.options.extras.previewPosition)==="top"||a==="left"?(a=this.preview=new d(c,this),f=this.textarea=new b(c,this)):(a=this.textarea=new b(c,this),f=this.preview=new d(c,this));g.__super__.constructor.call(this,c,"jencil-text-editor",a,f);this.$element.addClass("jencil-preview-position-"+this.jencil.options.extras.previewPosition);this.setValue(this.jencil.getSourceValue());this.jencil.options.extras.defaultPreviewState===
"close"&&this.preview.hide();this.textarea.update(j(function(){this.jencil.setSourceValue(this.getValue());return this.preview.update()},this))}l(g,i);g.extras={options:{previewPosition:"right",previewTemplatePath:"~/extras/templates/preview.html",defaultPreviewState:"open"}};g.prototype.init=function(){h.fn.tabby!=null&&this.textarea.$element.tabby();return g.__super__.init.call(this)};g.prototype.relocate=function(){g.__super__.relocate.call(this);if(Jencil.utils.detector.browser==="Explorer"&&
Jencil.utils.detector.version===8)return document.selection.createRange().select()};g.prototype.getValue=function(){return this.textarea.getValue()};g.prototype.setValue=function(b){return this.textarea.setValue(b)};g.prototype.getSelection=function(){return this.textarea.controller.getSelection()};g.prototype.setSelection=function(b,a){return this.textarea.controller.setSelection(b,a)};g.prototype.getSelected=function(){return this.textarea.controller.getSelected()};g.prototype.replaceSelected=function(b,
a){a==null&&(a=!1);return this.textarea.controller.replaceSelected(b,a)};g.prototype.insertBeforeSelected=function(b,a){a==null&&(a=!1);return this.textarea.controller.insertBeforeSelected(b,a)};g.prototype.insertAfterSelected=function(b,a){a==null&&(a=!1);return this.textarea.controller.insertAfterSelected(b,a)};g.prototype.wrapSelected=function(b,a,g,d){g==null&&(g=!1);d==null&&(d=void 0);return this.textarea.controller.wrapSelected(b,a,g,d)};return g}()});namespace("Jencil.button",function(e){var h,
d;h=Jencil.button.ButtonBase;e.MarkupButtonBase=d=function(){function b(){b.__super__.constructor.apply(this,arguments)}l(b,h);b.prototype.clickAfter=function(){return this.editor().update()};return b}();e.SimpleMarkupButton=function(){function b(g,c){var a,f;a=c[0];f=c[1];this.before=c[2];this.after=c[3];this.insert=c[4];b.__super__.constructor.call(this,g,a,f)}l(b,d);b.prototype.click=function(){return this.editor().wrapSelected(this.before,this.after,!0,this.insert||this.jencil.options.defaultInsertText)};
return b}();e.MultilineMarkupButton=function(){function b(g,c){var a,f;a=c[0];f=c[1];this.before=c[2];this.after=c[3];this.blockBefore=c[4];this.blockAfter=c[5];b.__super__.constructor.call(this,g,a,f)}l(b,d);b.prototype.click=function(){var b,c,a,f,d,e,h;f=this.editor().getSelected().split("\n");a=f[0]===this.blockBefore?1:0;for(b=0,h=f.length;0<=h?b<h:b>h;0<=h?b++:b--)e=Jencil.utils.string.format(this.before,{i:b+1-a}),d=Jencil.utils.string.format(this.after,{i:b+1-a}),c=f[b],c===this.blockBefore||
c===this.blockAfter||(f[b]=c.startsWith(e)&&c.endsWith(d)?c.substring(e.length,c.length-d.length):""+e+c+d);this.blockBefore!==void 0&&(f[0]===this.blockBefore?f.shift():f.unshift(this.blockBefore));this.blockAfter!==void 0&&(f[f.length-1]===this.blockAfter?f.pop():f.push(this.blockAfter));b=f.join("\n");return this.editor().replaceSelected(b,!0)};return b}();e.LinkMarkupButton=function(){function b(d,c){this.formatstr=c[0];b.__super__.constructor.call(this,d,"link","Link")}l(b,d);b.prototype.click=
function(){var b,c,a;b=prompt("Please input link url");if(b!==null&&(c=prompt("Please input link label",this.editor().getSelected()),c!==null&&(a=prompt("(Optional) Please input link title"),a!==null)))return b=Jencil.utils.string.format(this.formatstr,{href:b,label:c,title:a}),this.editor().replaceSelected(b)};return b}();return e.ImageMarkupButton=function(){function b(d,c){this.formatstr=c[0];b.__super__.constructor.call(this,d,"image","Image")}l(b,d);b.prototype.click=function(){var b,c,a;c=prompt("Please input image src url");
if(c!==null&&(b=prompt("(Optional) Please input image alt label",this.editor().getSelected()),b!==null&&(a=prompt("(Optional) Please input image title"),a!==null)))return b=Jencil.utils.string.format(this.formatstr,{src:c,alt:b,title:a}),this.editor().replaceSelected(b)};return b}()});namespace("Jencil.editor.pane",function(e){var i;i=Jencil.editor.pane.EditorPane;return e.RichareaPane=function(){function d(b,e){var c;d.__super__.constructor.call(this,b,"jencil-richarea-pane",e);this.$element.css({position:"relative"});
this.$surface=h("<iframe>").addClass("surface");this.$surface.appendTo(this.$element);this.$surface.css({width:"100%",height:"100%",border:"none",margin:0,padding:0});if(this.jencil.options.extras.richareaTemplatePath!=null)c=this.jencil.options.extras.richareaTemplatePath,this.$surface.attr("src",Jencil.utils.path.abspath(c));Jencil.utils.detector.browser==="Explorer"&&this.$surface.attr("frameborder",0);this.controller=null}l(d,i);d.prototype.init=function(){this.controller=new Richarea(this.$surface);
return this.controller.ready(j(function(){this.relocate();this.$body=h(this.controller.raw.body);this.$body.css({margin:0,padding:0});this.$body.bind("keypress change click blur enter",j(function(){return this.update()},this));return d.__super__.init.call(this)},this))};d.prototype.relocate=function(){d.__super__.relocate.call(this);Jencil.utils.detector.browser==="Explorer"&&Jencil.utils.detector.version<8&&this.$surface.height(this.$element.height());if(Jencil.utils.detector.browser==="Explorer"&&
Jencil.utils.detector.version<9)return this.$body.height(this.$surface.height())};d.prototype.getValue=function(){var b;if((b=this.controller)!=null&&b.ready())return this.controller.getValue()};d.prototype.setValue=function(b){var d;if((d=this.controller)!=null&&d.ready())return this.controller.setValue(b)};return d}()});namespace("Jencil.editor",function(e){var h,d,b;h=Jencil.editor.DualPaneEditorBase;b=Jencil.editor.pane.TextareaPane;d=Jencil.editor.pane.RichareaPane;return e.RichEditor=function(){function e(c){var a,
f;(a=c.options.extras.previewPosition)==="top"||a==="left"?(a=this.preview=new b(c,this),f=this.richarea=new d(c,this)):(a=this.richarea=new d(c,this),f=this.preview=new b(c,this));e.__super__.constructor.call(this,c,"jencil-rich-editor",a,f);this.$element.addClass("jencil-preview-position-"+this.jencil.options.extras.previewPosition);this.jencil.options.extras.defaultPreviewState==="close"&&this.preview.hide()}l(e,h);e.extras={options:{richareaTemplatePath:"~/extras/templates/richarea.html"}};e.prototype.init=
function(){e.__super__.init.call(this);return this.richarea.controller.ready(j(function(){this.setValue(this.jencil.getSourceValue());this.preview.setValue(this.getValue());this.richarea.update(j(function(){this.jencil.setSourceValue(this.getValue());return this.preview.setValue(this.getValue())},this));this.preview.update(j(function(){this.jencil.setSourceValue(this.preview.getValue());return this.richarea.setValue(this.preview.getValue())},this));return this.update()},this))};e.prototype.getValue=
function(){return this.richarea.getValue()};e.prototype.setValue=function(b){return this.richarea.setValue(b)};return e}()});namespace("Jencil.button",function(e){var h,d;d=Jencil.button.MarkupButtonBase;e.CommandButton=h=function(){function b(d,c){var a,f;f=c[0];a=c[1];this.command=c[2];this.args=c[3];b.__super__.constructor.call(this,d,f,a)}l(b,d);b.prototype.click=function(){return this.exec(this.command,this.args)};b.prototype.exec=function(b,c){if(this.editor().richarea.controller!=null)return this.editor().richarea.controller.execCommand(b,
c)};return b}();return e.PromptCommandButton=function(){function b(d,c){var a,f,e;e=c[0];a=c[1];f=c[2];this.message=c[3];this.defaultValue=c[4];b.__super__.constructor.call(this,d,[e,a,f,void 0])}l(b,h);b.prototype.click=function(){var b;b=prompt(this.message,this.defaultValue||"");return b===null?void 0:this.exec(this.command,b)};return b}()})}).call(this);
