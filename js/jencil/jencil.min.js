/*!
 * Jencil - A JavaScript Cross-browser WYSIWYM and WYSIWYG editor v0.0.2rc2
 * http://lambdalisue.github.com/Jencil
 * 
 * Copyright 2011 (c) hashnote.net, Alisue allright reserved.
 * Licensed under the MIT license.
 * 
 * Dependencies:
 * - jQuery v1.4.2
 *   http://jquery.com/
 * - Tabby jQuery plugin v0.12
 *   http://teddevito.com/demos/textarea.html
 * - Textarea v0.1.0 (included)
 *   http://demos.textarea.hashnote.net/
 * - Richarea v0.1.1 (included)
 *   http://demos.richarea.hashnote.net/
 * 
 * Includes Tabby jQuery plugin v0.12
 *   http://teddevito.com/demos/textarea.html
 *   Copyright (c) 2009 Ted Devito
 * 
 * Includes Textarea v0.1.0
 *   http://demos.textarea.hashnote.net/
 *   Copyright (c) 2011 hashnote.net, Alisue allright reserved
 * 
 * Includes Richarea v0.1.1 (included)
 *   http://demos.richarea.hashnote.net/
 *   Copyright (c) 2011 hashnote.net, Alisue allright reserved
 * 
 * Last-Modified: Thu, 06 Oct 2011 16:12:26 GMT
 */
(function(){this.Textarea=function(){function i(m){this.textarea=typeof jQuery!=="undefined"&&jQuery!==null&&m instanceof jQuery?m.get(0):m}i.prototype.getValue=function(){return this.textarea.value};i.prototype.setValue=function(m){return this.textarea.value=m};i.prototype.getSelection=function(){var m,i;if(document.selection)i=document.selection.createRange(),m=i.duplicate(),m.moveToElementText(this.textarea),m.setEndPoint("EndToEnd",i),m=m.text.length-i.text.length,i=m+i.text.length;else if(this.textarea.setSelectionRange)m=
this.textarea.selectionStart,i=this.textarea.selectionEnd;return[m,i]};i.prototype.setSelection=function(m,i){var k,n;n=this.textarea.scrollTop;if(this.textarea.createTextRange){if($.browser.opera&&$.browser.version>=9.5&&length===0)return!1;k=this.textarea.createTextRange();k.collapse(!0);k.moveStart("character",m);k.moveEnd("character",i-m);k.select()}else this.textarea.setSelectionRange&&this.textarea.setSelectionRange(m,i);this.textarea.focus();return this.textarea.scrollTop=n};i.prototype.getSelected=
function(){var m,i,k;if(document.selection)return m=document.selection.createRange(),m.text;else if(this.textarea.setSelectionRange)return k=this.getSelection(),i=k[0],m=k[1],this.textarea.value.substring(i,m);return!1};i.prototype._replaceSelected=function(i,o,k){o==null&&(o=void 0);k==null&&(k=void 0);if(document.selection)return this.textarea.focus(),k=document.selection.createRange(),k.text=i,k.select();else if(this.textarea.setSelectionRange)return o=this.textarea.value.substring(0,o),k=this.textarea.value.substring(k),
this.textarea.value=o+i+k};i.prototype.replaceSelected=function(i,o){var k,n,j;o==null&&(o=!1);n=this.textarea.scrollTop;k=this.getSelection();j=k[0];k=k[1];this._replaceSelected(i,j,k);k=j+i.length;o||(j=k);this.setSelection(j,k);this.textarea.focus();return this.textarea.scrollTop=n};i.prototype.insertBeforeSelected=function(i,o){var k,n,j,h;o==null&&(o=!1);n=this.textarea.scrollTop;j=this.getSelection();h=j[0];k=j[1];j=this.getSelected();this._replaceSelected(i+j,h,k);k=h+i.length;o||(h=k);this.setSelection(h,
k);this.textarea.focus();return this.textarea.scrollTop=n};i.prototype.insertAfterSelected=function(i,o){var k,n,j,h;o==null&&(o=!1);n=this.textarea.scrollTop;j=this.getSelection();h=j[0];k=j[1];j=this.getSelected();this._replaceSelected(j+i,h,k);k=h+i.length;o?h+=j.length:h=k;this.setSelection(h,k);this.textarea.focus();return this.textarea.scrollTop=n};i.prototype.wrapSelected=function(i,o,k,n){var j,h,g,d,b;k==null&&(k=!1);n==null&&(n=void 0);g=this.getSelected();return g.indexOf(i)===0&&g.lastIndexOf(o)===
g.length-o.length?(i=g.substring(i.length,g.length-o.length),this.replaceSelected(i,k)):(g===""&&n!=null?g=n:n=void 0,h=this.textarea.scrollTop,b=this.getSelection(),d=b[0],j=b[1],this._replaceSelected(i+g+o,d,j),k?n?(j=d+i.length+g.length,d+=i.length):j=d+i.length+o.length+g.length:d=j=d+i.length+g.length+o.length,this.setSelection(d,j),this.textarea.focus(),this.textarea.scrollTop=h)};return i}()}).call(this);
(function(){var i,m,o,k,n,j,h,g,d,b,e=function(a,f){return function(){return a.apply(f,arguments)}},c=Array.prototype.indexOf||function(a){for(var f=0,l=this.length;f<l;f++)if(this[f]===a)return f;return-1};o=function(){function a(){this.browser=this.searchString(a.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"An unknown browser";this.OS=this.searchString(a.dataOS)||"An unknown OS"}a.prototype.searchString=function(f){var a,
b,c;for(b=0,c=f.length;b<c;b++)if(a=f[b],this.versionSearchString=a.versionSearch||a.identify,a.string!=null)if(a.string.indexOf(a.subString)!==-1)return a.identify;else if(a.prop)return a.identify;return[]};a.prototype.searchVersion=function(f){var a;a=f.indexOf(this.versionSearchString);return a===-1?void 0:parseFloat(f.substring(a+this.versionSearchString.length+1))};a.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identify:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",
versionSearch:"OmniWeb/",identify:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identify:"Safari",versionSearch:"Version"},{prop:window.opera,identify:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identify:"iCab"},{string:navigator.vendor,subString:"KDE",identify:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identify:"Firefox"},{string:navigator.vendor,subString:"Camino",identify:"Camino"},{string:navigator.userAgent,subString:"Netscape",identify:"Netscape"},
{string:navigator.userAgent,subString:"MSIE",identify:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identify:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identify:"Netscape",versionSearch:"Mozilla"}];a.dataOS=[{string:navigator.platform,subString:"Win",identify:"Windows"},{string:navigator.platform,subString:"Mac",identify:"Mac"},{string:navigator.userAgent,subString:"iPhone",identify:"iPhone/iPad"},{string:navigator.platform,subString:"Linux",
identify:"Linux"}];return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Detector=o;b=function(a,f){var l,b;for(b in f)l=f[b],a.prototype[b]=l;return a};if(typeof exports!=="undefined"&&exports!==null)exports.partial=b;m=function(){function a(){}a.findChildPosition=function(f){var a;for(a=0;f.previousSibling;)f=f.previousSibling,a+=1;return a};a.isDataNode=function(f){return f!=null&&f.nodeValue!=null&&f.data!=null};a.isDataContainerNode=function(f){var l,b,c;if(f.firstChild==null)return!1;
c=f.childNodes;for(l=0,b=c.length;l<b;l++)if(f=c[l],!a.isDataNode(f))return!1;return!0};a.isAncestorOf=function(f,l){var b,c,e;b=!a.isDataNode(f);c=typeof f.contains==="function"?f.contains(a.isDataNode(l)?l.parentNode:l):void 0;e=l.parentNode===f;return b&&(c||e)};a.isAncestorOrSelf=function(f,l){return a.isAncestorOf(f,l)||f===l};a.findClosestAncestor=function(f,l){if(a.isAncestorOf(f,l))for(;(l!=null?l.parentNode:void 0)!==f;)l=l.parentNode;return l};a.getNodeLength=function(f){if(a.isDataNode(f))return f.length||
f.childNodes.length};a.splitDataNode=function(f,l){var b;if(!a.isDataNode(f))return!1;b=f.cloneNode(!1);f.deleteData(l,f.length);b.deleteData(0,l);return f.parentNode.insertBefore(b,f.nextSibling)};return a}();h=function(){function a(){}a.convertToW3CRange=function(f,a){var b,c,e,d;b=function(f,b,c){var e,d,p,g,h;p=a.createElement("span");d=b.duplicate();d.collapse(c);g=d.parentElement();e=function(f,a){return f.compareEndPoints(c?"StartToStart":"StartToEnd",a)};h=function(){g.insertBefore(p,p.previousSibling);
return d.moveToElementText(p)};for(h();e(d,b)>0&&p.previousSibling;)h();if(e(d,b)===-1&&p.nextSibling)d.setEndPoint(c?"EndToStart":"EndToEnd",b),f[c?"setStart":"setEnd"](p.nextSibling,d.text.length);else f[c?"setStartBefore":"setEndBefore"](p);return p.parentNode.removeChild(p)};d=new g(a);c=f.compareEndPoints("StartToEnd",f)!==0;e=f.parentElement().isContentEditable;if(c&&e)b(d,f,!0),b(d,f,!1),d.startContainer===d.endContainer&&d.endOffset===1&&m.isDataContainerNode(d.startContainer)&&(b=m.getNodeLength(d.endContainer.firstChild),
d.setEnd(d.endContainer,b));else if(e)e=f.duplicate(),c=e.parentElement(),b=a.createElement("span"),c.insertBefore(b,c.firstChild),e.moveToElementText(b),e.setEndPoint("EndToEnd",f),e=e.text.length,d.setStart(c,e),d.setEnd(c,e),c.removeChild(b);return d};a.convertFromW3CRange=function(f){var a,b;a=function(f,a,l){var b,c,e,d,p;e=a[l?"startContainer":"endContainer"];d=a[l?"startOffset":"endOffset"];p=0;b=m.isDataNode(e)?e:e.childNodes[d];c=b.parentNode;if(e.nodeType===3||e.nodeType===4)p=d;e=a._document.createElement("span");
c.insertBefore(e,b);a=a._document.body.createTextRange();a.moveToElementText(e);e.parentNode.removeChild(e);f.setEndPoint(l?"StartToStart":"EndToStart",a);return f[l?"moveStart":"moveEnd"]("character",p)};b=f._document.body.createTextRange();a(b,f,!0);a(b,f,!1);return b};return a}();n=function(){function a(f){var a;this.range=f;if(!this.range.collapsed)a=f.commonAncestorContainer,this._current=null,this._next=f.startContainer===a&&!m.isDataNode(f.startContainer)?f.startContainer.childNodes[f.startOffset]:
m.findClosestAncestor(a,f.startContainer),this._end=f.endContainer===a&&!m.isDataNode(f.endContainer)?f.endContainer.childNodes[f.endOffset]:m.findClosestAncestor(a,f.endContainer).nextSibling}a.prototype.hasNext=function(){return this._next!=null};a.prototype.next=function(){var f;f=this._current=this._next;this._next=this._current!=null&&this._current.nextSibling!==this._end?this._current.nextSibling:null;m.isDataNode(this._current)&&(this.range.endContainer===this._current&&(f=f.cloneNode(!0),
f.deleteData(this.range.endOffset,f.length-this.range.endOffset)),this.range.startContainer===this._current&&(f=f.cloneNode(!0),f.deleteData(0,this.range.startOffset)));return f};a.prototype.remove=function(){var f,a;return m.isDataNode(this._current&&(this.range.startContainer===this._current||this.range.endContainer===this._current))?(a=this.range.startContainer===this._current?this.range.startOffset:0,f=this.range.endContainer===this._current?this.range.endOffset:this._current.length,this._current.deleteData(a,
f-a)):this._current.parentNode.removeChild(this._current)};a.prototype.hasPartialSubtree=function(){var f,a,b;f=!m.isDataNode(this._current);a=m.isAncestorOrSelf(this._current,this.range.startContainer);b=m.isAncestorOrSelf(this._current,this.range.endContainer);return f&&(a||b)};a.prototype.getSubtreeIterator=function(){var f;f=new g(this.range._document);f.selectNodeContents(this._current);m.isAncestorOrSelf(this._current,this.range.startContainer)&&f.setStart(this.range.startContainer,this.range.startOffset);
m.isAncestorOrSelf(this._current,this.range.endContainer)&&f.setEnd(this.range.endContainer,this.range.endOffset);return new a(f)};return a}();g=function(){function a(f){this._document=f;this.startContainer=f.body;this.startOffset=0;this.endContainer=f.body;this.endOffset=m.getNodeLength(f.body);this.commonAncestorContainer=null;this.collapsed=!1}a.START_TO_START=0;a.START_TO_END=1;a.END_TO_END=2;a.END_TO_START=3;a.prototype._refreshProperties=function(){var f;this.collapsed=this.startContainer===
this.endContainer&&this.startOffset===this.endOffset;for(f=this.startContainer;f!=null&&f!==this.endContainer&&!m.isAncestorOf(f,this.endContainer);)f=f.parentNode;return this.commonAncestorContainer=f};a.prototype.setStart=function(f,a){this.startContainer=f;this.startOffset=a;return this._refreshProperties()};a.prototype.setEnd=function(f,a){this.endContainer=f;this.endOffset=a;return this._refreshProperties()};a.prototype.setStartBefore=function(f){var a;a=f.parentNode;f=m.findChildPosition(f);
return this.setStart(a,f)};a.prototype.setStartAfter=function(f){var a;a=f.parentNode;f=m.findChildPosition(f);return this.setStart(a,f+1)};a.prototype.setEndBefore=function(f){var a;a=f.parentNode;f=m.findChildPosition(f);return this.setEnd(a,f)};a.prototype.setEndAfter=function(f){var a;a=f.parentNode;f=m.findChildPosition(f);return this.setEnd(a,f+1)};a.prototype.selectNode=function(f){this.setStartBefore(f);return this.setEndAfter(f)};a.prototype.selectNodeContents=function(f){this.setStart(f,
0);return this.setEnd(f,m.getNodeLength(f))};a.prototype.collapse=function(f){return f?this.setEnd(this.startContainer,this.startOffset):this.setStart(this.endContainer,this.endOffset)};a.prototype.cloneContents=function(){var f;f=function(a){var b,c;for(b=document.createDocumentFragment();(c=a.next())!=null;)c=c.cloneNode(!a.hasPartialSubtree()),a.hasPartialSubtree()&&c.appendChild(f(a.getSubtreeIterator())),b.appendChild(c);return flag};return f(new n(this))};a.prototype.extractContents=function(){var f,
a;a=this.cloneRange();this.startContainer!==this.commonAncestorContainer&&this.setStartAfter(m.findClosestAncestor(this.commonAncestorContainer,this.startContainer));this.collapse(!0);f=function(a){var b,l;for(b=document.createDocumentFragment();(l=a.next())!=null;)a.hasPartialSubtree(),a.hasPartialSubtree()?l=l.cloneNode(!1):a.remove(),a.hasPartialSubtree()&&l.appendChild(f(a.getSubtreeIterator())),b.appendChild(l);return b};return f(new n(a))};a.prototype.deleteContents=function(){var a,b;b=this.cloneRange();
this.startContainer!==this.commonAncestorContainer&&this.setStartAfter(m.findClosestAncestor(this.commonAncestorContainer,this.startContainer));this.collapse(!0);return a=function(c){for(;c.next();)c.hasPartialSubtree()?a(c.getSubtreeIterator()):c.remove();return a(new n(b))}};a.prototype.insertNode=function(a){m.isDataNode(this.startContainer)?(m.splitDataNode(this.startContainer,this.startOffset),this.startContainer.parentNode.insertBefore(a,this.startContainer.nextSibling)):this.startContainer.insertBefore(a,
this.startContainer.childNodes[this.startOffset]);return this.setStart(this.startContainer,this.startOffset)};a.prototype.surroundContents=function(a){var b;b=this.extractContents();this.insertNode(a);a.appendChild(b);return this.selectNode(a)};a.prototype.compareBoundaryPoints=function(f,b){var c,e,d,g;switch(f){case a.START_TO_START:case a.START_TO_END:c=this.startContainer;d=this.startOffset;break;case a.END_TO_END:case a.END_TO_START:c=this.endContainer,d=this.endOffset}switch(f){case a.START_TO_START:case a.END_TO_START:e=
b.startContainer;g=b.startOffset;break;case a.START_TO_END:case a.END_TO_END:e=b.endContainer,g=b.endOffset}if(c.sourceIndex<e.souceIndex)return-1;if(c.sourceIndex===e.sourceIndex){if(d<g)return-1;if(d===g)return 0}return 1};a.prototype.cloneRange=function(){var f;f=new a(this.document);f.setStart(this.startContainer,this.startOffset);f.setEnd(this.endContainer,this.endOffset);return f};a.prototype.detach=function(){};a.prototype.toString=function(){return h.convertFromW3CRange(this).text};a.prototype.createContextualFragment=
function(a){var b;b=m.isDataNode(this.startContainer)?this.startContainer.parentNode:this.startContainer;b=b.cloneNode(!1);b.innerHTML=a;for(a=this._document.createDocumentFragment();b.firstChild!=null;)a.appendChild(b.firstChild);return a};return a}();d=function(){function a(a){this.rangeCount=0;this._document=a;this._document.parentWindow.focus();this._document.attachEvent("onselectionchange",e(function(){return this._selectionChangeHolder()},this));this._refreshProperties()}a.prototype._selectionChangeHolder=
function(){var a,b;b=this._document.selection.createRange();a=b.compareEndPoints("StartToEnd",b)!==0;b=b.parentElement().isContentEditable;return a&&b?this.rangeCount=1:this.rangeCount=0};a.prototype._refreshProperties=function(){var a;a=this.getRangeAt(0);return this.isCollapsed=a==null||a.collapsed?!0:!1};a.prototype.addRange=function(a){var b;b=this._document.selection.createRange();a=h.convertFromW3CRange(a);return this._selectionExists(b)?(a.compareEndPoints("StartToStart",b)===-1?a.compareEndPoints("StartToEnd",
b)>-1&&a.compareEndPoints("EndToEnd",b)===-1&&b.setEndPoint("StartToStart",a):a.compareEndPoints("EndToStart",b)<1&&a.compareEndPoints("EndToEnd",b)>-1&&b.sendEndPoint("EndToEnd",a),b.select()):a.select()};a.prototype.removeAllRanges=function(){return this._document.selection.empty()};a.prototype.getRangeAt=function(){var a;try{return a=this._document.selection.createRange(),h.convertToW3CRange(a,this._document)}catch(b){return null}};a.prototype.toString=function(){return this._document.selection.createRange().text};
return a}();String.prototype.startsWith=function(a){return this.lastIndexOf(a,0)===0};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};k=function(){function a(){}a.prototype.CONTAINER_ELEMENTS="body,div,center,blockquote,li,td".split(",");a.prototype.BLOCK_ELEMENTS="address,dir,dl,form,h1,h2,h3,h4,h5,h6,hr,menu,noframes,ol,p,pre,table,ul,xmp".split(",");a.prototype.createElementFromHTML=function(a){var b;b=document.createElement("div");b.innerHTML=a;return b.firstChild};a.prototype.getTextContent=
function(a,b){var c;b==null&&(b=!1);c=a.textContent||a.nodeValue;return b?c.trim():c};a.prototype.isContainerNode=function(a){var b,e;return(b=(e=a.tagName)!=null?e.toLowerCase():void 0,a=b)&&c.call(this.CONTAINER_ELEMENTS,a)>=0};a.prototype.isBlockNode=function(a){var b,e;return(b=(e=a.tagName)!=null?e.toLowerCase():void 0,a=b)&&c.call(this.BLOCK_ELEMENTS,a)>=0};a.prototype.isInlineNode=function(a){return!this.isContainerNode(a&&!this.isBlockNode(a))};a.prototype.isVisibleNode=function(a){var b,
c,e;if(a.nodeType===3)return a=this.getTextContent(a),a=a.replace(/\s\t\r\n/,""),a.length!==0;else{e=a.childNodes;for(b=0,c=e.length;b<c;b++)if(a=e[b],this.isVisibleNode(a)===!1)return!1;return!0}};a.prototype.isIsolateNode=function(a){return!a.nextSibling&&!a.previousSibling};a.prototype.getNextNode=function(a){for(;!a.nextSibling;)if(a=a.parentNode,!a)return null;return a.nextSibling};a.prototype.getNextLeaf=function(a){for(a=this.getNextNode(a);(a!=null?a.firstChild:void 0)!=null;)a=a.firstChild;
return a};a.prototype.getPreviousNode=function(a){for(;!a.previousSibling;)if(a=a.parentNode,!a)return null;return a.previousSibling};a.prototype.getPreviousLeaf=function(a){for(a=this.getPreviousNode(a);(a!=null?a.lastChild:void 0)!=null;)a=a.lastChild;return a};a.prototype.extractLeaf=function(a,b,c){var e,d,g,h;b==null&&(b=void 0);c==null&&(c=void 0);d=this.getTextContent(a,!1);b==null&&(b=0);if(c==null)c=d.length;if(b===c||b===0&&c===d.length)return a;e=d.substring(0,b);b=d.substring(b,c);g=d.substring(c,
d.length);c=a.nextSibling;d=a.parentNode;d.removeChild(a);e.length>0&&(a=document.createTextNode(e.trim()),this.isVisibleNode(a)&&d.insertBefore(a,c));b.length>0&&(h=document.createTextNode(b.trim()),d.insertBefore(h,c));g.length>0&&(a=document.createTextNode(g.trim()),this.isVisibleNode(a)&&d.insertBefore(a,c));return h};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=k;if(typeof require!=="undefined"&&require!==null)b=require("./partial").partial,k=require("./nodeutils.core").NodeUtils;
k=b(k,{_unwrapNode:function(a){var b,c,e,d;e=a.parentNode;c=e.nextSibling;b=e.parentNode;b.removeChild(e);for(d=[];e.firstChild!=null;)a=e.firstChild,d.push(b.insertBefore(a,c));return d},unwrapNode:function(a,b,e){var d,g,h;for(e==null&&(e=!1);a.parentNode!=null&&(e||this.isIsolateNode(a));){d=a.parentNode;if(g=(h=d.tagName)!=null?h.toLowerCase():void 0,c.call(b,g)>=0)return this._unwrapNode(a),!0;a=d}return!1},convertNode:function(a,b,e,d){var g,h,i,j;d==null&&(d=!1);for(i=function(a,b){var f,c;
f=a.nextSibling;c=a.parentNode;for(c.removeChild(a);a.firstChild!=null;)b.appendChild(a.firstChild);return c.insertBefore(b,f)};a.parentNode!=null&&(d||this.isIsolateNode(a));){g=a.parentNode;h=(j=g.tagName)!=null?j.toLowerCase():void 0;if(c.call(b,h)>=0)return h===e.tagName.toLowerCase()?this._unwrapNode(a):i(g,e),!0;a=g}return!1},wrapLeaf:function(a,b,c){var e,d,g;c==null&&(c=!0);if(!this.isVisibleNode(a))return!1;d=function(a,b){var f,c;f=a.nextSibling;c=a.parentNode;c.removeChild(a);b.appendChild(a);
return c.insertBefore(b,f)};g=function(a,b){var f,c,e,d,l;d=a.parentNode;l=null;if(a.previousSibling!=null){l=d.cloneNode(!1);for(f=a;f.previousSibling!=null;)f=f.previousSibling,l.insertBefore(f,l.firstChild)}e=null;if(a.nextSibling!=null){e=d.cloneNode(!1);for(f=a;f.nextSibling!=null;)f=f.nextSibling,e.insertBefore(f,null)}c=d.nextSibling;f=d.parentNode;f.removeChild(d);l!=null&&f.insertBefore(l,c);b.appendChild(a);f.insertBefore(b,c);if(e!=null)return f.insertBefore(e,c)};if(this.isContainerNode(b)){if(c||
!this.unwrapNode(a,[b.tagName.toLowerCase()],!0)){for(c=a;c.parentNode!=null;){e=c.parentNode;if(this.isContainerNode(e))return d(c,b),!0;c=e}d(a,b)}}else if(this.isBlockNode(b)){if(c||!this.convertNode(a,this.BLOCK_ELEMENTS,b,!0)){for(c=a;c.parentNode!=null;){e=c.parentNode;if(this.isContainerNode(e)&&this.isBlockNode(e))return g(c,b),!0;c=e}for(c=a;c.parentNode!=null;){e=c.parentNode;if(this.isContainerNode(e))return d(c,b),!0;c=e}d(a,b)}}else(c||!this.unwrapNode(a,[b.tagName.toLowerCase()],!0))&&
d(a,b);return!0},wrapNode:function(a,b,c,e,d){var g,h,i,j;c==null&&(c=!1);e==null&&(e=void 0);d==null&&(d=void 0);if(a.firstChild==null)return a=this.extractLeaf(a,e,d),this.wrapLeaf(a,b,c);e==null&&(e=0);if(d==null)d=a.childNodes.length;i=a.childNodes;j=[];for(g=0,h=i.length;g<h;g++)a=i[g],j.push(a!=null?this.wrapNode(a,b,c,e,d):void 0);return j},wrapRange:function(a,b,c){var e,d,g,h,i,j;c==null&&(c=!1);if(a.startContainer===a.endContainer)return this.wrapNode(a.startContainer,b,c,a.startOffset,
a.endOffset);if(!c&&(d=!1,this.isContainerNode(b)?d=this.convertNode(a.commonAncestorContainer,[(i=b.tagName)!=null?i.toLowerCase():void 0],b,!0):this.isBlockNode(b)&&(d=this.convertNode(a.commonAncestorContainer,this.BLOCK_ELEMENTS,b,!0)),d===!0))return!0;if(this.isContainerNode(b))b.appendChild(a.extractContents()),a.insertNode(b);else{if(this.isBlockNode(b)){if(!function(a,b){var f;for(f=a;f!=null||f===b;){if(this.isBlockNode(f))return!0;f=this.getNextNode(f)}return!1}(a.startContainer,a.endContainer)){b.appendChild(a.extractContents());
a.insertNode(b);return}h=!0}else h=!1;d=function(a){return h?this.getNextNode(a):this.getNextLeaf(a)};e=function(a){return h?this.getPreviousNode(a):this.getPreviousLeaf(a)};a.startContainer.firstChild!=null?i=a.startContainer.childNodes[a.startOffset]:(i=d(a.startContainer),this.wrapNode(a.startContainer,b,c,a.startOffset,void 0));a.endContainer.firstChild!=null?e=a.endOffset>0?a.endContainer.childNodes[a.endOffset-1]:e(a.endContainer):(e=e(a.endContainer),this.wrapNode(a.endContainer,b,c,void 0,
a.endOffset));for(j=[];i!=null&&i!==a.endContainer;){g=d(i);i.parentNode!=null&&this.wrapNode(i,b,c);if(i===e)break;j.push(i=g)}return j}},unwrapRange:function(a,b,c){c==null&&(c=!1);return this.unwrapNode(a.commonAncestorContainer,b,c)},convertRange:function(a,b,c,e){e==null&&(e=!1);return this.convertNode(a.commonAncestorContainer,b,c,e)}});if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=k;if(typeof require!=="undefined"&&require!==null)b=require("./partial").partial,k=require("./nodeutils.wrap").NodeUtils;
k=b(k,{unstyleLeaf:function(a,b,c){var e,d,g;c==null&&(c=!1);for(e=c?"div":"span";a.parentNode!=null&&a.parentNode.tagName!=null;){c=a.parentNode;d=c.tagName.toLowerCase();if(d===e){for(d=0,g=b.length;d<g;d++)e=b[d],c.style[e]="";c.getAttribute("style")===""&&this._unwrapNode(a);return!0}a=c}return!1},styleLeaf:function(a,b,c,e){var d,g,h,i,j,k,n,m,o;c==null&&(c=!1);e==null&&(e=!1);o=c?"div":"span";m=document.createElement(o);for(h in b)n=b[h],m.style[h]=n;k=function(){var a;a=[];for(h in b)n=b[h],
a.push(h);return a}();g=function(a){var b,c,f;for(c=0,f=k.length;c<f;c++)if(b=k[c],a.style[b]!==m.style[b])return!1;return!0};for(d=a;d.parentNode!=null&&d.parentNode.tagName!=null;){i=d.parentNode;j=i.tagName.toLowerCase();if(j===o){if(!e&&g(i))this.unstyleLeaf(d,k,c);else for(h in b)n=b[h],i.style[h]=n;return!0}d=i}this.wrapLeaf(a,m);return!0},styleNode:function(a,b,c,e,d,g){var h,i,j,k;c==null&&(c=!1);e==null&&(e=!1);d==null&&(d=void 0);g==null&&(g=void 0);if(a.firstChild==null)return a=this.extractLeaf(a,
d,g),this.styleLeaf(a,b,c,e);d==null&&(d=0);if(g==null)g=a.childNodes.length;j=a.childNodes;k=[];for(h=0,i=j.length;h<i;h++)a=j[h],k.push(a!=null?this.styleNode(a,b,c,e,d,g):void 0);return k},styleRange:function(a,b,c,e){var d,g,h,i,j;c==null&&(c=!1);e==null&&(e=!1);if(a.startContainer===a.endContainer)return this.styleNode(a.startContainer,b,c,e,a.startOffset,a.endOffset);g=function(a){return this.getNextLeaf(a)};d=function(a){return this.getPreviousLeaf(a)};a.startContainer.firstChild!=null?i=a.startContainer.childNodes[a.startOffset]:
(i=g(a.startContainer),this.styleNode(a.startContainer,b,c,e,a.startOffset,void 0));a.endContainer.firstChild!=null?d=a.endOffset>0?a.endContainer.childNodes[a.endOffset-1]:d(a.endContainer):(d=d(a.endContainer),this.styleNode(a.endContainer,b,c,e,void 0,a.endOffset));for(j=[];i!=null&&i!==a.endContainer;){h=g(i);i.parentNode!=null&&this.styleNode(i,b,c,e);if(i===d)break;j.push(i=h)}return j},unstyleRange:function(a,b,c,e){c==null&&(c=!1);e==null&&(e=!1);return this.unstyleLeaf(a.commonAncestorContainer,
b,c,e)}});if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=k;i=function(){function a(a){this.raw=a;this.utils=new k}a.prototype.execCommand=function(a,b,c){var g,h,i;c==null&&(c=!1);g=e(function(){if(this.raw.window.getSelection!=null)return this.raw.window.getSelection();else if(this.raw.document.selection!=null)return new d(this.raw.document)},this)();if(g==null)return((h=window.console)!=null?h.error:void 0)!=null&&console.error("This browser does not support W3C type of range or Microsoft type of range."),
!1;g=g.getRangeAt(0);switch(a){case "wrap":this.utils.wrapRange(g,this.utils.createElementFromHTML(b),c);break;case "unwrap":this.utils.unwrapRange(g,b,c);break;case "style":this.utils.styleRange(g,b,c);break;case "unstyle":this.utils.unstyleRange(g,b,c);break;default:return((i=window.console)!=null?i.error:void 0)!=null&&console.error("Unknown command type has passed. type: "+a),!1}return!0};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.API=i;if(typeof require!=="undefined"&&
require!==null)b=require("../utils/partial").partial,i=require("./api.core").API;i=b(i,{strong:function(){return this.execCommand("wrap","<strong>")},em:function(){return this.execCommand("wrap","<em>")},ins:function(){return this.execCommand("wrap","<ins>")},del:function(){return this.execCommand("wrap","<del>")},sub:function(){return this.execCommand("wrap","<sub>")},sup:function(){return this.execCommand("wrap","<sup>")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=i;if(typeof require!==
"undefined"&&require!==null)b=require("../utils/partial").partial,i=require("./api.core").API;i=b(i,{blockquote:function(){return this.execCommand("wrap","<blockquote>",!0)},unblockquote:function(){return this.execCommand("unwrap",["blockquote"],!0)},heading:function(a){return this.execCommand("wrap","<h"+a+">")},h1:function(){return this.heading(1)},h2:function(){return this.heading(2)},h3:function(){return this.heading(3)},h4:function(){return this.heading(4)},h5:function(){return this.heading(5)},
h6:function(){return this.heading(6)},p:function(){return this.execCommand("wrap","<p>")},pre:function(){return this.execCommand("wrap","<pre>")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=i;if(typeof require!=="undefined"&&require!==null)b=require("../utils/partial").partial,i=require("./api.core").API;i=b(i,{a:function(a){return this.execCommand("wrap","<a href='"+a+"'>")},img:function(a){return this.execCommand("wrap","<img src='"+a+"'>")},ul:function(){return this.raw.execCommand("insertUnorderedList")},
ol:function(){return this.raw.execCommand("insertOrderedList")},hr:function(){return this.raw.execCommand("insertHorizontalRule")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=i;if(typeof require!=="undefined"&&require!==null)b=require("../utils/partial").partial,i=require("./commandapi.core").API;i=b(i,{forecolor:function(a){return this.execCommand("style",{color:a})},backcolor:function(a){return this.execCommand("style",{backgroundColor:a})},fontfamily:function(a){return this.execCommand("style",
{fontFamily:a})},fontsize:function(a){return this.execCommand("style",{fontSize:a})},justifyleft:function(){return this.execCommand("style",{textAlign:"left"},!0)},justifycenter:function(){return this.execCommand("style",{textAlign:"center"},!0)},justifyright:function(){return this.execCommand("style",{textAlign:"right"},!0)},justifyfull:function(){return this.execCommand("style",{textAlign:"justify"},!0)}});if(typeof exports!=="undefined"&&exports!==null)exports.API=i;if(typeof require!=="undefined"&&
require!==null)b=require("../utils/partial").partial,i=require("./api.core").API;i=b(i,{indent:function(){return this.raw.execCommand("indent")},outdent:function(){return this.raw.execCommand("outdent")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=i;if(typeof require!=="undefined"&&require!==null)o=require("./utils/detector").Detector;j=function(){function a(a){var b,c;this.iframe=a;b=new o;this._loaded=!1;this._callbacks=[];this.ready(e(function(){var a,c;this.document=this.iframe.contentDocument!=
null?this.iframe.contentDocument:this.iframe.contentWindow.document;this.document.body==null&&this.document.writeln("<body></body>");this.body=this.document.body;this.body.style.cursor="text";this.body.style.height="100%";b.browser==="Explorer"&&b.version<9&&(a=e(function(){return this.body.style.height=""+this.iframe.offsetHeight+"px"},this),setTimeout(e(function(){var b,c;((b=this.iframe)!=null?b.offsetHeight:void 0)!==((c=this.body)!=null?c.offsetHeight:void 0)&&a();return setTimeout(arguments.callee,
100)},this),100));if(this.body.spellcheck!=null)this.body.spellcheck=!1;this.body.contentEditable!=null?this.body.contentEditable=!0:this.document.designMode!=null?this.document.designMode="On":((c=window.console)!=null?c.error:void 0)!=null&&console.error("This browser doesn't support contentEditable nor designMode");return this.window=this.iframe.contentWindow},this));c=e(function(){var a,b,c,f;this._loaded=!0;f=this._callbacks;for(b=0,c=f.length;b<c;b++)a=f[b],a();return this._callbacks=void 0},
this);this.iframe.getAttribute("src")!=null?b.browser==="Explorer"&&b.version<9?this.iframe.attachEvent("onreadystatechange",e(function(){if(this.iframe.readyState==="complete")return this.iframe.onreadystatechange=null,c()},this)):this.iframe.addEventListener("load",e(function(){return c()},this),!1):c()}a.prototype.ready=function(a){a==null&&(a=void 0);return a==null?this._loaded:this._loaded?a():this._callbacks.push(a)};a.prototype.getValue=function(){if(this.ready())return this.body.innerHTML};
a.prototype.setValue=function(a){if(this.ready())return this.body.innerHTML=a};a.prototype.execCommand=function(a,b,c){b==null&&(b=!1);c==null&&(c=null);return this.document.execCommand(a,b,c)};a.prototype.queryCommandState=function(a){return this.document.queryCommandState(a)};a.prototype.queryCommandEnabled=function(a){return this.document.queryCommandEnabled(a)};a.prototype.queryCommandIndeterm=function(a){return this.document.queryCommandIndeterm(a)};a.prototype.queryCommandSupported=function(a){return this.document.queryCommandSupported(a)};
a.prototype.queryCommandValue=function(a){return this.document.queryCommandValue(a)};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Rawarea=j;this.Richarea=function(){function a(a){this.iframe=a;if(window.jQuery!=null&&this.iframe instanceof jQuery)this.iframe=this.iframe.get(0);this.raw=new j(this.iframe);this.raw.ready(e(function(){var a;if(this.iframe.innerHTML!=null)return a=this.iframe.innerHTML,a=a.split("&lt;").join("<"),a=a.split("&gt;").join(">"),this.setValue(a)},this));
this.api=new i(this.raw)}a.prototype.ready=function(a){a==null&&(a=void 0);return this.raw.ready(a)};a.prototype.getValue=function(){return this.raw.getValue()};a.prototype.setValue=function(a){return this.raw.setValue(a)};a.prototype.execCommand=function(a,b){var c;b==null&&(b=void 0);if(a in this.api)return this.api[a](b);else if(((c=window.console)!=null?c.error:void 0)!=null)return console.error("Command '"+a+"' not found.")};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Richarea=
Richarea}).call(this);
(function(i){i.fn.tabby=function(m){var o=i.extend({},i.fn.tabby.defaults,m),k=i.fn.tabby.pressed;return this.each(function(){$this=i(this);var n=i.meta?i.extend({},o,$this.data()):o;$this.bind("keydown",function(j){var h=i.fn.tabby.catch_kc(j);if(16==h)k.shft=!0;if(17==h)k.ctrl=!0,setTimeout("$.fn.tabby.pressed.ctrl = false;",1E3);if(18==h)k.alt=!0,setTimeout("$.fn.tabby.pressed.alt = false;",1E3);if(9==h&&!k.ctrl&&!k.alt){k.last=h;setTimeout("$.fn.tabby.pressed.last = null;",0);var j=i(j.target).get(0),
g=k.shft,h=j.scrollTop;if(j.setSelectionRange){var d=j.selectionStart,b=j.selectionEnd;if(d==b)if(g)if("\t"==j.value.substring(d-n.tabString.length,d))j.value=j.value.substring(0,d-n.tabString.length)+j.value.substring(d),j.focus(),j.setSelectionRange(d-n.tabString.length,d-n.tabString.length);else{if("\t"==j.value.substring(d,d+n.tabString.length))j.value=j.value.substring(0,d)+j.value.substring(d+n.tabString.length),j.focus(),j.setSelectionRange(d,d)}else j.value=j.value.substring(0,d)+n.tabString+
j.value.substring(d),j.focus(),j.setSelectionRange(d+n.tabString.length,d+n.tabString.length);else{var e=j.value.split("\n"),c=[],a=0,f=0,l;for(l in e)f=a+e[l].length,c.push({start:a,end:f,selected:a<=d&&f>d||f>=b&&a<b||a>d&&f<b}),a=f+1;e=0;for(l in c)if(c[l].selected)if(a=c[l].start+e,g&&n.tabString==j.value.substring(a,a+n.tabString.length))j.value=j.value.substring(0,a)+j.value.substring(a+n.tabString.length),e-=n.tabString.length;else if(!g)j.value=j.value.substring(0,a)+n.tabString+j.value.substring(a),
e+=n.tabString.length;j.focus();j.setSelectionRange(d+(e>0?n.tabString.length:e<0?-n.tabString.length:0),b+e)}}else if(document.selection&&(l=document.selection.createRange(),j==l.parentElement()))if(""==l.text){if(g){g=l.getBookmark();l.moveStart("character",-n.tabString.length);if(n.tabString==l.text)l.text="";else if(l.moveToBookmark(g),l.moveEnd("character",n.tabString.length),n.tabString==l.text)l.text="";l.collapse(!0)}else l.text=n.tabString,l.collapse(!1);l.select()}else{b=l.text;d=b.length;
c=b.split("\r\n");b=document.body.createTextRange();b.moveToElementText(j);b.setEndPoint("EndToStart",l);a=b.text;e=a.split("\r\n");a=a.length;f=document.body.createTextRange();f.moveToElementText(j);f.setEndPoint("StartToEnd",l);var f=f.text,m=document.body.createTextRange();m.moveToElementText(j);m.setEndPoint("StartToEnd",b);var o=m.text,m=i(j).html();i("#r3").text(a+" + "+d+" + "+f.length+" = "+m.length);a+o.length<m.length?(e.push(""),a+=2,g&&n.tabString==c[0].substring(0,n.tabString.length)?
c[0]=c[0].substring(n.tabString.length):g||(c[0]=n.tabString+c[0])):g&&n.tabString==e[e.length-1].substring(0,n.tabString.length)?e[e.length-1]=e[e.length-1].substring(n.tabString.length):g||(e[e.length-1]=n.tabString+e[e.length-1]);for(o=1;o<c.length;o++)g&&n.tabString==c[o].substring(0,n.tabString.length)?c[o]=c[o].substring(n.tabString.length):g||(c[o]=n.tabString+c[o]);1==e.length&&0==a&&(g&&n.tabString==c[0].substring(0,n.tabString.length)?c[0]=c[0].substring(n.tabString.length):g||(c[0]=n.tabString+
c[0]));a+d+f.length<m.length&&c.push("");b.text=e.join("\r\n");l.text=c.join("\r\n");g=document.body.createTextRange();g.moveToElementText(j);0<a?g.setEndPoint("StartToEnd",b):g.setEndPoint("StartToStart",b);g.setEndPoint("EndToEnd",l);g.select()}j.scrollTop=h;return!1}}).bind("keyup",function(j){if(16==i.fn.tabby.catch_kc(j))k.shft=!1}).bind("blur",function(j){9==k.last&&i(j.target).one("focus",function(){k.last=null}).get(0).focus()})})};i.fn.tabby.catch_kc=function(i){return i.keyCode?i.keyCode:
i.charCode?i.charCode:i.which};i.fn.tabby.pressed={shft:!1,ctrl:!1,alt:!1,last:null};i.fn.tabby.defaults={tabString:String.fromCharCode(9)}})(jQuery);
(function(){var i,m,o=Array.prototype.slice,k=function(h,g){return function(){return h.apply(g,arguments)}},n=Object.prototype.hasOwnProperty,j=function(h,g){function d(){this.constructor=h}for(var b in g)n.call(g,b)&&(h[b]=g[b]);d.prototype=g.prototype;h.prototype=new d;h.__super__=g.prototype;return h};m=function(){function h(){this.browser=this.searchString(h.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"An unknown browser";
this.OS=this.searchString(h.dataOS)||"An unknown OS"}h.prototype.searchString=function(g){var d,b,e;for(b=0,e=g.length;b<e;b++)if(d=g[b],this.versionSearchString=d.versionSearch||d.identify,d.string!=null)if(d.string.indexOf(d.subString)!==-1)return d.identify;else if(d.prop)return d.identify;return[]};h.prototype.searchVersion=function(g){var d;d=g.indexOf(this.versionSearchString);return d===-1?void 0:parseFloat(g.substring(d+this.versionSearchString.length+1))};h.dataBrowser=[{string:navigator.userAgent,
subString:"Chrome",identify:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identify:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identify:"Safari",versionSearch:"Version"},{prop:window.opera,identify:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identify:"iCab"},{string:navigator.vendor,subString:"KDE",identify:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identify:"Firefox"},{string:navigator.vendor,subString:"Camino",
identify:"Camino"},{string:navigator.userAgent,subString:"Netscape",identify:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identify:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identify:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identify:"Netscape",versionSearch:"Mozilla"}];h.dataOS=[{string:navigator.platform,subString:"Win",identify:"Windows"},{string:navigator.platform,subString:"Mac",identify:"Mac"},{string:navigator.userAgent,
subString:"iPhone",identify:"iPhone/iPad"},{string:navigator.platform,subString:"Linux",identify:"Linux"}];return h}();if(typeof exports!=="undefined"&&exports!==null)exports.Detector=m;window.namespace=function(h,g,d){var b,e,c,a,f;arguments.length<3&&(b=[typeof exports!=="undefined"?exports:window].concat(o.call(arguments)),h=b[0],g=b[1],d=b[2]);e=h;f=g.split(".");for(c=0,a=f.length;c<a;c++)b=f[c],h=h[b]||(h[b]={});return d(h,e)};if(typeof exports!=="undefined"&&exports!==null)exports.namespace=
namespace;namespace(this,"dynamicloader.script",function(h){var g;h.include=g=function(d){var b;b=document.createElement("script");b.type="text/javascript";b.src=d;document.head=document.head||document.getElementsByTagName("head")[0];return document.head.appendChild(b)};h.load=function(d,b,e,c){var a;c==null&&(c=5E3);a=new Function("return !!("+b+")");return a()?typeof e==="function"?e():void 0:(g(d),setTimeout(function(){return c=!0},c),setTimeout(function(){return c!==!0&&!a()?setTimeout(arguments.callee,
100):typeof e==="function"?e():void 0},100))};return h.loadall=function(){return next()}});namespace("dynamicloader.css",function(h){h.include=function(g,d){var b;d==null&&(d="all");b=document.createElement("link");b.rel="stylesheet";b.type="text/css";b.media=d;b.href=g;document.head=document.head||document.getElementsByTagName("head")[0];return document.head.appendChild(b)};return h.remove=function(g){return i("link").each(function(d,b){if(b.href.match(g)!=null)return i(b).remove()})}});if(String.prototype.startsWith==
null)String.prototype.startsWith=function(h){return this.lastIndexOf(h,0)===0};if(String.prototype.endsWith==null)String.prototype.endsWith=function(h){var g;g=this.length-h.length;return g>=0&&this.lastIndexOf(h,g)===g};if(String.prototype.replaceAll==null)String.prototype.replaceAll=function(h,g){return this.split(h).join(g)};if(String.prototype.trim==null)String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};i=jQuery;i.fn.jencil=function(h){h=i.extend(!0,Jencil.options["default"],
h);if(this.length>1&&h.documentTypeElement!=null)logger.warn("documentTypeElement is not avaialble on multiple textarea"),h.documentTypeElement=void 0;Jencil.utils.path.init(h);Jencil.theme.init(h);if(Jencil.jencils==null)Jencil.jencils=[];return this.each(function(){return Jencil.jencils.push(new Jencil.core.JencilCore(i(this),h))})};namespace("Jencil.core",function(h){return h.JencilCore=function(){function g(d,b){this.$textarea=d;this.options=b;this.profile=void 0;this.wrapper=new Jencil.widget.Wrapper(this);
this.buttonHolder=new Jencil.widget.ButtonHolder(this);this.documentType=new Jencil.widget.DocumentType(this);this.toolbar=new Jencil.widget.Toolbar(this);this.toolbar.append(this.buttonHolder);this.toolbar.append(this.documentType);this.wrapper.append(this.toolbar);this.workspace=new Jencil.widget.Workspace(this);this.wrapper.append(this.workspace);this.$textarea.after(this.wrapper.$element);this.$textarea.hide();Jencil.profile.load(this,this.getProfileName())}g.prototype.update=function(){return this.workspace.use(this.profile.editor,
k(function(){this.buttonHolder.update();return this.workspace.editor.update()},this))};g.prototype.getProfileName=function(){return this.documentType.getProfileName()};g.prototype.getSourceValue=function(){return this.$textarea.val()};g.prototype.setSourceValue=function(d){return this.$textarea.val(d)};return g}()});namespace("Jencil.utils",function(h){return h.detector=new m});namespace("Jencil.utils.path",function(h){var g;h.init=function(d){var b,e;return h.path=new g((b=(e=d.root)!=null?e:d.rootPattern)!=
null?b:/(.*)jencil(\.min)?\.js/)};h.abspath=function(d,b,e){e==null&&(e="~/");return h.path.abspath(d,b,e)};return h.Path=g=function(){function d(b){b instanceof RegExp?i("script").each(k(function(e,c){var a;a=c.src.match(b);if(a!=null)return this.root=a[1],this.root=this.root.slice(0,this.root.length-2+1||9E9)},this)):this.root=b}d.prototype.abspath=function(b,e,c){c==null&&(c="~/");if(e==null)e=this.root;b!=null&&b.startsWith(c)&&(b=""+e+"/"+b.slice(2,b.length+1||9E9));return b};return d}()});namespace("Jencil.utils.script",
function(h){h.load=function(g,d,b){return dynamicloader.script.load(Jencil.utils.path.abspath(g),d,b)};return h.loadall=function(g,d){var b;b=0;return function(){var e,c;c=g[b][0];e=g[b][1];b++;return b>g.length?typeof d==="function"?d():void 0:Jencil.utils.module.load(c,e,next)}()}});namespace("Jencil.utils.css",function(h){h.include=function(g){return dynamicloader.css.include(g)};return h.remove=function(g){return dynamicloader.css.remove(g)}});namespace("Jencil.utils.string",function(h){return h.format=
function(g,d){var b,e;for(b in d)e=d[b],g=g.replace("{{"+b+"}}",e);return g}});namespace("Jencil.options",function(h){return h["default"]={debug:!0,root:null,rootPattern:null,theme:{root:"~/extras/themes","default":"default"},profile:{root:"~/extras/profiles","default":"default"}}});namespace("Jencil.profile",function(h){h.abspath=function(g,d){g.endsWith(".js")||(g=""+d.options.profile.root+"/"+g+".js");return Jencil.utils.path.abspath(g)};return h.load=function(g,d){var b;b=Jencil.profile.abspath(d,
g);delete Jencil.profile.Profile;delete g.profile;return Jencil.utils.script.load(b,"Jencil.profile.Profile",function(){g.profile=new Jencil.profile.Profile(g);return g.update()})}});namespace("Jencil.theme",function(h){h.root=void 0;h.init=function(g){h.root=Jencil.utils.path.abspath(g.theme.root);return Jencil.theme.load(g.theme["default"])};h.load=function(g){var d,b,e,c,a;Jencil.theme.current!=null&&Jencil.utils.css.remove(RegExp(""+Jencil.theme.current+"/.*.css"));Jencil.theme.current=Jencil.utils.path.abspath(""+
Jencil.theme.root+"/"+g);Jencil.theme.include(""+Jencil.theme.current+"/style.css","screen, projection");if(Jencil.jencils!=null){e=Jencil.jencils;a=[];for(g=0,b=e.length;g<b;g++)d=e[g],d=d.workspace.editor.constructor,a.push(((c=d.extras)!=null?c.stylesheets:void 0)!=null?Jencil.theme.includeall(d.extras.stylesheets):void 0);return a}};h.abspath=function(g){return Jencil.utils.path.abspath(g,Jencil.theme.current)};h.include=function(g,d){g=Jencil.theme.abspath(g);return Jencil.utils.css.include(g,
d)};return h.includeall=function(g){var d,b,e,c;c=[];for(b=0,e=g.length;b<e;b++)d=g[b],c.push(Jencil.theme.include(d,"screen, projection"));return c}});namespace("Jencil.widget",function(h){var g;h.Widget=g=function(){function d(b,e,c){this.jencil=b;this.cls=e;c==null&&(c="div");this.$element=i("<"+c+">").addClass(e)}d.prototype.after=function(b){return this.$element.after(b.$element)};d.prototype.append=function(b){return this.$element.append(b.$element)};d.prototype.appendTo=function(b){return this.$element.appendTo(b.$element)};
d.prototype.before=function(b){return this.$element.before(b.$element)};d.prototype.prepend=function(b){return this.$element.prepend(b.$element)};d.prototype.prependTo=function(b){return this.$element.prependTo(b.$element)};return d}();h.Wrapper=function(){function d(b){d.__super__.constructor.call(this,b,"jencil")}j(d,g);return d}();h.DocumentType=function(){function d(b){d.__super__.constructor.call(this,b,"jencil-document-type");this.$documentTypeElement=this.jencil.options.documentTypeElement;
if(this.$documentTypeElement!=null){if(!(this.$documentTypeElement instanceof jQuery))this.$documentTypeElement=i(this.$documentTypeElement);this.$element.append(this.$documentTypeElement);this.$documentTypeElement.change(k(function(){return Jencil.profile.load(this.jencil,this.getProfileName())},this))}}j(d,g);d.prototype.getProfileName=function(){return this.$documentTypeElement!=null?this.$documentTypeElement.val():this.jencil.options.profile["default"]};return d}();h.ButtonHolder=function(){function d(b){d.__super__.constructor.call(this,
b,"jencil-button-holder")}j(d,g);d.prototype.update=function(){var b,e,c,a,f,d;this.$element.children().remove();f=this.jencil.profile.buttonsets;d=[];for(c=0,a=f.length;c<a;c++)b=f[c],e=b[0],b=b.slice(1,b.length+1||9E9),e=Jencil.button.createButton(this.jencil,e,b),d.push(this.append(e));return d};return d}();h.Toolbar=function(){function d(b){d.__super__.constructor.call(this,b,"jencil-toolbar")}j(d,g);return d}();return h.Workspace=function(){function d(b){d.__super__.constructor.call(this,b,"jencil-workspace");
this.editor=null}j(d,g);d.prototype.use=function(b,e){return Jencil.editor.use(this.jencil,b,k(function(){return e()},this))};return d}()});namespace("Jencil.button",function(h){var g,d;d=Jencil.widget.Widget;h.createButton=function(b,e,c){var a;switch(e){case "-":case "separator":a=Jencil.button.Separator;break;case "+":case "exec":a=Jencil.button.ExecButton;break;case "preview":a=Jencil.button.PreviewButton;break;default:if(a=Jencil.button[e],a==null)throw Error("Unknown button type is passed (type: "+
e+")");}return new a(b,c)};h.ButtonBase=g=function(){function b(e,c,a){b.__super__.constructor.call(this,e,"button","a");this.$element.addClass(c);this.$element.attr("title",a);this.$element.css("cursor","pointer");Jencil.utils.detector.browser==="Explorer"&&Jencil.utils.detector.version<8&&this.$element.attr("href","javascript:void(0);");this.$element.append(i("<span>"+a+"</span>"));this.$element.click(k(function(){this.clickBefore();this.click();return this.clickAfter()},this))}j(b,d);b.prototype.editor=
function(){return this.jencil.workspace.editor};b.prototype.clickBefore=function(){};b.prototype.click=function(){};b.prototype.clickAfter=function(){};return b}();h.MarkupButtonBase=function(){function b(){b.__super__.constructor.apply(this,arguments)}j(b,g);b.prototype.clickAfter=function(){this.editor().update();return this.editor().focus()};return b}();h.Separator=function(){function b(e){b.__super__.constructor.call(this,e,"separator","span");this.$element.append(i("<span>|</span>"))}j(b,d);
return b}();h.ExecButton=function(){function b(e,c){var a,f;a=c[0];f=c[1];this._click=c[2];this._clickBefore=c[3];this._clickAfter=c[4];b.__super__.constructor.call(this,e,a,f)}j(b,g);b.prototype.clickBefore=function(){return this._clickBefore(this.editor())};b.prototype.click=function(){return this._click(this.editor())};b.prototype.clickAfter=function(){return this._clickAfter(this.editor())};return b}();return h.PreviewButton=function(){function b(e){b.__super__.constructor.call(this,e,"preview",
"Preview")}j(b,g);b.prototype.click=function(){var b,c;b=this.editor();(c=b.preview)!=null&&c.toggle();return b.relocate()};return b}()});namespace("Jencil.editor",function(h){var g,d,b,e;d=Jencil.widget.Widget;b=function(b){return b.outerWidth(!0)-b.width()};e=function(b){return b.outerHeight(!0)-b.height()};h.use=function(b,a,e){var d,g,h,j,k;e==null&&(e=void 0);g=function(){var e,d;e=Jencil.editor[a].extras;if((e!=null?e.options:void 0)!=null)b.options.extras=i.extend(!0,e.options,(d=b.options.extras)!=
null?d:{});(e!=null?e.stylesheets:void 0)!=null&&Jencil.theme.includeall(e.stylesheets);return(e!=null?e.requires:void 0)!=null?Jencil.utils.script.loadall(e.requires,function(){return h()}):h()};h=function(){var d;d=Jencil.editor[a];if(b.workspace.editor!=null)b.workspace.editor.$element.remove(),b.workspace.editor=null;d=new d(b);b.workspace.append(d);b.workspace.editor=d;d.init();if(e!=null)return e()};return a instanceof Array?(k=a,a=k[0],j=k[1],d=k[2],Jencil.utils.script.load(j,d,function(){return g()})):
g()};h.EditorBase=g=function(){function c(a,b){c.__super__.constructor.call(this,a,b);this.workspace=this.jencil.workspace;this.$element.addClass("jencil-editor");this.$element.hide()}j(c,d);c.prototype.init=function(){this.$element.show();return this.relocate()};c.prototype.update=function(){return this.relocate()};c.prototype.relocate=function(){var a,c,d,g;c=b(this.$element);d=e(this.$element);g=this.workspace.$element.width();a=this.workspace.$element.height();this.$element.width(g-c);return this.$element.height(a-
d)};c.prototype.focus=function(){throw Error("subclass must override this method to focus editor main panel");};return c}();h.SinglePaneEditorBase=function(){function c(a,b,e){this.pane=e;c.__super__.constructor.call(this,a,b);this.pane.$element.appendTo(this.$element);this.pane.$element.addClass("jencil-pane");this.$element.addClass("jencil-siglepane-editor")}j(c,g);c.prototype.init=function(){this.pane.init();return c.__super__.init.call(this)};c.prototype.update=function(){this.pane.update();return c.__super__.update.call(this)};
c.prototype.relocate=function(){var a,d,g,h;c.__super__.relocate.call(this);d=b(this.pane.$element);g=e(this.pane.$element);h=this.$element.width();a=this.$element.height();this.pane.$element.width(h-d);return this.pane.$element.height(a-g)};c.prototype.focus=function(){return this.pane.focus()};return c}();return h.DualPaneEditorBase=function(){function c(a,b,e,d,g){this.lhspane=e;this.rhspane=d;this.panedir=g!=null?g:"horizontal";c.__super__.constructor.call(this,a,b);this.lhspane.$element.appendTo(this.$element);
this.rhspane.$element.appendTo(this.$element);this.lhspane.$element.addClass("jencil-lhspane");this.rhspane.$element.addClass("jencil-rhspane");this.$element.addClass("jencil-panedir-"+this.panedir)}j(c,g);c.prototype.init=function(){this.lhspane.init();this.rhspane.init();return c.__super__.init.call(this)};c.prototype.update=function(){this.lhspane.update();this.rhspane.update();return c.__super__.update.call(this)};c.prototype.relocate=function(){var a,d,g,h,i,j;c.__super__.relocate.call(this);
this.lhspane.isVisible()&&this.rhspane.isVisible()?(this.$element.removeClass("jencil-singlepane-editor"),this.$element.addClass("jencil-dualpane-editor")):(this.$element.addClass("jencil-singlepane-editor"),this.$element.removeClass("jencil-dualpane-editor"));d=b(this.lhspane.$element);h=b(this.rhspane.$element);g=e(this.lhspane.$element);i=e(this.rhspane.$element);j=this.$element.width();a=this.$element.height();this.lhspane.isVisible()&&this.rhspane.isVisible()?this.panedir==="horizontal"?(this.lhspane.$element.css({"float":"left"}),
this.rhspane.$element.css({"float":"right"}),this.lhspane.$element.width(j/2-d),this.rhspane.$element.width(j/2-h),this.lhspane.$element.height(a-g),this.rhspane.$element.height(a-i)):(this.lhspane.$element.css({"float":"none"}),this.rhspane.$element.css({"float":"none"}),this.lhspane.$element.width(j-d),this.rhspane.$element.width(j-h),this.lhspane.$element.height(a/2-g),this.rhspane.$element.height(a/2-i)):this.lhspane.isVisible()?(this.lhspane.$element.css({"float":"none"}),this.lhspane.$element.width(j-
d),this.lhspane.$element.height(a-g)):(this.rhspane.$element.css({"float":"none"}),this.rhspane.$element.width(j-h),this.rhspane.$element.height(a-i));this.lhspane.relocate();return this.rhspane.relocate()};return c}()});namespace("Jencil.editor.pane",function(h){var g,d;d=Jencil.widget.Widget;h.EditorPane=g=function(){function b(e,c,a){this.editor=a;b.__super__.constructor.call(this,e,c);this._updateCallbacks=[]}j(b,d);b.prototype.init=function(){return this};b.prototype.update=function(b){var c,
a,d,g;if(b!=null)return this._updateCallbacks.push(b);else{d=this._updateCallbacks;g=[];for(c=0,a=d.length;c<a;c++)b=d[c],g.push(b());return g}};b.prototype.isVisible=function(){return this.$element.is(":visible")};b.prototype.show=function(){this.update();this.editor.$element.removeClass(""+this.cls+"-invisible");return this.$element.show()};b.prototype.hide=function(){this.editor.$element.addClass(""+this.cls+"-invisible");return this.$element.hide()};b.prototype.toggle=function(){return this.isVisible()?
this.hide():this.show()};b.prototype.relocate=function(){};b.prototype.focus=function(){return this.$element.focus()};return b}();return h.PreviewPane=function(){function b(e,c){b.__super__.constructor.call(this,e,"jencil-preview-pane",c);this.$element.css({position:"relative"});this.$surface=i("<iframe>").addClass("surface");this.$surface.appendTo(this.$element);this.$surface.css({width:"100%",height:"100%",border:"none",margin:0,padding:0});Jencil.utils.detector.browser==="Explorer"&&this.$surface.attr("frameborder",
0)}j(b,g);b.prototype.init=function(){var e;e=this.$surface.get(0);this._document=e.contentDocument!=null?e.contentDocument:e.contentWindow.document;this._document.write("<body></body>");return b.__super__.init.call(this)};b.prototype._writeContent=function(b){var c,a;c=k(function(a){var c;if(this._document!=null){try{c=this._document.documentElement.scrollTop}catch(d){c=0}this._document.open();this._document.write(a.replace("{{content}}",b));this._document.close();return this._document.documentElement.scrollTop=
c}},this);return this._previewTemplate==null?(a=Jencil.utils.path.abspath(this.jencil.options.extras.previewTemplatePath),i.ajax({url:a,success:k(function(a){this._previewTemplate=a;return c(a)},this)})):c(this._previewTemplate)};b.prototype.update=function(){var e,c;e=k(function(a){this._writeContent(a);return e.__super__.constructor.call(this)},this);e.__super__=b.__super__.update.apply(this,arguments);c=k(function(){var a,b;a=this.editor.getValue();return((b=this.jencil.profile.extras)!=null?b.previewParserPath:
void 0)!=null?(a=encodeURIComponent(a),i.ajax({url:Jencil.utils.path.abspath(this.jencil.profile.extras.previewParserPath),type:this.jencil.profile.extras.previewParserMethod||"GET",dataType:this.jencil.profile.extras.previewParserType||"text",data:""+(this.jencil.profile.extras.previewParserVal||"data")+"="+a,success:k(function(a){return e(a)},this)})):e(a)},this);return this.jencil.profile!=null?c():setTimeout(k(function(){return this.jencil.profile!=null?c():setTimeout(arguments.callee,100)},this),
100)};b.prototype.relocate=function(){b.__super__.relocate.call(this);if(Jencil.utils.detector.browser==="Explorer"&&Jencil.utils.detector.version<8)return this.$surface.height(this.$element.height())};return b}()});namespace("Jencil.editor.pane",function(h){var g;g=Jencil.editor.pane.EditorPane;return h.TextareaPane=function(){function d(b,e){d.__super__.constructor.call(this,b,"jencil-textarea-pane",e);this.$element.css({position:"relative"});this.$surface=i("<textarea>").addClass("surface");this.$surface.appendTo(this.$element);
this.$surface.css({width:"100%",height:"100%",border:"none",margin:0,padding:0,resize:"none",outline:"none"});this.$surface.bind("keyup keypress click change blur enter",k(function(){return this.update()},this));this.controller=new Textarea(this.$surface)}j(d,g);d.prototype.init=function(){i.fn.tabby!=null&&this.$element.tabby();return d.__super__.init.call(this)};d.prototype.relocate=function(){d.__super__.relocate.call(this);if(Jencil.utils.detector.browser==="Explorer"&&Jencil.utils.detector.version<
8)return this.$surface.height(this.$element.height())};d.prototype.getValue=function(){return this.controller.getValue()};d.prototype.setValue=function(b){return this.controller.setValue(b)};d.prototype.focus=function(){return this.$surface.focus()};return d}()});namespace("Jencil.editor",function(h){var g,d,b;g=Jencil.editor.DualPaneEditorBase;d=Jencil.editor.pane.PreviewPane;b=Jencil.editor.pane.TextareaPane;return h.TextEditor=function(){function e(c){var a,f;(a=c.options.extras.previewPosition)===
"top"||a==="left"?(a=this.preview=new d(c,this),f=this.textarea=new b(c,this)):(a=this.textarea=new b(c,this),f=this.preview=new d(c,this));e.__super__.constructor.call(this,c,"jencil-text-editor",a,f);this.$element.addClass("jencil-preview-position-"+this.jencil.options.extras.previewPosition);this.setValue(this.jencil.getSourceValue());this.jencil.options.extras.defaultPreviewState==="close"&&this.preview.hide();this.textarea.update(k(function(){this.jencil.setSourceValue(this.getValue());return this.preview.update()},
this))}j(e,g);e.extras={options:{previewPosition:"right",previewTemplatePath:"~/extras/templates/preview.html",defaultPreviewState:"open"}};e.prototype.relocate=function(){e.__super__.relocate.call(this);if(Jencil.utils.detector.browser==="Explorer"&&Jencil.utils.detector.version===8)return document.selection.createRange().select()};e.prototype.getValue=function(){return this.textarea.getValue()};e.prototype.setValue=function(b){return this.textarea.setValue(b)};e.prototype.focus=function(){return this.textarea.focus()};
e.prototype.getSelection=function(){return this.textarea.controller.getSelection()};e.prototype.setSelection=function(b,a){return this.textarea.controller.setSelection(b,a)};e.prototype.getSelected=function(){return this.textarea.controller.getSelected()};e.prototype.replaceSelected=function(b,a){a==null&&(a=!1);return this.textarea.controller.replaceSelected(b,a)};e.prototype.insertBeforeSelected=function(b,a){a==null&&(a=!1);return this.textarea.controller.insertBeforeSelected(b,a)};e.prototype.insertAfterSelected=
function(b,a){a==null&&(a=!1);return this.textarea.controller.insertAfterSelected(b,a)};e.prototype.wrapSelected=function(b,a,e,d){e==null&&(e=!1);d==null&&(d=void 0);return this.textarea.controller.wrapSelected(b,a,e,d)};return e}()});namespace("Jencil.button",function(h){var g,d;g=Jencil.button.ButtonBase;h.MarkupButtonBase=d=function(){function b(){b.__super__.constructor.apply(this,arguments)}j(b,g);b.prototype.clickAfter=function(){return this.editor().update()};return b}();h.SimpleMarkupButton=
function(){function b(e,c){var a,d;a=c[0];d=c[1];this.before=c[2];this.after=c[3];this.insert=c[4];b.__super__.constructor.call(this,e,a,d)}j(b,d);b.prototype.click=function(){return this.editor().wrapSelected(this.before,this.after,!0,this.insert||this.jencil.options.defaultInsertText)};return b}();h.MultilineMarkupButton=function(){function b(d,c){var a,f;a=c[0];f=c[1];this.before=c[2];this.after=c[3];this.blockBefore=c[4];this.blockAfter=c[5];b.__super__.constructor.call(this,d,a,f)}j(b,d);b.prototype.click=
function(){var b,c,a,d,g,h,i;d=this.editor().getSelected().split("\n");a=d[0]===this.blockBefore?1:0;for(b=0,i=d.length;0<=i?b<i:b>i;0<=i?b++:b--)h=Jencil.utils.string.format(this.before,{i:b+1-a}),g=Jencil.utils.string.format(this.after,{i:b+1-a}),c=d[b],c===this.blockBefore||c===this.blockAfter||(d[b]=c.startsWith(h)&&c.endsWith(g)?c.substring(h.length,c.length-g.length):""+h+c+g);this.blockBefore!==void 0&&(d[0]===this.blockBefore?d.shift():d.unshift(this.blockBefore));this.blockAfter!==void 0&&
(d[d.length-1]===this.blockAfter?d.pop():d.push(this.blockAfter));b=d.join("\n");return this.editor().replaceSelected(b,!0)};return b}();h.LinkMarkupButton=function(){function b(d,c){this.formatstr=c[0];b.__super__.constructor.call(this,d,"link","Link")}j(b,d);b.prototype.click=function(){var b,c,a;b=prompt("Please input link url");if(b!==null&&(c=prompt("Please input link label",this.editor().getSelected()),c!==null&&(a=prompt("(Optional) Please input link title"),a!==null)))return b=Jencil.utils.string.format(this.formatstr,
{href:b,label:c,title:a}),this.editor().replaceSelected(b)};return b}();return h.ImageMarkupButton=function(){function b(d,c){this.formatstr=c[0];b.__super__.constructor.call(this,d,"image","Image")}j(b,d);b.prototype.click=function(){var b,c,a;c=prompt("Please input image src url");if(c!==null&&(b=prompt("(Optional) Please input image alt label",this.editor().getSelected()),b!==null&&(a=prompt("(Optional) Please input image title"),a!==null)))return b=Jencil.utils.string.format(this.formatstr,{src:c,
alt:b,title:a}),this.editor().replaceSelected(b)};return b}()});namespace("Jencil.editor.pane",function(h){var g;g=Jencil.editor.pane.EditorPane;return h.RichareaPane=function(){function d(b,e){var c;d.__super__.constructor.call(this,b,"jencil-richarea-pane",e);this.$element.css({position:"relative"});this.$surface=i("<iframe>").addClass("surface");this.$surface.appendTo(this.$element);this.$surface.css({width:"100%",height:"100%",border:"none",margin:0,padding:0});if(this.jencil.options.extras.richareaTemplatePath!=
null)c=this.jencil.options.extras.richareaTemplatePath,this.$surface.attr("src",Jencil.utils.path.abspath(c));Jencil.utils.detector.browser==="Explorer"&&this.$surface.attr("frameborder",0);this.controller=null}j(d,g);d.prototype.init=function(){this.controller=new Richarea(this.$surface);return this.controller.ready(k(function(){this.relocate();this.$body=i(this.controller.raw.body);this.$body.css({margin:0,padding:0});this.$body.bind("keyup keypress change click blur enter",k(function(){this.update();
if(Jencil.utils.detector.browser==="Firefox")return setTimeout(k(function(){return this.update()},this),100)},this));return d.__super__.init.call(this)},this))};d.prototype.relocate=function(){d.__super__.relocate.call(this);Jencil.utils.detector.browser==="Explorer"&&Jencil.utils.detector.version<8&&this.$surface.height(this.$element.height());if(Jencil.utils.detector.browser==="Explorer"&&Jencil.utils.detector.version<9)return this.$body.height(this.$surface.height())};d.prototype.getValue=function(){var b;
if((b=this.controller)!=null&&b.ready())return this.controller.getValue()};d.prototype.setValue=function(b){var d;if((d=this.controller)!=null&&d.ready())return this.controller.setValue(b)};d.prototype.focus=function(){return this.$surface.focus()};return d}()});namespace("Jencil.editor",function(h){var g,d,b;g=Jencil.editor.DualPaneEditorBase;b=Jencil.editor.pane.TextareaPane;d=Jencil.editor.pane.RichareaPane;return h.RichEditor=function(){function e(c){var a,f;(a=c.options.extras.previewPosition)===
"top"||a==="left"?(a=this.preview=new b(c,this),f=this.richarea=new d(c,this)):(a=this.richarea=new d(c,this),f=this.preview=new b(c,this));e.__super__.constructor.call(this,c,"jencil-rich-editor",a,f);this.$element.addClass("jencil-preview-position-"+this.jencil.options.extras.previewPosition);this.jencil.options.extras.defaultPreviewState==="close"&&this.preview.hide()}j(e,g);e.extras={options:{richareaTemplatePath:"~/extras/templates/richarea.html"}};e.prototype.init=function(){e.__super__.init.call(this);
return this.richarea.controller.ready(k(function(){this.setValue(this.jencil.getSourceValue());this.preview.setValue(this.getValue());this.richarea.update(k(function(){this.jencil.setSourceValue(this.getValue());return this.preview.setValue(this.getValue())},this));this.preview.update(k(function(){this.jencil.setSourceValue(this.preview.getValue());return this.richarea.setValue(this.preview.getValue())},this));return this.update()},this))};e.prototype.getValue=function(){return this.richarea.getValue()};
e.prototype.setValue=function(b){return this.richarea.setValue(b)};e.prototype.focus=function(){return this.richarea.focus()};return e}()});namespace("Jencil.button",function(h){var g,d;d=Jencil.button.MarkupButtonBase;h.CommandButton=g=function(){function b(d,c){var a,f;f=c[0];a=c[1];this.command=c[2];this.args=c[3];b.__super__.constructor.call(this,d,f,a)}j(b,d);b.prototype.click=function(){return this.exec(this.command,this.args)};b.prototype.clickAfter=function(){return this.editor().focus()};
b.prototype.exec=function(b,c){if(this.editor().richarea.controller!=null)return this.editor().richarea.controller.execCommand(b,c)};return b}();return h.PromptCommandButton=function(){function b(d,c){var a,f,g;g=c[0];a=c[1];f=c[2];this.message=c[3];this.defaultValue=c[4];b.__super__.constructor.call(this,d,[g,a,f,void 0])}j(b,g);b.prototype.click=function(){var b;b=prompt(this.message,this.defaultValue||"");return b===null?void 0:this.exec(this.command,b)};return b}()})}).call(this);
