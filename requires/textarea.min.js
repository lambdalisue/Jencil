/*!
 * Textarea - JavaScript textarea munipulate library v0.1.1
 * 
 * Cross browser textarea munipulator library written in CoffeeScript
 * 
 * Author: Alisue (lambdalisue@hashnote.net)
 * License: MIT License
 * Version: v0.1.1
 * Url: http://github.com/lambdalisue/Textarea
 * Date: Sat, 01 Oct 2011 18:15:34 GMT
 * Reference:
 * - http://archiva.jp/web/javascript/getRange_in_textarea.html
 * - http://livepipe.net/control/textarea
 * - http://markitup.jaysalvat.com/home/
 */
(function(){this.Textarea=function(){function e(a){this.textarea=typeof jQuery!=="undefined"&&jQuery!==null&&a instanceof jQuery?a.get(0):a}e.prototype.getValue=function(){return this.textarea.value};e.prototype.setValue=function(a){return this.textarea.value=a};e.prototype.getSelection=function(){var a,c;if(document.selection)c=document.selection.createRange(),a=c.duplicate(),a.moveToElementText(this.textarea),a.setEndPoint("EndToEnd",c),a=a.text.length-c.text.length,c=a+c.text.length;else if(this.textarea.setSelectionRange)a=
this.textarea.selectionStart,c=this.textarea.selectionEnd;return[a,c]};e.prototype.setSelection=function(a,c){var b,g;g=this.textarea.scrollTop;if(this.textarea.createTextRange){if($.browser.opera&&$.browser.version>=9.5&&length===0)return!1;b=this.textarea.createTextRange();b.collapse(!0);b.moveStart("character",a);b.moveEnd("character",c-a);b.select()}else this.textarea.setSelectionRange&&this.textarea.setSelectionRange(a,c);this.textarea.focus();return this.textarea.scrollTop=g};e.prototype.getSelected=
function(){var a,c,b;if(document.selection)return a=document.selection.createRange(),a.text;else if(this.textarea.setSelectionRange)return b=this.getSelection(),c=b[0],a=b[1],this.textarea.value.substring(c,a);return!1};e.prototype._replaceSelected=function(a,c,b){c==null&&(c=void 0);b==null&&(b=void 0);if(document.selection)return this.textarea.focus(),b=document.selection.createRange(),b.text=a,b.select();else if(this.textarea.setSelectionRange)return c=this.textarea.value.substring(0,c),b=this.textarea.value.substring(b),
this.textarea.value=c+a+b};e.prototype.replaceSelected=function(a,c){var b,g,d,f;c==null&&(c=!1);g=this.textarea.scrollTop;f=this.getSelection();d=f[0];b=f[1];this._replaceSelected(a,d,b);b=d+a.length;c||(d=b);this.setSelection(d,b);this.textarea.focus();return this.textarea.scrollTop=g};e.prototype.insertBeforeSelected=function(a,c){var b,g,d,f;c==null&&(c=!1);g=this.textarea.scrollTop;d=this.getSelection();f=d[0];b=d[1];d=this.getSelected();this._replaceSelected(a+d,f,b);b=f+a.length;c||(f=b);this.setSelection(f,
b);this.textarea.focus();return this.textarea.scrollTop=g};e.prototype.insertAfterSelected=function(a,c){var b,g,d,f;c==null&&(c=!1);g=this.textarea.scrollTop;d=this.getSelection();f=d[0];b=d[1];d=this.getSelected();this._replaceSelected(d+a,f,b);b=f+a.length;c?f+=d.length:f=b;this.setSelection(f,b);this.textarea.focus();return this.textarea.scrollTop=g};e.prototype.wrapSelected=function(a,c,b,g){var d,f,h,e,i;b==null&&(b=!1);g==null&&(g=void 0);h=this.getSelected();return h.indexOf(a)===0&&h.lastIndexOf(c)===
h.length-c.length?(a=h.substring(a.length,h.length-c.length),this.replaceSelected(a,b)):(h===""&&g!=null?h=g:g=void 0,f=this.textarea.scrollTop,i=this.getSelection(),e=i[0],d=i[1],this._replaceSelected(a+h+c,e,d),b?g?(d=e+a.length+h.length,e+=a.length):d=e+a.length+c.length+h.length:e=d=e+a.length+h.length+c.length,this.setSelection(e,d),this.textarea.focus(),this.textarea.scrollTop=f)};return e}()}).call(this);
