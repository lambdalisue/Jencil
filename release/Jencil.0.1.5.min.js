/**
 * Jencil 0.1.5
 *
 * Author:  lambdalisue
 * URL:     http://hashnote.net/
 * License: MIT License
 * 
 * Copyright (C) 2012 lambdalisue, hashnote.net allright reserved.
 *
 * This application include following Library inside
 * 
 * Tabby jQuery plugin version 0.12
 * Ted Devito - http://teddevito.com/demos/textarea.html
 * Copyright (c) 2009 Ted Devito
 *
 * shortcut.js
 * http://www.openjs.com/scripts/events/keyboard_shortcuts/
 * Version : 2.01.B
 * By Binny V A
 * License : BSD
 */
shortcut={all_shortcuts:{},add:function(b,h,d){var g={type:"keydown",propagate:false,disable_in_input:false,target:document,keycode:false};if(!d){d=g}else{for(var a in g){if(typeof d[a]=="undefined"){d[a]=g[a]}}}var f=d.target;if(typeof d.target=="string"){f=document.getElementById(d.target)}var c=this;b=b.toLowerCase();var e=function(o){o=o||window.event;if(d.disable_in_input){var l;if(o.target){l=o.target}else{if(o.srcElement){l=o.srcElement}}if(l.nodeType==3){l=l.parentNode}if(l.tagName=="INPUT"||l.tagName=="TEXTAREA"){return}}if(o.keyCode){code=o.keyCode}else{if(o.which){code=o.which}}var n=String.fromCharCode(code).toLowerCase();if(code==188){n=","}if(code==190){n="."}var s=b.split("+");var r=0;var p={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};var m={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var q={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(o.ctrlKey){q.ctrl.pressed=true}if(o.shiftKey){q.shift.pressed=true}if(o.altKey){q.alt.pressed=true}if(o.metaKey){q.meta.pressed=true}for(var j=0;k=s[j],j<s.length;j++){if(k=="ctrl"||k=="control"){r++;q.ctrl.wanted=true}else{if(k=="shift"){r++;q.shift.wanted=true}else{if(k=="alt"){r++;q.alt.wanted=true}else{if(k=="meta"){r++;q.meta.wanted=true}else{if(k.length>1){if(m[k]==code){r++}}else{if(d.keycode){if(d.keycode==code){r++}}else{if(n==k){r++}else{if(p[n]&&o.shiftKey){n=p[n];if(n==k){r++}}}}}}}}}}if(r==s.length&&q.ctrl.pressed==q.ctrl.wanted&&q.shift.pressed==q.shift.wanted&&q.alt.pressed==q.alt.wanted&&q.meta.pressed==q.meta.wanted){h(o);if(!d.propagate){o.cancelBubble=true;o.returnValue=false;if(o.stopPropagation){o.stopPropagation();o.preventDefault()}return false}}};this.all_shortcuts[b]={callback:e,target:f,event:d.type};if(f.addEventListener){f.addEventListener(d.type,e,false)}else{if(f.attachEvent){f.attachEvent("on"+d.type,e)}else{f["on"+d.type]=e}}},remove:function(a){a=a.toLowerCase();var d=this.all_shortcuts[a];delete (this.all_shortcuts[a]);if(!d){return}var b=d.event;var c=d.target;var e=d.callback;if(c.detachEvent){c.detachEvent("on"+b,e)}else{if(c.removeEventListener){c.removeEventListener(b,e,false)}else{c["on"+b]=false}}}};(function(d){d.fn.tabby=function(f){var g=d.extend({},d.fn.tabby.defaults,f);var h=d.fn.tabby.pressed;return this.each(function(){$this=d(this);var i=d.meta?d.extend({},g,$this.data()):g;$this.bind("keydown",function(l){var j=d.fn.tabby.catch_kc(l);if(16==j){h.shft=true}if(17==j){h.ctrl=true;setTimeout("$.fn.tabby.pressed.ctrl = false;",1000)}if(18==j){h.alt=true;setTimeout("$.fn.tabby.pressed.alt = false;",1000)}if(9==j&&!h.ctrl&&!h.alt){l.preventDefault;h.last=j;setTimeout("$.fn.tabby.pressed.last = null;",0);e(d(l.target).get(0),h.shft,i);return false}}).bind("keyup",function(j){if(16==d.fn.tabby.catch_kc(j)){h.shft=false}}).bind("blur",function(j){if(9==h.last){d(j.target).one("focus",function(l){h.last=null}).get(0).focus()}})})};d.fn.tabby.catch_kc=function(f){return f.keyCode?f.keyCode:f.charCode?f.charCode:f.which};d.fn.tabby.pressed={shft:false,ctrl:false,alt:false,last:null};function b(f){if(window.console&&window.console.log){window.console.log("textarea count: "+f.size())}}function e(i,h,g){var f=i.scrollTop;if(i.setSelectionRange){a(i,h,g)}else{if(document.selection){c(i,h,g)}}i.scrollTop=f}d.fn.tabby.defaults={tabString:String.fromCharCode(9)};function a(j,f,v){var u=j.selectionStart;var s=j.selectionEnd;if(u==s){if(f){if(v.tabString==j.value.substring(u-v.tabString.length,u)){j.value=j.value.substring(0,u-v.tabString.length)+j.value.substring(u);j.focus();j.setSelectionRange(u-v.tabString.length,u-v.tabString.length)}else{if(v.tabString==j.value.substring(u,u+v.tabString.length)){j.value=j.value.substring(0,u)+j.value.substring(u+v.tabString.length);j.focus();j.setSelectionRange(u,u)}}}else{j.value=j.value.substring(0,u)+v.tabString+j.value.substring(u);j.focus();j.setSelectionRange(u+v.tabString.length,u+v.tabString.length)}}else{var w=j.value.split("\n");var t=new Array();var m=0;var h=0;var g=false;for(var p in w){h=m+w[p].length;t.push({start:m,end:h,selected:(m<=u&&h>u)||(h>=s&&m<s)||(m>u&&h<s)});m=h+1}var l=0;for(var p in t){if(t[p].selected){var r=t[p].start+l;if(f&&v.tabString==j.value.substring(r,r+v.tabString.length)){j.value=j.value.substring(0,r)+j.value.substring(r+v.tabString.length);l-=v.tabString.length}else{if(!f){j.value=j.value.substring(0,r)+v.tabString+j.value.substring(r);l+=v.tabString.length}}}}j.focus();var q=u+((l>0)?v.tabString.length:(l<0)?-v.tabString.length:0);var n=s+l;j.setSelectionRange(q,n)}}function c(r,x,f){var q=document.selection.createRange();if(r==q.parentElement()){if(""==q.text){if(x){var m=q.getBookmark();q.moveStart("character",-f.tabString.length);if(f.tabString==q.text){q.text=""}else{q.moveToBookmark(m);q.moveEnd("character",f.tabString.length);if(f.tabString==q.text){q.text=""}}q.collapse(true);q.select()}else{q.text=f.tabString;q.collapse(false);q.select()}}else{var l=q.text;var p=l.length;var v=l.split("\r\n");var A=document.body.createTextRange();A.moveToElementText(r);A.setEndPoint("EndToStart",q);var n=A.text;var y=n.split("\r\n");var s=n.length;var z=document.body.createTextRange();z.moveToElementText(r);z.setEndPoint("StartToEnd",q);var w=z.text;var g=document.body.createTextRange();g.moveToElementText(r);g.setEndPoint("StartToEnd",A);var t=g.text;var h=d(r).html();d("#r3").text(s+" + "+p+" + "+w.length+" = "+h.length);if((s+t.length)<h.length){y.push("");s+=2;if(x&&f.tabString==v[0].substring(0,f.tabString.length)){v[0]=v[0].substring(f.tabString.length)}else{if(!x){v[0]=f.tabString+v[0]}}}else{if(x&&f.tabString==y[y.length-1].substring(0,f.tabString.length)){y[y.length-1]=y[y.length-1].substring(f.tabString.length)}else{if(!x){y[y.length-1]=f.tabString+y[y.length-1]}}}for(var u=1;u<v.length;u++){if(x&&f.tabString==v[u].substring(0,f.tabString.length)){v[u]=v[u].substring(f.tabString.length)}else{if(!x){v[u]=f.tabString+v[u]}}}if(1==y.length&&0==s){if(x&&f.tabString==v[0].substring(0,f.tabString.length)){v[0]=v[0].substring(f.tabString.length)}else{if(!x){v[0]=f.tabString+v[0]}}}if((s+p+w.length)<h.length){v.push("");p+=2}A.text=y.join("\r\n");q.text=v.join("\r\n");var j=document.body.createTextRange();j.moveToElementText(r);if(0<s){j.setEndPoint("StartToEnd",A)}else{j.setEndPoint("StartToStart",A)}j.setEndPoint("EndToEnd",q);j.select()}}}})(jQuery);(function(){var ae,U,J,W,c,C,Z,g,f,p,S,w,s,i,aa,H,R,af,F,y,B,P,G,b,ab,u,A,K,j,a,T,z,Y,L,I,ah,O,t,ai,D,n,N,ad,m,o,x,ac,ag,e,d,E,X,q,Q,v,V,l,h,M=[].slice,aj={}.hasOwnProperty,r=function(an,al){for(var ak in al){if(aj.call(al,ak)){an[ak]=al[ak]}}function am(){this.constructor=an}am.prototype=al.prototype;an.prototype=new am();an.__super__=al.prototype;return an};V=function(ap,ak,am){var at,aq,an,ar,ao,al;if(arguments.length<3){ao=[(typeof exports!=="undefined"?exports:window)].concat(M.call(arguments)),ap=ao[0],ak=ao[1],am=ao[2]}aq=ap;al=ak.split(".");for(an=0,ar=al.length;an<ar;an++){at=al[an];ap=ap[at]||(ap[at]={})}return am(ap,aq)};if(typeof window!=="undefined"&&window!==null){window.namespace=V}if(typeof exports!=="undefined"&&exports!==null){exports.namespace=V}l={repeat:function(an,al){var am,ak;if(al<1){return""}ak="";am=an.valueOf();while(al>0){if(al&1){ak+=am}al>>=1;am+=am}return ak},startsWith:function(al,ak){return al.lastIndexOf(ak,0)===0},endsWith:function(am,al){var ak;ak=am.length-al.length;return ak>=0&&am.lastIndexOf(al,ak)===ak},trimLeft:function(ak){return ak.replace(/^\s+/g,"")},trimRight:function(ak){return ak.replace(/\s+$/g,"")},trim:function(ak){return ak.replace(/^\s+|\s+$/g,"")}};ag=function(al,ak,am){if(!(al.prototype[ak]!=null)){return al.prototype[ak]=function(){var an;an=[this].concat(Array.prototype.slice.call(arguments));return am.apply(this,an)}}};ag(String,"repeat",l.repeat);ag(String,"startsWith",l.startsWith);ag(String,"endsWith",l.endsWith);ag(String,"trimLeft",l.trimLeft);ag(String,"trimRight",l.trimRight);ag(String,"trim",l.trim);if(typeof exports!=="undefined"&&exports!==null){exports.strutils=l}A=(function(){function ak(){}ak.prototype.name="Not implemeted error";ak.prototype.message="The function has not implemented yet";return ak})();K=(function(){function ak(){}ak.prototype.createMemento=function(){throw new A};ak.prototype.setMemento=function(al){throw new A};return ak})();g=(function(){function ak(al){this._originator=al;this._undoStack=[];this._redoStack=[]}ak.prototype.originator=function(al){if(al!=null){this._originator=al;return this}return this._originator};ak.prototype.save=function(al){al=al||this.originator().createMemento();this._undoStack.push(al);this._redoStack=[];return this};ak.prototype.undo=function(){var al;if(!this.canUndo()){return false}al=this.originator();this._redoStack.push(al.createMemento());al.setMemento(this._undoStack.pop());if(typeof al.focus==="function"){al.focus()}return true};ak.prototype.redo=function(){var al;if(!this.canRedo()){return false}al=this.originator();this._undoStack.push(al.createMemento());al.setMemento(this._redoStack.pop());if(typeof al.focus==="function"){al.focus()}return true};ak.prototype.canUndo=function(){return this._undoStack.length>0};ak.prototype.canRedo=function(){return this._redoStack.length>0};return ak})();if(typeof exports!=="undefined"&&exports!==null){exports.NotImplementedError=A;exports.Originator=K;exports.Caretaker=g}T=(function(){function ak(al,am){this.document=al;this.element=am;if(this.document instanceof jQuery){this.document=this.document.get(0)}if(this.element instanceof jQuery){this.element=this.element.get(0)}}ak.prototype._getCaret=function(){var ao,ap,an,al,am;if(this.document.selection!=null){al=this.document.selection.createRange();ap=al.duplicate();ap.moveToElementText(this.element);ap.setEndPoint("EndToEnd",al);am=ap.text.length-al.text.length;an=am+al.text.length}else{if(this.element.setSelectionRange!=null){am=this.element.selectionStart;an=this.element.selectionEnd}}ao=[am,an];return ao};ak.prototype._setCaret=function(ao,al){var am,an;an=this.element.scrollTop;if(this.element.setSelectionRange!=null){this.element.setSelectionRange(ao,al)}else{if(this.element.createTextRange){am=this.element.createTextRange();am.collapse(true);am.moveStart("character",ao);am.moveEnd("character",al-ao);am.select()}}this.element.focus();this.element.scrollTop=an;return this};ak.prototype.caret=function(am,al){if((am!=null)&&am instanceof Array){al=am[1];am=am[0]}if((am!=null)&&!(al!=null)){al=am}if((am!=null)&&(al!=null)){return this._setCaret(am,al)}return this._getCaret()};ak.prototype.caretOffset=function(am){var al;al=this.caret();return this.caret(al[0]+am)};ak.prototype.replace=function(ap,aq,an){var am,al,ao;ao=this.element.scrollTop;al=this.element.value.substring(0,aq);am=this.element.value.substring(an);this.element.value=al+ap+am;this.element.scrollTop=ao;return this};ak.prototype._getText=function(){var ao,al,am,an;if(this.document.selection!=null){al=this.document.selection.createRange();return al.text}else{if(this.element.setSelectionRange){an=this.caret(),am=an[0],ao=an[1];return this.element.value.substring(am,ao)}}return null};ak.prototype._setText=function(aq,am){var ap,al,ao,an;ao=this.element.scrollTop;an=this.caret(),al=an[0],ap=an[1];this.replace(aq,al,ap);ap=al+aq.length;if(!am){al=ap}this.caret(al,ap);this.element.focus();this.element.scrollTop=ao;return this};ak.prototype.text=function(am,al){if(am!=null){return this._setText(am,al)}return this._getText()};ak.prototype.insertBefore=function(ar,am){var ap,al,ao,aq,an;ao=this.element.scrollTop;an=this.caret(),al=an[0],ap=an[1];aq=this.text();this.replace(ar+aq,al,ap);ap=al+ar.length;if(!am){al=ap}this.caret(al,ap);this.element.focus();this.element.scrollTop=ao;return this};ak.prototype.insertAfter=function(ar,am){var ap,al,ao,aq,an;ao=this.element.scrollTop;an=this.caret(),al=an[0],ap=an[1];aq=this.text();this.replace(aq+ar,al,ap);al=ap;ap=ap+ar.length;if(!am){al=ap}this.caret(al,ap);this.element.focus();this.element.scrollTop=ao;return this};ak.prototype.enclose=function(an,ap,am){var aq,au,al,ar,at,ao;al=this.element.scrollTop;at=this.text();if(at.indexOf(an)===0&&at.lastIndexOf(ap)===(at.length-ap.length)){ar=at.substring(an.length,at.length-ap.length);this.text(ar,am)}else{ao=this.caret(),au=ao[0],aq=ao[1];this.replace(an+at+ap,au,aq);aq=au+an.length+at.length+ap.length;if(!am){au=aq}this.caret(au,aq)}this.element.focus();this.element.scrollTop=al;return this};ak.prototype.lineCaret=function(ao){var an,al,am;ao=ao||this.caret()[0];am=this.element.value;al=am.lastIndexOf("\n",ao-1)+1;an=am.indexOf("\n",ao);if(an===-1){an=am.length}return[al,an]};ak.prototype._getLine=function(ao){var an,al,am;am=this.lineCaret(ao),al=am[0],an=am[1];return this.element.value.substring(al,an)};ak.prototype._setLine=function(al,an){var aq,am,ap,ao;ap=this.element.scrollTop;ao=this.lineCaret(),am=ao[0],aq=ao[1];this.replace(al,am,aq);aq=am+al.length;if(!an){am=aq}this.caret(am,aq);this.element.focus();this.element.scrollTop=ap;return this};ak.prototype.line=function(am,al){if(am!=null){return this._setLine(am,al)}return this._getLine()};ak.prototype.selectWholeLine=function(ao){var an,al,am;am=this.lineCaret(ao),al=am[0],an=am[1];return this.caret(al,an)};ak.prototype.selectWholeCurrentLine=function(){return this.selectWholeLine(null)};return ak})();Q=(function(){var ak,az,ao,an,av,aw,ax,am,at,al,ar,au,ay,aq,ap;ar=function(aA){if(aA==null){aA=false}return this.outerWidth(aA)-this.width()};al=function(aA){if(aA==null){aA=false}return this.outerHeight(aA)-this.height()};ay=function(aA,aB){var aC;if(aA==null){aA=false}if(typeof aA==="number"){aB=aA;aA=false}if(aB!=null){aC=this.nonContentWidth(aA);return this.width(aB-aC)}return this._outerWidth(aA)};au=function(aA,aB){var aC;if(aA==null){aA=false}if(typeof aA==="number"){aB=aA;aA=false}if(aB!=null){aC=this.nonContentHeight(aA);return this.height(aB-aC)}return this._outerHeight(aA)};at=function(aB,aA){var aC;if(aA==null){aA=null}aC=this.css(aB);if(aC===""||aC==="none"||aC===null||aC===(void 0)||aC===NaN){return aA}aC=parseInt(aC,10);return aC};am=function(){return this.ncss("min-width")};ax=function(){return this.ncss("min-height")};aw=function(){return this.ncss("max-width")};av=function(){return this.ncss("max-height")};ao=function(aA){var aD,aC,aB;if(aA==null){aA=false}aC=aA?this.ncss("margin-left"):0;aD=this.ncss("border-left-width");aB=this.ncss("padding-left");return aC+aD+aB};an=function(aA){var aD,aC,aB;if(aA==null){aA=false}aC=aA?this.ncss("margin-top"):0;aD=this.ncss("border-top-width");aB=this.ncss("padding-top");return aC+aD+aB};ak=function(aA){var aB;aB=this.offset();if(aA!=null){aB.left=aA;return this.offset(aB)}return aB.left};az=function(aA){var aB;aB=this.offset();if(aA!=null){aB.top=aA;return this.offset(aB)}return aB.top};aq=function(aA,aC){var aD,aB;if(aA==null){aA=false}if(typeof aA==="number"){aC=aA;aA=false}aB=Q(this.parent());aD=aB.absoluteX()+aB.contentX(aA);if(aC!=null){return this.absoluteX(aC+aD)}return this.absoluteX()-aD};ap=function(aA,aC){var aD,aB;if(aA==null){aA=false}if(typeof aA==="number"){aC=aA;aA=false}aB=Q(this.parent());aD=aB.absoluteY()+aB.contentY(aA);if(aC!=null){return this.absoluteY(aC+aD)}return this.absoluteY()-aD};Q=function(aA){if(aA.__evoluted__===true){return aA}aA._outerWidth=aA.outerWidth;aA._outerHeight=aA.outerHeight;aA.nonContentWidth=ar;aA.nonContentHeight=al;aA.outerWidth=ay;aA.outerHeight=au;aA.nonContentWidth=ar;aA.nonContentHeight=al;aA.ncss=at;aA.minWidth=am;aA.minHeight=ax;aA.maxWidth=aw;aA.maxHeight=av;aA.contentX=ao;aA.contentY=an;aA.absoluteX=ak;aA.absoluteY=az;aA.relativeX=aq;aA.relativeY=ap;aA.__evoluted__=true;return aA};return Q})();q=function(al){var ak;al.css("position","relative");ak=$("<div>").appendTo(al).hide().css({position:"absolute",top:"0",left:"0",overflow:"hidden","z-index":99999});ak.on=function(){ak.refresh();ak.show();return this};ak.refresh=function(){ak.width(al.outerWidth(true));ak.height(al.outerHeight(true));return this};ak.off=function(){ak.hide();return this};return ak};ac=(function(){var ak,al;al=function(){return(new Date()).getTime()};ak={start:0,end:100,duration:1000,callbackEach:null,callbackDone:null,easing:jQuery.easing.swing};return function(am){var ap,an,ao;am=jQuery.extend(ak,am);an=al();ap=am.end-am.start;ao=function(){var ar,aq;ar=al()-an;aq=am.easing(ar/am.duration,ar,0,1,am.duration);aq=aq*ap+am.start;am.callbackEach(aq,ar);if(ar<am.duration){return setTimeout(ao,1)}else{am.callbackEach(am.end,am.duration);return typeof am.callbackDone==="function"?am.callbackDone():void 0}};ao();return null}})();e=(function(){var ak;ak=function(ar){var ao,am,aq,an,ap,al;if(ar.which!==13){return}an=this.selection.line();ao=((ap=this.autoIndent.pre)!=null?ap.call(this,ar,an):void 0)===true;if(ao!==true){am=an.replace(/^([\t\s]*).*$/,"$1");aq="\n"+am;this.selection.insertAfter(aq,false)}if((al=this.autoIndent.post)!=null){al.call(this,ar,an,am,aq,ao)}ar.stopPropagation();ar.stopImmediatePropagation();ar.preventDefault();this.focus();return false};return function(al,an,am){if(!(al instanceof jQuery)){al=$(al)}if(!(al.selection!=null)){al.selection=new T(document,al.get(0))}al.autoIndent=function(ao){return ak.call(al,ao)};al.autoIndent.enable=function(){al.on("keydown",al.autoIndent);return al};al.autoIndent.disable=function(){al.off("keydown",al.autoIndent);return al};if(an!=null){al.autoIndent.pre=function(ap,ao){return an.call(al,ap,ao)}}if(am!=null){al.autoIndent.post=function(ar,ap,ao,aq){return am.call(al,ar,ap,ao,aq)}}return al.autoIndent.enable()}})();if(window.i18n!=null){h=function(ak){return i18n.t(ak,{defaultValue:ak})}}else{h=function(ak){return ak}}p={mainPanelClass:null,editorClass:null,viewerClass:null,helperClass:null,toolbarButtons:[],statusbarButtons:[],defaultVolume:null,defaultVolume2:null};this.Jencil=(function(){function ak(al,am){var an,ao=this;an={profile:"Html",profiles:{Html:F,Markdown:G},resizable:true,enableTabIndent:true,enableAutoIndent:true,tabString:"\t",defaultVolume:null,defaultVolume2:null,width:640,height:620,editorTemplatePath:null,viewerTemplatePath:null,helperTemplatePath:null};this.options=jQuery.extend(an,am);this.element=al.hide();this.caretaker=new g();this.caretaker.originator=function(){return ao.editor()};this.wrapper=new x(this,this.options.width,this.options.height);this.fullscreen=new w(this);this.element.after(this.wrapper.element).after(this.fullscreen.element);this.profile(this.options.profile)}ak.prototype.editor=function(){return this.wrapper.workspace.mainPanel.editorPanel||null};ak.prototype.viewer=function(){return this.wrapper.workspace.mainPanel.viewerPanel||null};ak.prototype.helper=function(){return this.wrapper.workspace.mainPanel.helperPanel||null};ak.prototype.profile=function(al){this.wrapper.init(al);this.wrapper.adjust();return this.caretaker.save()};return ak})();$.fn.jencil=function(ak){return $(this).each(function(){var al;al=$(this);return al.data("jencil",new Jencil(al,ak))})};V("Jencil.profiles",function(ak){return ak.DefaultProfile=p});V("Jencil.utils.namespace",function(ak){return ak.namespace=V});V("Jencil.utils.strutils",function(ak){return ak.strutils=l});V("Jencil.utils.evolution",function(ak){return ak.evolute=Q});V("Jencil.utils.selection",function(ak){return ak.Selection=T});V("Jencil.utils.animation",function(ak){return ak.animate=ac});V("Jencil.utils.autoindent",function(ak){return ak.autoIndentable=e});V("Jencil.utils.curtain",function(ak){return ak.curtainFactory=q});V("Jencil.utils.i18n",function(ak){return ak.translate=h});V("Jencil.utils.undo",function(ak){ak.NotImplementedError=A;ak.Originator=K;return ak.Caretaker=g});V("Jencil",function(ak){return ak.t=h});m=(function(){function ak(am,al,an){this.core=am;if(al==null){al="<div>"}if(al instanceof jQuery){this.element=al}else{this.element=$(al,an)}this.element=Q(this.element)}ak.prototype.init=function(){return this};ak.prototype.adjust=function(){return this};return ak})();j=(function(ak){r(al,ak);function al(an,am,ao){if(am==null){am="<div>"}al.__super__.constructor.call(this,an,am,ao);this.element.addClass("panel")}return al})(m);u=(function(al){r(ak,al);function ak(ao,ap,am,ar){var aq,an,at=this;this.fst=ap;this.snd=am;this.splitter=ar;ak.__super__.constructor.call(this,ao);this.element.addClass("multiple");this.element.append(this.fst.element);this.element.append(this.splitter.element);this.element.append(this.snd.element);an=function(au){if(!this.element.is(":visible")){return this.toggle(au,null)}};aq=function(au){if(this.element.is(":visible")){return this.toggle(null,au)}};this.fst.toggle=function(av,au){return at._togglePanel(0,av,au)};this.fst.show=an;this.fst.hide=aq;this.snd.toggle=function(av,au){return at._togglePanel(1,av,au)};this.snd.show=an;this.snd.hide=aq;this.splitter.element.dblclick(function(){return at.snd.toggle()})}ak.prototype.init=function(){this.splitter.init();this.fst.init();return this.snd.init()};ak.prototype._togglePanel=function(au,ar,an){var ap,am,ao,aq,at=this;if(ak._animating){return}ao=this.splitter.volume();ap=null;if((0<ao&&ao<1)){am=au;this.splitter._previousVolume=ao;aq=an}else{am=this.splitter._previousVolume||this.splitter.defaultVolume;if(am===au){am=0.5}aq=ar}ak._animating=true;ap=function(){ak._animating=false;return typeof aq==="function"?aq():void 0};return ac({start:ao,end:am,duration:500,callbackEach:function(aw,av){return at.splitter.volume(aw)},callbackDone:ap})};return ak})(j);n=(function(al){r(ak,al);function ak(an,ao,am,ap){var aq;if(ap==null){ap=0.5}aq=new N(an,ao,am,ap);ak.__super__.constructor.call(this,an,ao,am,aq);this.element.addClass("vertical")}ak.prototype.adjust=function(){this.fst.element.outerHeight(true,this.element.height());this.snd.element.outerHeight(true,this.element.height());this.splitter.element.outerHeight(true,this.element.height());this.splitter.adjust();return this};return ak})(u);aa=(function(al){r(ak,al);function ak(an,ao,am,ap){var aq;if(ap==null){ap=0.5}aq=new H(an,ao,am,ap);ak.__super__.constructor.call(this,an,ao,am,aq);this.element.addClass("horizontal")}ak.prototype.adjust=function(){this.fst.element.outerWidth(true,this.element.width());this.snd.element.outerWidth(true,this.element.width());this.splitter.element.outerWidth(true,this.element.width());this.splitter.adjust();return this};return ak})(u);V("Jencil.widgets",function(ak){ak.Widget=m;ak.Panel=j;ak.MultiplePanel=u;ak.VerticalPanel=n;return ak.HorizontalPanel=aa});Y=(function(ak){r(al,ak);function al(an,ao,am,ap){var aq,ar,at=this;this.fst=ao;this.snd=am;this.defaultVolume=ap!=null?ap:0.5;al.__super__.constructor.call(this,an);this.element.addClass("splitter");this._volume=this.defaultVolume;aq=function(aw){var av,au;at.mousemove(aw);if((av=at.fst.curtain)!=null){av.refresh()}if((au=at.snd.curtain)!=null){au.refresh()}aw.stopPropagation();aw.stopImmediatePropagation();return aw.preventDefault()};ar=function(aw){var ax,av,au;ax=$(window);ax.unbind("mousemove",aq);ax.unbind("mouseup",ar);if((av=at.fst.curtain)!=null){av.off()}if((au=at.snd.curtain)!=null){au.off()}aw.stopPropagation();aw.stopImmediatePropagation();return aw.preventDefault()};this.element.mousedown(function(aw){var ax,av,au;ax=$(window);ax.mousemove(aq);ax.mouseup(ar);if((av=at.fst.curtain)!=null){av.on()}if((au=at.snd.curtain)!=null){au.on()}aw.stopPropagation();aw.stopImmediatePropagation();return aw.preventDefault()})}al.prototype.init=function(){this.container=Q(this.element.parent());return this};al.prototype.volume=function(an,am){if(am==null){am=false}if(an!=null){this._volume=an;if(!am){this.adjust()}return this}return this._volume};al.prototype.value=function(ap,ao){var am,an;if(ao==null){ao=false}am=this.valueWidth();if(ap!=null){an=ap/am;return this.volume(an,ao)}return this.volume()*am};al.prototype.regulateValue=function(an){var ao,am;am=this.minValue();ao=this.maxValue();if(an<am){an=am}if(an>ao){an=ao}return an};return al})(m);N=(function(ak){r(al,ak);function al(ao,ap,an,aq){var ar,am;al.__super__.constructor.call(this,ao,ap,an,aq);this.element.addClass("vertical");this.fst.element.addClass("left");this.snd.element.addClass("right");this.fst.element.css({"float":"left"});this.snd.element.css({"float":"left"});if((ar=this.fst.curtain)!=null){ar.css("pointer","col-resize")}if((am=this.snd.curtain)!=null){am.css("pointer","col-resize")}}al.prototype.mousemove=function(an){var ao,am;ao=this.container.absoluteX()+this.container.contentX(true);am=an.pageX-ao;am=this.regulateValue(am);return this.value(am)};al.prototype.valueWidth=function(){return this.container.width()};al.prototype.minValue=function(){var an,am;an=this.fst.element.minWidth()+this.fst.element.nonContentWidth();am=this.snd.element.maxWidth();if(am!=null){am=this.valueWidth()-(am+this.snd.element.nonContentWidth())}if((an!=null)&&(am!=null)){return Math.max(an,am)}return an||am||0};al.prototype.maxValue=function(){var ao,an,am;am=this.valueWidth();ao=this.fst.element.maxWidth();if(ao!=null){ao=ao+this.fst.element.nonContentWidth()}an=this.snd.element.minWidth()+this.snd.element.nonContentWidth();if(an!=null){an=am-an}if((ao!=null)&&(an!=null)){return Math.min(ao,an)}return ao||an||am};al.prototype.adjust=function(){var ap,ao,an,am;an=this.value();am=this.valueWidth();ap=an-this.fst.element.nonContentWidth(true);ao=(am-an)-this.snd.element.nonContentWidth(true);if(ap<=0){if(this.fst.element.is(":visible")){this.fst.element.hide()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.snd.element.outerWidth(true,am);this._value=an=0}else{if(ao<=0){if(!this.fst.element.is(":visible")){this.fst.element.show()}if(this.snd.element.is(":visible")){this.snd.element.hide()}this.fst.element.outerWidth(true,am);this._value=an=am}else{if(!this.fst.element.is(":visible")){this.fst.element.show()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.fst.element.width(ap);this.snd.element.width(ao)}}this.fst.adjust();this.snd.adjust();this.element.relativeX(an-this.element.outerWidth()/2);return this};return al})(Y);H=(function(al){r(ak,al);function ak(ao,ap,an,aq){var ar,am;ak.__super__.constructor.call(this,ao,ap,an,aq);this.element.addClass("horizontal");this.fst.element.addClass("top");this.snd.element.addClass("bottom");if((ar=this.fst.curtain)!=null){ar.css("pointer","raw-resize")}if((am=this.snd.curtain)!=null){am.css("pointer","raw-resize")}}ak.prototype.mousemove=function(an){var ao,am;ao=this.container.absoluteY()+this.container.contentY(true);am=an.pageY-ao;am=this.regulateValue(am);return this.value(am)};ak.prototype.valueWidth=function(){return this.container.height()};ak.prototype.minValue=function(){var an,am;an=this.fst.element.minHeight()+this.fst.element.nonContentHeight();am=this.snd.element.maxHeight();if(am!=null){am=this.valueWidth()-(am+this.snd.element.nonContentHeight())}if((an!=null)&&(am!=null)){return Math.max(an,am)}return an||am||0};ak.prototype.maxValue=function(){var ao,an,am;am=this.valueWidth();ao=this.fst.element.maxHeight();if(ao!=null){ao=ao+this.fst.element.nonContentHeight()}an=this.snd.element.minHeight()+this.snd.element.nonContentHeight();if(an!=null){an=am-an}if((ao!=null)&&(an!=null)){return Math.min(ao,an)}return ao||an||am};ak.prototype.adjust=function(){var ap,ao,an,am;an=this.value();am=this.valueWidth();ap=an-this.fst.element.nonContentHeight(true);ao=(am-an)-this.snd.element.nonContentHeight(true);if(ap<=0){if(this.fst.element.is(":visible")){this.fst.element.hide()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.snd.element.outerHeight(true,am);this._value=an=0}else{if(ao<=0){if(!this.fst.element.is(":visible")){this.fst.element.show()}if(this.snd.element.is(":visible")){this.snd.element.hide()}this.fst.element.outerHeight(true,am);this._value=an=am}else{if(!this.fst.element.is(":visible")){this.fst.element.show()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.fst.element.height(ap);this.snd.element.height(ao)}}this.fst.adjust();this.snd.adjust();this.element.relativeY(an-this.element.outerHeight()/2);return this};return ak})(Y);V("Jencil.splitters",function(ak){ak.Splitter=Y;ak.VerticalSplitter=N;return ak.HorizontalSplitter=H});W=(function(al){r(ak,al);function ak(an,am,ao){if(am==null){am="<div>"}ak.__super__.constructor.call(this,an,am,ao);this.element.addClass("editor");this._changeCallbacks=[]}ak.prototype.val=function(am){throw new Error("NotImplementedError")};ak.prototype.change=function(ap){var ao,am,an;if(ap!=null){this._changeCallbacks.push(ap);return this}an=this._changeCallbacks;for(ao=0,am=an.length;ao<am;ao++){ap=an[ao];ap.call(this,this.val())}return this};ak.prototype.h1=null;ak.prototype.h2=null;ak.prototype.h3=null;ak.prototype.h4=null;ak.prototype.h5=null;ak.prototype.h6=null;ak.prototype.bold=null;ak.prototype.italic=null;ak.prototype.underline=null;ak.prototype.strike=null;ak.prototype.superscript=null;ak.prototype.subscript=null;ak.prototype.anchor=null;ak.prototype.image=null;ak.prototype.unorderedList=null;ak.prototype.orderedList=null;return ak})(j);O=(function(ak){r(al,ak);function al(an,am,ao){var ap=this;if(am==null){am="<div>"}al.__super__.constructor.call(this,an,am,ao);this.textarea=$("<textarea>").appendTo(this.element).css({margin:"0",padding:"0",border:"none",outline:"none",resize:"none"});this.textarea=Q(this.textarea);this.textarea.on("keydown",function(aq){if(aq.which!==13){return}return ap.core.caretaker.save()});if(($.fn.tabby!=null)&&this.core.options.enableTabIndent){this.textarea.tabby({tabString:this.core.options.tabString})}this.textarea=e(this.textarea);if(!this.core.options.enableAutoIndent){this.textarea.autoIndent.disable()}this.textarea.on("keypress keyup click blur",function(){return ap.change()})}al.prototype.val=function(am){if(am!=null){this.textarea.val(am);this.change();return this}return this.textarea.val()};al.prototype.focus=function(){this.textarea.focus();return this};al.prototype.createMemento=function(){return this.val()};al.prototype.setMemento=function(am){return this.val(am)};al.prototype.adjust=function(){this.textarea.outerWidth(this.element.width());this.textarea.outerHeight(this.element.height());return this};al.prototype.selectWholeLineIfNoSelectionFound=function(){var am;am=this.textarea.selection.caret();if(am[0]===am[1]){this.textarea.selection.selectWholeCurrentLine()}};al.prototype.selection=function(an,am){if(am==null){am=true}if(an!=null){this.textarea.selection.text(an,am);this.core.caretaker.save();return this.change()}return this.textarea.selection.text()};al.prototype.enclose=function(am,an,ao){if(ao==null){ao=true}this.selectWholeLineIfNoSelectionFound();this.textarea.selection.enclose(am,an,ao);this.core.caretaker.save();return this.change()};al.prototype.insertBefore=function(an,am){if(am==null){am=true}this.selectWholeLineIfNoSelectionFound();this.textarea.selection.insertBefore(an,am);this.core.caretaker.save();return this.change()};al.prototype.insertAfter=function(an,am){if(am==null){am=true}this.selectWholeLineIfNoSelectionFound();this.textarea.selection.insertAfter(an,am);this.core.caretaker.save();return this.change()};return al})(W);V("Jencil.editors",function(ak){ak.BaseEditor=W;return ak.TextEditor=O});C=(function(al){r(ak,al);function ak(an,am,ao){if(am==null){am="<div>"}ak.__super__.constructor.call(this,an,am,ao);this.element.addClass("viewer")}ak.prototype.update=function(an,am){throw new Error("NotImplementedError")};return ak})(j);ah=(function(al){r(ak,al);function ak(am){ak.__super__.constructor.call(this,am);this.templatePath=this.core.options.viewerTemplatePath;this.element.css({position:"relative"});this.curtain=q(this.element);this.iframe=$("<iframe>").appendTo(this.element).css({margin:"0",padding:"0",border:"none",outline:"none",resize:"none",width:"100%",height:"100%",overflow:"visible"});this.iframe.attr("frameborder",0);this.iframe=Q(this.iframe);this.iframe.init=function(){var an;an=this.get(0);if(an.contentDocument!=null){this.document=an.contentDocument}else{this.document=an.contentWindow.document}return this.document.write("<body></body>")};this.iframe.write=function(an){var ap;if(this.document!=null){try{ap=this.document.documentElement.scrollTop}catch(ao){ap=0}this.document.open();this.document.write(an);this.document.close();$("a",$(this.document)).attr("target","_blank");this.document.documentElement.scrollTop=ap;this.width(this.document.scrollLeft);this.height(this.document.scrollTop);return true}return false};this.iframe.loadTemplate=function(an,ao){var ap=this;return $.ajax({url:an,success:function(aq){ap._template=aq;return ap.write(ao)}})}}ak.prototype.init=function(){return this.iframe.init()};ak.prototype.update=function(an,am){if(!this.element.is(":visible")&&!am){return}if(this.iframe._template!=null){an=this.iframe._template.replace("{{content}}",an)}else{if(this.templatePath!=null){this.iframe.loadTemplate(this.templatePath,an)}}return this.iframe.write(an)};ak.prototype.adjust=function(){this.iframe.outerWidth(this.element.width());this.iframe.outerHeight(this.element.height());return this};return ak})(C);U=(function(al){r(ak,al);function ak(am,an){this.config=an;ak.__super__.constructor.call(this,am);this.config=jQuery.extend({type:"GET",dataType:"text",data:function(ao){return encodeURIComponent(ao)},url:null},this.config)}ak.prototype.update=function(an,am){var ao=this;if(this._valueCache!==an||am){this._valueCache=an;return $.ajax({type:this.config.type,dataType:this.config.dataType,data:JSON.stringify(this.config.data(an)),url:this.config.url,success:function(ap){if(ao.iframe._template!=null){ap=ao.iframe._template.replace("{{content}}",ap)}else{if(ao.templatePath!=null){ao.iframe.loadTemplate(ao.templatePath,ap)}}return ao.iframe.write(ap)}})}};return ak})(ah);V("Jencil.viewers",function(ak){ak.BaseViewer=C;ak.TemplateViewer=ah;return ak.AjaxViewer=U});c=(function(al){r(ak,al);function ak(an,am,ao){if(am==null){am="<div>"}ak.__super__.constructor.call(this,an,am,ao);this.element.addClass("helper")}return ak})(j);I=(function(al){r(ak,al);function ak(am){ak.__super__.constructor.call(this,am);this.templatePath=this.core.options.helperTemplatePath;this.element.css({position:"relative"});this.curtain=q(this.element);this.iframe=$("<iframe>").appendTo(this.element).css({margin:"0",padding:"0",border:"none",outline:"none",resize:"none",width:"100%",height:"100%",overflow:"visible"});this.iframe.attr("frameborder",0);this.iframe=Q(this.iframe);this.iframe.init=function(){var an;an=this.get(0);if(an.contentDocument!=null){this.document=an.contentDocument}else{this.document=an.contentWindow.document}return this.document.write("<body></body>")};this.iframe.write=function(an){var ap;if(this.document!=null){try{ap=this.document.documentElement.scrollTop}catch(ao){ap=0}this.document.open();this.document.write(an);this.document.close();this.document.documentElement.scrollTop=ap;this.width(this.document.scrollLeft);this.height(this.document.scrollTop);return true}return false};this.iframe.loadTemplate=function(an){var ao=this;return $.ajax({url:an,success:function(ap){return ao.write(ap)}})}}ak.prototype.init=function(){this.iframe.init();if(this.templatePath!=null){return this.iframe.loadTemplate(this.templatePath)}};ak.prototype.adjust=function(){this.iframe.outerWidth(this.element.width());this.iframe.outerHeight(this.element.height());return this};return ak})(c);V("Jencil.helpers",function(ak){ak.BaseHelper=c;return ak.TemplateHelper=I});z=(function(ak){r(al,ak);function al(am){al.__super__.constructor.call(this,am,"<span>");this.element.addClass("separator")}return al})(m);Z=(function(al){r(ak,al);function ak(am,an,ap,ao){this.name=an;this.text=ap;this.title=ao;ak.__super__.constructor.call(this,am,"<a>");this.text=Jencil.t(this.text||this.name);this.title=Jencil.t(this.title||this.text);this.element.addClass("button").addClass(an);this.element.append($("<span>"+this.text+"</span>"));this.element.attr("title",this.title)}ak.prototype.enable=function(){this.element.removeClass("disable");return this};ak.prototype.disable=function(){this.element.addClass("disable");return this};ak.prototype.init=function(){this.validate();return this};ak.prototype.validate=function(){return this};return ak})(m);ae=(function(al){r(ak,al);function ak(an,ao,aq,ap,at,am){var ar=this;this.shortcut=am;ak.__super__.constructor.call(this,an,ao,aq,ap);this.callback=function(){if(!ar.element.hasClass("disable")){ar.callback.raw()}return ar};this.callback.raw=at;this.element.click(function(){return ar.callback()});if((this.shortcut!=null)&&(window.shortcut!=null)){window.shortcut.add(this.shortcut,function(au){return ar.callback()});this.element.attr("title",""+this.title+" ("+this.shortcut+")")}}return ak})(Z);f=(function(ak){r(al,ak);function al(an,ao,ar,aq,ap,am){var at;this.command=ap;at=function(){var au;au=an.editor();return au[ap].call(au)};al.__super__.constructor.call(this,an,ao,ar,aq,at,am)}al.prototype.validate=function(){var am;am=this.core.editor();if(!(am[this.command]!=null)){this.disable()}return this};al.factory=function(an,ap){var at,ao,am,ar,aq;ao=ar=aq=at=am=null;switch(ap.length){case 5:ao=ap[0];ar=ap[1];aq=ap[2];at=ap[3];am=ap[4];break;case 4:ao=ap[0];ar=aq=ap[1];at=ap[2];am=ap[3];break;case 3:ao=at=ap[0];ar=aq=ap[1];am=ap[2];break;case 2:ao=at=ap[0];ar=aq=ap[1];am=null;break;case 1:ao=at=ar=aq=ap[0];am=null}return new al(an,ao,ar,aq,at,am)};return al})(ae);D=(function(ak){r(al,ak);function al(am){var ao,an=this;ao=function(ap){return an.core.caretaker.undo()};al.__super__.constructor.call(this,am,"undo","Undo","Undo",ao,"Ctrl+Z")}al.prototype.init=function(){var am,an=this;am=function(){if(an.core.caretaker.canUndo()===false){an.disable()}else{an.enable()}return setTimeout(am,100)};return am()};return al})(ae);a=(function(al){r(ak,al);function ak(am){var ao,an=this;ao=function(ap){return an.core.caretaker.redo()};ak.__super__.constructor.call(this,am,"redo","Redo","Redo",ao,"Ctrl+Shift+Z")}ak.prototype.init=function(){var am,an=this;am=function(){if(an.core.caretaker.canRedo()===false){an.disable()}else{an.enable()}return setTimeout(am,100)};return am()};return ak})(ae);s=(function(al){r(ak,al);function ak(am){var ao,an=this;ao=function(ap){return an.core.fullscreen.toggle()};ak.__super__.constructor.call(this,am,"fullscreen","Toggle fullscreen","Fullscreen",ao,"Ctrl+F")}ak.prototype.init=function(){var am,an=this;am=function(){if(an.core.fullscreen.element.is(":visible")===true){an.element.addClass("hide")}else{an.element.removeClass("hide")}return setTimeout(am,100)};return am()};return ak})(ae);ad=(function(al){r(ak,al);function ak(am){var ao,an=this;ao=function(ap){return an.core.viewer().toggle()};ak.__super__.constructor.call(this,am,"viewer","Quick view","Quick view",ao,"Ctrl+Q")}ak.prototype.validate=function(){if(!(this.core.viewer()!=null)){this.disable();return false}return true};ak.prototype.init=function(){var am,an=this;if(!this.validate()){return}am=function(){if(an.core.viewer().element.is(":visible")){an.element.addClass("hide")}else{an.element.removeClass("hide")}return setTimeout(am,100)};return am()};return ak})(ae);i=(function(al){r(ak,al);function ak(am){var ao,an=this;ao=function(ap){return an.core.helper().toggle()};ak.__super__.constructor.call(this,am,"helper","Help","Help",ao,"Ctrl+H")}ak.prototype.validate=function(){if(!this.core.helper()){this.disable();return false}return true};ak.prototype.init=function(){var am,an=this;if(!this.validate()){return}am=function(){if(an.core.helper().element.is(":visible")){an.element.addClass("hide")}else{an.element.removeClass("hide")}return setTimeout(am,100)};return am()};return ak})(ae);X=function(ak,al){if(al instanceof Array){return f.factory(ak,al)}if(typeof al==="string"){switch(al){case"Separator":return new z(ak);case"Undo":return new D(ak);case"Redo":return new a(ak);case"Fullscreen":return new s(ak);case"Viewer":return new ad(ak);case"Helper":return new i(ak);default:throw new Exception(""+al+" is not known Button type")}}return new al(ak)};V("Jencil.buttons",function(ak){ak.Separator=z;ak.Button=Z;ak.ActionButton=ae;ak.CommandButton=f;ak.UndoButton=D;ak.RedoButton=a;ak.FullscreenButton=s;ak.ViewerButton=ad;ak.HelperButton=i;return ak.buttonFactory=X});x=(function(ak){r(al,ak);function al(an,ao,am){var ap=this;al.__super__.constructor.call(this,an);this.element.addClass("jencil wrapper");this.element.width(ao);this.element.height(am);this.workspace=new o(this.core);this.workspace.element.appendTo(this.element);this.curtain={on:function(){var at,aq,aw,av,au,ar;if((at=ap.core.editor())!=null){if((aq=at.curtain)!=null){aq.on()}}if((aw=ap.core.viewer())!=null){if((av=aw.curtain)!=null){av.on()}}if((au=ap.core.helper())!=null){if((ar=au.curtain)!=null){ar.on()}}return ap.adjust()},refresh:function(){var at,aq,aw,av,au,ar;if((at=ap.core.editor())!=null){if((aq=at.curtain)!=null){aq.refresh()}}if((aw=ap.core.viewer())!=null){if((av=aw.curtain)!=null){av.refresh()}}if((au=ap.core.helper())!=null){if((ar=au.curtain)!=null){ar.refresh()}}return ap.adjust()},off:function(){var at,aq,aw,av,au,ar;if((at=ap.core.editor())!=null){if((aq=at.curtain)!=null){aq.off()}}if((aw=ap.core.viewer())!=null){if((av=aw.curtain)!=null){av.off()}}if((au=ap.core.helper())!=null){if((ar=au.curtain)!=null){ar.off()}}return ap.adjust()}}}al.prototype.init=function(am){var an=this;if((this.element.resizable!=null)&&this.core.options.resizable===true){this.element.resizable({start:function(){return an.curtain.on()},resize:function(){return an.curtain.refresh()},stop:function(){return an.curtain.off()}})}this.workspace.profile(am);this.workspace.init();return this};al.prototype.adjust=function(){this.workspace.element.outerWidth(true,this.element.width());this.workspace.element.outerHeight(true,this.element.height());this.workspace.adjust();return this};return al})(j);o=(function(al){r(ak,al);function ak(am){ak.__super__.constructor.call(this,am);this.element.addClass("workspace")}ak.prototype.profile=function(ay){var av,ao,at,ar,ax,am,au,aq,ap,an,aw=this;if(ay!=null){if(typeof ay==="string"){ay=this.core.options.profiles[ay]}ao=jQuery.extend(true,p,ay);ao.defaultVolume=this.core.options.defaultVolume||ao.defaultVolume;ao.defaultVolume2=this.core.options.defaultVolume2||ao.defaultVolume2;this.element.empty();this.mainPanel=new ao.mainPanelClass(this.core,ao);if((au=this.mainPanel.editorPanel)!=null){au.val(this.core.element.val())}if((aq=this.mainPanel.editorPanel)!=null){aq.change(function(az){return aw.core.element.val(az)})}this.toolbar=new t(this.core);ap=ao.toolbarButtons;for(at=0,ax=ap.length;at<ax;at++){av=ap[at];av=X(this.core,av);this.toolbar.addButton(av)}this.statusbar=new L(this.core);an=ao.statusbarButtons;for(ar=0,am=an.length;ar<am;ar++){av=an[ar];av=X(this.core,av);this.statusbar.addButton(av)}this.element.append(this.toolbar.element);this.element.append(this.mainPanel.element);this.element.append(this.statusbar.element);this._profile=ao;return this}return this._profile};ak.prototype.init=function(){this.toolbar.init();this.statusbar.init();return this.mainPanel.init()};ak.prototype.adjust=function(){var an,am;this.toolbar.element.outerWidth(true,this.element.width());this.statusbar.element.outerWidth(true,this.element.width());this.mainPanel.element.outerWidth(true,this.element.width());this.mainPanel.element.outerHeight(true,this.element.height());this.mainPanel.adjust();an=this.toolbar.element.outerHeight(true);am=this.statusbar.element.outerHeight(true);this.mainPanel.element.outerHeight(true,this.element.height()-(an+am));this.toolbar.adjust();this.statusbar.adjust();this.mainPanel.adjust();return this};ak.prototype.update=function(am){if(this.mainPanel.editorPanel&&this.mainPanel.viewerPanel){return this.mainPanel.viewerPanel.update(this.mainPanel.editorPanel.val(),am)}};return ak})(j);J=(function(al){r(ak,al);function ak(am){ak.__super__.constructor.call(this,am);this._buttons=[]}ak.prototype.init=function(){var an,ap,am,ao;ao=this._buttons;for(ap=0,am=ao.length;ap<am;ap++){an=ao[ap];an.init()}return this};ak.prototype.addButton=function(am){this._buttons.push(am);return this.element.append(am.element)};return ak})(j);t=(function(al){r(ak,al);function ak(am){ak.__super__.constructor.call(this,am);this.element.addClass("toolbar")}return ak})(J);L=(function(al){r(ak,al);function ak(am){ak.__super__.constructor.call(this,am);this.element.addClass("statusbar")}return ak})(J);V("Jencil.workspace",function(ak){ak.Wrapper=x;ak.Workspace=o;ak.Bar=J;ak.Toolbar=t;return ak.Statusbar=L});ab=(function(ak){r(al,ak);function al(ao,ap,am,ar){var aq,an,at=this;this.fst=ap;this.snd=am;this.splitter=ar;al.__super__.constructor.call(this,ao);this.element.addClass("multi");this.element.append(this.fst.element);this.element.append(this.splitter.element);this.element.append(this.snd.element);an=function(au){if(!this.element.is(":visible")){return this.toggle(au,null)}};aq=function(au){if(this.element.is(":visible")){return this.toggle(null,au)}};this.fst.toggle=function(av,au){return at._togglePanel(0,av,au)};this.fst.show=an;this.fst.hide=aq;this.snd.toggle=function(av,au){return at._togglePanel(1,av,au)};this.snd.show=an;this.snd.hide=aq;this.splitter.element.dblclick(function(){return at.snd.toggle()})}al.prototype.init=function(){this.splitter.init();this.fst.init();return this.snd.init()};al.prototype._togglePanel=function(au,ar,an){var ap,am,ao,aq,at=this;if(al._animating){return}ao=this.splitter.volume();ap=null;if((0<ao&&ao<1)){am=au;this.splitter._previousVolume=ao;aq=an}else{am=this.splitter._previousVolume||this.splitter.defaultVolume;if(am===au){am=0.5}aq=ar}al._animating=true;ap=function(){al._animating=false;return typeof aq==="function"?aq():void 0};return ac({start:ao,end:am,duration:500,callbackEach:function(aw,av){return at.splitter.volume(aw)},callbackDone:ap})};return al})(j);n=(function(al){r(ak,al);function ak(an,ao,am,ap){var aq;if(ap==null){ap=0.5}aq=new N(an,ao,am,ap);ak.__super__.constructor.call(this,an,ao,am,aq);this.element.addClass("vertical")}ak.prototype.adjust=function(){this.fst.element.outerHeight(true,this.element.height());this.snd.element.outerHeight(true,this.element.height());this.splitter.element.outerHeight(true,this.element.height());this.splitter.adjust();return this};return ak})(ab);aa=(function(al){r(ak,al);function ak(an,ao,am,ap){var aq;if(ap==null){ap=0.5}aq=new H(an,ao,am,ap);ak.__super__.constructor.call(this,an,ao,am,aq);this.element.addClass("horizontal")}ak.prototype.adjust=function(){this.fst.element.outerWidth(true,this.element.width());this.snd.element.outerWidth(true,this.element.width());this.splitter.element.outerWidth(true,this.element.width());this.splitter.adjust();return this};return ak})(ab);V("Jencil.multipanels",function(ak){ak.MultiPanel=ab;ak.VerticalPanel=n;return ak.HorizontalPanel=aa});b=(function(){function ak(al,an){var am;am=new an.editorClass(al);am.element.addClass("mainPanel");return am}return ak})();S=(function(al){r(ak,al);function ak(am,an){var ao=this;this.editorPanel=new an.editorClass(am);this.viewerPanel=new an.viewerClass(am);ak.__super__.constructor.call(this,am,this.editorPanel,this.viewerPanel,an.defaultVolume);this.element.addClass("mainPanel");this.editorPanel.change(function(ap){return ao.viewerPanel.update(ap)})}ak.prototype.init=function(){ak.__super__.init.call(this);return this.viewerPanel.update(this.editorPanel.val())};return ak})(n);ai=(function(al){r(ak,al);function ak(am,an){var ao=this;this.editorPanel=new an.editorClass(am);this.viewerPanel=new an.viewerClass(am);this.helperPanel=new an.helperClass(am);this.verticalPanel=new n(am,this.editorPanel,this.viewerPanel,an.defaultVolume);ak.__super__.constructor.call(this,am,this.verticalPanel,this.helperPanel,an.defaultVolume2);this.element.addClass("mainPanel");this.editorPanel.change(function(ap){return ao.viewerPanel.update(ap)})}ak.prototype.init=function(){ak.__super__.init.call(this);return this.viewerPanel.update(this.editorPanel.val())};return ak})(aa);V("Jencil.mainpanels",function(ak){ak.MonomainPanel=b;ak.DimainPanel=S;return ak.TrimainPanel=ai});w=(function(al){r(ak,al);function ak(am){var an=this;ak.__super__.constructor.call(this,am);this.element.addClass("fullscreen");this.element.css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%","z-index":100});this.curtain=$("<div>").addClass("curtain");this.curtain.css({position:"absolute",top:"0",left:"0",width:"100%",height:"100%",background:"black",opacity:"0.6",cursor:"pointer"});this.cell=$("<div>").css({position:"absolute",top:"5%",left:"5%",width:"90%",height:"90%"});if($.browser.msie&&$.browser.version<7){this.element.css("position","absolute");$(window).scroll(function(){return an.element.css("top",$(document).scrollTop())})}this.curtain.click(function(){return an.off()});this.element.append(this.curtain);this.element.append(this.cell);this.element.hide();this.resize=function(){return an.core.wrapper.adjust()}}ak.prototype.on=function(){var am,an=this;am=9/10;this.cell.append(this.core.wrapper.element);this.core.wrapper.element.outerWidth(true,this.element.width()*am);this.core.wrapper.element.outerHeight(true,this.element.height()*am);this.core.wrapper.init();this.core.wrapper.adjust();this.core.wrapper.workspace.update(true);this.element.fadeIn("fast",function(){an.core.wrapper.element.css("width","100%");an.core.wrapper.element.css("height","100%");return an.core.wrapper.adjust()});return $(window).on("resize",this.resize)};ak.prototype.off=function(){this.core.element.after(this.core.wrapper.element);this.core.wrapper.element.css("width","");this.core.wrapper.element.css("height","");this.core.wrapper.init();this.core.wrapper.adjust();this.core.wrapper.workspace.update(true);this.element.fadeOut("fast");return $(window).unbind("resize",this.resize)};ak.prototype.toggle=function(an,am){if(this.element.is(":visible")){this.off();return typeof am==="function"?am():void 0}else{this.on();return typeof an==="function"?an():void 0}};return ak})(j);d=(function(){var al,am,an,ak;al=(function(){var ar,ap,aq,ao;aq=["p","li"];ao=[];for(ar=0,ap=aq.length;ar<ap;ar++){ak=aq[ar];ao.push([ak,new RegExp("^[s\t]*<"+ak+">"),new RegExp("</"+ak+">[s\t]*$")])}return ao})();an=function(au,ap){var aq,at,ar,ao;if(au.shiftKey){return}for(ar=0,ao=al.length;ar<ao;ar++){at=al[ar];if(at[1].test(ap)||at[2].test(ap)){aq=this.selection._getLineCaret();this.selection.caret(aq[1]);return}}};am=function(av,aq,ao,au){var at,ar,ap;if(av.shiftKey){return}for(ar=0,ap=al.length;ar<ap;ar++){at=al[ar];if(at[2].test(aq)){ak=at[0];this.selection.insertAfter("<"+ak+"></"+ak+">",false);this.selection.caretOffset(-(3+ak.length));return}}};return function(ao){if(!(ao.autoIndent!=null)){ao=e(ao)}ao.autoIndent.pre=function(aq,ap){return an.call(ao,aq,ap)};ao.autoIndent.post=function(at,aq,ap,ar){return am.call(ao,at,aq,ap,ar)};return ao}})();v=(function(){var ak;ak=new RegExp("^<h([1-6])>(.*)</h[1-6]>\n?$");return function(ao){var an,al,am;an=this.textarea.selection.caret();if(an[0]===an[1]){this.textarea.selection.selectWholeCurrentLine()}am=this.selection();if(ak.test(am)){if(RegExp.$1===ao.toString()){al=RegExp.$2}else{al="<h"+ao+">"+RegExp.$2+"</h"+ao+">"}return this.selection(al)}else{return this.enclose("<h"+ao+">","</h"+ao+">\n")}}})();R=(function(al){r(ak,al);function ak(am){ak.__super__.constructor.call(this,am);this.textarea=d(this.textarea)}ak.prototype.h1=function(){return v.call(this,1)};ak.prototype.h2=function(){return v.call(this,2)};ak.prototype.h3=function(){return v.call(this,3)};ak.prototype.h4=function(){return v.call(this,4)};ak.prototype.h5=function(){return v.call(this,5)};ak.prototype.h6=function(){return v.call(this,6)};ak.prototype.bold=function(){return this.enclose("<b>","</b>")};ak.prototype.italic=function(){return this.enclose("<i>","</i>")};ak.prototype.underline=function(){return this.enclose("<u>","</u>")};ak.prototype.strike=function(){return this.enclose("<s>","</s>")};ak.prototype.superscript=function(){return this.enclose("<sup>","</sup>")};ak.prototype.subscript=function(){return this.enclose("<sub>","</sub>")};ak.prototype.quote=function(){return this.enclose("<q>","</q>")};ak.prototype.blockquote=function(){return this.enclose("\n<blockquote>","</blockquote>\n")};ak.prototype.code=function(){return this.enclose("<code>","</code>")};ak.prototype.pre=function(){return this.enclose("<pre>","</pre>")};ak.prototype.anchorLink=function(){var am,an;an=this.selection();if(!an){an=window.prompt("Please input a link text","Here")}am=window.prompt("Please input a link url","http://");if(!(am!=null)){return}return this.selection("<a href='"+am+"'>"+an+"</a>")};ak.prototype.image=function(){var am,an;an=window.prompt("Please input a image url","http://");am=window.prompt("(Optional) Please input a alt message","Image");if(!(an!=null)){return}return this.selection("<img src='"+an+"' alt='"+am+"'>")};ak.prototype.unorderedList=function(){var an,am;an=this.selection();an=(function(){var ar,ap,aq,ao;aq=an.split("\n");ao=[];for(ar=0,ap=aq.length;ar<ap;ar++){am=aq[ar];ao.push("  <li>"+am+"</li>")}return ao})();an.unshift("<ul>");an.push("</ul>");return this.selection(an.join("\n"))};ak.prototype.orderedList=function(){var an,am;an=this.selection();an=(function(){var ar,ap,aq,ao;aq=an.split("\n");ao=[];for(ar=0,ap=aq.length;ar<ap;ar++){am=aq[ar];ao.push("  <li>"+am+"</li>")}return ao})();an.unshift("<ol>");an.push("</ol>");return this.selection(an.join("\n"))};return ak})(O);y=ah;af=(function(al){r(ak,al);function ak(am){var an;ak.__super__.constructor.call(this,am);an='<p><span class="key">Ctrl+Z</span>'+(Jencil.t("Undo"))+'<p>\n<p><span class="key">Ctrl+Shift+Z</span>'+(Jencil.t("Redo"))+'<p>\n<p><span class="key">Ctrl+B</span>'+(Jencil.t("Make selected text property as <b>Bold</b>"))+'<p>\n<p><span class="key">Ctrl+I</span>'+(Jencil.t("Make selected text property as <i>Italic</i>"))+'<p>\n<p><span class="key">Ctrl+U</span>'+(Jencil.t("Underline selected text like <u>Underline</u>"))+'<p>\n<p><span class="key">Ctrl+F</span>'+(Jencil.t("Toggle fullscreen mode"))+'<p>\n<p><span class="key">Ctrl+Q</span>'+(Jencil.t("Toggle quick view"))+'<p>\n<p><span class="key">Ctrl+H</span>'+(Jencil.t("Toggle help"))+"<p>";this.element.html(an)}return ak})(c);F={mainPanelClass:ai,editorClass:R,viewerClass:y,helperClass:af,defaultVolume:1,defaultVolume2:0.7,toolbarButtons:["Undo","Redo","Separator",["h1","H1"],["h2","H2"],["h3","H3"],["h4","H4"],["h5","H5"],["h6","H6"],"Separator",["bold","Bold","Ctrl+B"],["italic","Italic","Ctrl+I"],["underline","Underline","Ctrl+U"],["strike","Strikeout"],["superscript","Superscript"],["subscript","Subscript"],"Separator",["anchorLink","Anchor link"],["image","Image"],["unorderedList","Unordered list"],["orderedList","Ordered list"],["quote","Quote"],["blockquote","Blockquote"],["code","Code"],["pre","Pre"],"Separator","Fullscreen"],statusbarButtons:["Viewer","Helper"]};V("Jencil.profiles",function(ak){return ak.HtmlProfile=F});v=(function(){var ak,an,ao,al,am;an=new RegExp("^s*(#{1,6}s*).*");ak=function(ap,ar){var aq;aq="#".repeat(ar);return""+aq+" "+ap};al=function(ap){return ap.replace(/^(\s*)#{1,6}\s*/g,"$1")};ao=function(ap,ar){var aq;aq="#".repeat(ar);return ap.replace(/^(\s*)#{1,6}\s*/g,"$1"+aq+" ")};am=function(aq,ax){var aw,ap,au,ar,at,av;av=aq.val();aw=aq.selection.caret();at=aq.selection.text();ap=0;if(an.test(at)){au=RegExp.$1.trim();if(au.length===ax){ar=al(at)}else{ar=ao(at,ax)}}else{ar=ak(at,ax);if(aw[0]>0&&av[aw[0]-1]!=="\n"){ar="\n"+ar}if(aw[1]<av.length&&av[aw[1]]!=="\n"){ar=""+ar+"\n";ap=-1}}aq.selection.text(ar);if(ap!==0){return aq.selection.caretOffset(ap)}};return function(ap){this.selectWholeLineIfNoSelectionFound();return am(this.textarea,ap)}})();E=(function(){var ao,an,ap,al,am,ak;an=/^(\s*)((?:(?:\d+\.)|(?:[\*\+\->])))(\s+)/;ap=/^(\s*)(\d+)(\.\s+)/;ak=/^(\s*)([\*\+\->])(\s+)/;ao=function(aq){var au,av,ar,at;if(an.test(aq)){au=RegExp.$1;av=RegExp.$2;ar=RegExp.$3;at=av.endsWith(".")?1:2}else{if(this._listInfo){return this._listInfo}else{at=0}}return{type:at,leading:au,mark:av,spaces:ar}};am=function(aw,ar){var at,av,au,aq;if(aw.shiftKey){return}av=ao.call(this,ar);if((au=av.type)===3||au===4){return true}if((aq=av.type)===1||aq===2){if(ar.replace(an,"").length===0){this.selection.line(ar.replace(an,"$1"));this._listInfo=null;return true}at=this.selection.lineCaret();return this.selection.caret(at[1])}};al=function(az,aC,aq,aA,aB){var at,av,ay,ax,aw,au,ar;aA=null;av=ao.call(this,aC);if(aB&&!az.shiftKey&&((ax=av.type)===3||ax===4)){at=av.mark+av.spaces;aq=aC.replace(/^([\t\s]*).*$/,"$1");aq=" ".repeat(aq.length-at.length);aA="\n"+aq;if(aA!=null){this.selection.insertAfter(aA,false)}aB=false}if(aB){return}if(az.shiftKey){if((aw=av.type)===1||aw===2){at=av.mark+av.spaces;aA=" ".repeat(at.length);this._listInfo=av;this._listInfo.type+=2}}else{if((au=av.type)===1||au===3){ay=parseInt(av.mark.replace(".",""));aA=""+(ay+1)+"."+av.spaces}else{if((ar=av.type)===2||ar===4){aA=""+av.mark+av.spaces}}}if(aA!=null){return this.selection.insertAfter(aA,false)}};return function(aq){if(!(aq.autoIndent!=null)){aq=e(aq)}aq.autoIndent.pre=function(at,ar){return am.call(aq,at,ar)};aq.autoIndent.post=function(aw,at,ar,av,au){return al.call(aq,aw,at,ar,av,au)};return aq}})();B=(function(al){r(ak,al);function ak(am){ak.__super__.constructor.call(this,am);this.textarea=E(this.textarea)}ak.prototype.selectWholeLineIfNoSelectionFound=function(){var ao,am,an;ao=this.textarea.selection.caret();if(ao[0]===ao[1]){an=this.textarea.selection.lineCaret();am=this.textarea.selection.line();if(/^(\s*[\*\+\-]\s*|^\s*\d+\.\s*|^\s*>\s*)/g.test(am)){an[0]+=RegExp.$1.length}this.textarea.selection.caret(an)}};ak.prototype.h1=function(){return v.call(this,1)};ak.prototype.h2=function(){return v.call(this,2)};ak.prototype.h3=function(){return v.call(this,3)};ak.prototype.h4=function(){return v.call(this,4)};ak.prototype.h5=function(){return v.call(this,5)};ak.prototype.h6=function(){return v.call(this,6)};ak.prototype.bold=function(){return this.enclose("**","**")};ak.prototype.italic=function(){return this.enclose("*","*")};ak.prototype.blockquote=(function(){var am,ao,an;ao=/^(\s*)>\s*([^\n]*)$/m;an=/^(\s*)([^\n]*)$/m;am=function(ar){var aq,at,ap;for(at=0,ap=ar.length;at<ap;at++){aq=ar[at];if(aq.length===0){continue}if(!ao.test(aq)){return false}}return true};return function(){var at,ar,aq,aw,au,av,ap;aq=this.selection().split("\n");if(am(aq)){for(at=aw=0,av=aq.length;0<=av?aw<av:aw>av;at=0<=av?++aw:--aw){ar=aq[at];aq[at]=ar.replace(ao,"$1$2")}}else{for(at=au=0,ap=aq.length;0<=ap?au<ap:au>ap;at=0<=ap?++au:--au){ar=aq[at];aq[at]=ar.replace(an,"$1> $2")}}return this.selection(aq.join("\n"))}})();ak.prototype.code=function(){var ap,an,ao,am;an=this.selection().split("\n");ap=this.textarea.selection.caret();if(an.length>1){ao=(function(){var at,ar,aq;aq=[];for(at=0,ar=an.length;at<ar;at++){am=an[at];aq.push("\t"+am)}return aq})();return this.selection(ao.join("\n"))}else{return this.enclose("`","`")}};ak.prototype.anchorLink=function(){var am,an;an=this.selection();if(!an){an=window.prompt("Please input a link text","Here")}am=window.prompt("Please input a link url","http://");if(!(am!=null)){return}return this.selection("["+an+"]("+am+")")};ak.prototype.image=function(){var am,an;an=window.prompt("Please input a image url","http://");am=window.prompt("(Optional) Please input a alt message","Image");if(!(an!=null)){return}return this.selection("!["+am+"]("+an+")")};ak.prototype.unorderedList=(function(){var am,ao,an;ao=/^(\s*)\*\s*([^\n]*)$/m;an=/^(\s*)([^\n]*)$/m;am=function(ar){var aq,at,ap;for(at=0,ap=ar.length;at<ap;at++){aq=ar[at];if(aq.length===0){continue}if(!ao.test(aq)){return false}}return true};return function(){var at,ar,aq,aw,au,av,ap;aq=this.selection().split("\n");if(am(aq)){for(at=aw=0,av=aq.length;0<=av?aw<av:aw>av;at=0<=av?++aw:--aw){ar=aq[at];aq[at]=ar.replace(ao,"$1$2")}}else{for(at=au=0,ap=aq.length;0<=ap?au<ap:au>ap;at=0<=ap?++au:--au){ar=aq[at];aq[at]=ar.replace(an,"$1* $2")}}return this.selection(aq.join("\n"))}})();ak.prototype.orderedList=(function(){var am,ao,an;ao=/^(\s*)\d+\.\s*([^\n]*)$/m;an=/^(\s*)([^\n]*)$/m;am=function(ar){var aq,at,ap;for(at=0,ap=ar.length;at<ap;at++){aq=ar[at];if(aq.length===0){continue}if(!ao.test(aq)){return false}}return true};return function(){var at,ar,aq,aw,au,av,ap;aq=this.selection().split("\n");if(am(aq)){for(at=aw=0,av=aq.length;0<=av?aw<av:aw>av;at=0<=av?++aw:--aw){ar=aq[at];aq[at]=ar.replace(ao,"$1$2")}}else{for(at=au=0,ap=aq.length;0<=ap?au<ap:au>ap;at=0<=ap?++au:--au){ar=aq[at];aq[at]=ar.replace(an,"$1"+(at+1)+". $2")}}return this.selection(aq.join("\n"))}})();return ak})(O);V("Jencil.types.markdown.editor.MarkdownEditor",function(ak){return ak.MarkdownEditor=B});P=(function(al){r(ak,al);function ak(){return ak.__super__.constructor.apply(this,arguments)}ak.prototype.update=function(ao,an){var am;am=window.markdown.toHTML(ao);return ak.__super__.update.call(this,am,an)};return ak})(ah);G={mainPanelClass:S,editorClass:B,viewerClass:P,defaultVolume:1,toolbarButtons:["Undo","Redo","Separator",["h1","H1"],["h2","H2"],["h3","H3"],["h4","H4"],["h5","H5"],["h6","H6"],"Separator",["bold","Bold","Ctrl+B"],["italic","Italic","Ctrl+I"],"Separator",["anchorLink","Anchor link"],["image","Image"],["unorderedList","Unordered list"],["orderedList","Ordered list"],["blockquote","Blockquote"],["code","Code"],"Separator","Fullscreen"],statusbarButtons:["Viewer"]};V("Jencil.profiles",function(ak){return ak.MarkdownProfile=G})}).call(this);