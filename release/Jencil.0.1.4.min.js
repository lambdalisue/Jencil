/**
 * Jencil 0.1.4
 *
 * Author:  lambdalisue
 * URL:     http://hashnote.net/
 * License: MIT License
 * 
 * Copyright (C) 2012 lambdalisue, hashnote.net allright reserved.
 *
 * This application include following Library inside
 * 
 * Tabby jQuery plugin version 0.12
 * Ted Devito - http://teddevito.com/demos/textarea.html
 * Copyright (c) 2009 Ted Devito
 *
 * shortcut.js
 * http://www.openjs.com/scripts/events/keyboard_shortcuts/
 * Version : 2.01.B
 * By Binny V A
 * License : BSD
 */
shortcut={all_shortcuts:{},add:function(b,h,d){var g={type:"keydown",propagate:false,disable_in_input:false,target:document,keycode:false};if(!d){d=g}else{for(var a in g){if(typeof d[a]=="undefined"){d[a]=g[a]}}}var f=d.target;if(typeof d.target=="string"){f=document.getElementById(d.target)}var c=this;b=b.toLowerCase();var e=function(o){o=o||window.event;if(d.disable_in_input){var l;if(o.target){l=o.target}else{if(o.srcElement){l=o.srcElement}}if(l.nodeType==3){l=l.parentNode}if(l.tagName=="INPUT"||l.tagName=="TEXTAREA"){return}}if(o.keyCode){code=o.keyCode}else{if(o.which){code=o.which}}var n=String.fromCharCode(code).toLowerCase();if(code==188){n=","}if(code==190){n="."}var s=b.split("+");var r=0;var p={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};var m={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var q={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(o.ctrlKey){q.ctrl.pressed=true}if(o.shiftKey){q.shift.pressed=true}if(o.altKey){q.alt.pressed=true}if(o.metaKey){q.meta.pressed=true}for(var j=0;k=s[j],j<s.length;j++){if(k=="ctrl"||k=="control"){r++;q.ctrl.wanted=true}else{if(k=="shift"){r++;q.shift.wanted=true}else{if(k=="alt"){r++;q.alt.wanted=true}else{if(k=="meta"){r++;q.meta.wanted=true}else{if(k.length>1){if(m[k]==code){r++}}else{if(d.keycode){if(d.keycode==code){r++}}else{if(n==k){r++}else{if(p[n]&&o.shiftKey){n=p[n];if(n==k){r++}}}}}}}}}}if(r==s.length&&q.ctrl.pressed==q.ctrl.wanted&&q.shift.pressed==q.shift.wanted&&q.alt.pressed==q.alt.wanted&&q.meta.pressed==q.meta.wanted){h(o);if(!d.propagate){o.cancelBubble=true;o.returnValue=false;if(o.stopPropagation){o.stopPropagation();o.preventDefault()}return false}}};this.all_shortcuts[b]={callback:e,target:f,event:d.type};if(f.addEventListener){f.addEventListener(d.type,e,false)}else{if(f.attachEvent){f.attachEvent("on"+d.type,e)}else{f["on"+d.type]=e}}},remove:function(a){a=a.toLowerCase();var d=this.all_shortcuts[a];delete (this.all_shortcuts[a]);if(!d){return}var b=d.event;var c=d.target;var e=d.callback;if(c.detachEvent){c.detachEvent("on"+b,e)}else{if(c.removeEventListener){c.removeEventListener(b,e,false)}else{c["on"+b]=false}}}};(function(d){d.fn.tabby=function(f){var g=d.extend({},d.fn.tabby.defaults,f);var h=d.fn.tabby.pressed;return this.each(function(){$this=d(this);var i=d.meta?d.extend({},g,$this.data()):g;$this.bind("keydown",function(l){var j=d.fn.tabby.catch_kc(l);if(16==j){h.shft=true}if(17==j){h.ctrl=true;setTimeout("$.fn.tabby.pressed.ctrl = false;",1000)}if(18==j){h.alt=true;setTimeout("$.fn.tabby.pressed.alt = false;",1000)}if(9==j&&!h.ctrl&&!h.alt){l.preventDefault;h.last=j;setTimeout("$.fn.tabby.pressed.last = null;",0);e(d(l.target).get(0),h.shft,i);return false}}).bind("keyup",function(j){if(16==d.fn.tabby.catch_kc(j)){h.shft=false}}).bind("blur",function(j){if(9==h.last){d(j.target).one("focus",function(l){h.last=null}).get(0).focus()}})})};d.fn.tabby.catch_kc=function(f){return f.keyCode?f.keyCode:f.charCode?f.charCode:f.which};d.fn.tabby.pressed={shft:false,ctrl:false,alt:false,last:null};function b(f){if(window.console&&window.console.log){window.console.log("textarea count: "+f.size())}}function e(i,h,g){var f=i.scrollTop;if(i.setSelectionRange){a(i,h,g)}else{if(document.selection){c(i,h,g)}}i.scrollTop=f}d.fn.tabby.defaults={tabString:String.fromCharCode(9)};function a(j,f,v){var u=j.selectionStart;var s=j.selectionEnd;if(u==s){if(f){if(v.tabString==j.value.substring(u-v.tabString.length,u)){j.value=j.value.substring(0,u-v.tabString.length)+j.value.substring(u);j.focus();j.setSelectionRange(u-v.tabString.length,u-v.tabString.length)}else{if(v.tabString==j.value.substring(u,u+v.tabString.length)){j.value=j.value.substring(0,u)+j.value.substring(u+v.tabString.length);j.focus();j.setSelectionRange(u,u)}}}else{j.value=j.value.substring(0,u)+v.tabString+j.value.substring(u);j.focus();j.setSelectionRange(u+v.tabString.length,u+v.tabString.length)}}else{var w=j.value.split("\n");var t=new Array();var m=0;var h=0;var g=false;for(var p in w){h=m+w[p].length;t.push({start:m,end:h,selected:(m<=u&&h>u)||(h>=s&&m<s)||(m>u&&h<s)});m=h+1}var l=0;for(var p in t){if(t[p].selected){var r=t[p].start+l;if(f&&v.tabString==j.value.substring(r,r+v.tabString.length)){j.value=j.value.substring(0,r)+j.value.substring(r+v.tabString.length);l-=v.tabString.length}else{if(!f){j.value=j.value.substring(0,r)+v.tabString+j.value.substring(r);l+=v.tabString.length}}}}j.focus();var q=u+((l>0)?v.tabString.length:(l<0)?-v.tabString.length:0);var n=s+l;j.setSelectionRange(q,n)}}function c(r,x,f){var q=document.selection.createRange();if(r==q.parentElement()){if(""==q.text){if(x){var m=q.getBookmark();q.moveStart("character",-f.tabString.length);if(f.tabString==q.text){q.text=""}else{q.moveToBookmark(m);q.moveEnd("character",f.tabString.length);if(f.tabString==q.text){q.text=""}}q.collapse(true);q.select()}else{q.text=f.tabString;q.collapse(false);q.select()}}else{var l=q.text;var p=l.length;var v=l.split("\r\n");var A=document.body.createTextRange();A.moveToElementText(r);A.setEndPoint("EndToStart",q);var n=A.text;var y=n.split("\r\n");var s=n.length;var z=document.body.createTextRange();z.moveToElementText(r);z.setEndPoint("StartToEnd",q);var w=z.text;var g=document.body.createTextRange();g.moveToElementText(r);g.setEndPoint("StartToEnd",A);var t=g.text;var h=d(r).html();d("#r3").text(s+" + "+p+" + "+w.length+" = "+h.length);if((s+t.length)<h.length){y.push("");s+=2;if(x&&f.tabString==v[0].substring(0,f.tabString.length)){v[0]=v[0].substring(f.tabString.length)}else{if(!x){v[0]=f.tabString+v[0]}}}else{if(x&&f.tabString==y[y.length-1].substring(0,f.tabString.length)){y[y.length-1]=y[y.length-1].substring(f.tabString.length)}else{if(!x){y[y.length-1]=f.tabString+y[y.length-1]}}}for(var u=1;u<v.length;u++){if(x&&f.tabString==v[u].substring(0,f.tabString.length)){v[u]=v[u].substring(f.tabString.length)}else{if(!x){v[u]=f.tabString+v[u]}}}if(1==y.length&&0==s){if(x&&f.tabString==v[0].substring(0,f.tabString.length)){v[0]=v[0].substring(f.tabString.length)}else{if(!x){v[0]=f.tabString+v[0]}}}if((s+p+w.length)<h.length){v.push("");p+=2}A.text=y.join("\r\n");q.text=v.join("\r\n");var j=document.body.createTextRange();j.moveToElementText(r);if(0<s){j.setEndPoint("StartToEnd",A)}else{j.setEndPoint("StartToStart",A)}j.setEndPoint("EndToEnd",q);j.select()}}}})(jQuery);(function(){var ad,U,J,W,c,C,Z,g,f,p,S,w,s,i,aa,H,R,ae,F,y,B,P,G,b,u,A,K,j,a,T,z,Y,L,I,ag,O,t,ah,D,n,N,ac,m,o,x,ab,af,e,d,E,X,q,Q,v,V,l,h,M=[].slice,ai={}.hasOwnProperty,r=function(am,ak){for(var aj in ak){if(ai.call(ak,aj)){am[aj]=ak[aj]}}function al(){this.constructor=am}al.prototype=ak.prototype;am.prototype=new al();am.__super__=ak.prototype;return am};V=function(ao,aj,al){var ar,ap,am,aq,an,ak;if(arguments.length<3){an=[(typeof exports!=="undefined"?exports:window)].concat(M.call(arguments)),ao=an[0],aj=an[1],al=an[2]}ap=ao;ak=aj.split(".");for(am=0,aq=ak.length;am<aq;am++){ar=ak[am];ao=ao[ar]||(ao[ar]={})}return al(ao,ap)};if(typeof window!=="undefined"&&window!==null){window.namespace=V}if(typeof exports!=="undefined"&&exports!==null){exports.namespace=V}l={repeat:function(am,ak){var al,aj;if(ak<1){return""}aj="";al=am.valueOf();while(ak>0){if(ak&1){aj+=al}ak>>=1;al+=al}return aj},startsWith:function(ak,aj){return ak.lastIndexOf(aj,0)===0},endsWith:function(al,ak){var aj;aj=al.length-ak.length;return aj>=0&&al.lastIndexOf(ak,aj)===aj},trimLeft:function(aj){return aj.replace(/^\s+/g,"")},trimRight:function(aj){return aj.replace(/\s+$/g,"")},trim:function(aj){return aj.replace(/^\s+|\s+$/g,"")}};af=function(ak,aj,al){if(!(ak.prototype[aj]!=null)){return ak.prototype[aj]=function(){var am;am=[this].concat(Array.prototype.slice.call(arguments));return al.apply(this,am)}}};af(String,"repeat",l.repeat);af(String,"startsWith",l.startsWith);af(String,"endsWith",l.endsWith);af(String,"trimLeft",l.trimLeft);af(String,"trimRight",l.trimRight);af(String,"trim",l.trim);if(typeof exports!=="undefined"&&exports!==null){exports.strutils=l}A=(function(){function aj(){}aj.prototype.name="Not implemeted error";aj.prototype.message="The function has not implemented yet";return aj})();K=(function(){function aj(){}aj.prototype.createMemento=function(){throw new A};aj.prototype.setMemento=function(ak){throw new A};return aj})();g=(function(){function aj(ak){this._originator=ak;this._undoStack=[];this._redoStack=[]}aj.prototype.originator=function(ak){if(ak!=null){this._originator=ak;return this}return this._originator};aj.prototype.save=function(ak){ak=ak||this.originator().createMemento();this._undoStack.push(ak);this._redoStack=[];return this};aj.prototype.undo=function(){var ak;if(!this.canUndo()){return false}ak=this.originator();this._redoStack.push(ak.createMemento());ak.setMemento(this._undoStack.pop());if(typeof ak.focus==="function"){ak.focus()}return true};aj.prototype.redo=function(){var ak;if(!this.canRedo()){return false}ak=this.originator();this._undoStack.push(ak.createMemento());ak.setMemento(this._redoStack.pop());if(typeof ak.focus==="function"){ak.focus()}return true};aj.prototype.canUndo=function(){return this._undoStack.length>0};aj.prototype.canRedo=function(){return this._redoStack.length>0};return aj})();if(typeof exports!=="undefined"&&exports!==null){exports.NotImplementedError=A;exports.Originator=K;exports.Caretaker=g}T=(function(){function aj(ak,al){this.document=ak;this.element=al;if(this.document instanceof jQuery){this.document=this.document.get(0)}if(this.element instanceof jQuery){this.element=this.element.get(0)}}aj.prototype._getCaret=function(){var an,ao,am,ak,al;if(this.document.selection!=null){ak=this.document.selection.createRange();ao=ak.duplicate();ao.moveToElementText(this.element);ao.setEndPoint("EndToEnd",ak);al=ao.text.length-ak.text.length;am=al+ak.text.length}else{if(this.element.setSelectionRange!=null){al=this.element.selectionStart;am=this.element.selectionEnd}}an=[al,am];return an};aj.prototype._setCaret=function(an,ak){var al,am;am=this.element.scrollTop;if(this.element.setSelectionRange!=null){this.element.setSelectionRange(an,ak)}else{if(this.element.createTextRange){al=this.element.createTextRange();al.collapse(true);al.moveStart("character",an);al.moveEnd("character",ak-an);al.select()}}this.element.focus();this.element.scrollTop=am;return this};aj.prototype.caret=function(al,ak){if((al!=null)&&al instanceof Array){ak=al[1];al=al[0]}if((al!=null)&&!(ak!=null)){ak=al}if((al!=null)&&(ak!=null)){return this._setCaret(al,ak)}return this._getCaret()};aj.prototype.caretOffset=function(al){var ak;ak=this.caret();return this.caret(ak[0]+al)};aj.prototype.replace=function(ao,ap,am){var al,ak,an;an=this.element.scrollTop;ak=this.element.value.substring(0,ap);al=this.element.value.substring(am);this.element.value=ak+ao+al;this.element.scrollTop=an;return this};aj.prototype._getText=function(){var an,ak,al,am;if(this.document.selection!=null){ak=this.document.selection.createRange();return ak.text}else{if(this.element.setSelectionRange){am=this.caret(),al=am[0],an=am[1];return this.element.value.substring(al,an)}}return null};aj.prototype._setText=function(ap,al){var ao,ak,an,am;an=this.element.scrollTop;am=this.caret(),ak=am[0],ao=am[1];this.replace(ap,ak,ao);ao=ak+ap.length;if(!al){ak=ao}this.caret(ak,ao);this.element.focus();this.element.scrollTop=an;return this};aj.prototype.text=function(al,ak){if(al!=null){return this._setText(al,ak)}return this._getText()};aj.prototype.insertBefore=function(aq,al){var ao,ak,an,ap,am;an=this.element.scrollTop;am=this.caret(),ak=am[0],ao=am[1];ap=this.text();this.replace(aq+ap,ak,ao);ao=ak+aq.length;if(!al){ak=ao}this.caret(ak,ao);this.element.focus();this.element.scrollTop=an;return this};aj.prototype.insertAfter=function(aq,al){var ao,ak,an,ap,am;an=this.element.scrollTop;am=this.caret(),ak=am[0],ao=am[1];ap=this.text();this.replace(ap+aq,ak,ao);ak=ao;ao=ao+aq.length;if(!al){ak=ao}this.caret(ak,ao);this.element.focus();this.element.scrollTop=an;return this};aj.prototype.enclose=function(am,ao,al){var ap,at,ak,aq,ar,an;ak=this.element.scrollTop;ar=this.text();if(ar.indexOf(am)===0&&ar.lastIndexOf(ao)===(ar.length-ao.length)){aq=ar.substring(am.length,ar.length-ao.length);this.text(aq,al)}else{an=this.caret(),at=an[0],ap=an[1];this.replace(am+ar+ao,at,ap);ap=at+am.length+ar.length+ao.length;if(!al){at=ap}this.caret(at,ap)}this.element.focus();this.element.scrollTop=ak;return this};aj.prototype.lineCaret=function(an){var am,ak,al;an=an||this.caret()[0];al=this.element.value;ak=al.lastIndexOf("\n",an-1)+1;am=al.indexOf("\n",an);if(am===-1){am=al.length}return[ak,am]};aj.prototype._getLine=function(an){var am,ak,al;al=this.lineCaret(an),ak=al[0],am=al[1];return this.element.value.substring(ak,am)};aj.prototype._setLine=function(ak,am){var ap,al,ao,an;ao=this.element.scrollTop;an=this.lineCaret(),al=an[0],ap=an[1];this.replace(ak,al,ap);ap=al+ak.length;if(!am){al=ap}this.caret(al,ap);this.element.focus();this.element.scrollTop=ao;return this};aj.prototype.line=function(al,ak){if(al!=null){return this._setLine(al,ak)}return this._getLine()};aj.prototype.selectWholeLine=function(an){var am,ak,al;al=this.lineCaret(an),ak=al[0],am=al[1];return this.caret(ak,am)};aj.prototype.selectWholeCurrentLine=function(){return this.selectWholeLine(null)};return aj})();Q=(function(){var aj,ay,an,am,au,av,aw,al,ar,ak,aq,at,ax,ap,ao;aq=function(az){if(az==null){az=false}return this.outerWidth(az)-this.width()};ak=function(az){if(az==null){az=false}return this.outerHeight(az)-this.height()};ax=function(az,aA){var aB;if(az==null){az=false}if(typeof az==="number"){aA=az;az=false}if(aA!=null){aB=this.nonContentWidth(az);return this.width(aA-aB)}return this._outerWidth(az)};at=function(az,aA){var aB;if(az==null){az=false}if(typeof az==="number"){aA=az;az=false}if(aA!=null){aB=this.nonContentHeight(az);return this.height(aA-aB)}return this._outerHeight(az)};ar=function(aA,az){var aB;if(az==null){az=null}aB=this.css(aA);if(aB===""||aB==="none"||aB===null||aB===(void 0)||aB===NaN){return az}aB=parseInt(aB,10);return aB};al=function(){return this.ncss("min-width")};aw=function(){return this.ncss("min-height")};av=function(){return this.ncss("max-width")};au=function(){return this.ncss("max-height")};an=function(az){var aC,aB,aA;if(az==null){az=false}aB=az?this.ncss("margin-left"):0;aC=this.ncss("border-left-width");aA=this.ncss("padding-left");return aB+aC+aA};am=function(az){var aC,aB,aA;if(az==null){az=false}aB=az?this.ncss("margin-top"):0;aC=this.ncss("border-top-width");aA=this.ncss("padding-top");return aB+aC+aA};aj=function(az){var aA;aA=this.offset();if(az!=null){aA.left=az;return this.offset(aA)}return aA.left};ay=function(az){var aA;aA=this.offset();if(az!=null){aA.top=az;return this.offset(aA)}return aA.top};ap=function(az,aB){var aC,aA;if(az==null){az=false}if(typeof az==="number"){aB=az;az=false}aA=Q(this.parent());aC=aA.absoluteX()+aA.contentX(az);if(aB!=null){return this.absoluteX(aB+aC)}return this.absoluteX()-aC};ao=function(az,aB){var aC,aA;if(az==null){az=false}if(typeof az==="number"){aB=az;az=false}aA=Q(this.parent());aC=aA.absoluteY()+aA.contentY(az);if(aB!=null){return this.absoluteY(aB+aC)}return this.absoluteY()-aC};Q=function(az){if(az.__evoluted__===true){return az}az._outerWidth=az.outerWidth;az._outerHeight=az.outerHeight;az.nonContentWidth=aq;az.nonContentHeight=ak;az.outerWidth=ax;az.outerHeight=at;az.nonContentWidth=aq;az.nonContentHeight=ak;az.ncss=ar;az.minWidth=al;az.minHeight=aw;az.maxWidth=av;az.maxHeight=au;az.contentX=an;az.contentY=am;az.absoluteX=aj;az.absoluteY=ay;az.relativeX=ap;az.relativeY=ao;az.__evoluted__=true;return az};return Q})();q=function(ak){var aj;ak.css("position","relative");aj=$("<div>").appendTo(ak).hide().css({position:"absolute",top:"0",left:"0",overflow:"hidden","z-index":99999});aj.on=function(){aj.refresh();aj.show();return this};aj.refresh=function(){aj.width(ak.outerWidth(true));aj.height(ak.outerHeight(true));return this};aj.off=function(){aj.hide();return this};return aj};ab=(function(){var aj,ak;ak=function(){return(new Date()).getTime()};aj={start:0,end:100,duration:1000,callbackEach:null,callbackDone:null,easing:jQuery.easing.swing};return function(al){var ao,am,an;al=jQuery.extend(aj,al);am=ak();ao=al.end-al.start;an=function(){var aq,ap;aq=ak()-am;ap=al.easing(aq/al.duration,aq,0,1,al.duration);ap=ap*ao+al.start;al.callbackEach(ap,aq);if(aq<al.duration){return setTimeout(an,1)}else{al.callbackEach(al.end,al.duration);return typeof al.callbackDone==="function"?al.callbackDone():void 0}};an();return null}})();e=(function(){var aj;aj=function(aq){var an,al,ap,am,ao,ak;if(aq.which!==13){return}am=this.selection.line();an=((ao=this.autoIndent.pre)!=null?ao.call(this,aq,am):void 0)===true;if(an!==true){al=am.replace(/^([\t\s]*).*$/,"$1");ap="\n"+al;this.selection.insertAfter(ap,false)}if((ak=this.autoIndent.post)!=null){ak.call(this,aq,am,al,ap,an)}aq.stopPropagation();aq.stopImmediatePropagation();aq.preventDefault();this.focus();return false};return function(ak,am,al){if(!(ak instanceof jQuery)){ak=$(ak)}if(!(ak.selection!=null)){ak.selection=new T(document,ak.get(0))}ak.autoIndent=function(an){return aj.call(ak,an)};ak.autoIndent.enable=function(){ak.on("keydown",ak.autoIndent);return ak};ak.autoIndent.disable=function(){ak.off("keydown",ak.autoIndent);return ak};if(am!=null){ak.autoIndent.pre=function(ao,an){return am.call(ak,ao,an)}}if(al!=null){ak.autoIndent.post=function(aq,ao,an,ap){return al.call(ak,aq,ao,an,ap)}}return ak.autoIndent.enable()}})();if(window.i18n!=null){h=function(aj){return i18n.t(aj,{defaultValue:aj})}}else{h=function(aj){return aj}}p={mainPanelClass:null,editorClass:null,viewerClass:null,helperClass:null,toolbarButtons:[],statusbarButtons:[],defaultVolume:null,defaultVolume2:null};this.Jencil=(function(){function aj(ak,al){var am,an=this;am={profile:"Html",profiles:{Html:F,Markdown:G},resizable:true,enableTabIndent:true,enableAutoIndent:true,tabString:"\t",defaultVolume:null,defaultVolume2:null,width:640,height:620,editorTemplatePath:null,viewerTemplatePath:null,helperTemplatePath:null};this.options=jQuery.extend(am,al);this.element=ak.hide();this.caretaker=new g();this.caretaker.originator=function(){return an.editor()};this.wrapper=new x(this,this.options.width,this.options.height);this.fullscreen=new w(this);this.element.after(this.wrapper.element).after(this.fullscreen.element);this.wrapper.init();this.wrapper.adjust();this.caretaker.save()}aj.prototype.editor=function(){return this.wrapper.workspace.mainPanel.editorPanel||null};aj.prototype.viewer=function(){return this.wrapper.workspace.mainPanel.viewerPanel||null};aj.prototype.helper=function(){return this.wrapper.workspace.mainPanel.helperPanel||null};return aj})();$.fn.jencil=function(aj){return new Jencil($(this),aj)};V("Jencil.profiles",function(aj){return aj.DefaultProfile=p});V("Jencil.utils.namespace",function(aj){return aj.namespace=V});V("Jencil.utils.strutils",function(aj){return aj.strutils=l});V("Jencil.utils.evolution",function(aj){return aj.evolute=Q});V("Jencil.utils.selection",function(aj){return aj.Selection=T});V("Jencil.utils.animation",function(aj){return aj.animate=ab});V("Jencil.utils.autoindent",function(aj){return aj.autoIndentable=e});V("Jencil.utils.curtain",function(aj){return aj.curtainFactory=q});V("Jencil.utils.i18n",function(aj){return aj.translate=h});V("Jencil.utils.undo",function(aj){aj.NotImplementedError=A;aj.Originator=K;return aj.Caretaker=g});V("Jencil",function(aj){return aj.t=h});m=(function(){function aj(al,ak,am){this.core=al;if(ak==null){ak="<div>"}if(ak instanceof jQuery){this.element=ak}else{this.element=$(ak,am)}this.element=Q(this.element)}aj.prototype.init=function(){return this};aj.prototype.adjust=function(){return this};return aj})();j=(function(aj){r(ak,aj);function ak(am,al,an){if(al==null){al="<div>"}ak.__super__.constructor.call(this,am,al,an);this.element.addClass("panel")}return ak})(m);u=(function(ak){r(aj,ak);function aj(an,ao,al,aq){var ap,am,ar=this;this.fst=ao;this.snd=al;this.splitter=aq;aj.__super__.constructor.call(this,an);this.element.addClass("multiple");this.element.append(this.fst.element);this.element.append(this.splitter.element);this.element.append(this.snd.element);am=function(at){if(!this.element.is(":visible")){return this.toggle(at,null)}};ap=function(at){if(this.element.is(":visible")){return this.toggle(null,at)}};this.fst.toggle=function(au,at){return ar._togglePanel(0,au,at)};this.fst.show=am;this.fst.hide=ap;this.snd.toggle=function(au,at){return ar._togglePanel(1,au,at)};this.snd.show=am;this.snd.hide=ap;this.splitter.element.dblclick(function(){return ar.snd.toggle()})}aj.prototype.init=function(){this.splitter.init();this.fst.init();return this.snd.init()};aj.prototype._togglePanel=function(at,aq,am){var ao,al,an,ap,ar=this;if(aj._animating){return}an=this.splitter.volume();ao=null;if((0<an&&an<1)){al=at;this.splitter._previousVolume=an;ap=am}else{al=this.splitter._previousVolume||this.splitter.defaultVolume;if(al===at){al=0.5}ap=aq}aj._animating=true;ao=function(){aj._animating=false;return typeof ap==="function"?ap():void 0};return ab({start:an,end:al,duration:500,callbackEach:function(av,au){return ar.splitter.volume(av)},callbackDone:ao})};return aj})(j);n=(function(ak){r(aj,ak);function aj(am,an,al,ao){var ap;if(ao==null){ao=0.5}ap=new N(am,an,al,ao);aj.__super__.constructor.call(this,am,an,al,ap);this.element.addClass("vertical")}aj.prototype.adjust=function(){this.fst.element.outerHeight(true,this.element.height());this.snd.element.outerHeight(true,this.element.height());this.splitter.element.outerHeight(true,this.element.height());this.splitter.adjust();return this};return aj})(u);aa=(function(ak){r(aj,ak);function aj(am,an,al,ao){var ap;if(ao==null){ao=0.5}ap=new H(am,an,al,ao);aj.__super__.constructor.call(this,am,an,al,ap);this.element.addClass("horizontal")}aj.prototype.adjust=function(){this.fst.element.outerWidth(true,this.element.width());this.snd.element.outerWidth(true,this.element.width());this.splitter.element.outerWidth(true,this.element.width());this.splitter.adjust();return this};return aj})(u);V("Jencil.widgets",function(aj){aj.Widget=m;aj.Panel=j;aj.MultiplePanel=u;aj.VerticalPanel=n;return aj.HorizontalPanel=aa});Y=(function(aj){r(ak,aj);function ak(am,an,al,ao){var ap,aq,ar=this;this.fst=an;this.snd=al;this.defaultVolume=ao!=null?ao:0.5;ak.__super__.constructor.call(this,am);this.element.addClass("splitter");this._volume=this.defaultVolume;ap=function(av){var au,at;ar.mousemove(av);if((au=ar.fst.curtain)!=null){au.refresh()}if((at=ar.snd.curtain)!=null){at.refresh()}av.stopPropagation();av.stopImmediatePropagation();return av.preventDefault()};aq=function(av){var aw,au,at;aw=$(window);aw.unbind("mousemove",ap);aw.unbind("mouseup",aq);if((au=ar.fst.curtain)!=null){au.off()}if((at=ar.snd.curtain)!=null){at.off()}av.stopPropagation();av.stopImmediatePropagation();return av.preventDefault()};this.element.mousedown(function(av){var aw,au,at;aw=$(window);aw.mousemove(ap);aw.mouseup(aq);if((au=ar.fst.curtain)!=null){au.on()}if((at=ar.snd.curtain)!=null){at.on()}av.stopPropagation();av.stopImmediatePropagation();return av.preventDefault()})}ak.prototype.init=function(){this.container=Q(this.element.parent());return this};ak.prototype.volume=function(am,al){if(al==null){al=false}if(am!=null){this._volume=am;if(!al){this.adjust()}return this}return this._volume};ak.prototype.value=function(ao,an){var al,am;if(an==null){an=false}al=this.valueWidth();if(ao!=null){am=ao/al;return this.volume(am,an)}return this.volume()*al};ak.prototype.regulateValue=function(am){var an,al;al=this.minValue();an=this.maxValue();if(am<al){am=al}if(am>an){am=an}return am};return ak})(m);N=(function(aj){r(ak,aj);function ak(an,ao,am,ap){var aq,al;ak.__super__.constructor.call(this,an,ao,am,ap);this.element.addClass("vertical");this.fst.element.addClass("left");this.snd.element.addClass("right");this.fst.element.css({"float":"left"});this.snd.element.css({"float":"left"});if((aq=this.fst.curtain)!=null){aq.css("pointer","col-resize")}if((al=this.snd.curtain)!=null){al.css("pointer","col-resize")}}ak.prototype.mousemove=function(am){var an,al;an=this.container.absoluteX()+this.container.contentX(true);al=am.pageX-an;al=this.regulateValue(al);return this.value(al)};ak.prototype.valueWidth=function(){return this.container.width()};ak.prototype.minValue=function(){var am,al;am=this.fst.element.minWidth()+this.fst.element.nonContentWidth();al=this.snd.element.maxWidth();if(al!=null){al=this.valueWidth()-(al+this.snd.element.nonContentWidth())}if((am!=null)&&(al!=null)){return Math.max(am,al)}return am||al||0};ak.prototype.maxValue=function(){var an,am,al;al=this.valueWidth();an=this.fst.element.maxWidth();if(an!=null){an=an+this.fst.element.nonContentWidth()}am=this.snd.element.minWidth()+this.snd.element.nonContentWidth();if(am!=null){am=al-am}if((an!=null)&&(am!=null)){return Math.min(an,am)}return an||am||al};ak.prototype.adjust=function(){var ao,an,am,al;am=this.value();al=this.valueWidth();ao=am-this.fst.element.nonContentWidth(true);an=(al-am)-this.snd.element.nonContentWidth(true);if(ao<=0){if(this.fst.element.is(":visible")){this.fst.element.hide()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.snd.element.outerWidth(true,al);this._value=am=0}else{if(an<=0){if(!this.fst.element.is(":visible")){this.fst.element.show()}if(this.snd.element.is(":visible")){this.snd.element.hide()}this.fst.element.outerWidth(true,al);this._value=am=al}else{if(!this.fst.element.is(":visible")){this.fst.element.show()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.fst.element.width(ao);this.snd.element.width(an)}}this.fst.adjust();this.snd.adjust();this.element.relativeX(am-this.element.outerWidth()/2);return this};return ak})(Y);H=(function(ak){r(aj,ak);function aj(an,ao,am,ap){var aq,al;aj.__super__.constructor.call(this,an,ao,am,ap);this.element.addClass("horizontal");this.fst.element.addClass("top");this.snd.element.addClass("bottom");if((aq=this.fst.curtain)!=null){aq.css("pointer","raw-resize")}if((al=this.snd.curtain)!=null){al.css("pointer","raw-resize")}}aj.prototype.mousemove=function(am){var an,al;an=this.container.absoluteY()+this.container.contentY(true);al=am.pageY-an;al=this.regulateValue(al);return this.value(al)};aj.prototype.valueWidth=function(){return this.container.height()};aj.prototype.minValue=function(){var am,al;am=this.fst.element.minHeight()+this.fst.element.nonContentHeight();al=this.snd.element.maxHeight();if(al!=null){al=this.valueWidth()-(al+this.snd.element.nonContentHeight())}if((am!=null)&&(al!=null)){return Math.max(am,al)}return am||al||0};aj.prototype.maxValue=function(){var an,am,al;al=this.valueWidth();an=this.fst.element.maxHeight();if(an!=null){an=an+this.fst.element.nonContentHeight()}am=this.snd.element.minHeight()+this.snd.element.nonContentHeight();if(am!=null){am=al-am}if((an!=null)&&(am!=null)){return Math.min(an,am)}return an||am||al};aj.prototype.adjust=function(){var ao,an,am,al;am=this.value();al=this.valueWidth();ao=am-this.fst.element.nonContentHeight(true);an=(al-am)-this.snd.element.nonContentHeight(true);if(ao<=0){if(this.fst.element.is(":visible")){this.fst.element.hide()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.snd.element.outerHeight(true,al);this._value=am=0}else{if(an<=0){if(!this.fst.element.is(":visible")){this.fst.element.show()}if(this.snd.element.is(":visible")){this.snd.element.hide()}this.fst.element.outerHeight(true,al);this._value=am=al}else{if(!this.fst.element.is(":visible")){this.fst.element.show()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.fst.element.height(ao);this.snd.element.height(an)}}this.fst.adjust();this.snd.adjust();this.element.relativeY(am-this.element.outerHeight()/2);return this};return aj})(Y);V("Jencil.splitters",function(aj){aj.Splitter=Y;aj.VerticalSplitter=N;return aj.HorizontalSplitter=H});W=(function(ak){r(aj,ak);function aj(am,al,an){if(al==null){al="<div>"}aj.__super__.constructor.call(this,am,al,an);this.element.addClass("editor");this._changeCallbacks=[]}aj.prototype.val=function(al){throw new Error("NotImplementedError")};aj.prototype.change=function(ao){var an,al,am;if(ao!=null){this._changeCallbacks.push(ao);return this}am=this._changeCallbacks;for(an=0,al=am.length;an<al;an++){ao=am[an];ao.call(this,this.val())}return this};aj.prototype.h1=null;aj.prototype.h2=null;aj.prototype.h3=null;aj.prototype.h4=null;aj.prototype.h5=null;aj.prototype.h6=null;aj.prototype.bold=null;aj.prototype.italic=null;aj.prototype.underline=null;aj.prototype.strike=null;aj.prototype.superscript=null;aj.prototype.subscript=null;aj.prototype.anchor=null;aj.prototype.image=null;aj.prototype.unorderedList=null;aj.prototype.orderedList=null;return aj})(j);O=(function(aj){r(ak,aj);function ak(am,al,an){var ao=this;if(al==null){al="<div>"}ak.__super__.constructor.call(this,am,al,an);this.textarea=$("<textarea>").appendTo(this.element).css({margin:"0",padding:"0",border:"none",outline:"none",resize:"none"});this.textarea=Q(this.textarea);this.textarea.on("keydown",function(ap){if(ap.which!==13){return}return ao.core.caretaker.save()});if(($.fn.tabby!=null)&&this.core.options.enableTabIndent){this.textarea.tabby({tabString:this.core.options.tabString})}this.textarea=e(this.textarea);if(!this.core.options.enableAutoIndent){this.textarea.autoIndent.disable()}this.textarea.on("keypress keyup click blur",function(){return ao.change()})}ak.prototype.val=function(al){if(al!=null){this.textarea.val(al);this.change();return this}return this.textarea.val()};ak.prototype.focus=function(){this.textarea.focus();return this};ak.prototype.createMemento=function(){return this.val()};ak.prototype.setMemento=function(al){return this.val(al)};ak.prototype.adjust=function(){this.textarea.outerWidth(this.element.width());this.textarea.outerHeight(this.element.height());return this};ak.prototype.selectWholeLineIfNoSelectionFound=function(){var al;al=this.textarea.selection.caret();if(al[0]===al[1]){this.textarea.selection.selectWholeCurrentLine()}};ak.prototype.selection=function(am,al){if(al==null){al=true}if(am!=null){this.textarea.selection.text(am,al);this.core.caretaker.save();return this.change()}return this.textarea.selection.text()};ak.prototype.enclose=function(al,am,an){if(an==null){an=true}this.selectWholeLineIfNoSelectionFound();this.textarea.selection.enclose(al,am,an);this.core.caretaker.save();return this.change()};ak.prototype.insertBefore=function(am,al){if(al==null){al=true}this.selectWholeLineIfNoSelectionFound();this.textarea.selection.insertBefore(am,al);this.core.caretaker.save();return this.change()};ak.prototype.insertAfter=function(am,al){if(al==null){al=true}this.selectWholeLineIfNoSelectionFound();this.textarea.selection.insertAfter(am,al);this.core.caretaker.save();return this.change()};return ak})(W);V("Jencil.editors",function(aj){aj.BaseEditor=W;return aj.TextEditor=O});C=(function(ak){r(aj,ak);function aj(am,al,an){if(al==null){al="<div>"}aj.__super__.constructor.call(this,am,al,an);this.element.addClass("viewer")}aj.prototype.update=function(am,al){throw new Error("NotImplementedError")};return aj})(j);ag=(function(ak){r(aj,ak);function aj(al){aj.__super__.constructor.call(this,al);this.templatePath=this.core.options.viewerTemplatePath;this.element.css({position:"relative"});this.curtain=q(this.element);this.iframe=$("<iframe>").appendTo(this.element).css({margin:"0",padding:"0",border:"none",outline:"none",resize:"none",width:"100%",height:"100%",overflow:"visible"});this.iframe.attr("frameborder",0);this.iframe=Q(this.iframe);this.iframe.init=function(){var am;am=this.get(0);if(am.contentDocument!=null){this.document=am.contentDocument}else{this.document=am.contentWindow.document}return this.document.write("<body></body>")};this.iframe.write=function(am){var ao;if(this.document!=null){try{ao=this.document.documentElement.scrollTop}catch(an){ao=0}this.document.open();this.document.write(am);this.document.close();$("a",$(this.document)).attr("target","_blank");this.document.documentElement.scrollTop=ao;this.width(this.document.scrollLeft);this.height(this.document.scrollTop);return true}return false};this.iframe.loadTemplate=function(am,an){var ao=this;return $.ajax({url:am,success:function(ap){ao._template=ap;return ao.write(an)}})}}aj.prototype.init=function(){return this.iframe.init()};aj.prototype.update=function(am,al){if(this.iframe._template!=null){am=this.iframe._template.replace("{{content}}",am)}else{if(this.templatePath!=null){this.iframe.loadTemplate(this.templatePath,am)}}return this.iframe.write(am)};aj.prototype.adjust=function(){this.iframe.outerWidth(this.element.width());this.iframe.outerHeight(this.element.height());return this};return aj})(C);U=(function(ak){r(aj,ak);function aj(al,am){this.config=am;aj.__super__.constructor.call(this,al);this.config=jQuery.extend({type:"GET",dataType:"text",data:function(an){return encodeURIComponent(an)},url:null},this.config)}aj.prototype.update=function(am,al){var an=this;if(this._valueCache!==am||al){this._valueCache=am;return $.ajax({type:this.config.type,dataType:this.config.dataType,data:JSON.stringify(this.config.data(am)),url:this.config.url,success:function(ao){if(an.iframe._template!=null){ao=an.iframe._template.replace("{{content}}",ao)}else{if(an.templatePath!=null){an.iframe.loadTemplate(an.templatePath,ao)}}return an.iframe.write(ao)}})}};return aj})(ag);V("Jencil.viewers",function(aj){aj.BaseViewer=C;aj.TemplateViewer=ag;return aj.AjaxViewer=U});c=(function(ak){r(aj,ak);function aj(am,al,an){if(al==null){al="<div>"}aj.__super__.constructor.call(this,am,al,an);this.element.addClass("helper")}return aj})(j);I=(function(ak){r(aj,ak);function aj(al){aj.__super__.constructor.call(this,al);this.templatePath=this.core.options.helperTemplatePath;this.element.css({position:"relative"});this.curtain=q(this.element);this.iframe=$("<iframe>").appendTo(this.element).css({margin:"0",padding:"0",border:"none",outline:"none",resize:"none",width:"100%",height:"100%",overflow:"visible"});this.iframe.attr("frameborder",0);this.iframe=Q(this.iframe);this.iframe.init=function(){var am;am=this.get(0);if(am.contentDocument!=null){this.document=am.contentDocument}else{this.document=am.contentWindow.document}return this.document.write("<body></body>")};this.iframe.write=function(am){var ao;if(this.document!=null){try{ao=this.document.documentElement.scrollTop}catch(an){ao=0}this.document.open();this.document.write(am);this.document.close();this.document.documentElement.scrollTop=ao;this.width(this.document.scrollLeft);this.height(this.document.scrollTop);return true}return false};this.iframe.loadTemplate=function(am){var an=this;return $.ajax({url:am,success:function(ao){return an.write(ao)}})}}aj.prototype.init=function(){this.iframe.init();if(this.templatePath!=null){return this.iframe.loadTemplate(this.templatePath)}};aj.prototype.adjust=function(){this.iframe.outerWidth(this.element.width());this.iframe.outerHeight(this.element.height());return this};return aj})(c);V("Jencil.helpers",function(aj){aj.BaseHelper=c;return aj.TemplateHelper=I});z=(function(aj){r(ak,aj);function ak(al){ak.__super__.constructor.call(this,al,"<span>");this.element.addClass("separator")}return ak})(m);Z=(function(ak){r(aj,ak);function aj(al,am,ao,an){this.name=am;this.text=ao;this.title=an;aj.__super__.constructor.call(this,al,"<a>");this.text=Jencil.t(this.text||this.name);this.title=Jencil.t(this.title||this.text);this.element.addClass("button").addClass(am);this.element.append($("<span>"+this.text+"</span>"));this.element.attr("title",this.title)}aj.prototype.enable=function(){return this.element.removeClass("disable")};aj.prototype.disable=function(){return this.element.addClass("disable")};aj.prototype.validate=function(){return this};return aj})(m);ad=(function(ak){r(aj,ak);function aj(am,an,ap,ao,ar,al){var aq=this;this.shortcut=al;aj.__super__.constructor.call(this,am,an,ap,ao);this.callback=function(){if(!aq.element.hasClass("disable")){return ar()}};this.callback.raw=ar;this.element.click(function(){return aq.callback()});if((this.shortcut!=null)&&(window.shortcut!=null)){window.shortcut.add(this.shortcut,function(at){return aq.callback()});this.element.attr("title",""+this.title+" ("+this.shortcut+")")}}return aj})(Z);f=(function(aj){r(ak,aj);function ak(am,an,aq,ap,ao,al){var ar;this.command=ao;ar=function(){var at;at=am.editor();return at[ao].call(at)};ak.__super__.constructor.call(this,am,an,aq,ap,ar,al)}ak.prototype.init=function(){return this.validate()};ak.prototype.validate=function(){var al;al=this.core.editor();if(!(al[this.command]!=null)){this.disable()}return this};ak.factory=function(am,ao){var ar,an,al,aq,ap;an=aq=ap=ar=al=null;switch(ao.length){case 5:an=ao[0];aq=ao[1];ap=ao[2];ar=ao[3];al=ao[4];break;case 4:an=ao[0];aq=ap=ao[1];ar=ao[2];al=ao[3];break;case 3:an=ar=ao[0];aq=ap=ao[1];al=ao[2];break;case 2:an=ar=ao[0];aq=ap=ao[1];al=null;break;case 1:an=ar=aq=ap=ao[0];al=null}return new ak(am,an,aq,ap,ar,al)};return ak})(ad);D=(function(aj){r(ak,aj);function ak(al){var an,am=this;an=function(ao){return am.core.caretaker.undo()};ak.__super__.constructor.call(this,al,"undo","Undo","Undo",an,"Ctrl+Z")}ak.prototype.init=function(){var al,am=this;al=function(){if(!am.core.caretaker.canUndo()){am.disable()}else{am.enable()}return setTimeout(al,100)};return al()};return ak})(ad);a=(function(ak){r(aj,ak);function aj(al){var an,am=this;an=function(ao){return am.core.caretaker.redo()};aj.__super__.constructor.call(this,al,"redo","Redo","Redo",an,"Ctrl+Shift+Z")}aj.prototype.init=function(){var al,am=this;al=function(){if(!am.core.caretaker.canRedo()){am.disable()}else{am.enable()}return setTimeout(al,100)};return al()};return aj})(ad);s=(function(ak){r(aj,ak);function aj(al){var an,am=this;an=function(ao){return am.core.fullscreen.toggle()};aj.__super__.constructor.call(this,al,"fullscreen","Toggle fullscreen","Fullscreen",an,"Ctrl+F")}aj.prototype.init=function(){var al,am=this;al=function(){if(am.core.fullscreen.element.is(":visible")){am.element.addClass("hide")}else{am.element.removeClass("hide")}return setTimeout(al,100)};return al()};return aj})(ad);ac=(function(ak){r(aj,ak);function aj(al){var an,am=this;an=function(ao){return am.core.viewer().toggle()};aj.__super__.constructor.call(this,al,"viewer","Quick view","Quick view",an,"Ctrl+Q")}aj.prototype.validate=function(){if(!this.core.viewer()){this.disable();return false}return true};aj.prototype.init=function(){var al,am=this;if(!this.validate()){return}al=function(){if(am.core.viewer().element.is(":visible")){am.element.addClass("hide")}else{am.element.removeClass("hide")}return setTimeout(al,100)};return al()};return aj})(ad);i=(function(ak){r(aj,ak);function aj(al){var an,am=this;an=function(ao){return am.core.helper().toggle()};aj.__super__.constructor.call(this,al,"helper","Help","Help",an,"Ctrl+H")}aj.prototype.validate=function(){if(!this.core.helper()){this.disable();return false}return true};aj.prototype.init=function(){var al,am=this;if(!this.validate()){return}al=function(){if(am.core.helper().element.is(":visible")){am.element.addClass("hide")}else{am.element.removeClass("hide")}return setTimeout(al,100)};return al()};return aj})(ad);X=function(aj,ak){if(ak instanceof Array){return f.factory(aj,ak)}if(typeof ak==="string"){switch(ak){case"Separator":return new z(aj);case"Undo":return new D(aj);case"Redo":return new a(aj);case"Fullscreen":return new s(aj);case"Viewer":return new ac(aj);case"Helper":return new i(aj);default:throw new Exception(""+ak+" is not known Button type")}}return new ak(aj)};V("Jencil.buttons",function(aj){aj.Separator=z;aj.Button=Z;aj.ActionButton=ad;aj.CommandButton=f;aj.UndoButton=D;aj.RedoButton=a;aj.FullscreenButton=s;aj.ViewerButton=ac;return aj.HelperButton=i});x=(function(aj){r(ak,aj);function ak(am,an,al){ak.__super__.constructor.call(this,am);this.element.addClass("jencil wrapper");this.element.width(an);this.element.height(al);this.workspace=new o(this.core);this.workspace.element.appendTo(this.element)}ak.prototype.init=function(){var al=this;if((this.element.resizable!=null)&&this.core.options.resizable===true){this.element.resizable({start:function(){var ao,am,ar,aq,ap,an;if((ao=al.core.editor())!=null){if((am=ao.curtain)!=null){am.on()}}if((ar=al.core.viewer())!=null){if((aq=ar.curtain)!=null){aq.on()}}return(ap=al.core.helper())!=null?(an=ap.curtain)!=null?an.on():void 0:void 0},resize:function(){var ao,am,ar,aq,ap,an;if((ao=al.core.editor())!=null){if((am=ao.curtain)!=null){am.refresh()}}if((ar=al.core.viewer())!=null){if((aq=ar.curtain)!=null){aq.refresh()}}if((ap=al.core.helper())!=null){if((an=ap.curtain)!=null){an.refresh()}}return al.adjust()},stop:function(){var ao,am,ar,aq,ap,an;if((ao=al.core.editor())!=null){if((am=ao.curtain)!=null){am.off()}}if((ar=al.core.viewer())!=null){if((aq=ar.curtain)!=null){aq.off()}}if((ap=al.core.helper())!=null){if((an=ap.curtain)!=null){an.off()}}return al.adjust()}})}return this.workspace.init()};ak.prototype.adjust=function(){this.workspace.element.outerWidth(true,this.element.width());this.workspace.element.outerHeight(true,this.element.height());this.workspace.adjust();return this};return ak})(j);o=(function(ak){r(aj,ak);function aj(al){aj.__super__.constructor.call(this,al);this.element.addClass("workspace");this.profile(al.options.profile)}aj.prototype.profile=function(an){var au,ar,ap,aw,al,at,aq,ao,am,av=this;if(an!=null){if(typeof an==="string"){an=this.core.options.profiles[an]}an=jQuery.extend(p,an);an.defaultVolume=this.core.options.defaultVolume||an.defaultVolume;an.defaultVolume2=this.core.options.defaultVolume2||an.defaultVolume2;this.element.empty();this.mainPanel=new an.mainPanelClass(this.core,an);if((at=this.mainPanel.editorPanel)!=null){at.val(this.core.element.val())}if((aq=this.mainPanel.editorPanel)!=null){aq.change(function(ax){return av.core.element.val(ax)})}this.toolbar=new t(this.core);ao=an.toolbarButtons;for(ar=0,aw=ao.length;ar<aw;ar++){au=ao[ar];au=X(this.core,au);this.toolbar.addButton(au)}this.statusbar=new L(this.core);am=an.statusbarButtons;for(ap=0,al=am.length;ap<al;ap++){au=am[ap];au=X(this.core,au);this.statusbar.addButton(au)}this.element.append(this.toolbar.element);this.element.append(this.mainPanel.element);this.element.append(this.statusbar.element);this._profile=an;return this}return this._profile};aj.prototype.init=function(){this.toolbar.init();this.statusbar.init();return this.mainPanel.init()};aj.prototype.adjust=function(){var am,al;this.toolbar.element.outerWidth(true,this.element.width());this.statusbar.element.outerWidth(true,this.element.width());this.mainPanel.element.outerWidth(true,this.element.width());this.mainPanel.element.outerHeight(true,this.element.height());this.mainPanel.adjust();am=this.toolbar.element.outerHeight(true);al=this.statusbar.element.outerHeight(true);this.mainPanel.element.outerHeight(true,this.element.height()-(am+al));this.toolbar.adjust();this.statusbar.adjust();this.mainPanel.adjust();return this};aj.prototype.update=function(al){if(this.mainPanel.editorPanel&&this.mainPanel.viewerPanel){return this.mainPanel.viewerPanel.update(this.mainPanel.editorPanel.val(),al)}};return aj})(j);J=(function(ak){r(aj,ak);function aj(al){aj.__super__.constructor.call(this,al);this._buttons=[]}aj.prototype.init=function(){var am,ao,al,an;an=this._buttons;for(ao=0,al=an.length;ao<al;ao++){am=an[ao];am.init()}return this};aj.prototype.addButton=function(al){this._buttons.push(al);return this.element.append(al.element)};return aj})(j);t=(function(ak){r(aj,ak);function aj(al){aj.__super__.constructor.call(this,al);this.element.addClass("toolbar")}return aj})(J);L=(function(ak){r(aj,ak);function aj(al){aj.__super__.constructor.call(this,al);this.element.addClass("statusbar")}return aj})(J);b=(function(){function aj(ak,am){var al;al=new am.editorClass(ak);al.element.addClass("mainPanel");return al}return aj})();S=(function(ak){r(aj,ak);function aj(al,am){var an=this;this.editorPanel=new am.editorClass(al);this.viewerPanel=new am.viewerClass(al);aj.__super__.constructor.call(this,al,this.editorPanel,this.viewerPanel,am.defaultVolume);this.element.addClass("mainPanel");this.editorPanel.change(function(ao){return an.viewerPanel.update(ao)})}return aj})(n);ah=(function(ak){r(aj,ak);function aj(al,am){var an=this;this.editorPanel=new am.editorClass(al);this.viewerPanel=new am.viewerClass(al);this.helperPanel=new am.helperClass(al);this.verticalPanel=new n(al,this.editorPanel,this.viewerPanel,am.defaultVolume);aj.__super__.constructor.call(this,al,this.verticalPanel,this.helperPanel,am.defaultVolume2);this.element.addClass("mainPanel");this.editorPanel.change(function(ao){return an.viewerPanel.update(ao)})}return aj})(aa);V("Jencil.mainpanels",function(aj){aj.MonomainPanel=b;aj.DimainPanel=S;return aj.TrimainPanel=ah});w=(function(ak){r(aj,ak);function aj(al){var am=this;aj.__super__.constructor.call(this,al);this.element.addClass("fullscreen");this.element.css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%","z-index":100});this.curtain=$("<div>").addClass("curtain");this.curtain.css({position:"absolute",top:"0",left:"0",width:"100%",height:"100%",background:"black",opacity:"0.6",cursor:"pointer"});this.cell=$("<div>").css({position:"absolute",top:"5%",left:"5%",width:"90%",height:"90%"});if($.browser.msie&&$.browser.version<7){this.element.css("position","absolute");$(window).scroll(function(){return am.element.css("top",$(document).scrollTop())})}this.curtain.click(function(){return am.off()});this.element.append(this.curtain);this.element.append(this.cell);this.element.hide();this.resize=function(){return am.core.wrapper.adjust()}}aj.prototype.on=function(){var al,am=this;al=9/10;this.cell.append(this.core.wrapper.element);this.core.wrapper.element.outerWidth(true,this.element.width()*al);this.core.wrapper.element.outerHeight(true,this.element.height()*al);this.core.wrapper.init();this.core.wrapper.adjust();this.core.wrapper.workspace.update(true);this.element.fadeIn("fast",function(){am.core.wrapper.element.css("width","100%");am.core.wrapper.element.css("height","100%");return am.core.wrapper.adjust()});return $(window).on("resize",this.resize)};aj.prototype.off=function(){this.core.element.after(this.core.wrapper.element);this.core.wrapper.element.css("width","");this.core.wrapper.element.css("height","");this.core.wrapper.init();this.core.wrapper.adjust();this.core.wrapper.workspace.update(true);this.element.fadeOut("fast");return $(window).unbind("resize",this.resize)};aj.prototype.toggle=function(am,al){if(this.element.is(":visible")){this.off();return typeof al==="function"?al():void 0}else{this.on();return typeof am==="function"?am():void 0}};return aj})(j);d=(function(){var ak,al,am,aj;ak=(function(){var aq,ao,ap,an;ap=["p","li"];an=[];for(aq=0,ao=ap.length;aq<ao;aq++){aj=ap[aq];an.push([aj,new RegExp("^[s\t]*<"+aj+">"),new RegExp("</"+aj+">[s\t]*$")])}return an})();am=function(at,ao){var ap,ar,aq,an;if(at.shiftKey){return}for(aq=0,an=ak.length;aq<an;aq++){ar=ak[aq];if(ar[1].test(ao)||ar[2].test(ao)){ap=this.selection._getLineCaret();this.selection.caret(ap[1]);return}}};al=function(au,ap,an,at){var ar,aq,ao;if(au.shiftKey){return}for(aq=0,ao=ak.length;aq<ao;aq++){ar=ak[aq];if(ar[2].test(ap)){aj=ar[0];this.selection.insertAfter("<"+aj+"></"+aj+">",false);this.selection.caretOffset(-(3+aj.length));return}}};return function(an){if(!(an.autoIndent!=null)){an=e(an)}an.autoIndent.pre=function(ap,ao){return am.call(an,ap,ao)};an.autoIndent.post=function(ar,ap,ao,aq){return al.call(an,ar,ap,ao,aq)};return an}})();v=(function(){var aj;aj=new RegExp("^<h([1-6])>(.*)</h[1-6]>\n?$");return function(an){var am,ak,al;am=this.textarea.selection.caret();if(am[0]===am[1]){this.textarea.selection.selectWholeCurrentLine()}al=this.selection();if(aj.test(al)){if(RegExp.$1===an.toString()){ak=RegExp.$2}else{ak="<h"+an+">"+RegExp.$2+"</h"+an+">"}return this.selection(ak)}else{return this.enclose("<h"+an+">","</h"+an+">\n")}}})();R=(function(ak){r(aj,ak);function aj(al){aj.__super__.constructor.call(this,al);this.textarea=d(this.textarea)}aj.prototype.h1=function(){return v.call(this,1)};aj.prototype.h2=function(){return v.call(this,2)};aj.prototype.h3=function(){return v.call(this,3)};aj.prototype.h4=function(){return v.call(this,4)};aj.prototype.h5=function(){return v.call(this,5)};aj.prototype.h6=function(){return v.call(this,6)};aj.prototype.bold=function(){return this.enclose("<b>","</b>")};aj.prototype.italic=function(){return this.enclose("<i>","</i>")};aj.prototype.underline=function(){return this.enclose("<u>","</u>")};aj.prototype.strike=function(){return this.enclose("<s>","</s>")};aj.prototype.superscript=function(){return this.enclose("<sup>","</sup>")};aj.prototype.subscript=function(){return this.enclose("<sub>","</sub>")};aj.prototype.quote=function(){return this.enclose("<q>","</q>")};aj.prototype.blockquote=function(){return this.enclose("\n<blockquote>","</blockquote>\n")};aj.prototype.code=function(){return this.enclose("<code>","</code>")};aj.prototype.pre=function(){return this.enclose("<pre>","</pre>")};aj.prototype.anchorLink=function(){var al,am;am=this.selection();if(!am){am=window.prompt("Please input a link text","Here")}al=window.prompt("Please input a link url","http://");if(!(al!=null)){return}return this.selection("<a href='"+al+"'>"+am+"</a>")};aj.prototype.image=function(){var al,am;am=window.prompt("Please input a image url","http://");al=window.prompt("(Optional) Please input a alt message","Image");if(!(am!=null)){return}return this.selection("<img src='"+am+"' alt='"+al+"'>")};aj.prototype.unorderedList=function(){var am,al;am=this.selection();am=(function(){var aq,ao,ap,an;ap=am.split("\n");an=[];for(aq=0,ao=ap.length;aq<ao;aq++){al=ap[aq];an.push("  <li>"+al+"</li>")}return an})();am.unshift("<ul>");am.push("</ul>");return this.selection(am.join("\n"))};aj.prototype.orderedList=function(){var am,al;am=this.selection();am=(function(){var aq,ao,ap,an;ap=am.split("\n");an=[];for(aq=0,ao=ap.length;aq<ao;aq++){al=ap[aq];an.push("  <li>"+al+"</li>")}return an})();am.unshift("<ol>");am.push("</ol>");return this.selection(am.join("\n"))};return aj})(O);y=ag;ae=(function(ak){r(aj,ak);function aj(al){var am;aj.__super__.constructor.call(this,al);am='<p><span class="key">Ctrl+Z</span>'+(Jencil.t("Undo"))+'<p>\n<p><span class="key">Ctrl+Shift+Z</span>'+(Jencil.t("Redo"))+'<p>\n<p><span class="key">Ctrl+B</span>'+(Jencil.t("Make selected text property as <b>Bold</b>"))+'<p>\n<p><span class="key">Ctrl+I</span>'+(Jencil.t("Make selected text property as <i>Italic</i>"))+'<p>\n<p><span class="key">Ctrl+U</span>'+(Jencil.t("Underline selected text like <u>Underline</u>"))+'<p>\n<p><span class="key">Ctrl+F</span>'+(Jencil.t("Toggle fullscreen mode"))+'<p>\n<p><span class="key">Ctrl+Q</span>'+(Jencil.t("Toggle quick view"))+'<p>\n<p><span class="key">Ctrl+H</span>'+(Jencil.t("Toggle help"))+"<p>";this.element.html(am)}return aj})(c);F={mainPanelClass:ah,editorClass:R,viewerClass:y,helperClass:ae,defaultVolume:1,defaultVolume2:0.7,toolbarButtons:["Undo","Redo","Separator",["h1","H1"],["h2","H2"],["h3","H3"],["h4","H4"],["h5","H5"],["h6","H6"],"Separator",["bold","Bold","Ctrl+B"],["italic","Italic","Ctrl+I"],["underline","Underline","Ctrl+U"],["strike","Strikeout"],["superscript","Superscript"],["subscript","Subscript"],"Separator",["anchorLink","Anchor link"],["image","Image"],["unorderedList","Unordered list"],["orderedList","Ordered list"],["quote","Quote"],["blockquote","Blockquote"],["code","Code"],["pre","Pre"],"Separator","Fullscreen"],statusbarButtons:["Viewer","Helper"]};V("Jencil.profiles",function(aj){return aj.HtmlProfile=F});v=(function(){var aj,am,an,ak,al;am=new RegExp("^s*(#{1,6}s*).*");aj=function(ao,aq){var ap;ap="#".repeat(aq);return""+ap+" "+ao};ak=function(ao){return ao.replace(/^(\s*)#{1,6}\s*/g,"$1")};an=function(ao,aq){var ap;ap="#".repeat(aq);return ao.replace(/^(\s*)#{1,6}\s*/g,"$1"+ap+" ")};al=function(ap,aw){var av,ao,at,aq,ar,au;au=ap.val();av=ap.selection.caret();ar=ap.selection.text();ao=0;if(am.test(ar)){at=RegExp.$1.trim();if(at.length===aw){aq=ak(ar)}else{aq=an(ar,aw)}}else{aq=aj(ar,aw);if(av[0]>0&&au[av[0]-1]!=="\n"){aq="\n"+aq}if(av[1]<au.length&&au[av[1]]!=="\n"){aq=""+aq+"\n";ao=-1}}ap.selection.text(aq);if(ao!==0){return ap.selection.caretOffset(ao)}};return function(ao){this.selectWholeLineIfNoSelectionFound();return al(this.textarea,ao)}})();E=(function(){var an,am,ao,ak,al,aj;am=/^(\s*)((?:(?:\d+\.)|(?:[\*\+\->])))(\s+)/;ao=/^(\s*)(\d+)(\.\s+)/;aj=/^(\s*)([\*\+\->])(\s+)/;an=function(ap){var at,au,aq,ar;if(am.test(ap)){at=RegExp.$1;au=RegExp.$2;aq=RegExp.$3;ar=au.endsWith(".")?1:2}else{if(this._listInfo){return this._listInfo}else{ar=0}}return{type:ar,leading:at,mark:au,spaces:aq}};al=function(av,aq){var ar,au,at,ap;if(av.shiftKey){return}au=an.call(this,aq);if((at=au.type)===3||at===4){return true}if((ap=au.type)===1||ap===2){if(aq.replace(am,"").length===0){this.selection.line(aq.replace(am,"$1"));this._listInfo=null;return true}ar=this.selection.lineCaret();return this.selection.caret(ar[1])}};ak=function(ay,aB,ap,az,aA){var ar,au,ax,aw,av,at,aq;az=null;au=an.call(this,aB);if(aA&&!ay.shiftKey&&((aw=au.type)===3||aw===4)){ar=au.mark+au.spaces;ap=aB.replace(/^([\t\s]*).*$/,"$1");ap=" ".repeat(ap.length-ar.length);az="\n"+ap;if(az!=null){this.selection.insertAfter(az,false)}aA=false}if(aA){return}if(ay.shiftKey){if((av=au.type)===1||av===2){ar=au.mark+au.spaces;az=" ".repeat(ar.length);this._listInfo=au;this._listInfo.type+=2}}else{if((at=au.type)===1||at===3){ax=parseInt(au.mark.replace(".",""));az=""+(ax+1)+"."+au.spaces}else{if((aq=au.type)===2||aq===4){az=""+au.mark+au.spaces}}}if(az!=null){return this.selection.insertAfter(az,false)}};return function(ap){if(!(ap.autoIndent!=null)){ap=e(ap)}ap.autoIndent.pre=function(ar,aq){return al.call(ap,ar,aq)};ap.autoIndent.post=function(av,ar,aq,au,at){return ak.call(ap,av,ar,aq,au,at)};return ap}})();B=(function(ak){r(aj,ak);function aj(al){aj.__super__.constructor.call(this,al);this.textarea=E(this.textarea)}aj.prototype.selectWholeLineIfNoSelectionFound=function(){var an,al,am;an=this.textarea.selection.caret();if(an[0]===an[1]){am=this.textarea.selection.lineCaret();al=this.textarea.selection.line();if(/^(\s*[\*\+\-]\s*|^\s*\d+\.\s*|^\s*>\s*)/g.test(al)){am[0]+=RegExp.$1.length}this.textarea.selection.caret(am)}};aj.prototype.h1=function(){return v.call(this,1)};aj.prototype.h2=function(){return v.call(this,2)};aj.prototype.h3=function(){return v.call(this,3)};aj.prototype.h4=function(){return v.call(this,4)};aj.prototype.h5=function(){return v.call(this,5)};aj.prototype.h6=function(){return v.call(this,6)};aj.prototype.bold=function(){return this.enclose("**","**")};aj.prototype.italic=function(){return this.enclose("*","*")};aj.prototype.blockquote=(function(){var al,an,am;an=/^(\s*)>\s*([^\n]*)$/m;am=/^(\s*)([^\n]*)$/m;al=function(aq){var ap,ar,ao;for(ar=0,ao=aq.length;ar<ao;ar++){ap=aq[ar];if(ap.length===0){continue}if(!an.test(ap)){return false}}return true};return function(){var ar,aq,ap,av,at,au,ao;ap=this.selection().split("\n");if(al(ap)){for(ar=av=0,au=ap.length;0<=au?av<au:av>au;ar=0<=au?++av:--av){aq=ap[ar];ap[ar]=aq.replace(an,"$1$2")}}else{for(ar=at=0,ao=ap.length;0<=ao?at<ao:at>ao;ar=0<=ao?++at:--at){aq=ap[ar];ap[ar]=aq.replace(am,"$1> $2")}}return this.selection(ap.join("\n"))}})();aj.prototype.code=function(){var ao,am,an,al;am=this.selection().split("\n");ao=this.textarea.selection.caret();if(am.length>1){an=(function(){var ar,aq,ap;ap=[];for(ar=0,aq=am.length;ar<aq;ar++){al=am[ar];ap.push("\t"+al)}return ap})();return this.selection(an.join("\n"))}else{return this.enclose("`","`")}};aj.prototype.anchorLink=function(){var al,am;am=this.selection();if(!am){am=window.prompt("Please input a link text","Here")}al=window.prompt("Please input a link url","http://");if(!(al!=null)){return}return this.selection("["+am+"]("+al+")")};aj.prototype.image=function(){var al,am;am=window.prompt("Please input a image url","http://");al=window.prompt("(Optional) Please input a alt message","Image");if(!(am!=null)){return}return this.selection("!["+al+"]("+am+")")};aj.prototype.unorderedList=(function(){var al,an,am;an=/^(\s*)\*\s*([^\n]*)$/m;am=/^(\s*)([^\n]*)$/m;al=function(aq){var ap,ar,ao;for(ar=0,ao=aq.length;ar<ao;ar++){ap=aq[ar];if(ap.length===0){continue}if(!an.test(ap)){return false}}return true};return function(){var ar,aq,ap,av,at,au,ao;ap=this.selection().split("\n");if(al(ap)){for(ar=av=0,au=ap.length;0<=au?av<au:av>au;ar=0<=au?++av:--av){aq=ap[ar];ap[ar]=aq.replace(an,"$1$2")}}else{for(ar=at=0,ao=ap.length;0<=ao?at<ao:at>ao;ar=0<=ao?++at:--at){aq=ap[ar];ap[ar]=aq.replace(am,"$1* $2")}}return this.selection(ap.join("\n"))}})();aj.prototype.orderedList=(function(){var al,an,am;an=/^(\s*)\d+\.\s*([^\n]*)$/m;am=/^(\s*)([^\n]*)$/m;al=function(aq){var ap,ar,ao;for(ar=0,ao=aq.length;ar<ao;ar++){ap=aq[ar];if(ap.length===0){continue}if(!an.test(ap)){return false}}return true};return function(){var ar,aq,ap,av,at,au,ao;ap=this.selection().split("\n");if(al(ap)){for(ar=av=0,au=ap.length;0<=au?av<au:av>au;ar=0<=au?++av:--av){aq=ap[ar];ap[ar]=aq.replace(an,"$1$2")}}else{for(ar=at=0,ao=ap.length;0<=ao?at<ao:at>ao;ar=0<=ao?++at:--at){aq=ap[ar];ap[ar]=aq.replace(am,"$1"+(ar+1)+". $2")}}return this.selection(ap.join("\n"))}})();return aj})(O);V("Jencil.types.markdown.editor.MarkdownEditor",function(aj){return aj.MarkdownEditor=B});P=(function(ak){r(aj,ak);function aj(){return aj.__super__.constructor.apply(this,arguments)}aj.prototype.update=function(an,am){var al;al=window.markdown.toHTML(an);return aj.__super__.update.call(this,al,am)};return aj})(ag);G={mainPanelClass:S,editorClass:B,viewerClass:P,defaultVolume:1,toolbarButtons:["Undo","Redo","Separator",["h1","H1"],["h2","H2"],["h3","H3"],["h4","H4"],["h5","H5"],["h6","H6"],"Separator",["bold","Bold","Ctrl+B"],["italic","Italic","Ctrl+I"],"Separator",["anchorLink","Anchor link"],["image","Image"],["unorderedList","Unordered list"],["orderedList","Ordered list"],["blockquote","Blockquote"],["code","Code"],"Separator","Fullscreen"],statusbarButtons:["Viewer"]};V("Jencil.profiles",function(aj){return aj.MarkdownProfile=G})}).call(this);