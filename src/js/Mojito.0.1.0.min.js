/**
 * Jencil 0.1.0
 *
 * Author:  lambdalisue
 * URL:     http://hashnote.net/
 * License: MIT License
 * 
 * Copyright (C) 2012 lambdalisue, hashnote.net allright reserved.
 *
 */
/**
 * Jencil 0.1.0
 *
 * Author:  lambdalisue
 * URL:     http://hashnote.net/
 * License: MIT License
 * 
 * Copyright (C) 2012 lambdalisue, hashnote.net allright reserved.
 *
 */
(function(){var M,F,H,J,e,c,r,n,G,K,x,D,w,t,o,y,f,N,d,b,E,u,I,z,O,B,q,v,h,A,j,g,i,s,L,l,C,P={}.hasOwnProperty,m=function(T,R){for(var Q in R){if(P.call(R,Q)){T[Q]=R[Q]}}function S(){this.constructor=T}S.prototype=R.prototype;T.prototype=new S();T.__super__=R.prototype;return T};y=(function(){function Q(){}Q.prototype.createMemento=function(){throw new Error("NotImplementedError")};Q.prototype.setMemento=function(R){throw new Error("NotImplementedError")};Q.validate=function(R){if(!(R.createMemento!=null)){throw new Error("Originator instance need `createMemento` method")}if(!(R.setMemento!=null)){throw new Error("Originator instance need `setMemento` method")}};return Q})();e=(function(){function Q(R){this._originator=R;this._undoStack=[];this._redoStack=[]}Q.prototype.originator=function(R){if(R!=null){y.validate(R);this._originator=R;return this}return R};Q.prototype.save=function(R){R=R||this.originator().createMemento();this._undoStack.push(R);return this._redoStack=[]};Q.prototype.undo=function(){var R;if(!this.canUndo()){return false}R=this.originator();this._redoStack.push(R.createMemento());R.setMemento(this._undoStack.pop());if(typeof R.focus==="function"){R.focus()}return true};Q.prototype.redo=function(){var R;if(!this.canRedo()){return false}R=this.originator();this._undoStack.push(R.createMemento());R.setMemento(this._redoStack.pop());if(typeof R.focus==="function"){R.focus()}return true};Q.prototype.canUndo=function(){return this._undoStack.length>0};Q.prototype.canRedo=function(){return this._redoStack.length>0};return Q})();E=(function(){function Q(R,S){this.document=R;this.element=S;this}Q.prototype._getCaret=function(){var U,T,R,S;if(this.document.selection!=null){R=this.document.selection.createRange();U=R.duplicate();U.moveToElementText(this.element);U.setEndPoint("EndToEnd",R);S=U.text.length-R.text.length;T=S+R.text.length}else{if(this.element.setSelectionRange!=null){S=this.element.selectionStart;T=this.element.selectionEnd}}return[S,T]};Q.prototype._setCaret=function(U,R){var S,T;T=this.element.scrollTop;if(this.element.setSelectionRange!=null){this.element.setSelectionRange(U,R)}else{if(this.element.createTextRange){S=this.element.createTextRange();S.collapse(true);S.moveStart("character",U);S.moveEnd("character",R-U);S.select()}}this.element.focus();this.element.scrollTop=T;return this};Q.prototype.caret=function(S,R){if((S!=null)&&typeof S==="array"){R=S[1];S=S[0]}if((S!=null)&&!(R!=null)){R=S}if((S!=null)&&(R!=null)){return this._setCaret(S,R)}return this._getCaret()};Q.prototype.caretMove=function(U){var T,R,S;S=this.caret(),R=S[0],T=S[1];return this.caret(R+U,T+U)};Q.prototype.lineCaret=function(){var U,R,T,S;S=this.caret(),R=S[0],U=S[1];T=this.element.value;R=T.lastIndexOf("\n",R-1)+1;U=T.indexOf("\n",R);if(U===-1){U=T.length}return[R,U]};Q.prototype._replace=function(W,X,T){var S,R,U,V;V=this.element.scrollTop;if(this.document.selection){this.element.focus();U=document.selection.createRange();U.text=W;U.select()}else{if(this.element.setSelectionRange){R=this.element.value.substring(0,X);S=this.element.value.substring(T);this.element.value=R+W+S}}this.element.scrollTop=V;return this};Q.prototype._getText=function(){var U,R,S,T;if(this.document.selection!=null){R=this.document.selection.createRange();return R.text}else{if(this.element.setSelectionRange){T=this.caret(),S=T[0],U=T[1];return this.element.value.substring(S,U)}}return null};Q.prototype._setText=function(W,S){var V,R,U,T;U=this.element.scrollTop;T=this.caret(),R=T[0],V=T[1];this._replace(W,R,V);V=R+W.length;if(!S){R=V}this.caret(R,V);this.element.focus();this.element.scrollTop=U;return this};Q.prototype.text=function(S,R){if(S!=null){return this._setText(S,R)}return this._getText()};Q.prototype.line=function(){var U,R,T,S;T=this.element.value;S=this.lineCaret(),R=S[0],U=S[1];return T.substr(R,U-R)};Q.prototype.insertBefore=function(X,S){var V,R,U,W,T;U=this.element.scrollTop;T=this.caret(),R=T[0],V=T[1];W=this.text();this._replace(X+W,R,V);V=R+X.length;if(!S){R=V}this.caret(R,V);this.element.focus();this.element.scrollTop=U;return this};Q.prototype.insertAfter=function(X,S){var V,R,U,W,T;U=this.element.scrollTop;T=this.caret(),R=T[0],V=T[1];W=this.text();this._replace(W+X,R,V);R=V;V=V+X.length;if(!S){R=V}this.caret(R,V);this.element.focus();this.element.scrollTop=U;return this};Q.prototype.wrap=function(W,X,S){var U,Z,R,V,Y,T;R=this.element.scrollTop;Y=this.text();if(Y.indexOf(W)===0&&Y.lastIndexOf(X)===(Y.length-X.length)){V=Y.substring(W.length,Y.length-X.length);this.text(V,S)}else{T=this.caret(),Z=T[0],U=T[1];this._replace(W+Y+X,Z,U);U=Z+W.length+Y.length+X.length;if(!S){Z=U}this.caret(Z,U)}this.element.focus();this.element.scrollTop=R;return this};return Q})();C=(function(){var Q,ae,U,T,aa,ab,ac,S,Y,R,X,Z,ad,W,V;X=function(af){if(af==null){af=false}return this.outerWidth(af)-this.width()};R=function(af){if(af==null){af=false}return this.outerHeight(af)-this.height()};ad=function(af,ag){var ah;if(af==null){af=false}if(typeof af==="number"){ag=af;af=false}if(ag!=null){ah=this.nonContentWidth(af);return this.width(ag-ah)}return this._outerWidth(af)};Z=function(af,ag){var ah;if(af==null){af=false}if(typeof af==="number"){ag=af;af=false}if(ag!=null){ah=this.nonContentHeight(af);return this.height(ag-ah)}return this._outerHeight(af)};X=function(af){if(af==null){af=false}return this.outerWidth(af)-this.width()};R=function(af){if(af==null){af=false}return this.outerHeight(af)-this.height()};Y=function(ag,af){var ah;if(af==null){af=null}ah=this.css(ag);if(ah===""||ah==="none"||ah===null||ah===(void 0)||ah===NaN){return af}ah=parseInt(ah,10);return ah};S=function(){return this.ncss("min-width")};ac=function(){return this.ncss("min-height")};ab=function(){return this.ncss("max-width")};aa=function(){return this.ncss("max-height")};U=function(af){var ai,ah,ag;if(af==null){af=false}ah=af?this.ncss("margin-left"):0;ai=this.ncss("border-left-width");ag=this.ncss("padding-left");return ah+ai+ag};T=function(af){var ai,ah,ag;if(af==null){af=false}ah=af?this.ncss("margin-top"):0;ai=this.ncss("border-top-width");ag=this.ncss("padding-top");return ah+ai+ag};Q=function(af){var ag;ag=this.offset();if(af!=null){ag.left=af;return this.offset(ag)}return ag.left};ae=function(af){var ag;ag=this.offset();if(af!=null){ag.top=af;return this.offset(ag)}return ag.top};W=function(af,ah){var ai,ag;if(af==null){af=false}if(typeof af==="number"){ah=af;af=false}ag=C(this.parent());ai=ag.absoluteX()+ag.contentX(af);if(ah!=null){return this.absoluteX(ah+ai)}return this.absoluteX()-ai};V=function(af,ah){var ai,ag;if(af==null){af=false}if(typeof af==="number"){ah=af;af=false}ag=C(this.parent());ai=ag.absoluteY()+ag.contentY(af);if(ah!=null){return this.absoluteY(ah+ai)}return this.absoluteY()-ai};C=function(af){if(af.__evoluted__===true){return af}af._outerWidth=af.outerWidth;af._outerHeight=af.outerHeight;af.nonContentWidth=X;af.nonContentHeight=R;af.outerWidth=ad;af.outerHeight=Z;af.nonContentWidth=X;af.nonContentHeight=R;af.ncss=Y;af.minWidth=S;af.minHeight=ac;af.maxWidth=ab;af.maxHeight=aa;af.contentX=U;af.contentY=T;af.absoluteX=Q;af.absoluteY=ae;af.relativeX=W;af.relativeY=V;af.__evoluted__=true;return af};return C})();l=function(R){var Q;R.css("position","relative");Q=$("<div>").appendTo(R).hide().css({position:"absolute",top:"0",left:"0",overflow:"hidden","z-index":99999});Q.on=function(){Q.refresh();return Q.show()};Q.refresh=function(){Q.width(R.outerWidth());return Q.height(R.outerHeight())};Q.off=function(){return Q.hide()};return Q};L=function(Q){var T,R,S;Q=$.extend({start:0,end:100,duration:1000,callback:null,done:null,easing:null},Q);R=L.now();T=Q.end-Q.start;Q.easing=Q.easing||L.easings["default"];S=function(){var V,U;V=L.now()-R;U=Q.easing(V,0,1,Q.duration);U=U*T+Q.start;Q.callback(U,V);if(V<Q.duration){return setTimeout(S,1)}else{Q.callback(Q.end,Q.duration);return typeof Q.done==="function"?Q.done():void 0}};S();return null};L.now=function(){return(new Date()).getTime()};L.easings={"default":function(R,T,Q,S){return jQuery.easing.swing(R/S,R,T,Q,S)}};if(typeof exports!=="undefined"&&exports!==null){exports.animate=L}this.Jencil=(function(){function Q(R,S){var T=this;this.options=jQuery.extend({profile:"Jencil.profiles.HtmlProfile"},S);this.caretaker=new e();this.caretaker.originator=function(){return T.editor()};this.element=R.hide();this.wrapper=new s(this);this.fullscreen=new r(this);this.element.after(this.wrapper.element).after(this.fullscreen.element);this.wrapper.init();this.caretaker.save()}Q.prototype.editor=function(){return this.wrapper.workspace.editorPanel};Q.prototype.viewer=function(){return this.wrapper.workspace.viewerPanel};return Q})();$.fn.mojito=function(Q){var R;R=$(this);return new Jencil(R)};g=(function(){function Q(S,R,T){this.core=S;if(R==null){R="<div>"}if(R instanceof jQuery){this.element=R}else{this.element=$(R,T)}this.element=C(this.element)}Q.prototype.init=function(){return this};Q.prototype.adjust=function(){return this};return Q})();f=(function(Q){m(R,Q);function R(T,S,U){if(S==null){S="<div>"}R.__super__.constructor.call(this,T,S,U);this.element.addClass("panel")}return R})(g);o=(function(R){m(Q,R);function Q(T,U,S,V){this.fst=U;this.snd=S;this.splitter=V;Q.__super__.constructor.call(this,T);this.element.addClass("multiple");this.element.append(this.fst.element);this.element.append(this.splitter.element);this.element.append(this.snd.element)}Q.prototype.init=function(){this.splitter.init();this.fst.init();return this.snd.init()};return Q})(f);h=(function(R){m(Q,R);function Q(T,U,S,V){var W;if(V==null){V=0.5}W=new A(T,U,S,V);Q.__super__.constructor.call(this,T,U,S,W);this.element.addClass("vertical")}Q.prototype.adjust=function(){this.fst.element.outerHeight(true,this.element.height());this.snd.element.outerHeight(true,this.element.height());this.splitter.element.outerHeight(true,this.element.height());this.splitter.adjust();return this};return Q})(o);K=(function(R){m(Q,R);function Q(T,U,S,V){var W;if(V==null){V=0.5}W=new x(T,U,S,V);Q.__super__.constructor.call(this,T,U,S,W);this.element.addClass("horizontal")}Q.prototype.adjust=function(){this.fst.element.outerWidth(true,this.element.width());this.snd.element.outerWidth(true,this.element.width());this.splitter.element.outerWidth(true,this.element.width());this.splitter.adjust();return this};return Q})(o);I=(function(Q){m(R,Q);function R(T,U,S,V){var W,X,Y=this;this.fst=U;this.snd=S;this.defaultVolume=V!=null?V:0.5;R.__super__.constructor.call(this,T);this.element.addClass("splitter");this._volume=this.defaultVolume;W=function(ab){var aa,Z;Y.mousemove(ab);if((aa=Y.fst.curtain)!=null){if(typeof aa.refresh==="function"){aa.refresh()}}if((Z=Y.snd.curtain)!=null){if(typeof Z.refresh==="function"){Z.refresh()}}ab.stopPropagation();ab.stopImmediatePropagation();return ab.preventDefault()};X=function(ab){var ac,aa,Z;ac=$(window);ac.unbind("mousemove",W);ac.unbind("mouseup",X);if((aa=Y.fst.curtain)!=null){if(typeof aa.off==="function"){aa.off()}}if((Z=Y.snd.curtain)!=null){if(typeof Z.off==="function"){Z.off()}}ab.stopPropagation();ab.stopImmediatePropagation();return ab.preventDefault()};this.element.mousedown(function(ab){var ac,aa,Z;ac=$(window);ac.mousemove(W);ac.mouseup(X);if((aa=Y.fst.curtain)!=null){if(typeof aa.on==="function"){aa.on()}}if((Z=Y.snd.curtain)!=null){if(typeof Z.on==="function"){Z.on()}}ab.stopPropagation();ab.stopImmediatePropagation();return ab.preventDefault()})}R.prototype.init=function(){return this.container=C(this.element.parent())};R.prototype.volume=function(T,S){if(S==null){S=false}if(T!=null){this._volume=T;if(!S){this.adjust()}return this}return this._volume};R.prototype.value=function(V,U){var S,T;if(U==null){U=false}S=this.valueWidth();if(V!=null){T=V/S;return this.volume(T,U)}return this.volume()*S};R.prototype.regulateValue=function(T){var U,S;S=this.minValue();U=this.maxValue();if(T<S){T=S}if(T>U){T=U}return T};return R})(g);A=(function(Q){m(R,Q);function R(U,V,T,W){var X,S;R.__super__.constructor.call(this,U,V,T,W);this.element.addClass("vertical");this.fst.element.addClass("left");this.snd.element.addClass("right");this.fst.element.css({"float":"left"});this.snd.element.css({"float":"left"});if((X=this.fst.curtain)!=null){X.css("pointer","col-resize")}if((S=this.snd.curtain)!=null){S.css("pointer","col-resize")}}R.prototype.mousemove=function(T){var U,S;U=this.container.absoluteX()+this.container.contentX(true);S=T.pageX-U;S=this.regulateValue(S);return this.value(S)};R.prototype.valueWidth=function(){return this.container.width()};R.prototype.minValue=function(){var T,S;T=this.fst.element.minWidth()+this.fst.element.nonContentWidth();S=this.snd.element.maxWidth()+this.snd.element.nonContentWidth();if(S!=null){S=this.valueWidth()-S}if((T!=null)&&(S!=null)){return Math.min(T,S)}return T||S||0};R.prototype.maxValue=function(){var U,T,S;S=this.valueWidth();U=this.fst.element.maxWidth()+this.fst.element.nonContentWidth();T=this.snd.element.minWidth()+this.snd.element.nonContentWidth();if(T!=null){T=S-T}if((U!=null)&&(T!=null)){return Math.max(U,T)}return U||T||S};R.prototype.adjust=function(){var V,U,T,S;T=this.value();S=this.valueWidth();V=T-this.fst.element.nonContentWidth(true);U=(S-T)-this.snd.element.nonContentWidth(true);if(V<=0){if(this.fst.element.is(":visible")){this.fst.element.hide()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.snd.element.outerWidth(true,S);this._value=T=0}else{if(U<=0){if(!this.fst.element.is(":visible")){this.fst.element.show()}if(this.snd.element.is(":visible")){this.snd.element.hide()}this.fst.element.outerWidth(true,S);this._value=T=S}else{if(!this.fst.element.is(":visible")){this.fst.element.show()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.fst.element.width(V);this.snd.element.width(U)}}this.fst.adjust();this.snd.adjust();this.element.relativeX(T-this.element.outerWidth()/2);return this};return R})(I);x=(function(R){m(Q,R);function Q(U,V,T,W){var X,S;Q.__super__.constructor.call(this,U,V,T,W);this.element.addClass("horizontal");this.fst.element.addClass("top");this.snd.element.addClass("bottom");if((X=this.fst.curtain)!=null){X.css("pointer","raw-resize")}if((S=this.snd.curtain)!=null){S.css("pointer","raw-resize")}}Q.prototype.mousemove=function(T){var U,S;U=this.container.absoluteY()+this.container.contentY(true);S=T.pageY-U;S=this.regulateValue(S);return this.value(S)};Q.prototype.valueWidth=function(){return this.container.height()};Q.prototype.minValue=function(){var T,S;T=this.fst.element.minHeight()+this.fst.element.nonContentHeight();S=this.snd.element.maxHeight()+this.snd.element.nonContentHeight();if(S!=null){S=this.valueWidth()-S}if((T!=null)&&(S!=null)){return Math.min(T,S)}return T||S||0};Q.prototype.maxValue=function(){var U,T,S;S=this.valueWidth();U=this.fst.element.maxHeight()+this.fst.element.nonContentHeight();T=this.snd.element.minHeight()+this.snd.element.nonContentHeight();if(T!=null){T=S-T}if((U!=null)&&(T!=null)){return Math.max(U,T)}return U||T||S};Q.prototype.adjust=function(){var V,U,T,S;T=this.value();S=this.valueWidth();V=T-this.fst.element.nonContentHeight(true);U=(S-T)-this.snd.element.nonContentHeight(true);if(V<=0){if(this.fst.element.is(":visible")){this.fst.element.hide()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.snd.element.outerHeight(true,S);this._value=T=0}else{if(U<=0){if(!this.fst.element.is(":visible")){this.fst.element.show()}if(this.snd.element.is(":visible")){this.snd.element.hide()}this.fst.element.outerHeight(true,S);this._value=T=S}else{if(!this.fst.element.is(":visible")){this.fst.element.show()}if(!this.snd.element.is(":visible")){this.snd.element.show()}this.fst.element.height(V);this.snd.element.height(U)}}this.fst.adjust();this.snd.adjust();this.element.relativeY(T-this.element.outerHeight()/2);return this};return Q})(I);H=(function(R){m(Q,R);function Q(T,S,U){if(S==null){S="<div>"}Q.__super__.constructor.call(this,T,S,U);this.element.addClass("editor");this._changeCallbacks=[]}Q.prototype.val=function(S){throw new Error("NotImplementedError")};Q.prototype.change=function(V){var U,S,T;if(V!=null){this._changeCallbacks.push(V);return this}T=this._changeCallbacks;for(U=0,S=T.length;U<S;U++){V=T[U];V.call(this,this.val())}return this};Q.prototype.h1=null;Q.prototype.h2=null;Q.prototype.h3=null;Q.prototype.h4=null;Q.prototype.h5=null;Q.prototype.h6=null;Q.prototype.bold=null;Q.prototype.italic=null;Q.prototype.underline=null;Q.prototype.strike=null;Q.prototype.superscript=null;Q.prototype.subscript=null;Q.prototype.anchor=null;Q.prototype.image=null;Q.prototype.unorderedList=null;Q.prototype.orderedList=null;Q.prototype.indent=null;Q.prototype.outdent=null;return Q})(f);B=(function(Q){m(R,Q);function R(T,S,U){var V=this;if(S==null){S="<div>"}R.__super__.constructor.call(this,T,S,U);this.textarea=$("<textarea>").appendTo(this.element).css({margin:"0",padding:"0",border:"none",outline:"none",resize:"none"});this.textarea=C(this.textarea);this.textarea.selection=new E(window.document,this.textarea.get(0));if($.fn.tabby!=null){this.textarea.tabby({tabString:"    "})}this.textarea.autoindent=function(Z){var W,Y,X;if(Z.which===13){V.core.caretaker.save();X=V.textarea.selection.line();W=X.replace(/^(\s*).*$/,"$1");Y="\n"+W;V.textarea.selection.insertAfter(Y,false);V.textarea.focus();Z.stopPropagation();Z.stopImmediatePropagation();Z.preventDefault();V.change();return false}};this.textarea.on("keydown",function(W){return V.textarea.autoindent(W)});this.textarea.on("click blur",function(){return V.change()})}R.prototype.val=function(S){if(S!=null){this.textarea.val(S);this.change();return this}return this.textarea.val()};R.prototype.focus=function(){this.textarea.focus();return this};R.prototype.createMemento=function(){return this.val()};R.prototype.setMemento=function(S){return this.val(S)};R.prototype.adjust=function(){this.textarea.outerWidth(this.element.width());this.textarea.outerHeight(this.element.height());return this};R.prototype.wrap=function(S,T,U){if(U==null){U=true}this.textarea.selection.wrap(S,T,U);this.change();return this};R.prototype.selection=function(T,S){if(S==null){S=true}if(T!=null){this.textarea.selection.text(T,S);this.change();return this}return this.textarea.selection.text()};return R})(H);j=(function(Q){m(R,Q);function R(T,S,U){if(S==null){S="<div>"}R.__super__.constructor.call(this,T,S,U);this.element.addClass("viewer")}R.prototype.update=function(S){throw new Error("NotImplementedError")};return R})(f);O=(function(R){m(Q,R);function Q(S){Q.__super__.constructor.call(this,S);this.element.css({position:"relative"});this.curtain=l(this.element);this.iframe=$("<iframe>").appendTo(this.element).css({margin:"0",padding:"0",border:"none",outline:"none",resize:"none",width:"100%",height:"100%",overflow:"visible"});this.iframe.attr("frameborder",0);this.iframe=C(this.iframe);this.iframe.init=function(){var T;T=this.get(0);if(T.contentDocument!=null){this.document=T.contentDocument}else{this.document=T.contentWindow.document}return this.document.write("<body></body>")};this.iframe.write=function(T){var V;if(this.document!=null){try{V=this.document.documentElement.scrollTop}catch(U){V=0}this.document.open();this.document.write(T);this.document.close();this.document.documentElement.scrollTop=V;this.width(this.document.scrollLeft);this.height(this.document.scrollTop);return true}return false};this.iframe.loadTemplate=function(T,U){var V=this;return $.ajax({url:T,success:function(W){V._template=W;return V.write(U)}})}}Q.prototype.init=function(){return this.iframe.init()};Q.prototype.update=function(S){if(this.iframe._template!=null){S=this.iframe._template.replace("{{content}}",S)}else{if(this.templatePath!=null){this.iframe.loadTemplate(this.templatePath,S)}}return this.iframe.write(S)};Q.prototype.adjust=function(){this.iframe.outerWidth(this.element.width());this.iframe.outerHeight(this.element.height());return this};return Q})(j);F=(function(R){m(Q,R);function Q(S,T){this.config=T;Q.__super__.constructor.call(this,S);this.config=jQuery.extend({type:"GET",dataType:"text",data:function(U){return encodeURIComponent(U)},url:null},this.config)}Q.prototype.update=function(S){var T,U=this;T=function(V){return T.__super__.constructor.call(U,V)};T.__super__=Q.__super__.update.apply(this,arguments);return $.ajax({type:this.config.type,dataType:this.config.dataType,data:this.config.data(S),url:this.config.url,success:function(V){return T(V)}})};return Q})(O);G=(function(R){m(Q,R);function Q(S){var T;T={type:"POST",dataType:"text",data:function(U){return{text:encodeURIComponent(U),mode:"gfm"}},url:"http://developer.github.com/v3/markdown/"};Q.__super__.constructor.call(this,S,T)}return Q})(F);u=(function(Q){m(R,Q);function R(S){R.__super__.constructor.call(this,S,"<span>");this.element.addClass("separator")}return R})(g);J=(function(R){m(Q,R);function Q(S,T,V,U){this.name=T;this.text=V;this.title=U;Q.__super__.constructor.call(this,S,"<a>");this.text=this.text||this.name;this.title=this.title||this.text;this.element.addClass("button").addClass(T);this.element.append($("<span>"+this.text+"</span>"));this.element.attr("title",this.title)}return Q})(g);M=(function(R){m(Q,R);function Q(T,U,W,V,X,S){this.shortcut=S;Q.__super__.constructor.call(this,T,U,W,V);this.element.click(function(){return X()});this.callback=X;if((this.shortcut!=null)&&(window.shortcut!=null)){window.shortcut.add(this.shortcut,function(Y){return X()});this.element.attr("title",""+this.title+" ("+this.shortcut+")")}}return Q})(J);c=(function(Q){m(R,Q);function R(T,U,X,W,V,S){var Y;Y=function(){var Z;Z=T.editor();return Z[V].call(Z)};R.__super__.constructor.call(this,T,U,X,W,Y,S)}R.factory=function(T,V){var Y,U,S,X,W;U=X=W=Y=S=null;switch(V.length){case 5:U=V[0];X=V[1];W=V[2];Y=V[3];S=V[4];break;case 4:U=V[0];X=W=V[1];Y=V[2];S=V[3];break;case 3:U=Y=V[0];X=W=V[1];S=V[2];break;case 2:U=Y=V[0];X=W=V[1];S=null;break;case 1:U=Y=X=W=V[0];S=null}return new R(T,U,X,W,Y,S)};return R})(M);v=(function(Q){m(R,Q);function R(S){var U,T=this;U=function(V){return T.core.caretaker.undo()};R.__super__.constructor.call(this,S,"undo","Undo","Undo",U,"Ctrl+Z")}R.prototype.init=function(){var S,T=this;S=function(){if(!T.core.caretaker.canUndo()){T.element.addClass("disabled")}else{T.element.removeClass("disabled")}return setTimeout(S,100)};return S()};return R})(M);b=(function(R){m(Q,R);function Q(S){var U,T=this;U=function(V){return T.core.caretaker.redo()};Q.__super__.constructor.call(this,S,"redo","Redo","Redo",U,"Ctrl+Shift+Z")}Q.prototype.init=function(){var S,T=this;S=function(){if(!T.core.caretaker.canRedo()){T.element.addClass("disabled")}else{T.element.removeClass("disabled")}return setTimeout(S,100)};return S()};return Q})(M);n=(function(R){m(Q,R);function Q(S){var U,T=this;U=function(V){return T.core.fullscreen.toggle()};Q.__super__.constructor.call(this,S,"fullscreen","Toggle fullscreen","Fullscreen",U,"Ctrl+F")}Q.prototype.init=function(){var S,T=this;S=function(){if(T.core.fullscreen.element.is(":visible")){T.element.addClass("hide")}else{T.element.removeClass("hide")}return setTimeout(S,100)};return S()};return Q})(M);N=(function(Q){m(R,Q);function R(S){var U,T=this;U=function(V){return T.core.viewer().toggle()};R.__super__.constructor.call(this,S,"preview","Toggle preview","Preview",U,"Ctrl+P")}R.prototype.init=function(){var S,T=this;S=function(){if(T.core.viewer().element.is(":visible")){T.element.addClass("hide")}else{T.element.removeClass("hide")}return setTimeout(S,100)};return S()};return R})(M);s=(function(Q){m(R,Q);function R(S){R.__super__.constructor.call(this,S);this.element.addClass("mojito wrapper");this.workspace=new i(this.core);this.workspace.element.appendTo(this.element)}R.prototype.init=function(){var S=this;if(this.element.resizable!=null){this.element.resizable({start:function(){var U,T;if((U=S.workspace.editorPanel.curtain)!=null){if(typeof U.on==="function"){U.on()}}return(T=S.workspace.viewerPanel.curtain)!=null?typeof T.on==="function"?T.on():void 0:void 0},resize:function(){var U,T;if((U=S.workspace.editorPanel.curtain)!=null){if(typeof U.refresh==="function"){U.refresh()}}if((T=S.workspace.viewerPanel.curtain)!=null){if(typeof T.refresh==="function"){T.refresh()}}return S.adjust()},stop:function(){var U,T;if((U=S.workspace.editorPanel.curtain)!=null){if(typeof U.off==="function"){U.off()}}if((T=S.workspace.viewerPanel.curtain)!=null){if(typeof T.off==="function"){T.off()}}return S.adjust()}})}this.workspace.init();return this.adjust()};R.prototype.adjust=function(){this.workspace.element.outerWidth(true,this.element.width());this.workspace.element.outerHeight(true,this.element.height());this.workspace.adjust();return this};return R})(f);i=(function(R){m(Q,R);function Q(S){Q.__super__.constructor.call(this,S);this.element.addClass("workspace");this.profile(new w())}Q.prototype.profile=function(T){var Y,ab,W,V,aa,S,X,U,Z=this;if(T!=null){this.element.empty();this.editorPanel=new T.editorClass(this.core);this.viewerPanel=new T.viewerClass(this.core);this.viewerPanel.toggle=function(ag,ae){var ah,ad,ac,af;ah=null;af=Z.mainPanel.splitter.volume();if((0<af&&af<1)){ac=1;Z._previousSplitterVolume=af;ah=ae}else{ac=Z._previousSplitterVolume||Z.mainPanel.splitter.defaultVolume;if(ac===1){ac=0.5}ah=ag}ad=function(){if(typeof ah==="function"){ah()}return Z.update()};return L({done:ad,start:af,end:ac,duration:500,callback:function(aj,ai){return Z.mainPanel.splitter.volume(aj)}})};this.viewerPanel.on=function(){if(Z.viewerPanel.element.is(":visible")){return}return Z.viewerPanel.toggle()};this.viewerPanel.off=function(){if(!Z.viewerPanel.element.is(":visible")){return}return Z.viewerPanel.toggle()};this.editorPanel.change(function(ac){return Z.update()});this.mainPanel=new h(this.core,this.editorPanel,this.viewerPanel,1);this.mainPanel.splitter.element.dblclick(function(){return Z.viewerPanel.toggle()});this.mainPanel.element.addClass("mainPanel");this.toolbar=new q(this.core);X=T.toolbarButtons;for(W=0,aa=X.length;W<aa;W++){ab=X[W];if(ab instanceof Array){Y=c.factory(this.core,ab)}else{Y=new ab(this.core)}this.toolbar.buttons.push(Y);this.toolbar.element.append(Y.element)}this.statusbar=new z(this.core);U=T.statusbarButtons;for(V=0,S=U.length;V<S;V++){ab=U[V];if(ab instanceof Array){Y=c.factory(this.core,ab)}else{Y=new ab(this.core)}this.statusbar.buttons.push(Y);this.statusbar.element.append(Y.element)}this.element.append(this.toolbar.element);this.element.append(this.mainPanel.element);this.element.append(this.statusbar.element);this._profile=T;return this}return this._profile};Q.prototype.init=function(){this.toolbar.init();this.statusbar.init();this.mainPanel.init();return this.adjust()};Q.prototype.adjust=function(){var S;this.toolbar.element.outerWidth(true,this.element.width());this.statusbar.element.outerWidth(true,this.element.width());this.mainPanel.element.outerWidth(true,this.element.width());this.toolbar.adjust();this.statusbar.adjust();S=this.toolbar.element.outerHeight(true)+this.statusbar.element.outerHeight(true);this.mainPanel.element.outerHeight(true,this.element.height()-S);this.mainPanel.adjust();return this};Q.prototype.update=function(){return this.viewerPanel.update(this.editorPanel.val())};return Q})(f);q=(function(R){m(Q,R);function Q(S){Q.__super__.constructor.call(this,S);this.element.addClass("toolbar");this.buttons=[]}Q.prototype.init=function(){var T,V,S,U;U=this.buttons;for(V=0,S=U.length;V<S;V++){T=U[V];T.init()}return this};return Q})(f);z=(function(R){m(Q,R);function Q(S){Q.__super__.constructor.call(this,S);this.element.addClass("statusbar");this.buttons=[]}Q.prototype.init=function(){var T,V,S,U;U=this.buttons;for(V=0,S=U.length;V<S;V++){T=U[V];T.init()}return this};return Q})(f);r=(function(R){m(Q,R);function Q(S){var T=this;Q.__super__.constructor.call(this,S);this.element.addClass("fullscreen");this.element.css({display:"table",position:"fixed",top:"0",left:"0",width:"100%",height:"100%"});this.curtain=C($("<div>").addClass("curtain"));this.curtain.css({position:"absolute",top:"0",left:"0",width:"100%",height:"100%",background:"black",opacity:"0.6"});this.cell=C($("<div>").css({display:"table-cell","vertical-align":"middle",width:"95%",height:"95%"}));if($.browser.msie&&$.browser.version<7){this.element.css("position","absolute");$(window).scroll(function(){return T.element.css("top",$(document).scrollTop())})}this.curtain.click(function(){return T.off()});this.element.append(this.curtain);this.element.append(this.cell);this.element.hide();this.resize=function(){return T.core.wrapper.adjust()}}Q.prototype.on=function(){var S=this;this._width=this.core.wrapper.element.css("width");this._height=this.core.wrapper.element.css("height");this.core.wrapper.element.css("width","90%");this.core.wrapper.element.css("height","90%");this.cell.append(this.core.wrapper.element);this.element.fadeIn("fast",function(){S.core.wrapper.init();S.core.wrapper.adjust();return S.core.wrapper.workspace.update()});return $(window).on("resize",this.resize)};Q.prototype.off=function(){var S=this;this.core.wrapper.element.css("width",this._width);this.core.wrapper.element.css("height",this._height);this.core.element.after(this.core.wrapper.element);this.element.fadeOut("fast",function(){S.core.wrapper.init();S.core.wrapper.adjust();return S.core.wrapper.workspace.update()});return $(window).unbind("resize",this.resize)};Q.prototype.toggle=function(T,S){if(this.element.is(":visible")){this.off();return typeof S==="function"?S():void 0}else{this.on();return typeof T==="function"?T():void 0}};return Q})(f);d=(function(){function Q(){}Q.prototype.editorClass=null;Q.prototype.viewerClass=null;Q.prototype.buttons=null;return Q})();w=(function(R){m(Q,R);function Q(){this.editorClass=D;this.viewerClass=t;this.toolbarButtons=[v,b,u,["h1","H1"],["h2","H2"],["h3","H3"],["h4","H4"],["h5","H5"],["h6","H6"],u,["bold","Bold","Ctrl + B"],["italic","Italic","Ctrl + B"],["underline","Underline","Ctrl + B"],["strike","Strikeout"],["superscript","Superscript"],["subscript","Subscript"],u,["anchor","Anchor link"],["image","Image"],["unorderedList","Unordered list"],["orderedList","Ordered list"],["indent","Indent"],["outdent","Outdent"],u,n,N];this.statusbarButtons=[v,b,u,["h1","H1"],["h2","H2"],["h3","H3"],["h4","H4"],["h5","H5"],["h6","H6"],u,["bold","Bold","Ctrl + B"],["italic","Italic","Ctrl + B"],["underline","Underline","Ctrl + B"],["strike","Strikeout"],["superscript","Superscript"],["subscript","Subscript"],u,["anchor","Anchor link"],["image","Image"],["unorderedList","Unordered list"],["orderedList","Ordered list"],["indent","Indent"],["outdent","Outdent"]]}return Q})(d);t=O;t=G;D=(function(R){m(Q,R);function Q(){return Q.__super__.constructor.apply(this,arguments)}Q.prototype.h1=function(){return this.wrap("<h1>","</h1>")};Q.prototype.h2=function(){return this.wrap("<h2>","</h2>")};Q.prototype.h3=function(){return this.wrap("<h3>","</h3>")};Q.prototype.h4=function(){return this.wrap("<h4>","</h4>")};Q.prototype.h5=function(){return this.wrap("<h5>","</h5>")};Q.prototype.h6=function(){return this.wrap("<h6>","</h6>")};Q.prototype.bold=function(){return this.wrap("<b>","</b>")};Q.prototype.italic=function(){return this.wrap("<i>","</i>")};Q.prototype.underline=function(){return this.wrap("<u>","</u>")};Q.prototype.strike=function(){return this.wrap("<s>","</s>")};Q.prototype.superscript=function(){return this.wrap("<sup>","</sup>")};Q.prototype.subscript=function(){return this.wrap("<sub>","</sub>")};Q.prototype.anchor=function(){var S,T;T=this.selection();if(!T){T=window.prompt("Please input a link text","Here")}S=window.prompt("Please input a link url","http://");if(!(S!=null)){return}return this.selection("<a href='"+S+"'>"+T+"</a>")};Q.prototype.image=function(){var S,T;T=window.prompt("Please input a image url","http://");S=window.prompt("(Optional) Please input a alt message","Image");if(!(T!=null)){return}return this.selection("<img src='"+T+"' alt='"+S+"'>")};Q.prototype.unorderedList=function(){var T,S;T=this.selection();T=(function(){var X,V,W,U;W=T.split("\n");U=[];for(X=0,V=W.length;X<V;X++){S=W[X];U.push("  <li>"+S+"</li>")}return U})();T.unshift("<ul>");T.push("</ul>");return this.selection(T.join("\n"))};Q.prototype.orderedList=function(){var T,S;T=this.selection();T=(function(){var X,V,W,U;W=T.split("\n");U=[];for(X=0,V=W.length;X<V;X++){S=W[X];U.push("  <li>"+S+"</li>")}return U})();T.unshift("<ol>");T.push("</ol>");return this.selection(T.join("\n"))};Q.prototype.indent=function(){var T,S;T=this.selection();T=(function(){var X,V,W,U;W=T.split("\n");U=[];for(X=0,V=W.length;X<V;X++){S=W[X];U.push("  "+S)}return U})();T.unshift("<div style='margin-left: 4em'>");T.push("</div>");return this.selection(T.join("\n"))};Q.prototype.outdent=function(){var T,S;T=this.selection();T=(function(){var X,V,W,U;W=T.split("\n");U=[];for(X=0,V=W.length;X<V;X++){S=W[X];U.push("  "+S)}return U})();T.unshift("<div style='margin-left: -4em'>");T.push("</div>");return this.selection(T.join("\n"))};return Q})(B)}).call(this);(function(e){e.fn.tabby=function(g){var h=e.extend({},e.fn.tabby.defaults,g);var i=e.fn.tabby.pressed;return this.each(function(){$this=e(this);var j=e.meta?e.extend({},h,$this.data()):h;$this.bind("keydown",function(m){var l=e.fn.tabby.catch_kc(m);if(16==l){i.shft=true}if(17==l){i.ctrl=true;setTimeout("$.fn.tabby.pressed.ctrl = false;",1000)}if(18==l){i.alt=true;setTimeout("$.fn.tabby.pressed.alt = false;",1000)}if(9==l&&!i.ctrl&&!i.alt){m.preventDefault;i.last=l;setTimeout("$.fn.tabby.pressed.last = null;",0);f(e(m.target).get(0),i.shft,j);return false}}).bind("keyup",function(l){if(16==e.fn.tabby.catch_kc(l)){i.shft=false}}).bind("blur",function(l){if(9==i.last){e(l.target).one("focus",function(m){i.last=null}).get(0).focus()}})})};e.fn.tabby.catch_kc=function(g){return g.keyCode?g.keyCode:g.charCode?g.charCode:g.which};e.fn.tabby.pressed={shft:false,ctrl:false,alt:false,last:null};function c(g){if(window.console&&window.console.log){window.console.log("textarea count: "+g.size())}}function f(j,i,h){var g=j.scrollTop;if(j.setSelectionRange){b(j,i,h)}else{if(document.selection){d(j,i,h)}}j.scrollTop=g}e.fn.tabby.defaults={tabString:String.fromCharCode(9)};function b(l,g,x){var w=l.selectionStart;var u=l.selectionEnd;if(w==u){if(g){if("\t"==l.value.substring(w-x.tabString.length,w)){l.value=l.value.substring(0,w-x.tabString.length)+l.value.substring(w);l.focus();l.setSelectionRange(w-x.tabString.length,w-x.tabString.length)}else{if("\t"==l.value.substring(w,w+x.tabString.length)){l.value=l.value.substring(0,w)+l.value.substring(w+x.tabString.length);l.focus();l.setSelectionRange(w,w)}}}else{l.value=l.value.substring(0,w)+x.tabString+l.value.substring(w);l.focus();l.setSelectionRange(w+x.tabString.length,w+x.tabString.length)}}else{var y=l.value.split("\n");var v=new Array();var n=0;var j=0;var h=false;for(var r in y){j=n+y[r].length;v.push({start:n,end:j,selected:(n<=w&&j>w)||(j>=u&&n<u)||(n>w&&j<u)});n=j+1}var m=0;for(var r in v){if(v[r].selected){var t=v[r].start+m;if(g&&x.tabString==l.value.substring(t,t+x.tabString.length)){l.value=l.value.substring(0,t)+l.value.substring(t+x.tabString.length);m-=x.tabString.length}else{if(!g){l.value=l.value.substring(0,t)+x.tabString+l.value.substring(t);m+=x.tabString.length}}}}l.focus();var s=w+((m>0)?x.tabString.length:(m<0)?-x.tabString.length:0);var q=u+m;l.setSelectionRange(s,q)}}function d(t,z,g){var s=document.selection.createRange();if(t==s.parentElement()){if(""==s.text){if(z){var n=s.getBookmark();s.moveStart("character",-g.tabString.length);if(g.tabString==s.text){s.text=""}else{s.moveToBookmark(n);s.moveEnd("character",g.tabString.length);if(g.tabString==s.text){s.text=""}}s.collapse(true);s.select()}else{s.text=g.tabString;s.collapse(false);s.select()}}else{var m=s.text;var r=m.length;var x=m.split("\r\n");var C=document.body.createTextRange();C.moveToElementText(t);C.setEndPoint("EndToStart",s);var q=C.text;var A=q.split("\r\n");var u=q.length;var B=document.body.createTextRange();B.moveToElementText(t);B.setEndPoint("StartToEnd",s);var y=B.text;var h=document.body.createTextRange();h.moveToElementText(t);h.setEndPoint("StartToEnd",C);var v=h.text;var j=e(t).html();e("#r3").text(u+" + "+r+" + "+y.length+" = "+j.length);if((u+v.length)<j.length){A.push("");u+=2;if(z&&g.tabString==x[0].substring(0,g.tabString.length)){x[0]=x[0].substring(g.tabString.length)}else{if(!z){x[0]=g.tabString+x[0]}}}else{if(z&&g.tabString==A[A.length-1].substring(0,g.tabString.length)){A[A.length-1]=A[A.length-1].substring(g.tabString.length)}else{if(!z){A[A.length-1]=g.tabString+A[A.length-1]}}}for(var w=1;w<x.length;w++){if(z&&g.tabString==x[w].substring(0,g.tabString.length)){x[w]=x[w].substring(g.tabString.length)}else{if(!z){x[w]=g.tabString+x[w]}}}if(1==A.length&&0==u){if(z&&g.tabString==x[0].substring(0,g.tabString.length)){x[0]=x[0].substring(g.tabString.length)}else{if(!z){x[0]=g.tabString+x[0]}}}if((u+r+y.length)<j.length){x.push("");r+=2}C.text=A.join("\r\n");s.text=x.join("\r\n");var l=document.body.createTextRange();l.moveToElementText(t);if(0<u){l.setEndPoint("StartToEnd",C)}else{l.setEndPoint("StartToStart",C)}l.setEndPoint("EndToEnd",s);l.select()}}}})(jQuery);(function(L){var e=L.Markdown=function e(S){switch(typeof S){case"undefined":this.dialect=e.dialects.Gruber;break;case"object":this.dialect=S;break;default:if(S in e.dialects){this.dialect=e.dialects[S]}else{throw new Error("Unknown Markdown dialect '"+String(S)+"'")}break}this.em_state=[];this.strong_state=[];this.debug_indent=""};L.parse=function(U,S){var T=new e(S);return T.toTree(U)};L.toHTML=function v(V,U,T){var S=L.toHTMLTree(V,U,T);return L.renderJsonML(S)};L.toHTMLTree=function x(T,X,V){if(typeof T==="string"){T=this.parse(T,X)}var U=D(T),S={};if(U&&U.references){S=U.references}var W=i(T,S,V);r(W);return W};function f(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function I(){var S=require("util");return"Markdown.mk_block( "+S.inspect(this.toString())+", "+S.inspect(this.trailing)+", "+S.inspect(this.lineNumber)+" )"}var g=e.mk_block=function(V,T,S){if(arguments.length==1){T="\n\n"}var U=new String(V);U.trailing=T;U.inspect=I;U.toSource=f;if(S!=undefined){U.lineNumber=S}return U};function H(T){var U=0,S=-1;while((S=T.indexOf("\n",S+1))!==-1){U++}return U}e.prototype.split_blocks=function A(U,X){var V=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,W=[],S;var T=1;if((S=/^(\s*\n)/.exec(U))!=null){T+=H(S[0]);V.lastIndex=S[0].length}while((S=V.exec(U))!==null){W.push(g(S[1],S[2],T));T+=H(S[0])}return W};e.prototype.processBlock=function N(X,W){var T=this.dialect.block,S=T.__order__;if("__call__" in T){return T.__call__.call(this,X,W)}for(var V=0;V<S.length;V++){var U=T[S[V]].call(this,X,W);if(U){if(!B(U)||(U.length>0&&!(B(U[0])))){this.debug(S[V],"didn't return a proper array")}return U}}return[]};e.prototype.processInline=function h(S){return this.dialect.inline.__call__.call(this,String(S))};e.prototype.toTree=function J(U,T){var V=U instanceof Array?U:this.split_blocks(U);var W=this.tree;try{this.tree=T||this.tree||["markdown"];V:while(V.length){var S=this.processBlock(V.shift(),V);if(!S.length){continue V}this.tree.push.apply(this.tree,S)}return this.tree}finally{if(T){this.tree=W}}};e.prototype.debug=function(){var S=Array.prototype.slice.call(arguments);S.unshift(this.debug_indent);if(typeof print!=="undefined"){print.apply(print,S)}if(typeof console!=="undefined"&&typeof console.log!=="undefined"){console.log.apply(null,S)}};e.prototype.loop_re_over_block=function(V,W,U){var T,S=W.valueOf();while(S.length&&(T=V.exec(S))!=null){S=S.substr(T[0].length);U.call(this,T)}return S};e.dialects={};e.dialects.Gruber={block:{atxHeader:function t(U,T){var S=U.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!S){return undefined}var V=["header",{level:S[1].length}];Array.prototype.push.apply(V,this.processInline(S[2]));if(S[0].length<U.length){T.unshift(g(U.substr(S[0].length),U.trailing,U.lineNumber+2))}return[V]},setextHeader:function y(U,T){var S=U.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!S){return undefined}var W=(S[2]==="=")?1:2;var V=["header",{level:W},S[1]];if(S[0].length<U.length){T.unshift(g(U.substr(S[0].length),U.trailing,U.lineNumber+2))}return[V]},code:function m(X,W){var U=[],V=/^(?: {0,3}\t| {4})(.*)\n?/,T;if(!X.match(V)){return undefined}block_search:do{var S=this.loop_re_over_block(V,X.valueOf(),function(Y){U.push(Y[1])});if(S.length){W.unshift(g(S,X.trailing));break block_search}else{if(W.length){if(!W[0].match(V)){break block_search}U.push(X.trailing.replace(/[^\n]/g,"").substring(2));X=W.shift()}else{break block_search}}}while(true);return[["code_block",U.join("\n")]]},horizRule:function Q(U,T){var S=U.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!S){return undefined}var V=[["hr"]];if(S[1]){V.unshift.apply(V,this.processBlock(S[1],[]))}if(S[3]){T.unshift(g(S[3]))}return V},lists:(function(){var V="[*+-]|\\d+\\.",T=/[*+-]/,ab=/\d+\./,Z=new RegExp("^( {0,3})("+V+")[ \t]+"),U="(?: {0,3}\\t| {4})";function W(ac){return new RegExp("(?:^("+U+"{0,"+ac+"} {0,3})("+V+")\\s+)|(^"+U+"{0,"+(ac-1)+"}[ ]{0,4})")}function S(ac){return ac.replace(/ {0,3}\t/g,"    ")}function aa(ad,aj,ai,ae){if(aj){ad.push(["para"].concat(ai));return}var ac=ad[ad.length-1] instanceof Array&&ad[ad.length-1][0]=="para"?ad[ad.length-1]:ad;if(ae&&ad.length>1){ai.unshift(ae)}for(var ag=0;ag<ai.length;ag++){var ah=ai[ag],af=typeof ah=="string";if(af&&ac.length>1&&typeof ac[ac.length-1]=="string"){ac[ac.length-1]+=ah}else{ac.push(ah)}}}function X(ai,ah){var ag=new RegExp("^("+U+"{"+ai+"}.*?\\n?)*$"),af=new RegExp("^"+U+"{"+ai+"}","gm"),ae=[];while(ah.length>0){if(ag.exec(ah[0])){var ad=ah.shift(),ac=ad.replace(af,"");ae.push(g(ac,ad.trailing,ad.lineNumber))}break}return ae}function Y(af,ae,ac){var ah=af.list;var ag=ah[ah.length-1];if(ag[1] instanceof Array&&ag[1][0]=="para"){return}if(ae+1==ac.length){ag.push(["para"].concat(ag.splice(1)))}else{var ad=ag.pop();ag.push(["para"].concat(ag.splice(1)),ad)}}return function(ah,an){var ao=ah.match(Z);if(!ao){return undefined}function af(ay){var az=T.exec(ay[2])?["bulletlist"]:["numberlist"];ag.push({list:az,indent:ay[1]});return az}var ag=[],at=af(ao),ae,am=false,ax=[ag[0].list],aq;loose_search:while(true){var ac=ah.split(/(?=\n)/);var au="";tight_search:for(var av=0;av<ac.length;av++){var ad="",ap=ac[av].replace(/^\n/,function(ay){ad=ay;return""});var ak=W(ag.length);ao=ap.match(ak);if(ao[1]!==undefined){if(au.length){aa(ae,am,this.processInline(au),ad);am=false;au=""}ao[1]=S(ao[1]);var ai=Math.floor(ao[1].length/4)+1;if(ai>ag.length){at=af(ao);ae.push(at);ae=at[1]=["listitem"]}else{var al=false;for(aq=0;aq<ag.length;aq++){if(ag[aq].indent!=ao[1]){continue}at=ag[aq].list;ag.splice(aq+1);al=true;break}if(!al){ai++;if(ai<=ag.length){ag.splice(ai);at=ag[ai-1].list}else{at=af(ao);ae.push(at)}}ae=["listitem"];at.push(ae)}ad=""}if(ap.length>ao[0].length){au+=ad+ap.substr(ao[0].length)}}if(au.length){aa(ae,am,this.processInline(au),ad);am=false;au=""}var ar=X(ag.length,an);if(ar.length>0){c(ag,Y,this);ae.push.apply(ae,this.toTree(ar,[]))}var aj=an[0]&&an[0].valueOf()||"";if(aj.match(Z)||aj.match(/^ /)){ah=an.shift();var aw=this.dialect.block.horizRule(ah,an);if(aw){ax.push.apply(ax,aw);break}c(ag,Y,this);am=true;continue loose_search}break}return ax}})(),blockquote:function M(X,V){if(!X.match(/^>/m)){return undefined}var Z=[];if(X[0]!=">"){var T=X.split(/\n/),W=[];while(T.length&&T[0][0]!=">"){W.push(T.shift())}X=T.join("\n");Z.push.apply(Z,this.processBlock(W.join("\n"),[]))}while(V.length&&V[0][0]==">"){var S=V.shift();X=new String(X+X.trailing+S);X.trailing=S.trailing}var U=X.replace(/^> ?/gm,""),Y=this.tree;Z.push(this.toTree(U,["blockquote"]));return Z},referenceDefn:function K(W,V){var U=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!W.match(U)){return undefined}if(!D(this.tree)){this.tree.splice(1,0,{})}var T=D(this.tree);if(T.references===undefined){T.references={}}var S=this.loop_re_over_block(U,W,function(X){if(X[2]&&X[2][0]=="<"&&X[2][X[2].length-1]==">"){X[2]=X[2].substring(1,X[2].length-1)}var Y=T.references[X[1].toLowerCase()]={href:X[2]};if(X[4]!==undefined){Y.title=X[4]}else{if(X[5]!==undefined){Y.title=X[5]}}});if(S.length){V.unshift(g(S,W.trailing))}return[]},para:function E(T,S){return[["para"].concat(this.processInline(T))]}}};e.dialects.Gruber.inline={__oneElement__:function d(X,T,W){var S,U,Y=0;T=T||this.dialect.inline.__patterns__;var V=new RegExp("([\\s\\S]*?)("+(T.source||T)+")");S=V.exec(X);if(!S){return[X.length,X]}else{if(S[1]){return[S[1].length,S[1]]}}var U;if(S[2] in this.dialect.inline){U=this.dialect.inline[S[2]].call(this,X.substr(S.index),S,W||[])}U=U||[S[2].length,S[2]];return U},__call__:function s(W,U){var S=[],T;function V(X){if(typeof X=="string"&&typeof S[S.length-1]=="string"){S[S.length-1]+=X}else{S.push(X)}}while(W.length>0){T=this.dialect.inline.__oneElement__.call(this,W,U,S);W=W.substr(T.shift());c(T,V)}return S},"]":function(){},"}":function(){},"\\":function u(S){if(S.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)){return[2,S[1]]}else{return[1,"\\"]}},"![":function n(U){var S=U.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(S){if(S[2]&&S[2][0]=="<"&&S[2][S[2].length-1]==">"){S[2]=S[2].substring(1,S[2].length-1)}S[2]=this.dialect.inline.__call__.call(this,S[2],/\\/)[0];var T={alt:S[1],href:S[2]||""};if(S[4]!==undefined){T.title=S[4]}return[S[0].length,["img",T]]}S=U.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/);if(S){return[S[0].length,["img_ref",{alt:S[1],ref:S[2].toLowerCase(),original:S[0]}]]}return[2,"!["]},"[":function o(ac){var Z=String(ac);var X=e.DialectHelpers.inline_until_char.call(this,ac.substr(1),"]");if(!X){return[1,"["]}var aa=1+X[0],T=X[1],Y,ab;ac=ac.substr(aa);var V=ac.match(/^\s*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(V){var S=V[1];aa+=V[0].length;if(S&&S[0]=="<"&&S[S.length-1]==">"){S=S.substring(1,S.length-1)}if(!V[3]){var U=1;for(var W=0;W<S.length;W++){switch(S[W]){case"(":U++;break;case")":if(--U==0){aa-=S.length-W;S=S.substring(0,W)}break}}}S=this.dialect.inline.__call__.call(this,S,/\\/)[0];ab={href:S||""};if(V[3]!==undefined){ab.title=V[3]}Y=["link",ab].concat(T);return[aa,Y]}V=ac.match(/^\s*\[(.*?)\]/);if(V){aa+=V[0].length;ab={ref:(V[1]||String(T)).toLowerCase(),original:Z.substr(0,aa)};Y=["link_ref",ab].concat(T);return[aa,Y]}if(T.length==1&&typeof T[0]=="string"){ab={ref:T[0].toLowerCase(),original:Z.substr(0,aa)};Y=["link_ref",ab,T[0]];return[aa,Y]}return[1,"["]},"<":function w(T){var S;if((S=T.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))!=null){if(S[3]){return[S[0].length,["link",{href:"mailto:"+S[3]},S[3]]]}else{if(S[2]=="mailto"){return[S[0].length,["link",{href:S[1]},S[1].substr("mailto:".length)]]}else{return[S[0].length,["link",{href:S[1]},S[1]]]}}}return[1,"<"]},"`":function z(T){var S=T.match(/(`+)(([\s\S]*?)\1)/);if(S&&S[2]){return[S[1].length+S[2].length,["inlinecode",S[3]]]}else{return[1,"`"]}},"  \n":function P(S){return[3,["linebreak"]]}};function G(S,V){var U=S+"_state",W=S=="strong"?"em_state":"strong_state";function T(X){this.len_after=X;this.name="close_"+V}return function(ae,ad){if(this[U][0]==V){this[U].shift();return[ae.length,new T(ae.length-V.length)]}else{var X=this[W].slice(),ac=this[U].slice();this[U].unshift(V);var Z=this.processInline(ae.substr(V.length));var aa=Z[Z.length-1];var Y=this[U].shift();if(aa instanceof T){Z.pop();var ab=ae.length-aa.len_after;return[ab,[S].concat(Z)]}else{this[W]=X;this[U]=ac;return[V.length,V]}}}}e.dialects.Gruber.inline["**"]=G("strong","**");e.dialects.Gruber.inline.__=G("strong","__");e.dialects.Gruber.inline["*"]=G("em","*");e.dialects.Gruber.inline._=G("em","_");e.buildBlockOrder=function(U){var S=[];for(var T in U){if(T=="__order__"||T=="__call__"){continue}S.push(T)}U.__order__=S};e.buildInlinePatterns=function(W){var V=[];for(var T in W){if(T.match(/^__.*__$/)){continue}var S=T.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");V.push(T.length==1?S:"(?:"+S+")")}V=V.join("|");W.__patterns__=V;var U=W.__call__;W.__call__=function(Y,X){if(X!=undefined){return U.call(this,Y,X)}else{return U.call(this,Y,V)}}};e.DialectHelpers={};e.DialectHelpers.inline_until_char=function(W,V){var U=0,S=[];while(true){if(W[U]==V){U++;return[U,S]}if(U>=W.length){return null}var T=this.dialect.inline.__oneElement__.call(this,W.substr(U));U+=T[0];S.push.apply(S,T.slice(1))}};e.subclassDialect=function(U){function S(){}S.prototype=U.block;function T(){}T.prototype=U.inline;return{block:new S(),inline:new T()}};e.buildBlockOrder(e.dialects.Gruber.block);e.buildInlinePatterns(e.dialects.Gruber.inline);e.dialects.Maruku=e.subclassDialect(e.dialects.Gruber);e.dialects.Maruku.processMetaHash=function l(V){var W=q(V),S={};for(var T=0;T<W.length;++T){if(/^#/.test(W[T])){S.id=W[T].substring(1)}else{if(/^\./.test(W[T])){if(S["class"]){S["class"]=S["class"]+W[T].replace(/./," ")}else{S["class"]=W[T].substring(1)}}else{if(/\=/.test(W[T])){var U=W[T].split(/\=/);S[U[0]]=U[1]}}}}return S};function q(U){var W=U.split(""),V=[""],S=false;while(W.length){var T=W.shift();switch(T){case" ":if(S){V[V.length-1]+=T}else{V.push("")}break;case"'":case'"':S=!S;break;case"\\":T=W.shift();default:V[V.length-1]+=T;break}}return V}e.dialects.Maruku.block.document_meta=function j(X,U){if(X.lineNumber>1){return undefined}if(!X.match(/^(?:\w+:.*\n)*\w+:.*$/)){return undefined}if(!D(this.tree)){this.tree.splice(1,0,{})}var W=X.split(/\n/);for(p in W){var S=W[p].match(/(\w+):\s*(.*)$/),T=S[1].toLowerCase(),V=S[2];this.tree[1][T]=V}return[]};e.dialects.Maruku.block.block_meta=function F(Z,W){var V=Z.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!V){return undefined}var U=this.dialect.processMetaHash(V[2]);var Y;if(V[1]===""){var X=this.tree[this.tree.length-1];Y=D(X);if(typeof X==="string"){return undefined}if(!Y){Y={};X.splice(1,0,Y)}for(a in U){Y[a]=U[a]}return[]}var T=Z.replace(/\n.*$/,""),S=this.processBlock(T,[]);Y=D(S[0]);if(!Y){Y={};S[0].splice(1,0,Y)}for(a in U){Y[a]=U[a]}return S};e.dialects.Maruku.block.definition_list=function O(U,X){var Z=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,Y=["dl"],W;if((T=U.match(Z))){var S=[U];while(X.length&&Z.exec(X[0])){S.push(X.shift())}for(var aa=0;aa<S.length;++aa){var T=S[aa].match(Z),V=T[1].replace(/\n$/,"").split(/\n/),ab=T[2].split(/\n:\s+/);for(W=0;W<V.length;++W){Y.push(["dt",V[W]])}for(W=0;W<ab.length;++W){Y.push(["dd"].concat(this.processInline(ab[W].replace(/(\n)\s+/,"$1"))))}}}else{return undefined}return[Y]};e.dialects.Maruku.inline["{:"]=function C(Z,X,V){if(!V.length){return[2,"{:"]}var W=V[V.length-1];if(typeof W==="string"){return[2,"{:"]}var T=Z.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!T){return[2,"{:"]}var Y=this.dialect.processMetaHash(T[1]),S=D(W);if(!S){S={};W.splice(1,0,S)}for(var U in Y){S[U]=Y[U]}return[T[0].length,""]};e.buildBlockOrder(e.dialects.Maruku.block);e.buildInlinePatterns(e.dialects.Maruku.inline);var B=Array.isArray||function(S){return Object.prototype.toString.call(S)=="[object Array]"};var c;if(Array.prototype.forEach){c=function(T,S,U){return T.forEach(S,U)}}else{c=function(T,S,V){for(var U=0;U<T.length;U++){S.call(V||T,T[U],U,T)}}}function D(S){return B(S)&&S.length>1&&typeof S[1]==="object"&&!(B(S[1]))?S[1]:undefined}L.renderJsonML=function(U,S){S=S||{};S.root=S.root||false;var T=[];if(S.root){T.push(R(U))}else{U.shift();if(U.length&&typeof U[0]==="object"&&!(U[0] instanceof Array)){U.shift()}while(U.length){T.push(R(U.shift()))}}return T.join("\n\n")};function b(S){return S.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function R(X){if(typeof X==="string"){return b(X)}var S=X.shift(),U={},V=[];if(X.length&&typeof X[0]==="object"&&!(X[0] instanceof Array)){U=X.shift()}while(X.length){V.push(arguments.callee(X.shift()))}var W="";for(var T in U){W+=" "+T+'="'+b(U[T])+'"'}if(S=="img"||S=="br"||S=="hr"){return"<"+S+W+"/>"}else{return"<"+S+W+">"+V.join("")+"</"+S+">"}}function i(aa,X,Z){var U;Z=Z||{};var W=aa.slice(0);if(typeof Z.preprocessTreeNode==="function"){W=Z.preprocessTreeNode(W,X)}var Y=D(W);if(Y){W[1]={};for(U in Y){W[1][U]=Y[U]}Y=W[1]}if(typeof W==="string"){return W}switch(W[0]){case"header":W[0]="h"+W[1].level;delete W[1].level;break;case"bulletlist":W[0]="ul";break;case"numberlist":W[0]="ol";break;case"listitem":W[0]="li";break;case"para":W[0]="p";break;case"markdown":W[0]="html";if(Y){delete Y.references}break;case"code_block":W[0]="pre";U=Y?2:1;var S=["code"];S.push.apply(S,W.splice(U));W[U]=S;break;case"inlinecode":W[0]="code";break;case"img":W[1].src=W[1].href;delete W[1].href;break;case"linebreak":W[0]="br";break;case"link":W[0]="a";break;case"link_ref":W[0]="a";var T=X[Y.ref];if(T){delete Y.ref;Y.href=T.href;if(T.title){Y.title=T.title}delete Y.original}else{return Y.original}break;case"img_ref":W[0]="img";var T=X[Y.ref];if(T){delete Y.ref;Y.src=T.href;if(T.title){Y.title=T.title}delete Y.original}else{return Y.original}break}U=1;if(Y){for(var V in W[1]){U=2}if(U===1){W.splice(U,1)}}for(;U<W.length;++U){W[U]=arguments.callee(W[U],X,Z)}return W}function r(T){var S=D(T)?2:1;while(S<T.length){if(typeof T[S]==="string"){if(S+1<T.length&&typeof T[S+1]==="string"){T[S]+=T.splice(S+1,1)[0]}else{++S}}else{arguments.callee(T[S]);++S}}}})((function(){if(typeof exports==="undefined"){window.markdown={};return window.markdown}else{return exports}})());shortcut={all_shortcuts:{},add:function(c,i,e){var h={type:"keydown",propagate:false,disable_in_input:false,target:document,keycode:false};if(!e){e=h}else{for(var b in h){if(typeof e[b]=="undefined"){e[b]=h[b]}}}var g=e.target;if(typeof e.target=="string"){g=document.getElementById(e.target)}var d=this;c=c.toLowerCase();var f=function(o){o=o||window.event;if(e.disable_in_input){var l;if(o.target){l=o.target}else{if(o.srcElement){l=o.srcElement}}if(l.nodeType==3){l=l.parentNode}if(l.tagName=="INPUT"||l.tagName=="TEXTAREA"){return}}if(o.keyCode){code=o.keyCode}else{if(o.which){code=o.which}}var n=String.fromCharCode(code).toLowerCase();if(code==188){n=","}if(code==190){n="."}var t=c.split("+");var s=0;var q={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};var m={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var r={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(o.ctrlKey){r.ctrl.pressed=true}if(o.shiftKey){r.shift.pressed=true}if(o.altKey){r.alt.pressed=true}if(o.metaKey){r.meta.pressed=true}for(var j=0;k=t[j],j<t.length;j++){if(k=="ctrl"||k=="control"){s++;r.ctrl.wanted=true}else{if(k=="shift"){s++;r.shift.wanted=true}else{if(k=="alt"){s++;r.alt.wanted=true}else{if(k=="meta"){s++;r.meta.wanted=true}else{if(k.length>1){if(m[k]==code){s++}}else{if(e.keycode){if(e.keycode==code){s++}}else{if(n==k){s++}else{if(q[n]&&o.shiftKey){n=q[n];if(n==k){s++}}}}}}}}}}if(s==t.length&&r.ctrl.pressed==r.ctrl.wanted&&r.shift.pressed==r.shift.wanted&&r.alt.pressed==r.alt.wanted&&r.meta.pressed==r.meta.wanted){i(o);if(!e.propagate){o.cancelBubble=true;o.returnValue=false;if(o.stopPropagation){o.stopPropagation();o.preventDefault()}return false}}};this.all_shortcuts[c]={callback:f,target:g,event:e.type};if(g.addEventListener){g.addEventListener(e.type,f,false)}else{if(g.attachEvent){g.attachEvent("on"+e.type,f)}else{g["on"+e.type]=f}}},remove:function(b){b=b.toLowerCase();var e=this.all_shortcuts[b];delete (this.all_shortcuts[b]);if(!e){return}var c=e.event;var d=e.target;var f=e.callback;if(d.detachEvent){d.detachEvent("on"+c,f)}else{if(d.removeEventListener){d.removeEventListener(c,f,false)}else{d["on"+c]=false}}}}(function(e){e.fn.tabby=function(g){var h=e.extend({},e.fn.tabby.defaults,g);var i=e.fn.tabby.pressed;return this.each(function(){$this=e(this);var j=e.meta?e.extend({},h,$this.data()):h;$this.bind("keydown",function(m){var l=e.fn.tabby.catch_kc(m);if(16==l){i.shft=true}if(17==l){i.ctrl=true;setTimeout("$.fn.tabby.pressed.ctrl = false;",1000)}if(18==l){i.alt=true;setTimeout("$.fn.tabby.pressed.alt = false;",1000)}if(9==l&&!i.ctrl&&!i.alt){m.preventDefault;i.last=l;setTimeout("$.fn.tabby.pressed.last = null;",0);f(e(m.target).get(0),i.shft,j);return false}}).bind("keyup",function(l){if(16==e.fn.tabby.catch_kc(l)){i.shft=false}}).bind("blur",function(l){if(9==i.last){e(l.target).one("focus",function(m){i.last=null}).get(0).focus()}})})};e.fn.tabby.catch_kc=function(g){return g.keyCode?g.keyCode:g.charCode?g.charCode:g.which};e.fn.tabby.pressed={shft:false,ctrl:false,alt:false,last:null};function c(g){if(window.console&&window.console.log){window.console.log("textarea count: "+g.size())}}function f(j,i,h){var g=j.scrollTop;if(j.setSelectionRange){b(j,i,h)}else{if(document.selection){d(j,i,h)}}j.scrollTop=g}e.fn.tabby.defaults={tabString:String.fromCharCode(9)};function b(l,g,x){var w=l.selectionStart;var u=l.selectionEnd;if(w==u){if(g){if("\t"==l.value.substring(w-x.tabString.length,w)){l.value=l.value.substring(0,w-x.tabString.length)+l.value.substring(w);l.focus();l.setSelectionRange(w-x.tabString.length,w-x.tabString.length)}else{if("\t"==l.value.substring(w,w+x.tabString.length)){l.value=l.value.substring(0,w)+l.value.substring(w+x.tabString.length);l.focus();l.setSelectionRange(w,w)}}}else{l.value=l.value.substring(0,w)+x.tabString+l.value.substring(w);l.focus();l.setSelectionRange(w+x.tabString.length,w+x.tabString.length)}}else{var y=l.value.split("\n");var v=new Array();var n=0;var j=0;var h=false;for(var r in y){j=n+y[r].length;v.push({start:n,end:j,selected:(n<=w&&j>w)||(j>=u&&n<u)||(n>w&&j<u)});n=j+1}var m=0;for(var r in v){if(v[r].selected){var t=v[r].start+m;if(g&&x.tabString==l.value.substring(t,t+x.tabString.length)){l.value=l.value.substring(0,t)+l.value.substring(t+x.tabString.length);m-=x.tabString.length}else{if(!g){l.value=l.value.substring(0,t)+x.tabString+l.value.substring(t);m+=x.tabString.length}}}}l.focus();var s=w+((m>0)?x.tabString.length:(m<0)?-x.tabString.length:0);var q=u+m;l.setSelectionRange(s,q)}}function d(t,z,g){var s=document.selection.createRange();if(t==s.parentElement()){if(""==s.text){if(z){var n=s.getBookmark();s.moveStart("character",-g.tabString.length);if(g.tabString==s.text){s.text=""}else{s.moveToBookmark(n);s.moveEnd("character",g.tabString.length);if(g.tabString==s.text){s.text=""}}s.collapse(true);s.select()}else{s.text=g.tabString;s.collapse(false);s.select()}}else{var m=s.text;var r=m.length;var x=m.split("\r\n");var C=document.body.createTextRange();C.moveToElementText(t);C.setEndPoint("EndToStart",s);var q=C.text;var A=q.split("\r\n");var u=q.length;var B=document.body.createTextRange();B.moveToElementText(t);B.setEndPoint("StartToEnd",s);var y=B.text;var h=document.body.createTextRange();h.moveToElementText(t);h.setEndPoint("StartToEnd",C);var v=h.text;var j=e(t).html();e("#r3").text(u+" + "+r+" + "+y.length+" = "+j.length);if((u+v.length)<j.length){A.push("");u+=2;if(z&&g.tabString==x[0].substring(0,g.tabString.length)){x[0]=x[0].substring(g.tabString.length)}else{if(!z){x[0]=g.tabString+x[0]}}}else{if(z&&g.tabString==A[A.length-1].substring(0,g.tabString.length)){A[A.length-1]=A[A.length-1].substring(g.tabString.length)}else{if(!z){A[A.length-1]=g.tabString+A[A.length-1]}}}for(var w=1;w<x.length;w++){if(z&&g.tabString==x[w].substring(0,g.tabString.length)){x[w]=x[w].substring(g.tabString.length)}else{if(!z){x[w]=g.tabString+x[w]}}}if(1==A.length&&0==u){if(z&&g.tabString==x[0].substring(0,g.tabString.length)){x[0]=x[0].substring(g.tabString.length)}else{if(!z){x[0]=g.tabString+x[0]}}}if((u+r+y.length)<j.length){x.push("");r+=2}C.text=A.join("\r\n");s.text=x.join("\r\n");var l=document.body.createTextRange();l.moveToElementText(t);if(0<u){l.setEndPoint("StartToEnd",C)}else{l.setEndPoint("StartToStart",C)}l.setEndPoint("EndToEnd",s);l.select()}}}})(jQuery);(function(L){var e=L.Markdown=function e(S){switch(typeof S){case"undefined":this.dialect=e.dialects.Gruber;break;case"object":this.dialect=S;break;default:if(S in e.dialects){this.dialect=e.dialects[S]}else{throw new Error("Unknown Markdown dialect '"+String(S)+"'")}break}this.em_state=[];this.strong_state=[];this.debug_indent=""};L.parse=function(U,S){var T=new e(S);return T.toTree(U)};L.toHTML=function v(V,U,T){var S=L.toHTMLTree(V,U,T);return L.renderJsonML(S)};L.toHTMLTree=function x(T,X,V){if(typeof T==="string"){T=this.parse(T,X)}var U=D(T),S={};if(U&&U.references){S=U.references}var W=i(T,S,V);r(W);return W};function f(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function I(){var S=require("util");return"Markdown.mk_block( "+S.inspect(this.toString())+", "+S.inspect(this.trailing)+", "+S.inspect(this.lineNumber)+" )"}var g=e.mk_block=function(V,T,S){if(arguments.length==1){T="\n\n"}var U=new String(V);U.trailing=T;U.inspect=I;U.toSource=f;if(S!=undefined){U.lineNumber=S}return U};function H(T){var U=0,S=-1;while((S=T.indexOf("\n",S+1))!==-1){U++}return U}e.prototype.split_blocks=function A(U,X){var V=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,W=[],S;var T=1;if((S=/^(\s*\n)/.exec(U))!=null){T+=H(S[0]);V.lastIndex=S[0].length}while((S=V.exec(U))!==null){W.push(g(S[1],S[2],T));T+=H(S[0])}return W};e.prototype.processBlock=function N(X,W){var T=this.dialect.block,S=T.__order__;if("__call__" in T){return T.__call__.call(this,X,W)}for(var V=0;V<S.length;V++){var U=T[S[V]].call(this,X,W);if(U){if(!B(U)||(U.length>0&&!(B(U[0])))){this.debug(S[V],"didn't return a proper array")}return U}}return[]};e.prototype.processInline=function h(S){return this.dialect.inline.__call__.call(this,String(S))};e.prototype.toTree=function J(U,T){var V=U instanceof Array?U:this.split_blocks(U);var W=this.tree;try{this.tree=T||this.tree||["markdown"];V:while(V.length){var S=this.processBlock(V.shift(),V);if(!S.length){continue V}this.tree.push.apply(this.tree,S)}return this.tree}finally{if(T){this.tree=W}}};e.prototype.debug=function(){var S=Array.prototype.slice.call(arguments);S.unshift(this.debug_indent);if(typeof print!=="undefined"){print.apply(print,S)}if(typeof console!=="undefined"&&typeof console.log!=="undefined"){console.log.apply(null,S)}};e.prototype.loop_re_over_block=function(V,W,U){var T,S=W.valueOf();while(S.length&&(T=V.exec(S))!=null){S=S.substr(T[0].length);U.call(this,T)}return S};e.dialects={};e.dialects.Gruber={block:{atxHeader:function t(U,T){var S=U.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!S){return undefined}var V=["header",{level:S[1].length}];Array.prototype.push.apply(V,this.processInline(S[2]));if(S[0].length<U.length){T.unshift(g(U.substr(S[0].length),U.trailing,U.lineNumber+2))}return[V]},setextHeader:function y(U,T){var S=U.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!S){return undefined}var W=(S[2]==="=")?1:2;var V=["header",{level:W},S[1]];if(S[0].length<U.length){T.unshift(g(U.substr(S[0].length),U.trailing,U.lineNumber+2))}return[V]},code:function m(X,W){var U=[],V=/^(?: {0,3}\t| {4})(.*)\n?/,T;if(!X.match(V)){return undefined}block_search:do{var S=this.loop_re_over_block(V,X.valueOf(),function(Y){U.push(Y[1])});if(S.length){W.unshift(g(S,X.trailing));break block_search}else{if(W.length){if(!W[0].match(V)){break block_search}U.push(X.trailing.replace(/[^\n]/g,"").substring(2));X=W.shift()}else{break block_search}}}while(true);return[["code_block",U.join("\n")]]},horizRule:function Q(U,T){var S=U.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!S){return undefined}var V=[["hr"]];if(S[1]){V.unshift.apply(V,this.processBlock(S[1],[]))}if(S[3]){T.unshift(g(S[3]))}return V},lists:(function(){var V="[*+-]|\\d+\\.",T=/[*+-]/,ab=/\d+\./,Z=new RegExp("^( {0,3})("+V+")[ \t]+"),U="(?: {0,3}\\t| {4})";function W(ac){return new RegExp("(?:^("+U+"{0,"+ac+"} {0,3})("+V+")\\s+)|(^"+U+"{0,"+(ac-1)+"}[ ]{0,4})")}function S(ac){return ac.replace(/ {0,3}\t/g,"    ")}function aa(ad,aj,ai,ae){if(aj){ad.push(["para"].concat(ai));return}var ac=ad[ad.length-1] instanceof Array&&ad[ad.length-1][0]=="para"?ad[ad.length-1]:ad;if(ae&&ad.length>1){ai.unshift(ae)}for(var ag=0;ag<ai.length;ag++){var ah=ai[ag],af=typeof ah=="string";if(af&&ac.length>1&&typeof ac[ac.length-1]=="string"){ac[ac.length-1]+=ah}else{ac.push(ah)}}}function X(ai,ah){var ag=new RegExp("^("+U+"{"+ai+"}.*?\\n?)*$"),af=new RegExp("^"+U+"{"+ai+"}","gm"),ae=[];while(ah.length>0){if(ag.exec(ah[0])){var ad=ah.shift(),ac=ad.replace(af,"");ae.push(g(ac,ad.trailing,ad.lineNumber))}break}return ae}function Y(af,ae,ac){var ah=af.list;var ag=ah[ah.length-1];if(ag[1] instanceof Array&&ag[1][0]=="para"){return}if(ae+1==ac.length){ag.push(["para"].concat(ag.splice(1)))}else{var ad=ag.pop();ag.push(["para"].concat(ag.splice(1)),ad)}}return function(ah,an){var ao=ah.match(Z);if(!ao){return undefined}function af(ay){var az=T.exec(ay[2])?["bulletlist"]:["numberlist"];ag.push({list:az,indent:ay[1]});return az}var ag=[],at=af(ao),ae,am=false,ax=[ag[0].list],aq;loose_search:while(true){var ac=ah.split(/(?=\n)/);var au="";tight_search:for(var av=0;av<ac.length;av++){var ad="",ap=ac[av].replace(/^\n/,function(ay){ad=ay;return""});var ak=W(ag.length);ao=ap.match(ak);if(ao[1]!==undefined){if(au.length){aa(ae,am,this.processInline(au),ad);am=false;au=""}ao[1]=S(ao[1]);var ai=Math.floor(ao[1].length/4)+1;if(ai>ag.length){at=af(ao);ae.push(at);ae=at[1]=["listitem"]}else{var al=false;for(aq=0;aq<ag.length;aq++){if(ag[aq].indent!=ao[1]){continue}at=ag[aq].list;ag.splice(aq+1);al=true;break}if(!al){ai++;if(ai<=ag.length){ag.splice(ai);at=ag[ai-1].list}else{at=af(ao);ae.push(at)}}ae=["listitem"];at.push(ae)}ad=""}if(ap.length>ao[0].length){au+=ad+ap.substr(ao[0].length)}}if(au.length){aa(ae,am,this.processInline(au),ad);am=false;au=""}var ar=X(ag.length,an);if(ar.length>0){c(ag,Y,this);ae.push.apply(ae,this.toTree(ar,[]))}var aj=an[0]&&an[0].valueOf()||"";if(aj.match(Z)||aj.match(/^ /)){ah=an.shift();var aw=this.dialect.block.horizRule(ah,an);if(aw){ax.push.apply(ax,aw);break}c(ag,Y,this);am=true;continue loose_search}break}return ax}})(),blockquote:function M(X,V){if(!X.match(/^>/m)){return undefined}var Z=[];if(X[0]!=">"){var T=X.split(/\n/),W=[];while(T.length&&T[0][0]!=">"){W.push(T.shift())}X=T.join("\n");Z.push.apply(Z,this.processBlock(W.join("\n"),[]))}while(V.length&&V[0][0]==">"){var S=V.shift();X=new String(X+X.trailing+S);X.trailing=S.trailing}var U=X.replace(/^> ?/gm,""),Y=this.tree;Z.push(this.toTree(U,["blockquote"]));return Z},referenceDefn:function K(W,V){var U=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!W.match(U)){return undefined}if(!D(this.tree)){this.tree.splice(1,0,{})}var T=D(this.tree);if(T.references===undefined){T.references={}}var S=this.loop_re_over_block(U,W,function(X){if(X[2]&&X[2][0]=="<"&&X[2][X[2].length-1]==">"){X[2]=X[2].substring(1,X[2].length-1)}var Y=T.references[X[1].toLowerCase()]={href:X[2]};if(X[4]!==undefined){Y.title=X[4]}else{if(X[5]!==undefined){Y.title=X[5]}}});if(S.length){V.unshift(g(S,W.trailing))}return[]},para:function E(T,S){return[["para"].concat(this.processInline(T))]}}};e.dialects.Gruber.inline={__oneElement__:function d(X,T,W){var S,U,Y=0;T=T||this.dialect.inline.__patterns__;var V=new RegExp("([\\s\\S]*?)("+(T.source||T)+")");S=V.exec(X);if(!S){return[X.length,X]}else{if(S[1]){return[S[1].length,S[1]]}}var U;if(S[2] in this.dialect.inline){U=this.dialect.inline[S[2]].call(this,X.substr(S.index),S,W||[])}U=U||[S[2].length,S[2]];return U},__call__:function s(W,U){var S=[],T;function V(X){if(typeof X=="string"&&typeof S[S.length-1]=="string"){S[S.length-1]+=X}else{S.push(X)}}while(W.length>0){T=this.dialect.inline.__oneElement__.call(this,W,U,S);W=W.substr(T.shift());c(T,V)}return S},"]":function(){},"}":function(){},"\\":function u(S){if(S.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)){return[2,S[1]]}else{return[1,"\\"]}},"![":function n(U){var S=U.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(S){if(S[2]&&S[2][0]=="<"&&S[2][S[2].length-1]==">"){S[2]=S[2].substring(1,S[2].length-1)}S[2]=this.dialect.inline.__call__.call(this,S[2],/\\/)[0];var T={alt:S[1],href:S[2]||""};if(S[4]!==undefined){T.title=S[4]}return[S[0].length,["img",T]]}S=U.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/);if(S){return[S[0].length,["img_ref",{alt:S[1],ref:S[2].toLowerCase(),original:S[0]}]]}return[2,"!["]},"[":function o(ac){var Z=String(ac);var X=e.DialectHelpers.inline_until_char.call(this,ac.substr(1),"]");if(!X){return[1,"["]}var aa=1+X[0],T=X[1],Y,ab;ac=ac.substr(aa);var V=ac.match(/^\s*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(V){var S=V[1];aa+=V[0].length;if(S&&S[0]=="<"&&S[S.length-1]==">"){S=S.substring(1,S.length-1)}if(!V[3]){var U=1;for(var W=0;W<S.length;W++){switch(S[W]){case"(":U++;break;case")":if(--U==0){aa-=S.length-W;S=S.substring(0,W)}break}}}S=this.dialect.inline.__call__.call(this,S,/\\/)[0];ab={href:S||""};if(V[3]!==undefined){ab.title=V[3]}Y=["link",ab].concat(T);return[aa,Y]}V=ac.match(/^\s*\[(.*?)\]/);if(V){aa+=V[0].length;ab={ref:(V[1]||String(T)).toLowerCase(),original:Z.substr(0,aa)};Y=["link_ref",ab].concat(T);return[aa,Y]}if(T.length==1&&typeof T[0]=="string"){ab={ref:T[0].toLowerCase(),original:Z.substr(0,aa)};Y=["link_ref",ab,T[0]];return[aa,Y]}return[1,"["]},"<":function w(T){var S;if((S=T.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))!=null){if(S[3]){return[S[0].length,["link",{href:"mailto:"+S[3]},S[3]]]}else{if(S[2]=="mailto"){return[S[0].length,["link",{href:S[1]},S[1].substr("mailto:".length)]]}else{return[S[0].length,["link",{href:S[1]},S[1]]]}}}return[1,"<"]},"`":function z(T){var S=T.match(/(`+)(([\s\S]*?)\1)/);if(S&&S[2]){return[S[1].length+S[2].length,["inlinecode",S[3]]]}else{return[1,"`"]}},"  \n":function P(S){return[3,["linebreak"]]}};function G(S,V){var U=S+"_state",W=S=="strong"?"em_state":"strong_state";function T(X){this.len_after=X;this.name="close_"+V}return function(ae,ad){if(this[U][0]==V){this[U].shift();return[ae.length,new T(ae.length-V.length)]}else{var X=this[W].slice(),ac=this[U].slice();this[U].unshift(V);var Z=this.processInline(ae.substr(V.length));var aa=Z[Z.length-1];var Y=this[U].shift();if(aa instanceof T){Z.pop();var ab=ae.length-aa.len_after;return[ab,[S].concat(Z)]}else{this[W]=X;this[U]=ac;return[V.length,V]}}}}e.dialects.Gruber.inline["**"]=G("strong","**");e.dialects.Gruber.inline.__=G("strong","__");e.dialects.Gruber.inline["*"]=G("em","*");e.dialects.Gruber.inline._=G("em","_");e.buildBlockOrder=function(U){var S=[];for(var T in U){if(T=="__order__"||T=="__call__"){continue}S.push(T)}U.__order__=S};e.buildInlinePatterns=function(W){var V=[];for(var T in W){if(T.match(/^__.*__$/)){continue}var S=T.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");V.push(T.length==1?S:"(?:"+S+")")}V=V.join("|");W.__patterns__=V;var U=W.__call__;W.__call__=function(Y,X){if(X!=undefined){return U.call(this,Y,X)}else{return U.call(this,Y,V)}}};e.DialectHelpers={};e.DialectHelpers.inline_until_char=function(W,V){var U=0,S=[];while(true){if(W[U]==V){U++;return[U,S]}if(U>=W.length){return null}var T=this.dialect.inline.__oneElement__.call(this,W.substr(U));U+=T[0];S.push.apply(S,T.slice(1))}};e.subclassDialect=function(U){function S(){}S.prototype=U.block;function T(){}T.prototype=U.inline;return{block:new S(),inline:new T()}};e.buildBlockOrder(e.dialects.Gruber.block);e.buildInlinePatterns(e.dialects.Gruber.inline);e.dialects.Maruku=e.subclassDialect(e.dialects.Gruber);e.dialects.Maruku.processMetaHash=function l(V){var W=q(V),S={};for(var T=0;T<W.length;++T){if(/^#/.test(W[T])){S.id=W[T].substring(1)}else{if(/^\./.test(W[T])){if(S["class"]){S["class"]=S["class"]+W[T].replace(/./," ")}else{S["class"]=W[T].substring(1)}}else{if(/\=/.test(W[T])){var U=W[T].split(/\=/);S[U[0]]=U[1]}}}}return S};function q(U){var W=U.split(""),V=[""],S=false;while(W.length){var T=W.shift();switch(T){case" ":if(S){V[V.length-1]+=T}else{V.push("")}break;case"'":case'"':S=!S;break;case"\\":T=W.shift();default:V[V.length-1]+=T;break}}return V}e.dialects.Maruku.block.document_meta=function j(X,U){if(X.lineNumber>1){return undefined}if(!X.match(/^(?:\w+:.*\n)*\w+:.*$/)){return undefined}if(!D(this.tree)){this.tree.splice(1,0,{})}var W=X.split(/\n/);for(p in W){var S=W[p].match(/(\w+):\s*(.*)$/),T=S[1].toLowerCase(),V=S[2];this.tree[1][T]=V}return[]};e.dialects.Maruku.block.block_meta=function F(Z,W){var V=Z.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!V){return undefined}var U=this.dialect.processMetaHash(V[2]);var Y;if(V[1]===""){var X=this.tree[this.tree.length-1];Y=D(X);if(typeof X==="string"){return undefined}if(!Y){Y={};X.splice(1,0,Y)}for(a in U){Y[a]=U[a]}return[]}var T=Z.replace(/\n.*$/,""),S=this.processBlock(T,[]);Y=D(S[0]);if(!Y){Y={};S[0].splice(1,0,Y)}for(a in U){Y[a]=U[a]}return S};e.dialects.Maruku.block.definition_list=function O(U,X){var Z=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,Y=["dl"],W;if((T=U.match(Z))){var S=[U];while(X.length&&Z.exec(X[0])){S.push(X.shift())}for(var aa=0;aa<S.length;++aa){var T=S[aa].match(Z),V=T[1].replace(/\n$/,"").split(/\n/),ab=T[2].split(/\n:\s+/);for(W=0;W<V.length;++W){Y.push(["dt",V[W]])}for(W=0;W<ab.length;++W){Y.push(["dd"].concat(this.processInline(ab[W].replace(/(\n)\s+/,"$1"))))}}}else{return undefined}return[Y]};e.dialects.Maruku.inline["{:"]=function C(Z,X,V){if(!V.length){return[2,"{:"]}var W=V[V.length-1];if(typeof W==="string"){return[2,"{:"]}var T=Z.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!T){return[2,"{:"]}var Y=this.dialect.processMetaHash(T[1]),S=D(W);if(!S){S={};W.splice(1,0,S)}for(var U in Y){S[U]=Y[U]}return[T[0].length,""]};e.buildBlockOrder(e.dialects.Maruku.block);e.buildInlinePatterns(e.dialects.Maruku.inline);var B=Array.isArray||function(S){return Object.prototype.toString.call(S)=="[object Array]"};var c;if(Array.prototype.forEach){c=function(T,S,U){return T.forEach(S,U)}}else{c=function(T,S,V){for(var U=0;U<T.length;U++){S.call(V||T,T[U],U,T)}}}function D(S){return B(S)&&S.length>1&&typeof S[1]==="object"&&!(B(S[1]))?S[1]:undefined}L.renderJsonML=function(U,S){S=S||{};S.root=S.root||false;var T=[];if(S.root){T.push(R(U))}else{U.shift();if(U.length&&typeof U[0]==="object"&&!(U[0] instanceof Array)){U.shift()}while(U.length){T.push(R(U.shift()))}}return T.join("\n\n")};function b(S){return S.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function R(X){if(typeof X==="string"){return b(X)}var S=X.shift(),U={},V=[];if(X.length&&typeof X[0]==="object"&&!(X[0] instanceof Array)){U=X.shift()}while(X.length){V.push(arguments.callee(X.shift()))}var W="";for(var T in U){W+=" "+T+'="'+b(U[T])+'"'}if(S=="img"||S=="br"||S=="hr"){return"<"+S+W+"/>"}else{return"<"+S+W+">"+V.join("")+"</"+S+">"}}function i(aa,X,Z){var U;Z=Z||{};var W=aa.slice(0);if(typeof Z.preprocessTreeNode==="function"){W=Z.preprocessTreeNode(W,X)}var Y=D(W);if(Y){W[1]={};for(U in Y){W[1][U]=Y[U]}Y=W[1]}if(typeof W==="string"){return W}switch(W[0]){case"header":W[0]="h"+W[1].level;delete W[1].level;break;case"bulletlist":W[0]="ul";break;case"numberlist":W[0]="ol";break;case"listitem":W[0]="li";break;case"para":W[0]="p";break;case"markdown":W[0]="html";if(Y){delete Y.references}break;case"code_block":W[0]="pre";U=Y?2:1;var S=["code"];S.push.apply(S,W.splice(U));W[U]=S;break;case"inlinecode":W[0]="code";break;case"img":W[1].src=W[1].href;delete W[1].href;break;case"linebreak":W[0]="br";break;case"link":W[0]="a";break;case"link_ref":W[0]="a";var T=X[Y.ref];if(T){delete Y.ref;Y.href=T.href;if(T.title){Y.title=T.title}delete Y.original}else{return Y.original}break;case"img_ref":W[0]="img";var T=X[Y.ref];if(T){delete Y.ref;Y.src=T.href;if(T.title){Y.title=T.title}delete Y.original}else{return Y.original}break}U=1;if(Y){for(var V in W[1]){U=2}if(U===1){W.splice(U,1)}}for(;U<W.length;++U){W[U]=arguments.callee(W[U],X,Z)}return W}function r(T){var S=D(T)?2:1;while(S<T.length){if(typeof T[S]==="string"){if(S+1<T.length&&typeof T[S+1]==="string"){T[S]+=T.splice(S+1,1)[0]}else{++S}}else{arguments.callee(T[S]);++S}}}})((function(){if(typeof exports==="undefined"){window.markdown={};return window.markdown}else{return exports}})());shortcut={all_shortcuts:{},add:function(c,i,e){var h={type:"keydown",propagate:false,disable_in_input:false,target:document,keycode:false};if(!e){e=h}else{for(var b in h){if(typeof e[b]=="undefined"){e[b]=h[b]}}}var g=e.target;if(typeof e.target=="string"){g=document.getElementById(e.target)}var d=this;c=c.toLowerCase();var f=function(o){o=o||window.event;if(e.disable_in_input){var l;if(o.target){l=o.target}else{if(o.srcElement){l=o.srcElement}}if(l.nodeType==3){l=l.parentNode}if(l.tagName=="INPUT"||l.tagName=="TEXTAREA"){return}}if(o.keyCode){code=o.keyCode}else{if(o.which){code=o.which}}var n=String.fromCharCode(code).toLowerCase();if(code==188){n=","}if(code==190){n="."}var t=c.split("+");var s=0;var q={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};var m={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var r={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(o.ctrlKey){r.ctrl.pressed=true}if(o.shiftKey){r.shift.pressed=true}if(o.altKey){r.alt.pressed=true}if(o.metaKey){r.meta.pressed=true}for(var j=0;k=t[j],j<t.length;j++){if(k=="ctrl"||k=="control"){s++;r.ctrl.wanted=true}else{if(k=="shift"){s++;r.shift.wanted=true}else{if(k=="alt"){s++;r.alt.wanted=true}else{if(k=="meta"){s++;r.meta.wanted=true}else{if(k.length>1){if(m[k]==code){s++}}else{if(e.keycode){if(e.keycode==code){s++}}else{if(n==k){s++}else{if(q[n]&&o.shiftKey){n=q[n];if(n==k){s++}}}}}}}}}}if(s==t.length&&r.ctrl.pressed==r.ctrl.wanted&&r.shift.pressed==r.shift.wanted&&r.alt.pressed==r.alt.wanted&&r.meta.pressed==r.meta.wanted){i(o);if(!e.propagate){o.cancelBubble=true;o.returnValue=false;if(o.stopPropagation){o.stopPropagation();o.preventDefault()}return false}}};this.all_shortcuts[c]={callback:f,target:g,event:e.type};if(g.addEventListener){g.addEventListener(e.type,f,false)}else{if(g.attachEvent){g.attachEvent("on"+e.type,f)}else{g["on"+e.type]=f}}},remove:function(b){b=b.toLowerCase();var e=this.all_shortcuts[b];delete (this.all_shortcuts[b]);if(!e){return}var c=e.event;var d=e.target;var f=e.callback;if(d.detachEvent){d.detachEvent("on"+c,f)}else{if(d.removeEventListener){d.removeEventListener(c,f,false)}else{d["on"+c]=false}}}}(function(e){e.fn.tabby=function(g){var h=e.extend({},e.fn.tabby.defaults,g);var i=e.fn.tabby.pressed;return this.each(function(){$this=e(this);var j=e.meta?e.extend({},h,$this.data()):h;$this.bind("keydown",function(m){var l=e.fn.tabby.catch_kc(m);if(16==l){i.shft=true}if(17==l){i.ctrl=true;setTimeout("$.fn.tabby.pressed.ctrl = false;",1000)}if(18==l){i.alt=true;setTimeout("$.fn.tabby.pressed.alt = false;",1000)}if(9==l&&!i.ctrl&&!i.alt){m.preventDefault;i.last=l;setTimeout("$.fn.tabby.pressed.last = null;",0);f(e(m.target).get(0),i.shft,j);return false}}).bind("keyup",function(l){if(16==e.fn.tabby.catch_kc(l)){i.shft=false}}).bind("blur",function(l){if(9==i.last){e(l.target).one("focus",function(m){i.last=null}).get(0).focus()}})})};e.fn.tabby.catch_kc=function(g){return g.keyCode?g.keyCode:g.charCode?g.charCode:g.which};e.fn.tabby.pressed={shft:false,ctrl:false,alt:false,last:null};function c(g){if(window.console&&window.console.log){window.console.log("textarea count: "+g.size())}}function f(j,i,h){var g=j.scrollTop;if(j.setSelectionRange){b(j,i,h)}else{if(document.selection){d(j,i,h)}}j.scrollTop=g}e.fn.tabby.defaults={tabString:String.fromCharCode(9)};function b(l,g,x){var w=l.selectionStart;var u=l.selectionEnd;if(w==u){if(g){if("\t"==l.value.substring(w-x.tabString.length,w)){l.value=l.value.substring(0,w-x.tabString.length)+l.value.substring(w);l.focus();l.setSelectionRange(w-x.tabString.length,w-x.tabString.length)}else{if("\t"==l.value.substring(w,w+x.tabString.length)){l.value=l.value.substring(0,w)+l.value.substring(w+x.tabString.length);l.focus();l.setSelectionRange(w,w)}}}else{l.value=l.value.substring(0,w)+x.tabString+l.value.substring(w);l.focus();l.setSelectionRange(w+x.tabString.length,w+x.tabString.length)}}else{var y=l.value.split("\n");var v=new Array();var n=0;var j=0;var h=false;for(var r in y){j=n+y[r].length;v.push({start:n,end:j,selected:(n<=w&&j>w)||(j>=u&&n<u)||(n>w&&j<u)});n=j+1}var m=0;for(var r in v){if(v[r].selected){var t=v[r].start+m;if(g&&x.tabString==l.value.substring(t,t+x.tabString.length)){l.value=l.value.substring(0,t)+l.value.substring(t+x.tabString.length);m-=x.tabString.length}else{if(!g){l.value=l.value.substring(0,t)+x.tabString+l.value.substring(t);m+=x.tabString.length}}}}l.focus();var s=w+((m>0)?x.tabString.length:(m<0)?-x.tabString.length:0);var q=u+m;l.setSelectionRange(s,q)}}function d(t,z,g){var s=document.selection.createRange();if(t==s.parentElement()){if(""==s.text){if(z){var n=s.getBookmark();s.moveStart("character",-g.tabString.length);if(g.tabString==s.text){s.text=""}else{s.moveToBookmark(n);s.moveEnd("character",g.tabString.length);if(g.tabString==s.text){s.text=""}}s.collapse(true);s.select()}else{s.text=g.tabString;s.collapse(false);s.select()}}else{var m=s.text;var r=m.length;var x=m.split("\r\n");var C=document.body.createTextRange();C.moveToElementText(t);C.setEndPoint("EndToStart",s);var q=C.text;var A=q.split("\r\n");var u=q.length;var B=document.body.createTextRange();B.moveToElementText(t);B.setEndPoint("StartToEnd",s);var y=B.text;var h=document.body.createTextRange();h.moveToElementText(t);h.setEndPoint("StartToEnd",C);var v=h.text;var j=e(t).html();e("#r3").text(u+" + "+r+" + "+y.length+" = "+j.length);if((u+v.length)<j.length){A.push("");u+=2;if(z&&g.tabString==x[0].substring(0,g.tabString.length)){x[0]=x[0].substring(g.tabString.length)}else{if(!z){x[0]=g.tabString+x[0]}}}else{if(z&&g.tabString==A[A.length-1].substring(0,g.tabString.length)){A[A.length-1]=A[A.length-1].substring(g.tabString.length)}else{if(!z){A[A.length-1]=g.tabString+A[A.length-1]}}}for(var w=1;w<x.length;w++){if(z&&g.tabString==x[w].substring(0,g.tabString.length)){x[w]=x[w].substring(g.tabString.length)}else{if(!z){x[w]=g.tabString+x[w]}}}if(1==A.length&&0==u){if(z&&g.tabString==x[0].substring(0,g.tabString.length)){x[0]=x[0].substring(g.tabString.length)}else{if(!z){x[0]=g.tabString+x[0]}}}if((u+r+y.length)<j.length){x.push("");r+=2}C.text=A.join("\r\n");s.text=x.join("\r\n");var l=document.body.createTextRange();l.moveToElementText(t);if(0<u){l.setEndPoint("StartToEnd",C)}else{l.setEndPoint("StartToStart",C)}l.setEndPoint("EndToEnd",s);l.select()}}}})(jQuery);(function(L){var e=L.Markdown=function e(S){switch(typeof S){case"undefined":this.dialect=e.dialects.Gruber;break;case"object":this.dialect=S;break;default:if(S in e.dialects){this.dialect=e.dialects[S]}else{throw new Error("Unknown Markdown dialect '"+String(S)+"'")}break}this.em_state=[];this.strong_state=[];this.debug_indent=""};L.parse=function(U,S){var T=new e(S);return T.toTree(U)};L.toHTML=function v(V,U,T){var S=L.toHTMLTree(V,U,T);return L.renderJsonML(S)};L.toHTMLTree=function x(T,X,V){if(typeof T==="string"){T=this.parse(T,X)}var U=D(T),S={};if(U&&U.references){S=U.references}var W=i(T,S,V);r(W);return W};function f(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function I(){var S=require("util");return"Markdown.mk_block( "+S.inspect(this.toString())+", "+S.inspect(this.trailing)+", "+S.inspect(this.lineNumber)+" )"}var g=e.mk_block=function(V,T,S){if(arguments.length==1){T="\n\n"}var U=new String(V);U.trailing=T;U.inspect=I;U.toSource=f;if(S!=undefined){U.lineNumber=S}return U};function H(T){var U=0,S=-1;while((S=T.indexOf("\n",S+1))!==-1){U++}return U}e.prototype.split_blocks=function A(U,X){var V=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,W=[],S;var T=1;if((S=/^(\s*\n)/.exec(U))!=null){T+=H(S[0]);V.lastIndex=S[0].length}while((S=V.exec(U))!==null){W.push(g(S[1],S[2],T));T+=H(S[0])}return W};e.prototype.processBlock=function N(X,W){var T=this.dialect.block,S=T.__order__;if("__call__" in T){return T.__call__.call(this,X,W)}for(var V=0;V<S.length;V++){var U=T[S[V]].call(this,X,W);if(U){if(!B(U)||(U.length>0&&!(B(U[0])))){this.debug(S[V],"didn't return a proper array")}return U}}return[]};e.prototype.processInline=function h(S){return this.dialect.inline.__call__.call(this,String(S))};e.prototype.toTree=function J(U,T){var V=U instanceof Array?U:this.split_blocks(U);var W=this.tree;try{this.tree=T||this.tree||["markdown"];V:while(V.length){var S=this.processBlock(V.shift(),V);if(!S.length){continue V}this.tree.push.apply(this.tree,S)}return this.tree}finally{if(T){this.tree=W}}};e.prototype.debug=function(){var S=Array.prototype.slice.call(arguments);S.unshift(this.debug_indent);if(typeof print!=="undefined"){print.apply(print,S)}if(typeof console!=="undefined"&&typeof console.log!=="undefined"){console.log.apply(null,S)}};e.prototype.loop_re_over_block=function(V,W,U){var T,S=W.valueOf();while(S.length&&(T=V.exec(S))!=null){S=S.substr(T[0].length);U.call(this,T)}return S};e.dialects={};e.dialects.Gruber={block:{atxHeader:function t(U,T){var S=U.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!S){return undefined}var V=["header",{level:S[1].length}];Array.prototype.push.apply(V,this.processInline(S[2]));if(S[0].length<U.length){T.unshift(g(U.substr(S[0].length),U.trailing,U.lineNumber+2))}return[V]},setextHeader:function y(U,T){var S=U.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!S){return undefined}var W=(S[2]==="=")?1:2;var V=["header",{level:W},S[1]];if(S[0].length<U.length){T.unshift(g(U.substr(S[0].length),U.trailing,U.lineNumber+2))}return[V]},code:function m(X,W){var U=[],V=/^(?: {0,3}\t| {4})(.*)\n?/,T;if(!X.match(V)){return undefined}block_search:do{var S=this.loop_re_over_block(V,X.valueOf(),function(Y){U.push(Y[1])});if(S.length){W.unshift(g(S,X.trailing));break block_search}else{if(W.length){if(!W[0].match(V)){break block_search}U.push(X.trailing.replace(/[^\n]/g,"").substring(2));X=W.shift()}else{break block_search}}}while(true);return[["code_block",U.join("\n")]]},horizRule:function Q(U,T){var S=U.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!S){return undefined}var V=[["hr"]];if(S[1]){V.unshift.apply(V,this.processBlock(S[1],[]))}if(S[3]){T.unshift(g(S[3]))}return V},lists:(function(){var V="[*+-]|\\d+\\.",T=/[*+-]/,ab=/\d+\./,Z=new RegExp("^( {0,3})("+V+")[ \t]+"),U="(?: {0,3}\\t| {4})";function W(ac){return new RegExp("(?:^("+U+"{0,"+ac+"} {0,3})("+V+")\\s+)|(^"+U+"{0,"+(ac-1)+"}[ ]{0,4})")}function S(ac){return ac.replace(/ {0,3}\t/g,"    ")}function aa(ad,aj,ai,ae){if(aj){ad.push(["para"].concat(ai));return}var ac=ad[ad.length-1] instanceof Array&&ad[ad.length-1][0]=="para"?ad[ad.length-1]:ad;if(ae&&ad.length>1){ai.unshift(ae)}for(var ag=0;ag<ai.length;ag++){var ah=ai[ag],af=typeof ah=="string";if(af&&ac.length>1&&typeof ac[ac.length-1]=="string"){ac[ac.length-1]+=ah}else{ac.push(ah)}}}function X(ai,ah){var ag=new RegExp("^("+U+"{"+ai+"}.*?\\n?)*$"),af=new RegExp("^"+U+"{"+ai+"}","gm"),ae=[];while(ah.length>0){if(ag.exec(ah[0])){var ad=ah.shift(),ac=ad.replace(af,"");ae.push(g(ac,ad.trailing,ad.lineNumber))}break}return ae}function Y(af,ae,ac){var ah=af.list;var ag=ah[ah.length-1];if(ag[1] instanceof Array&&ag[1][0]=="para"){return}if(ae+1==ac.length){ag.push(["para"].concat(ag.splice(1)))}else{var ad=ag.pop();ag.push(["para"].concat(ag.splice(1)),ad)}}return function(ah,an){var ao=ah.match(Z);if(!ao){return undefined}function af(ay){var az=T.exec(ay[2])?["bulletlist"]:["numberlist"];ag.push({list:az,indent:ay[1]});return az}var ag=[],at=af(ao),ae,am=false,ax=[ag[0].list],aq;loose_search:while(true){var ac=ah.split(/(?=\n)/);var au="";tight_search:for(var av=0;av<ac.length;av++){var ad="",ap=ac[av].replace(/^\n/,function(ay){ad=ay;return""});var ak=W(ag.length);ao=ap.match(ak);if(ao[1]!==undefined){if(au.length){aa(ae,am,this.processInline(au),ad);am=false;au=""}ao[1]=S(ao[1]);var ai=Math.floor(ao[1].length/4)+1;if(ai>ag.length){at=af(ao);ae.push(at);ae=at[1]=["listitem"]}else{var al=false;for(aq=0;aq<ag.length;aq++){if(ag[aq].indent!=ao[1]){continue}at=ag[aq].list;ag.splice(aq+1);al=true;break}if(!al){ai++;if(ai<=ag.length){ag.splice(ai);at=ag[ai-1].list}else{at=af(ao);ae.push(at)}}ae=["listitem"];at.push(ae)}ad=""}if(ap.length>ao[0].length){au+=ad+ap.substr(ao[0].length)}}if(au.length){aa(ae,am,this.processInline(au),ad);am=false;au=""}var ar=X(ag.length,an);if(ar.length>0){c(ag,Y,this);ae.push.apply(ae,this.toTree(ar,[]))}var aj=an[0]&&an[0].valueOf()||"";if(aj.match(Z)||aj.match(/^ /)){ah=an.shift();var aw=this.dialect.block.horizRule(ah,an);if(aw){ax.push.apply(ax,aw);break}c(ag,Y,this);am=true;continue loose_search}break}return ax}})(),blockquote:function M(X,V){if(!X.match(/^>/m)){return undefined}var Z=[];if(X[0]!=">"){var T=X.split(/\n/),W=[];while(T.length&&T[0][0]!=">"){W.push(T.shift())}X=T.join("\n");Z.push.apply(Z,this.processBlock(W.join("\n"),[]))}while(V.length&&V[0][0]==">"){var S=V.shift();X=new String(X+X.trailing+S);X.trailing=S.trailing}var U=X.replace(/^> ?/gm,""),Y=this.tree;Z.push(this.toTree(U,["blockquote"]));return Z},referenceDefn:function K(W,V){var U=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!W.match(U)){return undefined}if(!D(this.tree)){this.tree.splice(1,0,{})}var T=D(this.tree);if(T.references===undefined){T.references={}}var S=this.loop_re_over_block(U,W,function(X){if(X[2]&&X[2][0]=="<"&&X[2][X[2].length-1]==">"){X[2]=X[2].substring(1,X[2].length-1)}var Y=T.references[X[1].toLowerCase()]={href:X[2]};if(X[4]!==undefined){Y.title=X[4]}else{if(X[5]!==undefined){Y.title=X[5]}}});if(S.length){V.unshift(g(S,W.trailing))}return[]},para:function E(T,S){return[["para"].concat(this.processInline(T))]}}};e.dialects.Gruber.inline={__oneElement__:function d(X,T,W){var S,U,Y=0;T=T||this.dialect.inline.__patterns__;var V=new RegExp("([\\s\\S]*?)("+(T.source||T)+")");S=V.exec(X);if(!S){return[X.length,X]}else{if(S[1]){return[S[1].length,S[1]]}}var U;if(S[2] in this.dialect.inline){U=this.dialect.inline[S[2]].call(this,X.substr(S.index),S,W||[])}U=U||[S[2].length,S[2]];return U},__call__:function s(W,U){var S=[],T;function V(X){if(typeof X=="string"&&typeof S[S.length-1]=="string"){S[S.length-1]+=X}else{S.push(X)}}while(W.length>0){T=this.dialect.inline.__oneElement__.call(this,W,U,S);W=W.substr(T.shift());c(T,V)}return S},"]":function(){},"}":function(){},"\\":function u(S){if(S.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)){return[2,S[1]]}else{return[1,"\\"]}},"![":function n(U){var S=U.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(S){if(S[2]&&S[2][0]=="<"&&S[2][S[2].length-1]==">"){S[2]=S[2].substring(1,S[2].length-1)}S[2]=this.dialect.inline.__call__.call(this,S[2],/\\/)[0];var T={alt:S[1],href:S[2]||""};if(S[4]!==undefined){T.title=S[4]}return[S[0].length,["img",T]]}S=U.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/);if(S){return[S[0].length,["img_ref",{alt:S[1],ref:S[2].toLowerCase(),original:S[0]}]]}return[2,"!["]},"[":function o(ac){var Z=String(ac);var X=e.DialectHelpers.inline_until_char.call(this,ac.substr(1),"]");if(!X){return[1,"["]}var aa=1+X[0],T=X[1],Y,ab;ac=ac.substr(aa);var V=ac.match(/^\s*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(V){var S=V[1];aa+=V[0].length;if(S&&S[0]=="<"&&S[S.length-1]==">"){S=S.substring(1,S.length-1)}if(!V[3]){var U=1;for(var W=0;W<S.length;W++){switch(S[W]){case"(":U++;break;case")":if(--U==0){aa-=S.length-W;S=S.substring(0,W)}break}}}S=this.dialect.inline.__call__.call(this,S,/\\/)[0];ab={href:S||""};if(V[3]!==undefined){ab.title=V[3]}Y=["link",ab].concat(T);return[aa,Y]}V=ac.match(/^\s*\[(.*?)\]/);if(V){aa+=V[0].length;ab={ref:(V[1]||String(T)).toLowerCase(),original:Z.substr(0,aa)};Y=["link_ref",ab].concat(T);return[aa,Y]}if(T.length==1&&typeof T[0]=="string"){ab={ref:T[0].toLowerCase(),original:Z.substr(0,aa)};Y=["link_ref",ab,T[0]];return[aa,Y]}return[1,"["]},"<":function w(T){var S;if((S=T.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))!=null){if(S[3]){return[S[0].length,["link",{href:"mailto:"+S[3]},S[3]]]}else{if(S[2]=="mailto"){return[S[0].length,["link",{href:S[1]},S[1].substr("mailto:".length)]]}else{return[S[0].length,["link",{href:S[1]},S[1]]]}}}return[1,"<"]},"`":function z(T){var S=T.match(/(`+)(([\s\S]*?)\1)/);if(S&&S[2]){return[S[1].length+S[2].length,["inlinecode",S[3]]]}else{return[1,"`"]}},"  \n":function P(S){return[3,["linebreak"]]}};function G(S,V){var U=S+"_state",W=S=="strong"?"em_state":"strong_state";function T(X){this.len_after=X;this.name="close_"+V}return function(ae,ad){if(this[U][0]==V){this[U].shift();return[ae.length,new T(ae.length-V.length)]}else{var X=this[W].slice(),ac=this[U].slice();this[U].unshift(V);var Z=this.processInline(ae.substr(V.length));var aa=Z[Z.length-1];var Y=this[U].shift();if(aa instanceof T){Z.pop();var ab=ae.length-aa.len_after;return[ab,[S].concat(Z)]}else{this[W]=X;this[U]=ac;return[V.length,V]}}}}e.dialects.Gruber.inline["**"]=G("strong","**");e.dialects.Gruber.inline.__=G("strong","__");e.dialects.Gruber.inline["*"]=G("em","*");e.dialects.Gruber.inline._=G("em","_");e.buildBlockOrder=function(U){var S=[];for(var T in U){if(T=="__order__"||T=="__call__"){continue}S.push(T)}U.__order__=S};e.buildInlinePatterns=function(W){var V=[];for(var T in W){if(T.match(/^__.*__$/)){continue}var S=T.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");V.push(T.length==1?S:"(?:"+S+")")}V=V.join("|");W.__patterns__=V;var U=W.__call__;W.__call__=function(Y,X){if(X!=undefined){return U.call(this,Y,X)}else{return U.call(this,Y,V)}}};e.DialectHelpers={};e.DialectHelpers.inline_until_char=function(W,V){var U=0,S=[];while(true){if(W[U]==V){U++;return[U,S]}if(U>=W.length){return null}var T=this.dialect.inline.__oneElement__.call(this,W.substr(U));U+=T[0];S.push.apply(S,T.slice(1))}};e.subclassDialect=function(U){function S(){}S.prototype=U.block;function T(){}T.prototype=U.inline;return{block:new S(),inline:new T()}};e.buildBlockOrder(e.dialects.Gruber.block);e.buildInlinePatterns(e.dialects.Gruber.inline);e.dialects.Maruku=e.subclassDialect(e.dialects.Gruber);e.dialects.Maruku.processMetaHash=function l(V){var W=q(V),S={};for(var T=0;T<W.length;++T){if(/^#/.test(W[T])){S.id=W[T].substring(1)}else{if(/^\./.test(W[T])){if(S["class"]){S["class"]=S["class"]+W[T].replace(/./," ")}else{S["class"]=W[T].substring(1)}}else{if(/\=/.test(W[T])){var U=W[T].split(/\=/);S[U[0]]=U[1]}}}}return S};function q(U){var W=U.split(""),V=[""],S=false;while(W.length){var T=W.shift();switch(T){case" ":if(S){V[V.length-1]+=T}else{V.push("")}break;case"'":case'"':S=!S;break;case"\\":T=W.shift();default:V[V.length-1]+=T;break}}return V}e.dialects.Maruku.block.document_meta=function j(X,U){if(X.lineNumber>1){return undefined}if(!X.match(/^(?:\w+:.*\n)*\w+:.*$/)){return undefined}if(!D(this.tree)){this.tree.splice(1,0,{})}var W=X.split(/\n/);for(p in W){var S=W[p].match(/(\w+):\s*(.*)$/),T=S[1].toLowerCase(),V=S[2];this.tree[1][T]=V}return[]};e.dialects.Maruku.block.block_meta=function F(Z,W){var V=Z.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!V){return undefined}var U=this.dialect.processMetaHash(V[2]);var Y;if(V[1]===""){var X=this.tree[this.tree.length-1];Y=D(X);if(typeof X==="string"){return undefined}if(!Y){Y={};X.splice(1,0,Y)}for(a in U){Y[a]=U[a]}return[]}var T=Z.replace(/\n.*$/,""),S=this.processBlock(T,[]);Y=D(S[0]);if(!Y){Y={};S[0].splice(1,0,Y)}for(a in U){Y[a]=U[a]}return S};e.dialects.Maruku.block.definition_list=function O(U,X){var Z=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,Y=["dl"],W;if((T=U.match(Z))){var S=[U];while(X.length&&Z.exec(X[0])){S.push(X.shift())}for(var aa=0;aa<S.length;++aa){var T=S[aa].match(Z),V=T[1].replace(/\n$/,"").split(/\n/),ab=T[2].split(/\n:\s+/);for(W=0;W<V.length;++W){Y.push(["dt",V[W]])}for(W=0;W<ab.length;++W){Y.push(["dd"].concat(this.processInline(ab[W].replace(/(\n)\s+/,"$1"))))}}}else{return undefined}return[Y]};e.dialects.Maruku.inline["{:"]=function C(Z,X,V){if(!V.length){return[2,"{:"]}var W=V[V.length-1];if(typeof W==="string"){return[2,"{:"]}var T=Z.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!T){return[2,"{:"]}var Y=this.dialect.processMetaHash(T[1]),S=D(W);if(!S){S={};W.splice(1,0,S)}for(var U in Y){S[U]=Y[U]}return[T[0].length,""]};e.buildBlockOrder(e.dialects.Maruku.block);e.buildInlinePatterns(e.dialects.Maruku.inline);var B=Array.isArray||function(S){return Object.prototype.toString.call(S)=="[object Array]"};var c;if(Array.prototype.forEach){c=function(T,S,U){return T.forEach(S,U)}}else{c=function(T,S,V){for(var U=0;U<T.length;U++){S.call(V||T,T[U],U,T)}}}function D(S){return B(S)&&S.length>1&&typeof S[1]==="object"&&!(B(S[1]))?S[1]:undefined}L.renderJsonML=function(U,S){S=S||{};S.root=S.root||false;var T=[];if(S.root){T.push(R(U))}else{U.shift();if(U.length&&typeof U[0]==="object"&&!(U[0] instanceof Array)){U.shift()}while(U.length){T.push(R(U.shift()))}}return T.join("\n\n")};function b(S){return S.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function R(X){if(typeof X==="string"){return b(X)}var S=X.shift(),U={},V=[];if(X.length&&typeof X[0]==="object"&&!(X[0] instanceof Array)){U=X.shift()}while(X.length){V.push(arguments.callee(X.shift()))}var W="";for(var T in U){W+=" "+T+'="'+b(U[T])+'"'}if(S=="img"||S=="br"||S=="hr"){return"<"+S+W+"/>"}else{return"<"+S+W+">"+V.join("")+"</"+S+">"}}function i(aa,X,Z){var U;Z=Z||{};var W=aa.slice(0);if(typeof Z.preprocessTreeNode==="function"){W=Z.preprocessTreeNode(W,X)}var Y=D(W);if(Y){W[1]={};for(U in Y){W[1][U]=Y[U]}Y=W[1]}if(typeof W==="string"){return W}switch(W[0]){case"header":W[0]="h"+W[1].level;delete W[1].level;break;case"bulletlist":W[0]="ul";break;case"numberlist":W[0]="ol";break;case"listitem":W[0]="li";break;case"para":W[0]="p";break;case"markdown":W[0]="html";if(Y){delete Y.references}break;case"code_block":W[0]="pre";U=Y?2:1;var S=["code"];S.push.apply(S,W.splice(U));W[U]=S;break;case"inlinecode":W[0]="code";break;case"img":W[1].src=W[1].href;delete W[1].href;break;case"linebreak":W[0]="br";break;case"link":W[0]="a";break;case"link_ref":W[0]="a";var T=X[Y.ref];if(T){delete Y.ref;Y.href=T.href;if(T.title){Y.title=T.title}delete Y.original}else{return Y.original}break;case"img_ref":W[0]="img";var T=X[Y.ref];if(T){delete Y.ref;Y.src=T.href;if(T.title){Y.title=T.title}delete Y.original}else{return Y.original}break}U=1;if(Y){for(var V in W[1]){U=2}if(U===1){W.splice(U,1)}}for(;U<W.length;++U){W[U]=arguments.callee(W[U],X,Z)}return W}function r(T){var S=D(T)?2:1;while(S<T.length){if(typeof T[S]==="string"){if(S+1<T.length&&typeof T[S+1]==="string"){T[S]+=T.splice(S+1,1)[0]}else{++S}}else{arguments.callee(T[S]);++S}}}})((function(){if(typeof exports==="undefined"){window.markdown={};return window.markdown}else{return exports}})());shortcut={all_shortcuts:{},add:function(c,i,e){var h={type:"keydown",propagate:false,disable_in_input:false,target:document,keycode:false};if(!e){e=h}else{for(var b in h){if(typeof e[b]=="undefined"){e[b]=h[b]}}}var g=e.target;if(typeof e.target=="string"){g=document.getElementById(e.target)}var d=this;c=c.toLowerCase();var f=function(o){o=o||window.event;if(e.disable_in_input){var l;if(o.target){l=o.target}else{if(o.srcElement){l=o.srcElement}}if(l.nodeType==3){l=l.parentNode}if(l.tagName=="INPUT"||l.tagName=="TEXTAREA"){return}}if(o.keyCode){code=o.keyCode}else{if(o.which){code=o.which}}var n=String.fromCharCode(code).toLowerCase();if(code==188){n=","}if(code==190){n="."}var t=c.split("+");var s=0;var q={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};var m={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var r={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(o.ctrlKey){r.ctrl.pressed=true}if(o.shiftKey){r.shift.pressed=true}if(o.altKey){r.alt.pressed=true}if(o.metaKey){r.meta.pressed=true}for(var j=0;k=t[j],j<t.length;j++){if(k=="ctrl"||k=="control"){s++;r.ctrl.wanted=true}else{if(k=="shift"){s++;r.shift.wanted=true}else{if(k=="alt"){s++;r.alt.wanted=true}else{if(k=="meta"){s++;r.meta.wanted=true}else{if(k.length>1){if(m[k]==code){s++}}else{if(e.keycode){if(e.keycode==code){s++}}else{if(n==k){s++}else{if(q[n]&&o.shiftKey){n=q[n];if(n==k){s++}}}}}}}}}}if(s==t.length&&r.ctrl.pressed==r.ctrl.wanted&&r.shift.pressed==r.shift.wanted&&r.alt.pressed==r.alt.wanted&&r.meta.pressed==r.meta.wanted){i(o);if(!e.propagate){o.cancelBubble=true;o.returnValue=false;if(o.stopPropagation){o.stopPropagation();o.preventDefault()}return false}}};this.all_shortcuts[c]={callback:f,target:g,event:e.type};if(g.addEventListener){g.addEventListener(e.type,f,false)}else{if(g.attachEvent){g.attachEvent("on"+e.type,f)}else{g["on"+e.type]=f}}},remove:function(b){b=b.toLowerCase();var e=this.all_shortcuts[b];delete (this.all_shortcuts[b]);if(!e){return}var c=e.event;var d=e.target;var f=e.callback;if(d.detachEvent){d.detachEvent("on"+c,f)}else{if(d.removeEventListener){d.removeEventListener(c,f,false)}else{d["on"+c]=false}}}}(function(e){e.fn.tabby=function(g){var h=e.extend({},e.fn.tabby.defaults,g);var i=e.fn.tabby.pressed;return this.each(function(){$this=e(this);var j=e.meta?e.extend({},h,$this.data()):h;$this.bind("keydown",function(m){var l=e.fn.tabby.catch_kc(m);if(16==l){i.shft=true}if(17==l){i.ctrl=true;setTimeout("$.fn.tabby.pressed.ctrl = false;",1000)}if(18==l){i.alt=true;setTimeout("$.fn.tabby.pressed.alt = false;",1000)}if(9==l&&!i.ctrl&&!i.alt){m.preventDefault;i.last=l;setTimeout("$.fn.tabby.pressed.last = null;",0);f(e(m.target).get(0),i.shft,j);return false}}).bind("keyup",function(l){if(16==e.fn.tabby.catch_kc(l)){i.shft=false}}).bind("blur",function(l){if(9==i.last){e(l.target).one("focus",function(m){i.last=null}).get(0).focus()}})})};e.fn.tabby.catch_kc=function(g){return g.keyCode?g.keyCode:g.charCode?g.charCode:g.which};e.fn.tabby.pressed={shft:false,ctrl:false,alt:false,last:null};function c(g){if(window.console&&window.console.log){window.console.log("textarea count: "+g.size())}}function f(j,i,h){var g=j.scrollTop;if(j.setSelectionRange){b(j,i,h)}else{if(document.selection){d(j,i,h)}}j.scrollTop=g}e.fn.tabby.defaults={tabString:String.fromCharCode(9)};function b(l,g,x){var w=l.selectionStart;var u=l.selectionEnd;if(w==u){if(g){if("\t"==l.value.substring(w-x.tabString.length,w)){l.value=l.value.substring(0,w-x.tabString.length)+l.value.substring(w);l.focus();l.setSelectionRange(w-x.tabString.length,w-x.tabString.length)}else{if("\t"==l.value.substring(w,w+x.tabString.length)){l.value=l.value.substring(0,w)+l.value.substring(w+x.tabString.length);l.focus();l.setSelectionRange(w,w)}}}else{l.value=l.value.substring(0,w)+x.tabString+l.value.substring(w);l.focus();l.setSelectionRange(w+x.tabString.length,w+x.tabString.length)}}else{var y=l.value.split("\n");var v=new Array();var n=0;var j=0;var h=false;for(var r in y){j=n+y[r].length;v.push({start:n,end:j,selected:(n<=w&&j>w)||(j>=u&&n<u)||(n>w&&j<u)});n=j+1}var m=0;for(var r in v){if(v[r].selected){var t=v[r].start+m;if(g&&x.tabString==l.value.substring(t,t+x.tabString.length)){l.value=l.value.substring(0,t)+l.value.substring(t+x.tabString.length);m-=x.tabString.length}else{if(!g){l.value=l.value.substring(0,t)+x.tabString+l.value.substring(t);m+=x.tabString.length}}}}l.focus();var s=w+((m>0)?x.tabString.length:(m<0)?-x.tabString.length:0);var q=u+m;l.setSelectionRange(s,q)}}function d(t,z,g){var s=document.selection.createRange();if(t==s.parentElement()){if(""==s.text){if(z){var n=s.getBookmark();s.moveStart("character",-g.tabString.length);if(g.tabString==s.text){s.text=""}else{s.moveToBookmark(n);s.moveEnd("character",g.tabString.length);if(g.tabString==s.text){s.text=""}}s.collapse(true);s.select()}else{s.text=g.tabString;s.collapse(false);s.select()}}else{var m=s.text;var r=m.length;var x=m.split("\r\n");var C=document.body.createTextRange();C.moveToElementText(t);C.setEndPoint("EndToStart",s);var q=C.text;var A=q.split("\r\n");var u=q.length;var B=document.body.createTextRange();B.moveToElementText(t);B.setEndPoint("StartToEnd",s);var y=B.text;var h=document.body.createTextRange();h.moveToElementText(t);h.setEndPoint("StartToEnd",C);var v=h.text;var j=e(t).html();e("#r3").text(u+" + "+r+" + "+y.length+" = "+j.length);if((u+v.length)<j.length){A.push("");u+=2;if(z&&g.tabString==x[0].substring(0,g.tabString.length)){x[0]=x[0].substring(g.tabString.length)}else{if(!z){x[0]=g.tabString+x[0]}}}else{if(z&&g.tabString==A[A.length-1].substring(0,g.tabString.length)){A[A.length-1]=A[A.length-1].substring(g.tabString.length)}else{if(!z){A[A.length-1]=g.tabString+A[A.length-1]}}}for(var w=1;w<x.length;w++){if(z&&g.tabString==x[w].substring(0,g.tabString.length)){x[w]=x[w].substring(g.tabString.length)}else{if(!z){x[w]=g.tabString+x[w]}}}if(1==A.length&&0==u){if(z&&g.tabString==x[0].substring(0,g.tabString.length)){x[0]=x[0].substring(g.tabString.length)}else{if(!z){x[0]=g.tabString+x[0]}}}if((u+r+y.length)<j.length){x.push("");r+=2}C.text=A.join("\r\n");s.text=x.join("\r\n");var l=document.body.createTextRange();l.moveToElementText(t);if(0<u){l.setEndPoint("StartToEnd",C)}else{l.setEndPoint("StartToStart",C)}l.setEndPoint("EndToEnd",s);l.select()}}}})(jQuery);(function(L){var e=L.Markdown=function e(S){switch(typeof S){case"undefined":this.dialect=e.dialects.Gruber;break;case"object":this.dialect=S;break;default:if(S in e.dialects){this.dialect=e.dialects[S]}else{throw new Error("Unknown Markdown dialect '"+String(S)+"'")}break}this.em_state=[];this.strong_state=[];this.debug_indent=""};L.parse=function(U,S){var T=new e(S);return T.toTree(U)};L.toHTML=function v(V,U,T){var S=L.toHTMLTree(V,U,T);return L.renderJsonML(S)};L.toHTMLTree=function x(T,X,V){if(typeof T==="string"){T=this.parse(T,X)}var U=D(T),S={};if(U&&U.references){S=U.references}var W=i(T,S,V);r(W);return W};function f(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function I(){var S=require("util");return"Markdown.mk_block( "+S.inspect(this.toString())+", "+S.inspect(this.trailing)+", "+S.inspect(this.lineNumber)+" )"}var g=e.mk_block=function(V,T,S){if(arguments.length==1){T="\n\n"}var U=new String(V);U.trailing=T;U.inspect=I;U.toSource=f;if(S!=undefined){U.lineNumber=S}return U};function H(T){var U=0,S=-1;while((S=T.indexOf("\n",S+1))!==-1){U++}return U}e.prototype.split_blocks=function A(U,X){var V=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,W=[],S;var T=1;if((S=/^(\s*\n)/.exec(U))!=null){T+=H(S[0]);V.lastIndex=S[0].length}while((S=V.exec(U))!==null){W.push(g(S[1],S[2],T));T+=H(S[0])}return W};e.prototype.processBlock=function N(X,W){var T=this.dialect.block,S=T.__order__;if("__call__" in T){return T.__call__.call(this,X,W)}for(var V=0;V<S.length;V++){var U=T[S[V]].call(this,X,W);if(U){if(!B(U)||(U.length>0&&!(B(U[0])))){this.debug(S[V],"didn't return a proper array")}return U}}return[]};e.prototype.processInline=function h(S){return this.dialect.inline.__call__.call(this,String(S))};e.prototype.toTree=function J(U,T){var V=U instanceof Array?U:this.split_blocks(U);var W=this.tree;try{this.tree=T||this.tree||["markdown"];V:while(V.length){var S=this.processBlock(V.shift(),V);if(!S.length){continue V}this.tree.push.apply(this.tree,S)}return this.tree}finally{if(T){this.tree=W}}};e.prototype.debug=function(){var S=Array.prototype.slice.call(arguments);S.unshift(this.debug_indent);if(typeof print!=="undefined"){print.apply(print,S)}if(typeof console!=="undefined"&&typeof console.log!=="undefined"){console.log.apply(null,S)}};e.prototype.loop_re_over_block=function(V,W,U){var T,S=W.valueOf();while(S.length&&(T=V.exec(S))!=null){S=S.substr(T[0].length);U.call(this,T)}return S};e.dialects={};e.dialects.Gruber={block:{atxHeader:function t(U,T){var S=U.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!S){return undefined}var V=["header",{level:S[1].length}];Array.prototype.push.apply(V,this.processInline(S[2]));if(S[0].length<U.length){T.unshift(g(U.substr(S[0].length),U.trailing,U.lineNumber+2))}return[V]},setextHeader:function y(U,T){var S=U.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!S){return undefined}var W=(S[2]==="=")?1:2;var V=["header",{level:W},S[1]];if(S[0].length<U.length){T.unshift(g(U.substr(S[0].length),U.trailing,U.lineNumber+2))}return[V]},code:function m(X,W){var U=[],V=/^(?: {0,3}\t| {4})(.*)\n?/,T;if(!X.match(V)){return undefined}block_search:do{var S=this.loop_re_over_block(V,X.valueOf(),function(Y){U.push(Y[1])});if(S.length){W.unshift(g(S,X.trailing));break block_search}else{if(W.length){if(!W[0].match(V)){break block_search}U.push(X.trailing.replace(/[^\n]/g,"").substring(2));X=W.shift()}else{break block_search}}}while(true);return[["code_block",U.join("\n")]]},horizRule:function Q(U,T){var S=U.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!S){return undefined}var V=[["hr"]];if(S[1]){V.unshift.apply(V,this.processBlock(S[1],[]))}if(S[3]){T.unshift(g(S[3]))}return V},lists:(function(){var V="[*+-]|\\d+\\.",T=/[*+-]/,ab=/\d+\./,Z=new RegExp("^( {0,3})("+V+")[ \t]+"),U="(?: {0,3}\\t| {4})";function W(ac){return new RegExp("(?:^("+U+"{0,"+ac+"} {0,3})("+V+")\\s+)|(^"+U+"{0,"+(ac-1)+"}[ ]{0,4})")}function S(ac){return ac.replace(/ {0,3}\t/g,"    ")}function aa(ad,aj,ai,ae){if(aj){ad.push(["para"].concat(ai));return}var ac=ad[ad.length-1] instanceof Array&&ad[ad.length-1][0]=="para"?ad[ad.length-1]:ad;if(ae&&ad.length>1){ai.unshift(ae)}for(var ag=0;ag<ai.length;ag++){var ah=ai[ag],af=typeof ah=="string";if(af&&ac.length>1&&typeof ac[ac.length-1]=="string"){ac[ac.length-1]+=ah}else{ac.push(ah)}}}function X(ai,ah){var ag=new RegExp("^("+U+"{"+ai+"}.*?\\n?)*$"),af=new RegExp("^"+U+"{"+ai+"}","gm"),ae=[];while(ah.length>0){if(ag.exec(ah[0])){var ad=ah.shift(),ac=ad.replace(af,"");ae.push(g(ac,ad.trailing,ad.lineNumber))}break}return ae}function Y(af,ae,ac){var ah=af.list;var ag=ah[ah.length-1];if(ag[1] instanceof Array&&ag[1][0]=="para"){return}if(ae+1==ac.length){ag.push(["para"].concat(ag.splice(1)))}else{var ad=ag.pop();ag.push(["para"].concat(ag.splice(1)),ad)}}return function(ah,an){var ao=ah.match(Z);if(!ao){return undefined}function af(ay){var az=T.exec(ay[2])?["bulletlist"]:["numberlist"];ag.push({list:az,indent:ay[1]});return az}var ag=[],at=af(ao),ae,am=false,ax=[ag[0].list],aq;loose_search:while(true){var ac=ah.split(/(?=\n)/);var au="";tight_search:for(var av=0;av<ac.length;av++){var ad="",ap=ac[av].replace(/^\n/,function(ay){ad=ay;return""});var ak=W(ag.length);ao=ap.match(ak);if(ao[1]!==undefined){if(au.length){aa(ae,am,this.processInline(au),ad);am=false;au=""}ao[1]=S(ao[1]);var ai=Math.floor(ao[1].length/4)+1;if(ai>ag.length){at=af(ao);ae.push(at);ae=at[1]=["listitem"]}else{var al=false;for(aq=0;aq<ag.length;aq++){if(ag[aq].indent!=ao[1]){continue}at=ag[aq].list;ag.splice(aq+1);al=true;break}if(!al){ai++;if(ai<=ag.length){ag.splice(ai);at=ag[ai-1].list}else{at=af(ao);ae.push(at)}}ae=["listitem"];at.push(ae)}ad=""}if(ap.length>ao[0].length){au+=ad+ap.substr(ao[0].length)}}if(au.length){aa(ae,am,this.processInline(au),ad);am=false;au=""}var ar=X(ag.length,an);if(ar.length>0){c(ag,Y,this);ae.push.apply(ae,this.toTree(ar,[]))}var aj=an[0]&&an[0].valueOf()||"";if(aj.match(Z)||aj.match(/^ /)){ah=an.shift();var aw=this.dialect.block.horizRule(ah,an);if(aw){ax.push.apply(ax,aw);break}c(ag,Y,this);am=true;continue loose_search}break}return ax}})(),blockquote:function M(X,V){if(!X.match(/^>/m)){return undefined}var Z=[];if(X[0]!=">"){var T=X.split(/\n/),W=[];while(T.length&&T[0][0]!=">"){W.push(T.shift())}X=T.join("\n");Z.push.apply(Z,this.processBlock(W.join("\n"),[]))}while(V.length&&V[0][0]==">"){var S=V.shift();X=new String(X+X.trailing+S);X.trailing=S.trailing}var U=X.replace(/^> ?/gm,""),Y=this.tree;Z.push(this.toTree(U,["blockquote"]));return Z},referenceDefn:function K(W,V){var U=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!W.match(U)){return undefined}if(!D(this.tree)){this.tree.splice(1,0,{})}var T=D(this.tree);if(T.references===undefined){T.references={}}var S=this.loop_re_over_block(U,W,function(X){if(X[2]&&X[2][0]=="<"&&X[2][X[2].length-1]==">"){X[2]=X[2].substring(1,X[2].length-1)}var Y=T.references[X[1].toLowerCase()]={href:X[2]};if(X[4]!==undefined){Y.title=X[4]}else{if(X[5]!==undefined){Y.title=X[5]}}});if(S.length){V.unshift(g(S,W.trailing))}return[]},para:function E(T,S){return[["para"].concat(this.processInline(T))]}}};e.dialects.Gruber.inline={__oneElement__:function d(X,T,W){var S,U,Y=0;T=T||this.dialect.inline.__patterns__;var V=new RegExp("([\\s\\S]*?)("+(T.source||T)+")");S=V.exec(X);if(!S){return[X.length,X]}else{if(S[1]){return[S[1].length,S[1]]}}var U;if(S[2] in this.dialect.inline){U=this.dialect.inline[S[2]].call(this,X.substr(S.index),S,W||[])}U=U||[S[2].length,S[2]];return U},__call__:function s(W,U){var S=[],T;function V(X){if(typeof X=="string"&&typeof S[S.length-1]=="string"){S[S.length-1]+=X}else{S.push(X)}}while(W.length>0){T=this.dialect.inline.__oneElement__.call(this,W,U,S);W=W.substr(T.shift());c(T,V)}return S},"]":function(){},"}":function(){},"\\":function u(S){if(S.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)){return[2,S[1]]}else{return[1,"\\"]}},"![":function n(U){var S=U.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(S){if(S[2]&&S[2][0]=="<"&&S[2][S[2].length-1]==">"){S[2]=S[2].substring(1,S[2].length-1)}S[2]=this.dialect.inline.__call__.call(this,S[2],/\\/)[0];var T={alt:S[1],href:S[2]||""};if(S[4]!==undefined){T.title=S[4]}return[S[0].length,["img",T]]}S=U.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/);if(S){return[S[0].length,["img_ref",{alt:S[1],ref:S[2].toLowerCase(),original:S[0]}]]}return[2,"!["]},"[":function o(ac){var Z=String(ac);var X=e.DialectHelpers.inline_until_char.call(this,ac.substr(1),"]");if(!X){return[1,"["]}var aa=1+X[0],T=X[1],Y,ab;ac=ac.substr(aa);var V=ac.match(/^\s*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(V){var S=V[1];aa+=V[0].length;if(S&&S[0]=="<"&&S[S.length-1]==">"){S=S.substring(1,S.length-1)}if(!V[3]){var U=1;for(var W=0;W<S.length;W++){switch(S[W]){case"(":U++;break;case")":if(--U==0){aa-=S.length-W;S=S.substring(0,W)}break}}}S=this.dialect.inline.__call__.call(this,S,/\\/)[0];ab={href:S||""};if(V[3]!==undefined){ab.title=V[3]}Y=["link",ab].concat(T);return[aa,Y]}V=ac.match(/^\s*\[(.*?)\]/);if(V){aa+=V[0].length;ab={ref:(V[1]||String(T)).toLowerCase(),original:Z.substr(0,aa)};Y=["link_ref",ab].concat(T);return[aa,Y]}if(T.length==1&&typeof T[0]=="string"){ab={ref:T[0].toLowerCase(),original:Z.substr(0,aa)};Y=["link_ref",ab,T[0]];return[aa,Y]}return[1,"["]},"<":function w(T){var S;if((S=T.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))!=null){if(S[3]){return[S[0].length,["link",{href:"mailto:"+S[3]},S[3]]]}else{if(S[2]=="mailto"){return[S[0].length,["link",{href:S[1]},S[1].substr("mailto:".length)]]}else{return[S[0].length,["link",{href:S[1]},S[1]]]}}}return[1,"<"]},"`":function z(T){var S=T.match(/(`+)(([\s\S]*?)\1)/);if(S&&S[2]){return[S[1].length+S[2].length,["inlinecode",S[3]]]}else{return[1,"`"]}},"  \n":function P(S){return[3,["linebreak"]]}};function G(S,V){var U=S+"_state",W=S=="strong"?"em_state":"strong_state";function T(X){this.len_after=X;this.name="close_"+V}return function(ae,ad){if(this[U][0]==V){this[U].shift();return[ae.length,new T(ae.length-V.length)]}else{var X=this[W].slice(),ac=this[U].slice();this[U].unshift(V);var Z=this.processInline(ae.substr(V.length));var aa=Z[Z.length-1];var Y=this[U].shift();if(aa instanceof T){Z.pop();var ab=ae.length-aa.len_after;return[ab,[S].concat(Z)]}else{this[W]=X;this[U]=ac;return[V.length,V]}}}}e.dialects.Gruber.inline["**"]=G("strong","**");e.dialects.Gruber.inline.__=G("strong","__");e.dialects.Gruber.inline["*"]=G("em","*");e.dialects.Gruber.inline._=G("em","_");e.buildBlockOrder=function(U){var S=[];for(var T in U){if(T=="__order__"||T=="__call__"){continue}S.push(T)}U.__order__=S};e.buildInlinePatterns=function(W){var V=[];for(var T in W){if(T.match(/^__.*__$/)){continue}var S=T.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");V.push(T.length==1?S:"(?:"+S+")")}V=V.join("|");W.__patterns__=V;var U=W.__call__;W.__call__=function(Y,X){if(X!=undefined){return U.call(this,Y,X)}else{return U.call(this,Y,V)}}};e.DialectHelpers={};e.DialectHelpers.inline_until_char=function(W,V){var U=0,S=[];while(true){if(W[U]==V){U++;return[U,S]}if(U>=W.length){return null}var T=this.dialect.inline.__oneElement__.call(this,W.substr(U));U+=T[0];S.push.apply(S,T.slice(1))}};e.subclassDialect=function(U){function S(){}S.prototype=U.block;function T(){}T.prototype=U.inline;return{block:new S(),inline:new T()}};e.buildBlockOrder(e.dialects.Gruber.block);e.buildInlinePatterns(e.dialects.Gruber.inline);e.dialects.Maruku=e.subclassDialect(e.dialects.Gruber);e.dialects.Maruku.processMetaHash=function l(V){var W=q(V),S={};for(var T=0;T<W.length;++T){if(/^#/.test(W[T])){S.id=W[T].substring(1)}else{if(/^\./.test(W[T])){if(S["class"]){S["class"]=S["class"]+W[T].replace(/./," ")}else{S["class"]=W[T].substring(1)}}else{if(/\=/.test(W[T])){var U=W[T].split(/\=/);S[U[0]]=U[1]}}}}return S};function q(U){var W=U.split(""),V=[""],S=false;while(W.length){var T=W.shift();switch(T){case" ":if(S){V[V.length-1]+=T}else{V.push("")}break;case"'":case'"':S=!S;break;case"\\":T=W.shift();default:V[V.length-1]+=T;break}}return V}e.dialects.Maruku.block.document_meta=function j(X,U){if(X.lineNumber>1){return undefined}if(!X.match(/^(?:\w+:.*\n)*\w+:.*$/)){return undefined}if(!D(this.tree)){this.tree.splice(1,0,{})}var W=X.split(/\n/);for(p in W){var S=W[p].match(/(\w+):\s*(.*)$/),T=S[1].toLowerCase(),V=S[2];this.tree[1][T]=V}return[]};e.dialects.Maruku.block.block_meta=function F(Z,W){var V=Z.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!V){return undefined}var U=this.dialect.processMetaHash(V[2]);var Y;if(V[1]===""){var X=this.tree[this.tree.length-1];Y=D(X);if(typeof X==="string"){return undefined}if(!Y){Y={};X.splice(1,0,Y)}for(a in U){Y[a]=U[a]}return[]}var T=Z.replace(/\n.*$/,""),S=this.processBlock(T,[]);Y=D(S[0]);if(!Y){Y={};S[0].splice(1,0,Y)}for(a in U){Y[a]=U[a]}return S};e.dialects.Maruku.block.definition_list=function O(U,X){var Z=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,Y=["dl"],W;if((T=U.match(Z))){var S=[U];while(X.length&&Z.exec(X[0])){S.push(X.shift())}for(var aa=0;aa<S.length;++aa){var T=S[aa].match(Z),V=T[1].replace(/\n$/,"").split(/\n/),ab=T[2].split(/\n:\s+/);for(W=0;W<V.length;++W){Y.push(["dt",V[W]])}for(W=0;W<ab.length;++W){Y.push(["dd"].concat(this.processInline(ab[W].replace(/(\n)\s+/,"$1"))))}}}else{return undefined}return[Y]};e.dialects.Maruku.inline["{:"]=function C(Z,X,V){if(!V.length){return[2,"{:"]}var W=V[V.length-1];if(typeof W==="string"){return[2,"{:"]}var T=Z.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!T){return[2,"{:"]}var Y=this.dialect.processMetaHash(T[1]),S=D(W);if(!S){S={};W.splice(1,0,S)}for(var U in Y){S[U]=Y[U]}return[T[0].length,""]};e.buildBlockOrder(e.dialects.Maruku.block);e.buildInlinePatterns(e.dialects.Maruku.inline);var B=Array.isArray||function(S){return Object.prototype.toString.call(S)=="[object Array]"};var c;if(Array.prototype.forEach){c=function(T,S,U){return T.forEach(S,U)}}else{c=function(T,S,V){for(var U=0;U<T.length;U++){S.call(V||T,T[U],U,T)}}}function D(S){return B(S)&&S.length>1&&typeof S[1]==="object"&&!(B(S[1]))?S[1]:undefined}L.renderJsonML=function(U,S){S=S||{};S.root=S.root||false;var T=[];if(S.root){T.push(R(U))}else{U.shift();if(U.length&&typeof U[0]==="object"&&!(U[0] instanceof Array)){U.shift()}while(U.length){T.push(R(U.shift()))}}return T.join("\n\n")};function b(S){return S.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function R(X){if(typeof X==="string"){return b(X)}var S=X.shift(),U={},V=[];if(X.length&&typeof X[0]==="object"&&!(X[0] instanceof Array)){U=X.shift()}while(X.length){V.push(arguments.callee(X.shift()))}var W="";for(var T in U){W+=" "+T+'="'+b(U[T])+'"'}if(S=="img"||S=="br"||S=="hr"){return"<"+S+W+"/>"}else{return"<"+S+W+">"+V.join("")+"</"+S+">"}}function i(aa,X,Z){var U;Z=Z||{};var W=aa.slice(0);if(typeof Z.preprocessTreeNode==="function"){W=Z.preprocessTreeNode(W,X)}var Y=D(W);if(Y){W[1]={};for(U in Y){W[1][U]=Y[U]}Y=W[1]}if(typeof W==="string"){return W}switch(W[0]){case"header":W[0]="h"+W[1].level;delete W[1].level;break;case"bulletlist":W[0]="ul";break;case"numberlist":W[0]="ol";break;case"listitem":W[0]="li";break;case"para":W[0]="p";break;case"markdown":W[0]="html";if(Y){delete Y.references}break;case"code_block":W[0]="pre";U=Y?2:1;var S=["code"];S.push.apply(S,W.splice(U));W[U]=S;break;case"inlinecode":W[0]="code";break;case"img":W[1].src=W[1].href;delete W[1].href;break;case"linebreak":W[0]="br";break;case"link":W[0]="a";break;case"link_ref":W[0]="a";var T=X[Y.ref];if(T){delete Y.ref;Y.href=T.href;if(T.title){Y.title=T.title}delete Y.original}else{return Y.original}break;case"img_ref":W[0]="img";var T=X[Y.ref];if(T){delete Y.ref;Y.src=T.href;if(T.title){Y.title=T.title}delete Y.original}else{return Y.original}break}U=1;if(Y){for(var V in W[1]){U=2}if(U===1){W.splice(U,1)}}for(;U<W.length;++U){W[U]=arguments.callee(W[U],X,Z)}return W}function r(T){var S=D(T)?2:1;while(S<T.length){if(typeof T[S]==="string"){if(S+1<T.length&&typeof T[S+1]==="string"){T[S]+=T.splice(S+1,1)[0]}else{++S}}else{arguments.callee(T[S]);++S}}}})((function(){if(typeof exports==="undefined"){window.markdown={};return window.markdown}else{return exports}})());shortcut={all_shortcuts:{},add:function(c,i,e){var h={type:"keydown",propagate:false,disable_in_input:false,target:document,keycode:false};if(!e){e=h}else{for(var b in h){if(typeof e[b]=="undefined"){e[b]=h[b]}}}var g=e.target;if(typeof e.target=="string"){g=document.getElementById(e.target)}var d=this;c=c.toLowerCase();var f=function(o){o=o||window.event;if(e.disable_in_input){var l;if(o.target){l=o.target}else{if(o.srcElement){l=o.srcElement}}if(l.nodeType==3){l=l.parentNode}if(l.tagName=="INPUT"||l.tagName=="TEXTAREA"){return}}if(o.keyCode){code=o.keyCode}else{if(o.which){code=o.which}}var n=String.fromCharCode(code).toLowerCase();if(code==188){n=","}if(code==190){n="."}var t=c.split("+");var s=0;var q={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};var m={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var r={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(o.ctrlKey){r.ctrl.pressed=true}if(o.shiftKey){r.shift.pressed=true}if(o.altKey){r.alt.pressed=true}if(o.metaKey){r.meta.pressed=true}for(var j=0;k=t[j],j<t.length;j++){if(k=="ctrl"||k=="control"){s++;r.ctrl.wanted=true}else{if(k=="shift"){s++;r.shift.wanted=true}else{if(k=="alt"){s++;r.alt.wanted=true}else{if(k=="meta"){s++;r.meta.wanted=true}else{if(k.length>1){if(m[k]==code){s++}}else{if(e.keycode){if(e.keycode==code){s++}}else{if(n==k){s++}else{if(q[n]&&o.shiftKey){n=q[n];if(n==k){s++}}}}}}}}}}if(s==t.length&&r.ctrl.pressed==r.ctrl.wanted&&r.shift.pressed==r.shift.wanted&&r.alt.pressed==r.alt.wanted&&r.meta.pressed==r.meta.wanted){i(o);if(!e.propagate){o.cancelBubble=true;o.returnValue=false;if(o.stopPropagation){o.stopPropagation();o.preventDefault()}return false}}};this.all_shortcuts[c]={callback:f,target:g,event:e.type};if(g.addEventListener){g.addEventListener(e.type,f,false)}else{if(g.attachEvent){g.attachEvent("on"+e.type,f)}else{g["on"+e.type]=f}}},remove:function(b){b=b.toLowerCase();var e=this.all_shortcuts[b];delete (this.all_shortcuts[b]);if(!e){return}var c=e.event;var d=e.target;var f=e.callback;if(d.detachEvent){d.detachEvent("on"+c,f)}else{if(d.removeEventListener){d.removeEventListener(c,f,false)}else{d["on"+c]=false}}}};
